var Fg=v=>{throw TypeError(v)};var Ng=(v,w,z)=>w.has(v)||Fg("Cannot "+z);var Bd=(v,w,z)=>(Ng(v,w,"read from private field"),z?z.call(v):w.get(v)),Um=(v,w,z)=>w.has(v)?Fg("Cannot add the same private member more than once"):w instanceof WeakSet?w.add(v):w.set(v,z),Vm=(v,w,z,E)=>(Ng(v,w,"write to private field"),E?E.call(v,z):w.set(v,z),z);(function(){const w=document.createElement("link").relList;if(w&&w.supports&&w.supports("modulepreload"))return;for(const L of document.querySelectorAll('link[rel="modulepreload"]'))E(L);new MutationObserver(L=>{for(const F of L)if(F.type==="childList")for(const A of F.addedNodes)A.tagName==="LINK"&&A.rel==="modulepreload"&&E(A)}).observe(document,{childList:!0,subtree:!0});function z(L){const F={};return L.integrity&&(F.integrity=L.integrity),L.referrerPolicy&&(F.referrerPolicy=L.referrerPolicy),L.crossOrigin==="use-credentials"?F.credentials="include":L.crossOrigin==="anonymous"?F.credentials="omit":F.credentials="same-origin",F}function E(L){if(L.ep)return;L.ep=!0;const F=z(L);fetch(L.href,F)}})();function E_(v){return v&&v.__esModule&&Object.prototype.hasOwnProperty.call(v,"default")?v.default:v}var Gm={exports:{}},ap={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jg;function Ny(){if(jg)return ap;jg=1;var v=Symbol.for("react.transitional.element"),w=Symbol.for("react.fragment");function z(E,L,F){var A=null;if(F!==void 0&&(A=""+F),L.key!==void 0&&(A=""+L.key),"key"in L){F={};for(var c in L)c!=="key"&&(F[c]=L[c])}else F=L;return L=F.ref,{$$typeof:v,type:E,key:A,ref:L!==void 0?L:null,props:F}}return ap.Fragment=w,ap.jsx=z,ap.jsxs=z,ap}var Ug;function jy(){return Ug||(Ug=1,Gm.exports=Ny()),Gm.exports}var Et=jy(),qm={exports:{}},fi={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vg;function Uy(){if(Vg)return fi;Vg=1;var v=Symbol.for("react.transitional.element"),w=Symbol.for("react.portal"),z=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),L=Symbol.for("react.profiler"),F=Symbol.for("react.consumer"),A=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),J=Symbol.for("react.suspense"),X=Symbol.for("react.memo"),re=Symbol.for("react.lazy"),Te=Symbol.iterator;function xe(be){return be===null||typeof be!="object"?null:(be=Te&&be[Te]||be["@@iterator"],typeof be=="function"?be:null)}var de={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ee=Object.assign,We={};function Ve(be,Qe,lt){this.props=be,this.context=Qe,this.refs=We,this.updater=lt||de}Ve.prototype.isReactComponent={},Ve.prototype.setState=function(be,Qe){if(typeof be!="object"&&typeof be!="function"&&be!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,be,Qe,"setState")},Ve.prototype.forceUpdate=function(be){this.updater.enqueueForceUpdate(this,be,"forceUpdate")};function et(){}et.prototype=Ve.prototype;function ft(be,Qe,lt){this.props=be,this.context=Qe,this.refs=We,this.updater=lt||de}var Tt=ft.prototype=new et;Tt.constructor=ft,Ee(Tt,Ve.prototype),Tt.isPureReactComponent=!0;var Ot=Array.isArray,pt={H:null,A:null,T:null,S:null,V:null},Ut=Object.prototype.hasOwnProperty;function oi(be,Qe,lt,gt,Ct,li){return lt=li.ref,{$$typeof:v,type:be,key:Qe,ref:lt!==void 0?lt:null,props:li}}function Di(be,Qe){return oi(be.type,Qe,void 0,void 0,void 0,be.props)}function Mi(be){return typeof be=="object"&&be!==null&&be.$$typeof===v}function Jt(be){var Qe={"=":"=0",":":"=2"};return"$"+be.replace(/[=:]/g,function(lt){return Qe[lt]})}var wi=/\/+/g;function en(be,Qe){return typeof be=="object"&&be!==null&&be.key!=null?Jt(""+be.key):Qe.toString(36)}function bn(){}function Yn(be){switch(be.status){case"fulfilled":return be.value;case"rejected":throw be.reason;default:switch(typeof be.status=="string"?be.then(bn,bn):(be.status="pending",be.then(function(Qe){be.status==="pending"&&(be.status="fulfilled",be.value=Qe)},function(Qe){be.status==="pending"&&(be.status="rejected",be.reason=Qe)})),be.status){case"fulfilled":return be.value;case"rejected":throw be.reason}}throw be}function Ei(be,Qe,lt,gt,Ct){var li=typeof be;(li==="undefined"||li==="boolean")&&(be=null);var Vt=!1;if(be===null)Vt=!0;else switch(li){case"bigint":case"string":case"number":Vt=!0;break;case"object":switch(be.$$typeof){case v:case w:Vt=!0;break;case re:return Vt=be._init,Ei(Vt(be._payload),Qe,lt,gt,Ct)}}if(Vt)return Ct=Ct(be),Vt=gt===""?"."+en(be,0):gt,Ot(Ct)?(lt="",Vt!=null&&(lt=Vt.replace(wi,"$&/")+"/"),Ei(Ct,Qe,lt,"",function(Hi){return Hi})):Ct!=null&&(Mi(Ct)&&(Ct=Di(Ct,lt+(Ct.key==null||be&&be.key===Ct.key?"":(""+Ct.key).replace(wi,"$&/")+"/")+Vt)),Qe.push(Ct)),1;Vt=0;var Kn=gt===""?".":gt+":";if(Ot(be))for(var Fi=0;Fi<be.length;Fi++)gt=be[Fi],li=Kn+en(gt,Fi),Vt+=Ei(gt,Qe,lt,li,Ct);else if(Fi=xe(be),typeof Fi=="function")for(be=Fi.call(be),Fi=0;!(gt=be.next()).done;)gt=gt.value,li=Kn+en(gt,Fi++),Vt+=Ei(gt,Qe,lt,li,Ct);else if(li==="object"){if(typeof be.then=="function")return Ei(Yn(be),Qe,lt,gt,Ct);throw Qe=String(be),Error("Objects are not valid as a React child (found: "+(Qe==="[object Object]"?"object with keys {"+Object.keys(be).join(", ")+"}":Qe)+"). If you meant to render a collection of children, use an array instead.")}return Vt}function Ke(be,Qe,lt){if(be==null)return be;var gt=[],Ct=0;return Ei(be,gt,"","",function(li){return Qe.call(lt,li,Ct++)}),gt}function yt(be){if(be._status===-1){var Qe=be._result;Qe=Qe(),Qe.then(function(lt){(be._status===0||be._status===-1)&&(be._status=1,be._result=lt)},function(lt){(be._status===0||be._status===-1)&&(be._status=2,be._result=lt)}),be._status===-1&&(be._status=0,be._result=Qe)}if(be._status===1)return be._result.default;throw be._result}var It=typeof reportError=="function"?reportError:function(be){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Qe=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof be=="object"&&be!==null&&typeof be.message=="string"?String(be.message):String(be),error:be});if(!window.dispatchEvent(Qe))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",be);return}console.error(be)};function mi(){}return fi.Children={map:Ke,forEach:function(be,Qe,lt){Ke(be,function(){Qe.apply(this,arguments)},lt)},count:function(be){var Qe=0;return Ke(be,function(){Qe++}),Qe},toArray:function(be){return Ke(be,function(Qe){return Qe})||[]},only:function(be){if(!Mi(be))throw Error("React.Children.only expected to receive a single React element child.");return be}},fi.Component=Ve,fi.Fragment=z,fi.Profiler=L,fi.PureComponent=ft,fi.StrictMode=E,fi.Suspense=J,fi.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=pt,fi.__COMPILER_RUNTIME={__proto__:null,c:function(be){return pt.H.useMemoCache(be)}},fi.cache=function(be){return function(){return be.apply(null,arguments)}},fi.cloneElement=function(be,Qe,lt){if(be==null)throw Error("The argument must be a React element, but you passed "+be+".");var gt=Ee({},be.props),Ct=be.key,li=void 0;if(Qe!=null)for(Vt in Qe.ref!==void 0&&(li=void 0),Qe.key!==void 0&&(Ct=""+Qe.key),Qe)!Ut.call(Qe,Vt)||Vt==="key"||Vt==="__self"||Vt==="__source"||Vt==="ref"&&Qe.ref===void 0||(gt[Vt]=Qe[Vt]);var Vt=arguments.length-2;if(Vt===1)gt.children=lt;else if(1<Vt){for(var Kn=Array(Vt),Fi=0;Fi<Vt;Fi++)Kn[Fi]=arguments[Fi+2];gt.children=Kn}return oi(be.type,Ct,void 0,void 0,li,gt)},fi.createContext=function(be){return be={$$typeof:A,_currentValue:be,_currentValue2:be,_threadCount:0,Provider:null,Consumer:null},be.Provider=be,be.Consumer={$$typeof:F,_context:be},be},fi.createElement=function(be,Qe,lt){var gt,Ct={},li=null;if(Qe!=null)for(gt in Qe.key!==void 0&&(li=""+Qe.key),Qe)Ut.call(Qe,gt)&&gt!=="key"&&gt!=="__self"&&gt!=="__source"&&(Ct[gt]=Qe[gt]);var Vt=arguments.length-2;if(Vt===1)Ct.children=lt;else if(1<Vt){for(var Kn=Array(Vt),Fi=0;Fi<Vt;Fi++)Kn[Fi]=arguments[Fi+2];Ct.children=Kn}if(be&&be.defaultProps)for(gt in Vt=be.defaultProps,Vt)Ct[gt]===void 0&&(Ct[gt]=Vt[gt]);return oi(be,li,void 0,void 0,null,Ct)},fi.createRef=function(){return{current:null}},fi.forwardRef=function(be){return{$$typeof:c,render:be}},fi.isValidElement=Mi,fi.lazy=function(be){return{$$typeof:re,_payload:{_status:-1,_result:be},_init:yt}},fi.memo=function(be,Qe){return{$$typeof:X,type:be,compare:Qe===void 0?null:Qe}},fi.startTransition=function(be){var Qe=pt.T,lt={};pt.T=lt;try{var gt=be(),Ct=pt.S;Ct!==null&&Ct(lt,gt),typeof gt=="object"&&gt!==null&&typeof gt.then=="function"&&gt.then(mi,It)}catch(li){It(li)}finally{pt.T=Qe}},fi.unstable_useCacheRefresh=function(){return pt.H.useCacheRefresh()},fi.use=function(be){return pt.H.use(be)},fi.useActionState=function(be,Qe,lt){return pt.H.useActionState(be,Qe,lt)},fi.useCallback=function(be,Qe){return pt.H.useCallback(be,Qe)},fi.useContext=function(be){return pt.H.useContext(be)},fi.useDebugValue=function(){},fi.useDeferredValue=function(be,Qe){return pt.H.useDeferredValue(be,Qe)},fi.useEffect=function(be,Qe,lt){var gt=pt.H;if(typeof lt=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return gt.useEffect(be,Qe)},fi.useId=function(){return pt.H.useId()},fi.useImperativeHandle=function(be,Qe,lt){return pt.H.useImperativeHandle(be,Qe,lt)},fi.useInsertionEffect=function(be,Qe){return pt.H.useInsertionEffect(be,Qe)},fi.useLayoutEffect=function(be,Qe){return pt.H.useLayoutEffect(be,Qe)},fi.useMemo=function(be,Qe){return pt.H.useMemo(be,Qe)},fi.useOptimistic=function(be,Qe){return pt.H.useOptimistic(be,Qe)},fi.useReducer=function(be,Qe,lt){return pt.H.useReducer(be,Qe,lt)},fi.useRef=function(be){return pt.H.useRef(be)},fi.useState=function(be){return pt.H.useState(be)},fi.useSyncExternalStore=function(be,Qe,lt){return pt.H.useSyncExternalStore(be,Qe,lt)},fi.useTransition=function(){return pt.H.useTransition()},fi.version="19.1.1",fi}var Gg;function xg(){return Gg||(Gg=1,qm.exports=Uy()),qm.exports}var Ye=xg(),Zm={exports:{}},sp={},$m={exports:{}},Hm={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qg;function Vy(){return qg||(qg=1,function(v){function w(Ke,yt){var It=Ke.length;Ke.push(yt);e:for(;0<It;){var mi=It-1>>>1,be=Ke[mi];if(0<L(be,yt))Ke[mi]=yt,Ke[It]=be,It=mi;else break e}}function z(Ke){return Ke.length===0?null:Ke[0]}function E(Ke){if(Ke.length===0)return null;var yt=Ke[0],It=Ke.pop();if(It!==yt){Ke[0]=It;e:for(var mi=0,be=Ke.length,Qe=be>>>1;mi<Qe;){var lt=2*(mi+1)-1,gt=Ke[lt],Ct=lt+1,li=Ke[Ct];if(0>L(gt,It))Ct<be&&0>L(li,gt)?(Ke[mi]=li,Ke[Ct]=It,mi=Ct):(Ke[mi]=gt,Ke[lt]=It,mi=lt);else if(Ct<be&&0>L(li,It))Ke[mi]=li,Ke[Ct]=It,mi=Ct;else break e}}return yt}function L(Ke,yt){var It=Ke.sortIndex-yt.sortIndex;return It!==0?It:Ke.id-yt.id}if(v.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var F=performance;v.unstable_now=function(){return F.now()}}else{var A=Date,c=A.now();v.unstable_now=function(){return A.now()-c}}var J=[],X=[],re=1,Te=null,xe=3,de=!1,Ee=!1,We=!1,Ve=!1,et=typeof setTimeout=="function"?setTimeout:null,ft=typeof clearTimeout=="function"?clearTimeout:null,Tt=typeof setImmediate<"u"?setImmediate:null;function Ot(Ke){for(var yt=z(X);yt!==null;){if(yt.callback===null)E(X);else if(yt.startTime<=Ke)E(X),yt.sortIndex=yt.expirationTime,w(J,yt);else break;yt=z(X)}}function pt(Ke){if(We=!1,Ot(Ke),!Ee)if(z(J)!==null)Ee=!0,Ut||(Ut=!0,en());else{var yt=z(X);yt!==null&&Ei(pt,yt.startTime-Ke)}}var Ut=!1,oi=-1,Di=5,Mi=-1;function Jt(){return Ve?!0:!(v.unstable_now()-Mi<Di)}function wi(){if(Ve=!1,Ut){var Ke=v.unstable_now();Mi=Ke;var yt=!0;try{e:{Ee=!1,We&&(We=!1,ft(oi),oi=-1),de=!0;var It=xe;try{t:{for(Ot(Ke),Te=z(J);Te!==null&&!(Te.expirationTime>Ke&&Jt());){var mi=Te.callback;if(typeof mi=="function"){Te.callback=null,xe=Te.priorityLevel;var be=mi(Te.expirationTime<=Ke);if(Ke=v.unstable_now(),typeof be=="function"){Te.callback=be,Ot(Ke),yt=!0;break t}Te===z(J)&&E(J),Ot(Ke)}else E(J);Te=z(J)}if(Te!==null)yt=!0;else{var Qe=z(X);Qe!==null&&Ei(pt,Qe.startTime-Ke),yt=!1}}break e}finally{Te=null,xe=It,de=!1}yt=void 0}}finally{yt?en():Ut=!1}}}var en;if(typeof Tt=="function")en=function(){Tt(wi)};else if(typeof MessageChannel<"u"){var bn=new MessageChannel,Yn=bn.port2;bn.port1.onmessage=wi,en=function(){Yn.postMessage(null)}}else en=function(){et(wi,0)};function Ei(Ke,yt){oi=et(function(){Ke(v.unstable_now())},yt)}v.unstable_IdlePriority=5,v.unstable_ImmediatePriority=1,v.unstable_LowPriority=4,v.unstable_NormalPriority=3,v.unstable_Profiling=null,v.unstable_UserBlockingPriority=2,v.unstable_cancelCallback=function(Ke){Ke.callback=null},v.unstable_forceFrameRate=function(Ke){0>Ke||125<Ke?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Di=0<Ke?Math.floor(1e3/Ke):5},v.unstable_getCurrentPriorityLevel=function(){return xe},v.unstable_next=function(Ke){switch(xe){case 1:case 2:case 3:var yt=3;break;default:yt=xe}var It=xe;xe=yt;try{return Ke()}finally{xe=It}},v.unstable_requestPaint=function(){Ve=!0},v.unstable_runWithPriority=function(Ke,yt){switch(Ke){case 1:case 2:case 3:case 4:case 5:break;default:Ke=3}var It=xe;xe=Ke;try{return yt()}finally{xe=It}},v.unstable_scheduleCallback=function(Ke,yt,It){var mi=v.unstable_now();switch(typeof It=="object"&&It!==null?(It=It.delay,It=typeof It=="number"&&0<It?mi+It:mi):It=mi,Ke){case 1:var be=-1;break;case 2:be=250;break;case 5:be=1073741823;break;case 4:be=1e4;break;default:be=5e3}return be=It+be,Ke={id:re++,callback:yt,priorityLevel:Ke,startTime:It,expirationTime:be,sortIndex:-1},It>mi?(Ke.sortIndex=It,w(X,Ke),z(J)===null&&Ke===z(X)&&(We?(ft(oi),oi=-1):We=!0,Ei(pt,It-mi))):(Ke.sortIndex=be,w(J,Ke),Ee||de||(Ee=!0,Ut||(Ut=!0,en()))),Ke},v.unstable_shouldYield=Jt,v.unstable_wrapCallback=function(Ke){var yt=xe;return function(){var It=xe;xe=yt;try{return Ke.apply(this,arguments)}finally{xe=It}}}}(Hm)),Hm}var Zg;function Gy(){return Zg||(Zg=1,$m.exports=Vy()),$m.exports}var Xm={exports:{}},ba={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $g;function qy(){if($g)return ba;$g=1;var v=xg();function w(J){var X="https://react.dev/errors/"+J;if(1<arguments.length){X+="?args[]="+encodeURIComponent(arguments[1]);for(var re=2;re<arguments.length;re++)X+="&args[]="+encodeURIComponent(arguments[re])}return"Minified React error #"+J+"; visit "+X+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function z(){}var E={d:{f:z,r:function(){throw Error(w(522))},D:z,C:z,L:z,m:z,X:z,S:z,M:z},p:0,findDOMNode:null},L=Symbol.for("react.portal");function F(J,X,re){var Te=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:L,key:Te==null?null:""+Te,children:J,containerInfo:X,implementation:re}}var A=v.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(J,X){if(J==="font")return"";if(typeof X=="string")return X==="use-credentials"?X:""}return ba.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=E,ba.createPortal=function(J,X){var re=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!X||X.nodeType!==1&&X.nodeType!==9&&X.nodeType!==11)throw Error(w(299));return F(J,X,null,re)},ba.flushSync=function(J){var X=A.T,re=E.p;try{if(A.T=null,E.p=2,J)return J()}finally{A.T=X,E.p=re,E.d.f()}},ba.preconnect=function(J,X){typeof J=="string"&&(X?(X=X.crossOrigin,X=typeof X=="string"?X==="use-credentials"?X:"":void 0):X=null,E.d.C(J,X))},ba.prefetchDNS=function(J){typeof J=="string"&&E.d.D(J)},ba.preinit=function(J,X){if(typeof J=="string"&&X&&typeof X.as=="string"){var re=X.as,Te=c(re,X.crossOrigin),xe=typeof X.integrity=="string"?X.integrity:void 0,de=typeof X.fetchPriority=="string"?X.fetchPriority:void 0;re==="style"?E.d.S(J,typeof X.precedence=="string"?X.precedence:void 0,{crossOrigin:Te,integrity:xe,fetchPriority:de}):re==="script"&&E.d.X(J,{crossOrigin:Te,integrity:xe,fetchPriority:de,nonce:typeof X.nonce=="string"?X.nonce:void 0})}},ba.preinitModule=function(J,X){if(typeof J=="string")if(typeof X=="object"&&X!==null){if(X.as==null||X.as==="script"){var re=c(X.as,X.crossOrigin);E.d.M(J,{crossOrigin:re,integrity:typeof X.integrity=="string"?X.integrity:void 0,nonce:typeof X.nonce=="string"?X.nonce:void 0})}}else X==null&&E.d.M(J)},ba.preload=function(J,X){if(typeof J=="string"&&typeof X=="object"&&X!==null&&typeof X.as=="string"){var re=X.as,Te=c(re,X.crossOrigin);E.d.L(J,re,{crossOrigin:Te,integrity:typeof X.integrity=="string"?X.integrity:void 0,nonce:typeof X.nonce=="string"?X.nonce:void 0,type:typeof X.type=="string"?X.type:void 0,fetchPriority:typeof X.fetchPriority=="string"?X.fetchPriority:void 0,referrerPolicy:typeof X.referrerPolicy=="string"?X.referrerPolicy:void 0,imageSrcSet:typeof X.imageSrcSet=="string"?X.imageSrcSet:void 0,imageSizes:typeof X.imageSizes=="string"?X.imageSizes:void 0,media:typeof X.media=="string"?X.media:void 0})}},ba.preloadModule=function(J,X){if(typeof J=="string")if(X){var re=c(X.as,X.crossOrigin);E.d.m(J,{as:typeof X.as=="string"&&X.as!=="script"?X.as:void 0,crossOrigin:re,integrity:typeof X.integrity=="string"?X.integrity:void 0})}else E.d.m(J)},ba.requestFormReset=function(J){E.d.r(J)},ba.unstable_batchedUpdates=function(J,X){return J(X)},ba.useFormState=function(J,X,re){return A.H.useFormState(J,X,re)},ba.useFormStatus=function(){return A.H.useHostTransitionStatus()},ba.version="19.1.1",ba}var Hg;function Zy(){if(Hg)return Xm.exports;Hg=1;function v(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(v)}catch(w){console.error(w)}}return v(),Xm.exports=qy(),Xm.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xg;function $y(){if(Xg)return sp;Xg=1;var v=Gy(),w=xg(),z=Zy();function E(i){var s="https://react.dev/errors/"+i;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)s+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+i+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function L(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function F(i){var s=i,u=i;if(i.alternate)for(;s.return;)s=s.return;else{i=s;do s=i,(s.flags&4098)!==0&&(u=s.return),i=s.return;while(i)}return s.tag===3?u:null}function A(i){if(i.tag===13){var s=i.memoizedState;if(s===null&&(i=i.alternate,i!==null&&(s=i.memoizedState)),s!==null)return s.dehydrated}return null}function c(i){if(F(i)!==i)throw Error(E(188))}function J(i){var s=i.alternate;if(!s){if(s=F(i),s===null)throw Error(E(188));return s!==i?null:i}for(var u=i,p=s;;){var b=u.return;if(b===null)break;var C=b.alternate;if(C===null){if(p=b.return,p!==null){u=p;continue}break}if(b.child===C.child){for(C=b.child;C;){if(C===u)return c(b),i;if(C===p)return c(b),s;C=C.sibling}throw Error(E(188))}if(u.return!==p.return)u=b,p=C;else{for(var G=!1,K=b.child;K;){if(K===u){G=!0,u=b,p=C;break}if(K===p){G=!0,p=b,u=C;break}K=K.sibling}if(!G){for(K=C.child;K;){if(K===u){G=!0,u=C,p=b;break}if(K===p){G=!0,p=C,u=b;break}K=K.sibling}if(!G)throw Error(E(189))}}if(u.alternate!==p)throw Error(E(190))}if(u.tag!==3)throw Error(E(188));return u.stateNode.current===u?i:s}function X(i){var s=i.tag;if(s===5||s===26||s===27||s===6)return i;for(i=i.child;i!==null;){if(s=X(i),s!==null)return s;i=i.sibling}return null}var re=Object.assign,Te=Symbol.for("react.element"),xe=Symbol.for("react.transitional.element"),de=Symbol.for("react.portal"),Ee=Symbol.for("react.fragment"),We=Symbol.for("react.strict_mode"),Ve=Symbol.for("react.profiler"),et=Symbol.for("react.provider"),ft=Symbol.for("react.consumer"),Tt=Symbol.for("react.context"),Ot=Symbol.for("react.forward_ref"),pt=Symbol.for("react.suspense"),Ut=Symbol.for("react.suspense_list"),oi=Symbol.for("react.memo"),Di=Symbol.for("react.lazy"),Mi=Symbol.for("react.activity"),Jt=Symbol.for("react.memo_cache_sentinel"),wi=Symbol.iterator;function en(i){return i===null||typeof i!="object"?null:(i=wi&&i[wi]||i["@@iterator"],typeof i=="function"?i:null)}var bn=Symbol.for("react.client.reference");function Yn(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===bn?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case Ee:return"Fragment";case Ve:return"Profiler";case We:return"StrictMode";case pt:return"Suspense";case Ut:return"SuspenseList";case Mi:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case de:return"Portal";case Tt:return(i.displayName||"Context")+".Provider";case ft:return(i._context.displayName||"Context")+".Consumer";case Ot:var s=i.render;return i=i.displayName,i||(i=s.displayName||s.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case oi:return s=i.displayName||null,s!==null?s:Yn(i.type)||"Memo";case Di:s=i._payload,i=i._init;try{return Yn(i(s))}catch{}}return null}var Ei=Array.isArray,Ke=w.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,yt=z.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,It={pending:!1,data:null,method:null,action:null},mi=[],be=-1;function Qe(i){return{current:i}}function lt(i){0>be||(i.current=mi[be],mi[be]=null,be--)}function gt(i,s){be++,mi[be]=i.current,i.current=s}var Ct=Qe(null),li=Qe(null),Vt=Qe(null),Kn=Qe(null);function Fi(i,s){switch(gt(Vt,s),gt(li,i),gt(Ct,null),s.nodeType){case 9:case 11:i=(i=s.documentElement)&&(i=i.namespaceURI)?Zf(i):0;break;default:if(i=s.tagName,s=s.namespaceURI)s=Zf(s),i=$f(s,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}lt(Ct),gt(Ct,i)}function Hi(){lt(Ct),lt(li),lt(Vt)}function po(i){i.memoizedState!==null&&gt(Kn,i);var s=Ct.current,u=$f(s,i.type);s!==u&&(gt(li,i),gt(Ct,u))}function dr(i){li.current===i&&(lt(Ct),lt(li)),Kn.current===i&&(lt(Kn),Q._currentValue=It)}var mo=Object.prototype.hasOwnProperty,tn=v.unstable_scheduleCallback,ra=v.unstable_cancelCallback,aa=v.unstable_shouldYield,ol=v.unstable_requestPaint,Xi=v.unstable_now,Ur=v.unstable_getCurrentPriorityLevel,br=v.unstable_ImmediatePriority,ks=v.unstable_UserBlockingPriority,Sa=v.unstable_NormalPriority,Wl=v.unstable_LowPriority,Ls=v.unstable_IdlePriority,cs=v.log,go=v.unstable_setDisableYieldValue,Vr=null,nn=null;function nr(i){if(typeof cs=="function"&&go(i),nn&&typeof nn.setStrictMode=="function")try{nn.setStrictMode(Vr,i)}catch{}}var rr=Math.clz32?Math.clz32:Ae,qc=Math.log,us=Math.LN2;function Ae(i){return i>>>=0,i===0?32:31-(qc(i)/us|0)|0}var H=256,Y=4194304;function ee(i){var s=i&42;if(s!==0)return s;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function ce(i,s,u){var p=i.pendingLanes;if(p===0)return 0;var b=0,C=i.suspendedLanes,G=i.pingedLanes;i=i.warmLanes;var K=p&134217727;return K!==0?(p=K&~C,p!==0?b=ee(p):(G&=K,G!==0?b=ee(G):u||(u=K&~i,u!==0&&(b=ee(u))))):(K=p&~C,K!==0?b=ee(K):G!==0?b=ee(G):u||(u=p&~i,u!==0&&(b=ee(u)))),b===0?0:s!==0&&s!==b&&(s&C)===0&&(C=b&-b,u=s&-s,C>=u||C===32&&(u&4194048)!==0)?s:b}function ye(i,s){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&s)===0}function Ce(i,s){switch(i){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ke(){var i=H;return H<<=1,(H&4194048)===0&&(H=256),i}function Se(){var i=Y;return Y<<=1,(Y&62914560)===0&&(Y=4194304),i}function Ze(i){for(var s=[],u=0;31>u;u++)s.push(i);return s}function je(i,s){i.pendingLanes|=s,s!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function ze(i,s,u,p,b,C){var G=i.pendingLanes;i.pendingLanes=u,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=u,i.entangledLanes&=u,i.errorRecoveryDisabledLanes&=u,i.shellSuspendCounter=0;var K=i.entanglements,me=i.expirationTimes,Fe=i.hiddenUpdates;for(u=G&~u;0<u;){var tt=31-rr(u),at=1<<tt;K[tt]=0,me[tt]=-1;var Ue=Fe[tt];if(Ue!==null)for(Fe[tt]=null,tt=0;tt<Ue.length;tt++){var Ge=Ue[tt];Ge!==null&&(Ge.lane&=-536870913)}u&=~at}p!==0&&Xe(i,p,0),C!==0&&b===0&&i.tag!==0&&(i.suspendedLanes|=C&~(G&~s))}function Xe(i,s,u){i.pendingLanes|=s,i.suspendedLanes&=~s;var p=31-rr(s);i.entangledLanes|=s,i.entanglements[p]=i.entanglements[p]|1073741824|u&4194090}function _e(i,s){var u=i.entangledLanes|=s;for(i=i.entanglements;u;){var p=31-rr(u),b=1<<p;b&s|i[p]&s&&(i[p]|=s),u&=~b}}function mt(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function Lt(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function vt(){var i=yt.p;return i!==0?i:(i=window.event,i===void 0?32:St(i.type))}function At(i,s){var u=yt.p;try{return yt.p=i,s()}finally{yt.p=u}}var kt=Math.random().toString(36).slice(2),ei="__reactFiber$"+kt,Qt="__reactProps$"+kt,ci="__reactContainer$"+kt,Bt="__reactEvents$"+kt,ui="__reactListeners$"+kt,Wn="__reactHandles$"+kt,ct="__reactResources$"+kt,wn="__reactMarker$"+kt;function Yi(i){delete i[ei],delete i[Qt],delete i[Bt],delete i[ui],delete i[Wn]}function Gr(i){var s=i[ei];if(s)return s;for(var u=i.parentNode;u;){if(s=u[ci]||u[ei]){if(u=s.alternate,s.child!==null||u!==null&&u.child!==null)for(i=tm(i);i!==null;){if(u=i[ei])return u;i=tm(i)}return s}i=u,u=i.parentNode}return null}function sa(i){if(i=i[ei]||i[ci]){var s=i.tag;if(s===5||s===6||s===13||s===26||s===27||s===3)return i}return null}function ht(i){var s=i.tag;if(s===5||s===26||s===27||s===6)return i.stateNode;throw Error(E(33))}function qt(i){var s=i[ct];return s||(s=i[ct]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function Dt(i){i[wn]=!0}var Rr=new Set,Ql={};function fr(i,s){Zt(i,s),Zt(i+"Capture",s)}function Zt(i,s){for(Ql[i]=s,i=0;i<s.length;i++)Rr.add(s[i])}var hs=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Os={},yn={};function Jl(i){return mo.call(yn,i)?!0:mo.call(Os,i)?!1:hs.test(i)?yn[i]=!0:(Os[i]=!0,!1)}function Bs(i,s,u){if(Jl(s))if(u===null)i.removeAttribute(s);else{switch(typeof u){case"undefined":case"function":case"symbol":i.removeAttribute(s);return;case"boolean":var p=s.toLowerCase().slice(0,5);if(p!=="data-"&&p!=="aria-"){i.removeAttribute(s);return}}i.setAttribute(s,""+u)}}function oa(i,s,u){if(u===null)i.removeAttribute(s);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(s);return}i.setAttribute(s,""+u)}}function qr(i,s,u,p){if(p===null)i.removeAttribute(u);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(u);return}i.setAttributeNS(s,u,""+p)}}var wr,rn;function _o(i){if(wr===void 0)try{throw Error()}catch(u){var s=u.stack.trim().match(/\n( *(at )?)/);wr=s&&s[1]||"",rn=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+wr+i+rn}var yo=!1;function ll(i,s){if(!i||yo)return"";yo=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var p={DetermineComponentFrameRoot:function(){try{if(s){var at=function(){throw Error()};if(Object.defineProperty(at.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(at,[])}catch(Ge){var Ue=Ge}Reflect.construct(i,[],at)}else{try{at.call()}catch(Ge){Ue=Ge}i.call(at.prototype)}}else{try{throw Error()}catch(Ge){Ue=Ge}(at=i())&&typeof at.catch=="function"&&at.catch(function(){})}}catch(Ge){if(Ge&&Ue&&typeof Ge.stack=="string")return[Ge.stack,Ue.stack]}return[null,null]}};p.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(p.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(p.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var C=p.DetermineComponentFrameRoot(),G=C[0],K=C[1];if(G&&K){var me=G.split(`
`),Fe=K.split(`
`);for(b=p=0;p<me.length&&!me[p].includes("DetermineComponentFrameRoot");)p++;for(;b<Fe.length&&!Fe[b].includes("DetermineComponentFrameRoot");)b++;if(p===me.length||b===Fe.length)for(p=me.length-1,b=Fe.length-1;1<=p&&0<=b&&me[p]!==Fe[b];)b--;for(;1<=p&&0<=b;p--,b--)if(me[p]!==Fe[b]){if(p!==1||b!==1)do if(p--,b--,0>b||me[p]!==Fe[b]){var tt=`
`+me[p].replace(" at new "," at ");return i.displayName&&tt.includes("<anonymous>")&&(tt=tt.replace("<anonymous>",i.displayName)),tt}while(1<=p&&0<=b);break}}}finally{yo=!1,Error.prepareStackTrace=u}return(u=i?i.displayName||i.name:"")?_o(u):""}function vo(i){switch(i.tag){case 26:case 27:case 5:return _o(i.type);case 16:return _o("Lazy");case 13:return _o("Suspense");case 19:return _o("SuspenseList");case 0:case 15:return ll(i.type,!1);case 11:return ll(i.type.render,!1);case 1:return ll(i.type,!0);case 31:return _o("Activity");default:return""}}function ds(i){try{var s="";do s+=vo(i),i=i.return;while(i);return s}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}function Zr(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Fu(i){var s=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function $h(i){var s=Fu(i)?"checked":"value",u=Object.getOwnPropertyDescriptor(i.constructor.prototype,s),p=""+i[s];if(!i.hasOwnProperty(s)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var b=u.get,C=u.set;return Object.defineProperty(i,s,{configurable:!0,get:function(){return b.call(this)},set:function(G){p=""+G,C.call(this,G)}}),Object.defineProperty(i,s,{enumerable:u.enumerable}),{getValue:function(){return p},setValue:function(G){p=""+G},stopTracking:function(){i._valueTracker=null,delete i[s]}}}}function fs(i){i._valueTracker||(i._valueTracker=$h(i))}function Nu(i){if(!i)return!1;var s=i._valueTracker;if(!s)return!0;var u=s.getValue(),p="";return i&&(p=Fu(i)?i.checked?"true":"false":i.value),i=p,i!==u?(s.setValue(i),!0):!1}function ec(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var tc=/[\n"\\]/g;function la(i){return i.replace(tc,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function Zc(i,s,u,p,b,C,G,K){i.name="",G!=null&&typeof G!="function"&&typeof G!="symbol"&&typeof G!="boolean"?i.type=G:i.removeAttribute("type"),s!=null?G==="number"?(s===0&&i.value===""||i.value!=s)&&(i.value=""+Zr(s)):i.value!==""+Zr(s)&&(i.value=""+Zr(s)):G!=="submit"&&G!=="reset"||i.removeAttribute("value"),s!=null?ic(i,G,Zr(s)):u!=null?ic(i,G,Zr(u)):p!=null&&i.removeAttribute("value"),b==null&&C!=null&&(i.defaultChecked=!!C),b!=null&&(i.checked=b&&typeof b!="function"&&typeof b!="symbol"),K!=null&&typeof K!="function"&&typeof K!="symbol"&&typeof K!="boolean"?i.name=""+Zr(K):i.removeAttribute("name")}function xo(i,s,u,p,b,C,G,K){if(C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"&&(i.type=C),s!=null||u!=null){if(!(C!=="submit"&&C!=="reset"||s!=null))return;u=u!=null?""+Zr(u):"",s=s!=null?""+Zr(s):u,K||s===i.value||(i.value=s),i.defaultValue=s}p=p??b,p=typeof p!="function"&&typeof p!="symbol"&&!!p,i.checked=K?i.checked:!!p,i.defaultChecked=!!p,G!=null&&typeof G!="function"&&typeof G!="symbol"&&typeof G!="boolean"&&(i.name=G)}function ic(i,s,u){s==="number"&&ec(i.ownerDocument)===i||i.defaultValue===""+u||(i.defaultValue=""+u)}function Fs(i,s,u,p){if(i=i.options,s){s={};for(var b=0;b<u.length;b++)s["$"+u[b]]=!0;for(u=0;u<i.length;u++)b=s.hasOwnProperty("$"+i[u].value),i[u].selected!==b&&(i[u].selected=b),b&&p&&(i[u].defaultSelected=!0)}else{for(u=""+Zr(u),s=null,b=0;b<i.length;b++){if(i[b].value===u){i[b].selected=!0,p&&(i[b].defaultSelected=!0);return}s!==null||i[b].disabled||(s=i[b])}s!==null&&(s.selected=!0)}}function ju(i,s,u){if(s!=null&&(s=""+Zr(s),s!==i.value&&(i.value=s),u==null)){i.defaultValue!==s&&(i.defaultValue=s);return}i.defaultValue=u!=null?""+Zr(u):""}function nc(i,s,u,p){if(s==null){if(p!=null){if(u!=null)throw Error(E(92));if(Ei(p)){if(1<p.length)throw Error(E(93));p=p[0]}u=p}u==null&&(u=""),s=u}u=Zr(s),i.defaultValue=u,p=i.textContent,p===u&&p!==""&&p!==null&&(i.value=p)}function ps(i,s){if(s){var u=i.firstChild;if(u&&u===i.lastChild&&u.nodeType===3){u.nodeValue=s;return}}i.textContent=s}var Va=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function ri(i,s,u){var p=s.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?p?i.setProperty(s,""):s==="float"?i.cssFloat="":i[s]="":p?i.setProperty(s,u):typeof u!="number"||u===0||Va.has(s)?s==="float"?i.cssFloat=u:i[s]=(""+u).trim():i[s]=u+"px"}function Ga(i,s,u){if(s!=null&&typeof s!="object")throw Error(E(62));if(i=i.style,u!=null){for(var p in u)!u.hasOwnProperty(p)||s!=null&&s.hasOwnProperty(p)||(p.indexOf("--")===0?i.setProperty(p,""):p==="float"?i.cssFloat="":i[p]="");for(var b in s)p=s[b],s.hasOwnProperty(b)&&u[b]!==p&&ri(i,b,p)}else for(var C in s)s.hasOwnProperty(C)&&ri(i,C,s[C])}function Ta(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var bo=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Uu=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function cl(i){return Uu.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}var Dr=null;function Ma(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Kt=null,qa=null;function rc(i){var s=sa(i);if(s&&(i=s.stateNode)){var u=i[Qt]||null;e:switch(i=s.stateNode,s.type){case"input":if(Zc(i,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),s=u.name,u.type==="radio"&&s!=null){for(u=i;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+la(""+s)+'"][type="radio"]'),s=0;s<u.length;s++){var p=u[s];if(p!==i&&p.form===i.form){var b=p[Qt]||null;if(!b)throw Error(E(90));Zc(p,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(s=0;s<u.length;s++)p=u[s],p.form===i.form&&Nu(p)}break e;case"textarea":ju(i,u.value,u.defaultValue);break e;case"select":s=u.value,s!=null&&Fs(i,!!u.multiple,s,!1)}}}var ac=!1;function ar(i,s,u){if(ac)return i(s,u);ac=!0;try{var p=i(s);return p}finally{if(ac=!1,(Kt!==null||qa!==null)&&(zn(),Kt&&(s=Kt,i=qa,qa=Kt=null,rc(s),i)))for(s=0;s<i.length;s++)rc(i[s])}}function on(i,s){var u=i.stateNode;if(u===null)return null;var p=u[Qt]||null;if(p===null)return null;u=p[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(i=i.type,p=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!p;break e;default:i=!1}if(i)return null;if(u&&typeof u!="function")throw Error(E(231,s,typeof u));return u}var ln=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ln=!1;if(ln)try{var ki={};Object.defineProperty(ki,"passive",{get:function(){Ln=!0}}),window.addEventListener("test",ki,ki),window.removeEventListener("test",ki,ki)}catch{Ln=!1}var Ea=null,si=null,sr=null;function $t(){if(sr)return sr;var i,s=si,u=s.length,p,b="value"in Ea?Ea.value:Ea.textContent,C=b.length;for(i=0;i<u&&s[i]===b[i];i++);var G=u-i;for(p=1;p<=G&&s[u-p]===b[C-p];p++);return sr=b.slice(i,1<p?1-p:void 0)}function Xt(i){var s=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&s===13&&(i=13)):i=s,i===10&&(i=13),32<=i||i===13?i:0}function Za(){return!0}function Ft(){return!1}function On(i){function s(u,p,b,C,G){this._reactName=u,this._targetInst=b,this.type=p,this.nativeEvent=C,this.target=G,this.currentTarget=null;for(var K in i)i.hasOwnProperty(K)&&(u=i[K],this[K]=u?u(C):C[K]);return this.isDefaultPrevented=(C.defaultPrevented!=null?C.defaultPrevented:C.returnValue===!1)?Za:Ft,this.isPropagationStopped=Ft,this}return re(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=Za)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=Za)},persist:function(){},isPersistent:Za}),s}var Sn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ms=On(Sn),Qn=re({},Sn,{view:0,detail:0}),Vu=On(Qn),ca,$c,ul,Ns=re({},Qn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:or,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==ul&&(ul&&i.type==="mousemove"?(ca=i.screenX-ul.screenX,$c=i.screenY-ul.screenY):$c=ca=0,ul=i),ca)},movementY:function(i){return"movementY"in i?i.movementY:$c}}),hl=On(Ns),Ca=re({},Ns,{dataTransfer:0}),Jn=On(Ca),dl=re({},Qn,{relatedTarget:0}),wo=On(dl),fl=re({},Sn,{animationName:0,elapsedTime:0,pseudoElement:0}),Bn=On(fl),sc=re({},Sn,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),pl=On(sc),ml=re({},Sn,{data:0}),Hh=On(ml),js={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},oc={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Gu={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function $d(i){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(i):(i=Gu[i])?!!s[i]:!1}function or(){return $d}var gl=re({},Qn,{key:function(i){if(i.key){var s=js[i.key]||i.key;if(s!=="Unidentified")return s}return i.type==="keypress"?(i=Xt(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?oc[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:or,charCode:function(i){return i.type==="keypress"?Xt(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Xt(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),$r=On(gl),Ir=re({},Ns,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Hc=On(Ir),lc=re({},Qn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:or}),_l=On(lc),qu=re({},Sn,{propertyName:0,elapsedTime:0,pseudoElement:0}),Hd=On(qu),Xd=re({},Ns,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),Yd=On(Xd),Kd=re({},Sn,{newState:0,oldState:0}),Xc=On(Kd),Yc=[9,13,27,32],yl=ln&&"CompositionEvent"in window,gs=null;ln&&"documentMode"in document&&(gs=document.documentMode);var Zu=ln&&"TextEvent"in window&&!gs,cc=ln&&(!yl||gs&&8<gs&&11>=gs),Aa=" ",Xh=!1;function Kc(i,s){switch(i){case"keyup":return Yc.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function vl(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var $a=!1;function Yh(i,s){switch(i){case"compositionend":return vl(s);case"keypress":return s.which!==32?null:(Xh=!0,Aa);case"textInput":return i=s.data,i===Aa&&Xh?null:i;default:return null}}function uc(i,s){if($a)return i==="compositionend"||!yl&&Kc(i,s)?(i=$t(),sr=si=Ea=null,$a=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return cc&&s.locale!=="ko"?null:s.data;default:return null}}var Kh={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function So(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s==="input"?!!Kh[i.type]:s==="textarea"}function Wh(i,s,u,p){Kt?qa?qa.push(p):qa=[p]:Kt=p,s=kh(s,"onChange"),0<s.length&&(u=new ms("onChange","change",null,u,p),i.push({event:u,listeners:s}))}var xl=null,hc=null;function Wc(i){Kp(i,0)}function bl(i){var s=ht(i);if(Nu(s))return i}function $u(i,s){if(i==="change")return s}var Hu=!1;if(ln){var dc;if(ln){var fc="oninput"in document;if(!fc){var Us=document.createElement("div");Us.setAttribute("oninput","return;"),fc=typeof Us.oninput=="function"}dc=fc}else dc=!1;Hu=dc&&(!document.documentMode||9<document.documentMode)}function Xu(){xl&&(xl.detachEvent("onpropertychange",Qc),hc=xl=null)}function Qc(i){if(i.propertyName==="value"&&bl(hc)){var s=[];Wh(s,hc,i,Ma(i)),ar(Wc,s)}}function wl(i,s,u){i==="focusin"?(Xu(),xl=s,hc=u,xl.attachEvent("onpropertychange",Qc)):i==="focusout"&&Xu()}function Wd(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return bl(hc)}function Jc(i,s){if(i==="click")return bl(s)}function Qd(i,s){if(i==="input"||i==="change")return bl(s)}function Qh(i,s){return i===s&&(i!==0||1/i===1/s)||i!==i&&s!==s}var kr=typeof Object.is=="function"?Object.is:Qh;function Sl(i,s){if(kr(i,s))return!0;if(typeof i!="object"||i===null||typeof s!="object"||s===null)return!1;var u=Object.keys(i),p=Object.keys(s);if(u.length!==p.length)return!1;for(p=0;p<u.length;p++){var b=u[p];if(!mo.call(s,b)||!kr(i[b],s[b]))return!1}return!0}function Yu(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function eu(i,s){var u=Yu(i);i=0;for(var p;u;){if(u.nodeType===3){if(p=i+u.textContent.length,i<=s&&p>=s)return{node:u,offset:s-i};i=p}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=Yu(u)}}function vi(i,s){return i&&s?i===s?!0:i&&i.nodeType===3?!1:s&&s.nodeType===3?vi(i,s.parentNode):"contains"in i?i.contains(s):i.compareDocumentPosition?!!(i.compareDocumentPosition(s)&16):!1:!1}function pc(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var s=ec(i.document);s instanceof i.HTMLIFrameElement;){try{var u=typeof s.contentWindow.location.href=="string"}catch{u=!1}if(u)i=s.contentWindow;else break;s=ec(i.document)}return s}function za(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s&&(s==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||s==="textarea"||i.contentEditable==="true")}var Ku=ln&&"documentMode"in document&&11>=document.documentMode,Vs=null,mc=null,Tl=null,gc=!1;function Gs(i,s,u){var p=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;gc||Vs==null||Vs!==ec(p)||(p=Vs,"selectionStart"in p&&za(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),Tl&&Sl(Tl,p)||(Tl=p,p=kh(mc,"onSelect"),0<p.length&&(s=new ms("onSelect","select",null,s,u),i.push({event:s,listeners:p}),s.target=Vs)))}function _s(i,s){var u={};return u[i.toLowerCase()]=s.toLowerCase(),u["Webkit"+i]="webkit"+s,u["Moz"+i]="moz"+s,u}var Ml={animationend:_s("Animation","AnimationEnd"),animationiteration:_s("Animation","AnimationIteration"),animationstart:_s("Animation","AnimationStart"),transitionrun:_s("Transition","TransitionRun"),transitionstart:_s("Transition","TransitionStart"),transitioncancel:_s("Transition","TransitionCancel"),transitionend:_s("Transition","TransitionEnd")},Wu={},Jh={};ln&&(Jh=document.createElement("div").style,"AnimationEvent"in window||(delete Ml.animationend.animation,delete Ml.animationiteration.animation,delete Ml.animationstart.animation),"TransitionEvent"in window||delete Ml.transitionend.transition);function To(i){if(Wu[i])return Wu[i];if(!Ml[i])return i;var s=Ml[i],u;for(u in s)if(s.hasOwnProperty(u)&&u in Jh)return Wu[i]=s[u];return i}var Qu=To("animationend"),ed=To("animationiteration"),Ju=To("animationstart"),tu=To("transitionrun"),iu=To("transitionstart"),nu=To("transitioncancel"),ru=To("transitionend"),qs=new Map,Mo="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Mo.push("scrollEnd");function pr(i,s){qs.set(i,s),fr(s,[i])}var Hr=new WeakMap;function Xr(i,s){if(typeof i=="object"&&i!==null){var u=Hr.get(i);return u!==void 0?u:(s={value:i,source:s,stack:ds(s)},Hr.set(i,s),s)}return{value:i,source:s,stack:ds(s)}}var Yr=[],Zs=0,ys=0;function Eo(){for(var i=Zs,s=ys=Zs=0;s<i;){var u=Yr[s];Yr[s++]=null;var p=Yr[s];Yr[s++]=null;var b=Yr[s];Yr[s++]=null;var C=Yr[s];if(Yr[s++]=null,p!==null&&b!==null){var G=p.pending;G===null?b.next=b:(b.next=G.next,G.next=b),p.pending=b}C!==0&&eh(u,b,C)}}function Co(i,s,u,p){Yr[Zs++]=i,Yr[Zs++]=s,Yr[Zs++]=u,Yr[Zs++]=p,ys|=p,i.lanes|=p,i=i.alternate,i!==null&&(i.lanes|=p)}function Ao(i,s,u,p){return Co(i,s,u,p),vs(i)}function Pa(i,s){return Co(i,null,null,s),vs(i)}function eh(i,s,u){i.lanes|=u;var p=i.alternate;p!==null&&(p.lanes|=u);for(var b=!1,C=i.return;C!==null;)C.childLanes|=u,p=C.alternate,p!==null&&(p.childLanes|=u),C.tag===22&&(i=C.stateNode,i===null||i._visibility&1||(b=!0)),i=C,C=C.return;return i.tag===3?(C=i.stateNode,b&&s!==null&&(b=31-rr(u),i=C.hiddenUpdates,p=i[b],p===null?i[b]=[s]:p.push(s),s.lane=u|536870912),C):null}function vs(i){if(50<Ch)throw Ch=0,Tf=null,Error(E(185));for(var s=i.return;s!==null;)i=s,s=i.return;return i.tag===3?i.stateNode:null}var Ra={};function th(i,s,u,p){this.tag=i,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Sr(i,s,u,p){return new th(i,s,u,p)}function ti(i){return i=i.prototype,!(!i||!i.isReactComponent)}function Tr(i,s){var u=i.alternate;return u===null?(u=Sr(i.tag,s,i.key,i.mode),u.elementType=i.elementType,u.type=i.type,u.stateNode=i.stateNode,u.alternate=i,i.alternate=u):(u.pendingProps=s,u.type=i.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=i.flags&65011712,u.childLanes=i.childLanes,u.lanes=i.lanes,u.child=i.child,u.memoizedProps=i.memoizedProps,u.memoizedState=i.memoizedState,u.updateQueue=i.updateQueue,s=i.dependencies,u.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},u.sibling=i.sibling,u.index=i.index,u.ref=i.ref,u.refCleanup=i.refCleanup,u}function ih(i,s){i.flags&=65011714;var u=i.alternate;return u===null?(i.childLanes=0,i.lanes=s,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=u.childLanes,i.lanes=u.lanes,i.child=u.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=u.memoizedProps,i.memoizedState=u.memoizedState,i.updateQueue=u.updateQueue,i.type=u.type,s=u.dependencies,i.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),i}function _c(i,s,u,p,b,C){var G=0;if(p=i,typeof i=="function")ti(i)&&(G=1);else if(typeof i=="string")G=_(i,u,Ct.current)?26:i==="html"||i==="head"||i==="body"?27:5;else e:switch(i){case Mi:return i=Sr(31,u,s,b),i.elementType=Mi,i.lanes=C,i;case Ee:return Da(u.children,b,C,s);case We:G=8,b|=24;break;case Ve:return i=Sr(12,u,s,b|2),i.elementType=Ve,i.lanes=C,i;case pt:return i=Sr(13,u,s,b),i.elementType=pt,i.lanes=C,i;case Ut:return i=Sr(19,u,s,b),i.elementType=Ut,i.lanes=C,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case et:case Tt:G=10;break e;case ft:G=9;break e;case Ot:G=11;break e;case oi:G=14;break e;case Di:G=16,p=null;break e}G=29,u=Error(E(130,i===null?"null":typeof i,"")),p=null}return s=Sr(G,u,s,b),s.elementType=i,s.type=p,s.lanes=C,s}function Da(i,s,u,p){return i=Sr(7,i,p,s),i.lanes=u,i}function nh(i,s,u){return i=Sr(6,i,null,s),i.lanes=u,i}function rh(i,s,u){return s=Sr(4,i.children!==null?i.children:[],i.key,s),s.lanes=u,s.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},s}var zo=[],Po=0,Ro=null,Do=0,Mr=[],mr=0,Ha=null,Ia=1,Kr="";function ua(i,s){zo[Po++]=Do,zo[Po++]=Ro,Ro=i,Do=s}function Io(i,s,u){Mr[mr++]=Ia,Mr[mr++]=Kr,Mr[mr++]=Ha,Ha=i;var p=Ia;i=Kr;var b=32-rr(p)-1;p&=~(1<<b),u+=1;var C=32-rr(s)+b;if(30<C){var G=b-b%5;C=(p&(1<<G)-1).toString(32),p>>=G,b-=G,Ia=1<<32-rr(s)+b|u<<b|p,Kr=C+i}else Ia=1<<C|u<<b|p,Kr=i}function ko(i){i.return!==null&&(ua(i,1),Io(i,1,0))}function yc(i){for(;i===Ro;)Ro=zo[--Po],zo[Po]=null,Do=zo[--Po],zo[Po]=null;for(;i===Ha;)Ha=Mr[--mr],Mr[mr]=null,Kr=Mr[--mr],Mr[mr]=null,Ia=Mr[--mr],Mr[mr]=null}var vn=null,xn=null,Si=!1,Xa=null,ha=!1,au=Error(E(519));function $s(i){var s=Error(E(418,""));throw da(Xr(s,i)),au}function El(i){var s=i.stateNode,u=i.type,p=i.memoizedProps;switch(s[ei]=i,s[Qt]=p,u){case"dialog":yi("cancel",s),yi("close",s);break;case"iframe":case"object":case"embed":yi("load",s);break;case"video":case"audio":for(u=0;u<Ih.length;u++)yi(Ih[u],s);break;case"source":yi("error",s);break;case"img":case"image":case"link":yi("error",s),yi("load",s);break;case"details":yi("toggle",s);break;case"input":yi("invalid",s),xo(s,p.value,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name,!0),fs(s);break;case"select":yi("invalid",s);break;case"textarea":yi("invalid",s),nc(s,p.value,p.defaultValue,p.children),fs(s)}u=p.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||s.textContent===""+u||p.suppressHydrationWarning===!0||Du(s.textContent,u)?(p.popover!=null&&(yi("beforetoggle",s),yi("toggle",s)),p.onScroll!=null&&yi("scroll",s),p.onScrollEnd!=null&&yi("scrollend",s),p.onClick!=null&&(s.onclick=Lh),s=!0):s=!1,s||$s(i)}function vc(i){for(vn=i.return;vn;)switch(vn.tag){case 5:case 13:ha=!1;return;case 27:case 3:ha=!0;return;default:vn=vn.return}}function Hs(i){if(i!==vn)return!1;if(!Si)return vc(i),Si=!0,!1;var s=i.tag,u;if((u=s!==3&&s!==27)&&((u=s===5)&&(u=i.type,u=!(u!=="form"&&u!=="button")||Hf(i.type,i.memoizedProps)),u=!u),u&&xn&&$s(i),vc(i),s===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(E(317));e:{for(i=i.nextSibling,s=0;i;){if(i.nodeType===8)if(u=i.data,u==="/$"){if(s===0){xn=va(i.nextSibling);break e}s--}else u!=="$"&&u!=="$!"&&u!=="$?"||s++;i=i.nextSibling}xn=null}}else s===27?(s=xn,Vl(i.type)?(i=Wf,Wf=null,xn=i):xn=s):xn=vn?va(i.stateNode.nextSibling):null;return!0}function Cl(){xn=vn=null,Si=!1}function cn(){var i=Xa;return i!==null&&(_a===null?_a=i:_a.push.apply(_a,i),Xa=null),i}function da(i){Xa===null?Xa=[i]:Xa.push(i)}var Lr=Qe(null),Ya=null,Wr=null;function Qr(i,s,u){gt(Lr,s._currentValue),s._currentValue=u}function Or(i){i._currentValue=Lr.current,lt(Lr)}function xc(i,s,u){for(;i!==null;){var p=i.alternate;if((i.childLanes&s)!==s?(i.childLanes|=s,p!==null&&(p.childLanes|=s)):p!==null&&(p.childLanes&s)!==s&&(p.childLanes|=s),i===u)break;i=i.return}}function Lo(i,s,u,p){var b=i.child;for(b!==null&&(b.return=i);b!==null;){var C=b.dependencies;if(C!==null){var G=b.child;C=C.firstContext;e:for(;C!==null;){var K=C;C=b;for(var me=0;me<s.length;me++)if(K.context===s[me]){C.lanes|=u,K=C.alternate,K!==null&&(K.lanes|=u),xc(C.return,u,i),p||(G=null);break e}C=K.next}}else if(b.tag===18){if(G=b.return,G===null)throw Error(E(341));G.lanes|=u,C=G.alternate,C!==null&&(C.lanes|=u),xc(G,u,i),G=null}else G=b.child;if(G!==null)G.return=b;else for(G=b;G!==null;){if(G===i){G=null;break}if(b=G.sibling,b!==null){b.return=G.return,G=b;break}G=G.return}b=G}}function Oo(i,s,u,p){i=null;for(var b=s,C=!1;b!==null;){if(!C){if((b.flags&524288)!==0)C=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var G=b.alternate;if(G===null)throw Error(E(387));if(G=G.memoizedProps,G!==null){var K=b.type;kr(b.pendingProps.value,G.value)||(i!==null?i.push(K):i=[K])}}else if(b===Kn.current){if(G=b.alternate,G===null)throw Error(E(387));G.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(i!==null?i.push(Q):i=[Q])}b=b.return}i!==null&&Lo(s,i,u,p),s.flags|=262144}function bc(i){for(i=i.firstContext;i!==null;){if(!kr(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function Xs(i){Ya=i,Wr=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function Tn(i){return Er(Ya,i)}function xs(i,s){return Ya===null&&Xs(i),Er(i,s)}function Er(i,s){var u=s._currentValue;if(s={context:s,memoizedValue:u,next:null},Wr===null){if(i===null)throw Error(E(308));Wr=s,i.dependencies={lanes:0,firstContext:s},i.flags|=524288}else Wr=Wr.next=s;return u}var ka=typeof AbortController<"u"?AbortController:function(){var i=[],s=this.signal={aborted:!1,addEventListener:function(u,p){i.push(p)}};this.abort=function(){s.aborted=!0,i.forEach(function(u){return u()})}},ah=v.unstable_scheduleCallback,td=v.unstable_NormalPriority,Fn={$$typeof:Tt,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ys(){return{controller:new ka,data:new Map,refCount:0}}function Bo(i){i.refCount--,i.refCount===0&&ah(td,function(){i.controller.abort()})}var Ks=null,su=0,bs=0,ws=null;function Al(i,s){if(Ks===null){var u=Ks=[];su=0,bs=jl(),ws={status:"pending",value:void 0,then:function(p){u.push(p)}}}return su++,s.then(Jr,Jr),s}function Jr(){if(--su===0&&Ks!==null){ws!==null&&(ws.status="fulfilled");var i=Ks;Ks=null,bs=0,ws=null;for(var s=0;s<i.length;s++)(0,i[s])()}}function La(i,s){var u=[],p={status:"pending",value:null,reason:null,then:function(b){u.push(b)}};return i.then(function(){p.status="fulfilled",p.value=s;for(var b=0;b<u.length;b++)(0,u[b])(s)},function(b){for(p.status="rejected",p.reason=b,b=0;b<u.length;b++)(0,u[b])(void 0)}),p}var sh=Ke.S;Ke.S=function(i,s){typeof s=="object"&&s!==null&&typeof s.then=="function"&&Al(i,s),sh!==null&&sh(i,s)};var Mn=Qe(null);function Ws(){var i=Mn.current;return i!==null?i:Oi.pooledCache}function ou(i,s){s===null?gt(Mn,Mn.current):gt(Mn,s.pool)}function wc(){var i=Ws();return i===null?null:{parent:Fn._currentValue,pool:i}}var Sc=Error(E(460)),lu=Error(E(474)),Qs=Error(E(542)),Js={then:function(){}};function Oa(i){return i=i.status,i==="fulfilled"||i==="rejected"}function _t(){}function cu(i,s,u){switch(u=i[u],u===void 0?i.push(s):u!==s&&(s.then(_t,_t),s=u),s.status){case"fulfilled":return s.value;case"rejected":throw i=s.reason,zl(i),i;default:if(typeof s.status=="string")s.then(_t,_t);else{if(i=Oi,i!==null&&100<i.shellSuspendCounter)throw Error(E(482));i=s,i.status="pending",i.then(function(p){if(s.status==="pending"){var b=s;b.status="fulfilled",b.value=p}},function(p){if(s.status==="pending"){var b=s;b.status="rejected",b.reason=p}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw i=s.reason,zl(i),i}throw Ss=s,Sc}}var Ss=null;function uu(){if(Ss===null)throw Error(E(459));var i=Ss;return Ss=null,i}function zl(i){if(i===Sc||i===Qs)throw Error(E(483))}var ea=!1;function Tc(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ii(i,s){i=i.updateQueue,s.updateQueue===i&&(s.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function Ka(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function Ts(i,s,u){var p=i.updateQueue;if(p===null)return null;if(p=p.shared,(Li&2)!==0){var b=p.pending;return b===null?s.next=s:(s.next=b.next,b.next=s),p.pending=s,s=vs(i),eh(i,null,u),s}return Co(i,p,s,u),vs(i)}function eo(i,s,u){if(s=s.updateQueue,s!==null&&(s=s.shared,(u&4194048)!==0)){var p=s.lanes;p&=i.pendingLanes,u|=p,s.lanes=u,_e(i,u)}}function oh(i,s){var u=i.updateQueue,p=i.alternate;if(p!==null&&(p=p.updateQueue,u===p)){var b=null,C=null;if(u=u.firstBaseUpdate,u!==null){do{var G={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};C===null?b=C=G:C=C.next=G,u=u.next}while(u!==null);C===null?b=C=s:C=C.next=s}else b=C=s;u={baseState:p.baseState,firstBaseUpdate:b,lastBaseUpdate:C,shared:p.shared,callbacks:p.callbacks},i.updateQueue=u;return}i=u.lastBaseUpdate,i===null?u.firstBaseUpdate=s:i.next=s,u.lastBaseUpdate=s}var lh=!1;function Fo(){if(lh){var i=ws;if(i!==null)throw i}}function to(i,s,u,p){lh=!1;var b=i.updateQueue;ea=!1;var C=b.firstBaseUpdate,G=b.lastBaseUpdate,K=b.shared.pending;if(K!==null){b.shared.pending=null;var me=K,Fe=me.next;me.next=null,G===null?C=Fe:G.next=Fe,G=me;var tt=i.alternate;tt!==null&&(tt=tt.updateQueue,K=tt.lastBaseUpdate,K!==G&&(K===null?tt.firstBaseUpdate=Fe:K.next=Fe,tt.lastBaseUpdate=me))}if(C!==null){var at=b.baseState;G=0,tt=Fe=me=null,K=C;do{var Ue=K.lane&-536870913,Ge=Ue!==K.lane;if(Ge?(xi&Ue)===Ue:(p&Ue)===Ue){Ue!==0&&Ue===bs&&(lh=!0),tt!==null&&(tt=tt.next={lane:0,tag:K.tag,payload:K.payload,callback:null,next:null});e:{var jt=i,Gt=K;Ue=s;var $i=u;switch(Gt.tag){case 1:if(jt=Gt.payload,typeof jt=="function"){at=jt.call($i,at,Ue);break e}at=jt;break e;case 3:jt.flags=jt.flags&-65537|128;case 0:if(jt=Gt.payload,Ue=typeof jt=="function"?jt.call($i,at,Ue):jt,Ue==null)break e;at=re({},at,Ue);break e;case 2:ea=!0}}Ue=K.callback,Ue!==null&&(i.flags|=64,Ge&&(i.flags|=8192),Ge=b.callbacks,Ge===null?b.callbacks=[Ue]:Ge.push(Ue))}else Ge={lane:Ue,tag:K.tag,payload:K.payload,callback:K.callback,next:null},tt===null?(Fe=tt=Ge,me=at):tt=tt.next=Ge,G|=Ue;if(K=K.next,K===null){if(K=b.shared.pending,K===null)break;Ge=K,K=Ge.next,Ge.next=null,b.lastBaseUpdate=Ge,b.shared.pending=null}}while(!0);tt===null&&(me=at),b.baseState=me,b.firstBaseUpdate=Fe,b.lastBaseUpdate=tt,C===null&&(b.shared.lanes=0),Fl|=G,i.lanes=G,i.memoizedState=at}}function hu(i,s){if(typeof i!="function")throw Error(E(191,i));i.call(s)}function ch(i,s){var u=i.callbacks;if(u!==null)for(i.callbacks=null,i=0;i<u.length;i++)hu(u[i],s)}var Wa=Qe(null),du=Qe(0);function fu(i,s){i=lo,gt(du,i),gt(Wa,s),lo=i|s.baseLanes}function Qa(){gt(du,lo),gt(Wa,Wa.current)}function Ni(){lo=du.current,lt(Wa),lt(du)}var fa=0,ni=null,Ci=null,En=null,Mc=!1,Pl=!1,gr=!1,No=0,xt=0,zt=null,pu=0;function dn(){throw Error(E(321))}function jo(i,s){if(s===null)return!1;for(var u=0;u<s.length&&u<i.length;u++)if(!kr(i[u],s[u]))return!1;return!0}function lr(i,s,u,p,b,C){return fa=C,ni=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Ke.H=i===null||i.memoizedState===null?ga:As,gr=!1,C=u(p,b),gr=!1,Pl&&(C=er(s,u,p,b)),uh(i),C}function uh(i){Ke.H=ur;var s=Ci!==null&&Ci.next!==null;if(fa=0,En=Ci=ni=null,Mc=!1,xt=0,zt=null,s)throw Error(E(300));i===null||yr||(i=i.dependencies,i!==null&&bc(i)&&(yr=!0))}function er(i,s,u,p){ni=i;var b=0;do{if(Pl&&(zt=null),xt=0,Pl=!1,25<=b)throw Error(E(301));if(b+=1,En=Ci=null,i.updateQueue!=null){var C=i.updateQueue;C.lastEffect=null,C.events=null,C.stores=null,C.memoCache!=null&&(C.memoCache.index=0)}Ke.H=qo,C=s(u,p)}while(Pl);return C}function id(){var i=Ke.H,s=i.useState()[0];return s=typeof s.then=="function"?Uo(s):s,i=i.useState()[0],(Ci!==null?Ci.memoizedState:null)!==i&&(ni.flags|=1024),s}function Ms(){var i=No!==0;return No=0,i}function Ki(i,s,u){s.updateQueue=i.updateQueue,s.flags&=-2053,i.lanes&=~u}function an(i){if(Mc){for(i=i.memoizedState;i!==null;){var s=i.queue;s!==null&&(s.pending=null),i=i.next}Mc=!1}fa=0,En=Ci=ni=null,Pl=!1,xt=No=0,zt=null}function Cr(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return En===null?ni.memoizedState=En=i:En=En.next=i,En}function ji(){if(Ci===null){var i=ni.alternate;i=i!==null?i.memoizedState:null}else i=Ci.next;var s=En===null?ni.memoizedState:En.next;if(s!==null)En=s,Ci=i;else{if(i===null)throw ni.alternate===null?Error(E(467)):Error(E(310));Ci=i,i={memoizedState:Ci.memoizedState,baseState:Ci.baseState,baseQueue:Ci.baseQueue,queue:Ci.queue,next:null},En===null?ni.memoizedState=En=i:En=En.next=i}return En}function Ja(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Uo(i){var s=xt;return xt+=1,zt===null&&(zt=[]),i=cu(zt,i,s),s=ni,(En===null?s.memoizedState:En.next)===null&&(s=s.alternate,Ke.H=s===null||s.memoizedState===null?ga:As),i}function Vo(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return Uo(i);if(i.$$typeof===Tt)return Tn(i)}throw Error(E(438,String(i)))}function Es(i){var s=null,u=ni.updateQueue;if(u!==null&&(s=u.memoCache),s==null){var p=ni.alternate;p!==null&&(p=p.updateQueue,p!==null&&(p=p.memoCache,p!=null&&(s={data:p.data.map(function(b){return b.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),u===null&&(u=Ja(),ni.updateQueue=u),u.memoCache=s,u=s.data[s.index],u===void 0)for(u=s.data[s.index]=Array(i),p=0;p<i;p++)u[p]=Jt;return s.index++,u}function ta(i,s){return typeof s=="function"?s(i):s}function Rl(i){var s=ji();return Dl(s,Ci,i)}function Dl(i,s,u){var p=i.queue;if(p===null)throw Error(E(311));p.lastRenderedReducer=u;var b=i.baseQueue,C=p.pending;if(C!==null){if(b!==null){var G=b.next;b.next=C.next,C.next=G}s.baseQueue=b=C,p.pending=null}if(C=i.baseState,b===null)i.memoizedState=C;else{s=b.next;var K=G=null,me=null,Fe=s,tt=!1;do{var at=Fe.lane&-536870913;if(at!==Fe.lane?(xi&at)===at:(fa&at)===at){var Ue=Fe.revertLane;if(Ue===0)me!==null&&(me=me.next={lane:0,revertLane:0,action:Fe.action,hasEagerState:Fe.hasEagerState,eagerState:Fe.eagerState,next:null}),at===bs&&(tt=!0);else if((fa&Ue)===Ue){Fe=Fe.next,Ue===bs&&(tt=!0);continue}else at={lane:0,revertLane:Fe.revertLane,action:Fe.action,hasEagerState:Fe.hasEagerState,eagerState:Fe.eagerState,next:null},me===null?(K=me=at,G=C):me=me.next=at,ni.lanes|=Ue,Fl|=Ue;at=Fe.action,gr&&u(C,at),C=Fe.hasEagerState?Fe.eagerState:u(C,at)}else Ue={lane:at,revertLane:Fe.revertLane,action:Fe.action,hasEagerState:Fe.hasEagerState,eagerState:Fe.eagerState,next:null},me===null?(K=me=Ue,G=C):me=me.next=Ue,ni.lanes|=at,Fl|=at;Fe=Fe.next}while(Fe!==null&&Fe!==s);if(me===null?G=C:me.next=K,!kr(C,i.memoizedState)&&(yr=!0,tt&&(u=ws,u!==null)))throw u;i.memoizedState=C,i.baseState=G,i.baseQueue=me,p.lastRenderedState=C}return b===null&&(p.lanes=0),[i.memoizedState,p.dispatch]}function Ec(i){var s=ji(),u=s.queue;if(u===null)throw Error(E(311));u.lastRenderedReducer=i;var p=u.dispatch,b=u.pending,C=s.memoizedState;if(b!==null){u.pending=null;var G=b=b.next;do C=i(C,G.action),G=G.next;while(G!==b);kr(C,s.memoizedState)||(yr=!0),s.memoizedState=C,s.baseQueue===null&&(s.baseState=C),u.lastRenderedState=C}return[C,p]}function f(i,s,u){var p=ni,b=ji(),C=Si;if(C){if(u===void 0)throw Error(E(407));u=u()}else u=s();var G=!kr((Ci||b).memoizedState,u);G&&(b.memoizedState=u,yr=!0),b=b.queue;var K=l.bind(null,p,b,i);if(we(2048,8,K,[i]),b.getSnapshot!==s||G||En!==null&&En.memoizedState.tag&1){if(p.flags|=2048,oe(9,pe(),n.bind(null,p,b,u,s),null),Oi===null)throw Error(E(349));C||(fa&124)!==0||e(p,s,u)}return u}function e(i,s,u){i.flags|=16384,i={getSnapshot:s,value:u},s=ni.updateQueue,s===null?(s=Ja(),ni.updateQueue=s,s.stores=[i]):(u=s.stores,u===null?s.stores=[i]:u.push(i))}function n(i,s,u,p){s.value=u,s.getSnapshot=p,h(s)&&m(i)}function l(i,s,u){return u(function(){h(s)&&m(i)})}function h(i){var s=i.getSnapshot;i=i.value;try{var u=s();return!kr(i,u)}catch{return!0}}function m(i){var s=Pa(i,2);s!==null&&ja(s,i,2)}function y(i){var s=Cr();if(typeof i=="function"){var u=i;if(i=u(),gr){nr(!0);try{u()}finally{nr(!1)}}}return s.memoizedState=s.baseState=i,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ta,lastRenderedState:i},s}function S(i,s,u,p){return i.baseState=u,Dl(i,Ci,typeof p=="function"?p:ta)}function M(i,s,u,p,b){if(no(i))throw Error(E(485));if(i=s.action,i!==null){var C={payload:b,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(G){C.listeners.push(G)}};Ke.T!==null?u(!0):C.isTransition=!1,p(C),u=s.pending,u===null?(C.next=s.pending=C,R(s,C)):(C.next=u.next,s.pending=u.next=C)}}function R(i,s){var u=s.action,p=s.payload,b=i.state;if(s.isTransition){var C=Ke.T,G={};Ke.T=G;try{var K=u(b,p),me=Ke.S;me!==null&&me(G,K),I(i,s,K)}catch(Fe){O(i,s,Fe)}finally{Ke.T=C}}else try{C=u(b,p),I(i,s,C)}catch(Fe){O(i,s,Fe)}}function I(i,s,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(p){B(i,s,p)},function(p){return O(i,s,p)}):B(i,s,u)}function B(i,s,u){s.status="fulfilled",s.value=u,j(s),i.state=u,s=i.pending,s!==null&&(u=s.next,u===s?i.pending=null:(u=u.next,s.next=u,R(i,u)))}function O(i,s,u){var p=i.pending;if(i.pending=null,p!==null){p=p.next;do s.status="rejected",s.reason=u,j(s),s=s.next;while(s!==p)}i.action=null}function j(i){i=i.listeners;for(var s=0;s<i.length;s++)(0,i[s])()}function Z(i,s){return s}function ie(i,s){if(Si){var u=Oi.formState;if(u!==null){e:{var p=ni;if(Si){if(xn){t:{for(var b=xn,C=ha;b.nodeType!==8;){if(!C){b=null;break t}if(b=va(b.nextSibling),b===null){b=null;break t}}C=b.data,b=C==="F!"||C==="F"?b:null}if(b){xn=va(b.nextSibling),p=b.data==="F!";break e}}$s(p)}p=!1}p&&(s=u[0])}}return u=Cr(),u.memoizedState=u.baseState=s,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Z,lastRenderedState:s},u.queue=p,u=Cs.bind(null,ni,p),p.dispatch=u,p=y(!1),C=ma.bind(null,ni,!1,p.queue),p=Cr(),b={state:s,dispatch:null,action:i,pending:null},p.queue=b,u=M.bind(null,ni,b,C,u),b.dispatch=u,p.memoizedState=i,[s,u,!1]}function te(i){var s=ji();return ne(s,Ci,i)}function ne(i,s,u){if(s=Dl(i,s,Z)[0],i=Rl(ta)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var p=Uo(s)}catch(G){throw G===Sc?Qs:G}else p=s;s=ji();var b=s.queue,C=b.dispatch;return u!==s.memoizedState&&(ni.flags|=2048,oe(9,pe(),se.bind(null,b,u),null)),[p,C,i]}function se(i,s){i.action=s}function ue(i){var s=ji(),u=Ci;if(u!==null)return ne(s,u,i);ji(),s=s.memoizedState,u=ji();var p=u.queue.dispatch;return u.memoizedState=i,[s,p,!1]}function oe(i,s,u,p){return i={tag:i,create:u,deps:p,inst:s,next:null},s=ni.updateQueue,s===null&&(s=Ja(),ni.updateQueue=s),u=s.lastEffect,u===null?s.lastEffect=i.next=i:(p=u.next,u.next=i,i.next=p,s.lastEffect=i),i}function pe(){return{destroy:void 0,resource:void 0}}function ge(){return ji().memoizedState}function le(i,s,u,p){var b=Cr();p=p===void 0?null:p,ni.flags|=i,b.memoizedState=oe(1|s,pe(),u,p)}function we(i,s,u,p){var b=ji();p=p===void 0?null:p;var C=b.memoizedState.inst;Ci!==null&&p!==null&&jo(p,Ci.memoizedState.deps)?b.memoizedState=oe(s,C,u,p):(ni.flags|=i,b.memoizedState=oe(1|s,C,u,p))}function Oe(i,s){le(8390656,8,i,s)}function Re(i,s){we(2048,8,i,s)}function De(i,s){return we(4,2,i,s)}function Be(i,s){return we(4,4,i,s)}function dt(i,s){if(typeof s=="function"){i=i();var u=s(i);return function(){typeof u=="function"?u():s(null)}}if(s!=null)return i=i(),s.current=i,function(){s.current=null}}function ut(i,s,u){u=u!=null?u.concat([i]):null,we(4,4,dt.bind(null,s,i),u)}function it(){}function wt(i,s){var u=ji();s=s===void 0?null:s;var p=u.memoizedState;return s!==null&&jo(s,p[1])?p[0]:(u.memoizedState=[i,s],i)}function Wt(i,s){var u=ji();s=s===void 0?null:s;var p=u.memoizedState;if(s!==null&&jo(s,p[1]))return p[0];if(p=i(),gr){nr(!0);try{i()}finally{nr(!1)}}return u.memoizedState=[p,s],p}function gi(i,s,u){return u===void 0||(fa&1073741824)!==0?i.memoizedState=s:(i.memoizedState=u,i=jp(),ni.lanes|=i,Fl|=i,u)}function sn(i,s,u,p){return kr(u,s)?u:Wa.current!==null?(i=gi(i,u,p),kr(i,s)||(yr=!0),i):(fa&42)===0?(yr=!0,i.memoizedState=u):(i=jp(),ni.lanes|=i,Fl|=i,s)}function Ai(i,s,u,p,b){var C=yt.p;yt.p=C!==0&&8>C?C:8;var G=Ke.T,K={};Ke.T=K,ma(i,!1,s,u);try{var me=b(),Fe=Ke.S;if(Fe!==null&&Fe(K,me),me!==null&&typeof me=="object"&&typeof me.then=="function"){var tt=La(me,p);pa(i,s,tt,ya(i))}else pa(i,s,p,ya(i))}catch(at){pa(i,s,{then:function(){},status:"rejected",reason:at},ya())}finally{yt.p=C,Ke.T=G}}function un(){}function zi(i,s,u,p){if(i.tag!==5)throw Error(E(476));var b=Pi(i).queue;Ai(i,b,s,It,u===null?un:function(){return Ii(i),u(p)})}function Pi(i){var s=i.memoizedState;if(s!==null)return s;s={memoizedState:It,baseState:It,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ta,lastRenderedState:It},next:null};var u={};return s.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ta,lastRenderedState:u},next:null},i.memoizedState=s,i=i.alternate,i!==null&&(i.memoizedState=s),s}function Ii(i){var s=Pi(i).next.queue;pa(i,s,{},ya())}function Gn(){return Tn(Q)}function hi(){return ji().memoizedState}function qn(){return ji().memoizedState}function cr(i){for(var s=i.return;s!==null;){switch(s.tag){case 24:case 3:var u=ya();i=Ka(u);var p=Ts(s,i,u);p!==null&&(ja(p,s,u),eo(p,s,u)),s={cache:Ys()},i.payload=s;return}s=s.return}}function io(i,s,u){var p=ya();u={lane:p,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null},no(i)?Il(s,u):(u=Ao(i,s,u,p),u!==null&&(ja(u,i,p),Go(u,s,p)))}function Cs(i,s,u){var p=ya();pa(i,s,u,p)}function pa(i,s,u,p){var b={lane:p,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null};if(no(i))Il(s,b);else{var C=i.alternate;if(i.lanes===0&&(C===null||C.lanes===0)&&(C=s.lastRenderedReducer,C!==null))try{var G=s.lastRenderedState,K=C(G,u);if(b.hasEagerState=!0,b.eagerState=K,kr(K,G))return Co(i,s,b,0),Oi===null&&Eo(),!1}catch{}finally{}if(u=Ao(i,s,b,p),u!==null)return ja(u,i,p),Go(u,s,p),!0}return!1}function ma(i,s,u,p){if(p={lane:2,revertLane:jl(),action:p,hasEagerState:!1,eagerState:null,next:null},no(i)){if(s)throw Error(E(479))}else s=Ao(i,u,p,2),s!==null&&ja(s,i,2)}function no(i){var s=i.alternate;return i===ni||s!==null&&s===ni}function Il(i,s){Pl=Mc=!0;var u=i.pending;u===null?s.next=s:(s.next=u.next,u.next=s),i.pending=s}function Go(i,s,u){if((u&4194048)!==0){var p=s.lanes;p&=i.pendingLanes,u|=p,s.lanes=u,_e(i,u)}}var ur={readContext:Tn,use:Vo,useCallback:dn,useContext:dn,useEffect:dn,useImperativeHandle:dn,useLayoutEffect:dn,useInsertionEffect:dn,useMemo:dn,useReducer:dn,useRef:dn,useState:dn,useDebugValue:dn,useDeferredValue:dn,useTransition:dn,useSyncExternalStore:dn,useId:dn,useHostTransitionStatus:dn,useFormState:dn,useActionState:dn,useOptimistic:dn,useMemoCache:dn,useCacheRefresh:dn},ga={readContext:Tn,use:Vo,useCallback:function(i,s){return Cr().memoizedState=[i,s===void 0?null:s],i},useContext:Tn,useEffect:Oe,useImperativeHandle:function(i,s,u){u=u!=null?u.concat([i]):null,le(4194308,4,dt.bind(null,s,i),u)},useLayoutEffect:function(i,s){return le(4194308,4,i,s)},useInsertionEffect:function(i,s){le(4,2,i,s)},useMemo:function(i,s){var u=Cr();s=s===void 0?null:s;var p=i();if(gr){nr(!0);try{i()}finally{nr(!1)}}return u.memoizedState=[p,s],p},useReducer:function(i,s,u){var p=Cr();if(u!==void 0){var b=u(s);if(gr){nr(!0);try{u(s)}finally{nr(!1)}}}else b=s;return p.memoizedState=p.baseState=b,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:b},p.queue=i,i=i.dispatch=io.bind(null,ni,i),[p.memoizedState,i]},useRef:function(i){var s=Cr();return i={current:i},s.memoizedState=i},useState:function(i){i=y(i);var s=i.queue,u=Cs.bind(null,ni,s);return s.dispatch=u,[i.memoizedState,u]},useDebugValue:it,useDeferredValue:function(i,s){var u=Cr();return gi(u,i,s)},useTransition:function(){var i=y(!1);return i=Ai.bind(null,ni,i.queue,!0,!1),Cr().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,s,u){var p=ni,b=Cr();if(Si){if(u===void 0)throw Error(E(407));u=u()}else{if(u=s(),Oi===null)throw Error(E(349));(xi&124)!==0||e(p,s,u)}b.memoizedState=u;var C={value:u,getSnapshot:s};return b.queue=C,Oe(l.bind(null,p,C,i),[i]),p.flags|=2048,oe(9,pe(),n.bind(null,p,C,u,s),null),u},useId:function(){var i=Cr(),s=Oi.identifierPrefix;if(Si){var u=Kr,p=Ia;u=(p&~(1<<32-rr(p)-1)).toString(32)+u,s="«"+s+"R"+u,u=No++,0<u&&(s+="H"+u.toString(32)),s+="»"}else u=pu++,s="«"+s+"r"+u.toString(32)+"»";return i.memoizedState=s},useHostTransitionStatus:Gn,useFormState:ie,useActionState:ie,useOptimistic:function(i){var s=Cr();s.memoizedState=s.baseState=i;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=u,s=ma.bind(null,ni,!0,u),u.dispatch=s,[i,s]},useMemoCache:Es,useCacheRefresh:function(){return Cr().memoizedState=cr.bind(null,ni)}},As={readContext:Tn,use:Vo,useCallback:wt,useContext:Tn,useEffect:Re,useImperativeHandle:ut,useInsertionEffect:De,useLayoutEffect:Be,useMemo:Wt,useReducer:Rl,useRef:ge,useState:function(){return Rl(ta)},useDebugValue:it,useDeferredValue:function(i,s){var u=ji();return sn(u,Ci.memoizedState,i,s)},useTransition:function(){var i=Rl(ta)[0],s=ji().memoizedState;return[typeof i=="boolean"?i:Uo(i),s]},useSyncExternalStore:f,useId:hi,useHostTransitionStatus:Gn,useFormState:te,useActionState:te,useOptimistic:function(i,s){var u=ji();return S(u,Ci,i,s)},useMemoCache:Es,useCacheRefresh:qn},qo={readContext:Tn,use:Vo,useCallback:wt,useContext:Tn,useEffect:Re,useImperativeHandle:ut,useInsertionEffect:De,useLayoutEffect:Be,useMemo:Wt,useReducer:Ec,useRef:ge,useState:function(){return Ec(ta)},useDebugValue:it,useDeferredValue:function(i,s){var u=ji();return Ci===null?gi(u,i,s):sn(u,Ci.memoizedState,i,s)},useTransition:function(){var i=Ec(ta)[0],s=ji().memoizedState;return[typeof i=="boolean"?i:Uo(i),s]},useSyncExternalStore:f,useId:hi,useHostTransitionStatus:Gn,useFormState:ue,useActionState:ue,useOptimistic:function(i,s){var u=ji();return Ci!==null?S(u,Ci,i,s):(u.baseState=i,[i,u.queue.dispatch])},useMemoCache:Es,useCacheRefresh:qn},Ui=null,Ri=0;function tr(i){var s=Ri;return Ri+=1,Ui===null&&(Ui=[]),cu(Ui,i,s)}function fn(i,s){s=s.props.ref,i.ref=s!==void 0?s:null}function Cc(i,s){throw s.$$typeof===Te?Error(E(525)):(i=Object.prototype.toString.call(s),Error(E(31,i==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":i)))}function nd(i){var s=i._init;return s(i._payload)}function mu(i){function s(Pe,Me){if(i){var Le=Pe.deletions;Le===null?(Pe.deletions=[Me],Pe.flags|=16):Le.push(Me)}}function u(Pe,Me){if(!i)return null;for(;Me!==null;)s(Pe,Me),Me=Me.sibling;return null}function p(Pe){for(var Me=new Map;Pe!==null;)Pe.key!==null?Me.set(Pe.key,Pe):Me.set(Pe.index,Pe),Pe=Pe.sibling;return Me}function b(Pe,Me){return Pe=Tr(Pe,Me),Pe.index=0,Pe.sibling=null,Pe}function C(Pe,Me,Le){return Pe.index=Le,i?(Le=Pe.alternate,Le!==null?(Le=Le.index,Le<Me?(Pe.flags|=67108866,Me):Le):(Pe.flags|=67108866,Me)):(Pe.flags|=1048576,Me)}function G(Pe){return i&&Pe.alternate===null&&(Pe.flags|=67108866),Pe}function K(Pe,Me,Le,rt){return Me===null||Me.tag!==6?(Me=nh(Le,Pe.mode,rt),Me.return=Pe,Me):(Me=b(Me,Le),Me.return=Pe,Me)}function me(Pe,Me,Le,rt){var Pt=Le.type;return Pt===Ee?tt(Pe,Me,Le.props.children,rt,Le.key):Me!==null&&(Me.elementType===Pt||typeof Pt=="object"&&Pt!==null&&Pt.$$typeof===Di&&nd(Pt)===Me.type)?(Me=b(Me,Le.props),fn(Me,Le),Me.return=Pe,Me):(Me=_c(Le.type,Le.key,Le.props,null,Pe.mode,rt),fn(Me,Le),Me.return=Pe,Me)}function Fe(Pe,Me,Le,rt){return Me===null||Me.tag!==4||Me.stateNode.containerInfo!==Le.containerInfo||Me.stateNode.implementation!==Le.implementation?(Me=rh(Le,Pe.mode,rt),Me.return=Pe,Me):(Me=b(Me,Le.children||[]),Me.return=Pe,Me)}function tt(Pe,Me,Le,rt,Pt){return Me===null||Me.tag!==7?(Me=Da(Le,Pe.mode,rt,Pt),Me.return=Pe,Me):(Me=b(Me,Le),Me.return=Pe,Me)}function at(Pe,Me,Le){if(typeof Me=="string"&&Me!==""||typeof Me=="number"||typeof Me=="bigint")return Me=nh(""+Me,Pe.mode,Le),Me.return=Pe,Me;if(typeof Me=="object"&&Me!==null){switch(Me.$$typeof){case xe:return Le=_c(Me.type,Me.key,Me.props,null,Pe.mode,Le),fn(Le,Me),Le.return=Pe,Le;case de:return Me=rh(Me,Pe.mode,Le),Me.return=Pe,Me;case Di:var rt=Me._init;return Me=rt(Me._payload),at(Pe,Me,Le)}if(Ei(Me)||en(Me))return Me=Da(Me,Pe.mode,Le,null),Me.return=Pe,Me;if(typeof Me.then=="function")return at(Pe,tr(Me),Le);if(Me.$$typeof===Tt)return at(Pe,xs(Pe,Me),Le);Cc(Pe,Me)}return null}function Ue(Pe,Me,Le,rt){var Pt=Me!==null?Me.key:null;if(typeof Le=="string"&&Le!==""||typeof Le=="number"||typeof Le=="bigint")return Pt!==null?null:K(Pe,Me,""+Le,rt);if(typeof Le=="object"&&Le!==null){switch(Le.$$typeof){case xe:return Le.key===Pt?me(Pe,Me,Le,rt):null;case de:return Le.key===Pt?Fe(Pe,Me,Le,rt):null;case Di:return Pt=Le._init,Le=Pt(Le._payload),Ue(Pe,Me,Le,rt)}if(Ei(Le)||en(Le))return Pt!==null?null:tt(Pe,Me,Le,rt,null);if(typeof Le.then=="function")return Ue(Pe,Me,tr(Le),rt);if(Le.$$typeof===Tt)return Ue(Pe,Me,xs(Pe,Le),rt);Cc(Pe,Le)}return null}function Ge(Pe,Me,Le,rt,Pt){if(typeof rt=="string"&&rt!==""||typeof rt=="number"||typeof rt=="bigint")return Pe=Pe.get(Le)||null,K(Me,Pe,""+rt,Pt);if(typeof rt=="object"&&rt!==null){switch(rt.$$typeof){case xe:return Pe=Pe.get(rt.key===null?Le:rt.key)||null,me(Me,Pe,rt,Pt);case de:return Pe=Pe.get(rt.key===null?Le:rt.key)||null,Fe(Me,Pe,rt,Pt);case Di:var pi=rt._init;return rt=pi(rt._payload),Ge(Pe,Me,Le,rt,Pt)}if(Ei(rt)||en(rt))return Pe=Pe.get(Le)||null,tt(Me,Pe,rt,Pt,null);if(typeof rt.then=="function")return Ge(Pe,Me,Le,tr(rt),Pt);if(rt.$$typeof===Tt)return Ge(Pe,Me,Le,xs(Me,rt),Pt);Cc(Me,rt)}return null}function jt(Pe,Me,Le,rt){for(var Pt=null,pi=null,Nt=Me,Ht=Me=0,Ji=null;Nt!==null&&Ht<Le.length;Ht++){Nt.index>Ht?(Ji=Nt,Nt=null):Ji=Nt.sibling;var bi=Ue(Pe,Nt,Le[Ht],rt);if(bi===null){Nt===null&&(Nt=Ji);break}i&&Nt&&bi.alternate===null&&s(Pe,Nt),Me=C(bi,Me,Ht),pi===null?Pt=bi:pi.sibling=bi,pi=bi,Nt=Ji}if(Ht===Le.length)return u(Pe,Nt),Si&&ua(Pe,Ht),Pt;if(Nt===null){for(;Ht<Le.length;Ht++)Nt=at(Pe,Le[Ht],rt),Nt!==null&&(Me=C(Nt,Me,Ht),pi===null?Pt=Nt:pi.sibling=Nt,pi=Nt);return Si&&ua(Pe,Ht),Pt}for(Nt=p(Nt);Ht<Le.length;Ht++)Ji=Ge(Nt,Pe,Ht,Le[Ht],rt),Ji!==null&&(i&&Ji.alternate!==null&&Nt.delete(Ji.key===null?Ht:Ji.key),Me=C(Ji,Me,Ht),pi===null?Pt=Ji:pi.sibling=Ji,pi=Ji);return i&&Nt.forEach(function(nl){return s(Pe,nl)}),Si&&ua(Pe,Ht),Pt}function Gt(Pe,Me,Le,rt){if(Le==null)throw Error(E(151));for(var Pt=null,pi=null,Nt=Me,Ht=Me=0,Ji=null,bi=Le.next();Nt!==null&&!bi.done;Ht++,bi=Le.next()){Nt.index>Ht?(Ji=Nt,Nt=null):Ji=Nt.sibling;var nl=Ue(Pe,Nt,bi.value,rt);if(nl===null){Nt===null&&(Nt=Ji);break}i&&Nt&&nl.alternate===null&&s(Pe,Nt),Me=C(nl,Me,Ht),pi===null?Pt=nl:pi.sibling=nl,pi=nl,Nt=Ji}if(bi.done)return u(Pe,Nt),Si&&ua(Pe,Ht),Pt;if(Nt===null){for(;!bi.done;Ht++,bi=Le.next())bi=at(Pe,bi.value,rt),bi!==null&&(Me=C(bi,Me,Ht),pi===null?Pt=bi:pi.sibling=bi,pi=bi);return Si&&ua(Pe,Ht),Pt}for(Nt=p(Nt);!bi.done;Ht++,bi=Le.next())bi=Ge(Nt,Pe,Ht,bi.value,rt),bi!==null&&(i&&bi.alternate!==null&&Nt.delete(bi.key===null?Ht:bi.key),Me=C(bi,Me,Ht),pi===null?Pt=bi:pi.sibling=bi,pi=bi);return i&&Nt.forEach(function(jm){return s(Pe,jm)}),Si&&ua(Pe,Ht),Pt}function $i(Pe,Me,Le,rt){if(typeof Le=="object"&&Le!==null&&Le.type===Ee&&Le.key===null&&(Le=Le.props.children),typeof Le=="object"&&Le!==null){switch(Le.$$typeof){case xe:e:{for(var Pt=Le.key;Me!==null;){if(Me.key===Pt){if(Pt=Le.type,Pt===Ee){if(Me.tag===7){u(Pe,Me.sibling),rt=b(Me,Le.props.children),rt.return=Pe,Pe=rt;break e}}else if(Me.elementType===Pt||typeof Pt=="object"&&Pt!==null&&Pt.$$typeof===Di&&nd(Pt)===Me.type){u(Pe,Me.sibling),rt=b(Me,Le.props),fn(rt,Le),rt.return=Pe,Pe=rt;break e}u(Pe,Me);break}else s(Pe,Me);Me=Me.sibling}Le.type===Ee?(rt=Da(Le.props.children,Pe.mode,rt,Le.key),rt.return=Pe,Pe=rt):(rt=_c(Le.type,Le.key,Le.props,null,Pe.mode,rt),fn(rt,Le),rt.return=Pe,Pe=rt)}return G(Pe);case de:e:{for(Pt=Le.key;Me!==null;){if(Me.key===Pt)if(Me.tag===4&&Me.stateNode.containerInfo===Le.containerInfo&&Me.stateNode.implementation===Le.implementation){u(Pe,Me.sibling),rt=b(Me,Le.children||[]),rt.return=Pe,Pe=rt;break e}else{u(Pe,Me);break}else s(Pe,Me);Me=Me.sibling}rt=rh(Le,Pe.mode,rt),rt.return=Pe,Pe=rt}return G(Pe);case Di:return Pt=Le._init,Le=Pt(Le._payload),$i(Pe,Me,Le,rt)}if(Ei(Le))return jt(Pe,Me,Le,rt);if(en(Le)){if(Pt=en(Le),typeof Pt!="function")throw Error(E(150));return Le=Pt.call(Le),Gt(Pe,Me,Le,rt)}if(typeof Le.then=="function")return $i(Pe,Me,tr(Le),rt);if(Le.$$typeof===Tt)return $i(Pe,Me,xs(Pe,Le),rt);Cc(Pe,Le)}return typeof Le=="string"&&Le!==""||typeof Le=="number"||typeof Le=="bigint"?(Le=""+Le,Me!==null&&Me.tag===6?(u(Pe,Me.sibling),rt=b(Me,Le),rt.return=Pe,Pe=rt):(u(Pe,Me),rt=nh(Le,Pe.mode,rt),rt.return=Pe,Pe=rt),G(Pe)):u(Pe,Me)}return function(Pe,Me,Le,rt){try{Ri=0;var Pt=$i(Pe,Me,Le,rt);return Ui=null,Pt}catch(Nt){if(Nt===Sc||Nt===Qs)throw Nt;var pi=Sr(29,Nt,null,Pe.mode);return pi.lanes=rt,pi.return=Pe,pi}finally{}}}var es=mu(!0),Zo=mu(!1),Nn=Qe(null),Wi=null;function _r(i){var s=i.alternate;gt(Cn,Cn.current&1),gt(Nn,i),Wi===null&&(s===null||Wa.current!==null||s.memoizedState!==null)&&(Wi=i)}function gu(i){if(i.tag===22){if(gt(Cn,Cn.current),gt(Nn,i),Wi===null){var s=i.alternate;s!==null&&s.memoizedState!==null&&(Wi=i)}}else Ar()}function Ar(){gt(Cn,Cn.current),gt(Nn,Nn.current)}function Ba(i){lt(Nn),Wi===i&&(Wi=null),lt(Cn)}var Cn=Qe(0);function ro(i){for(var s=i;s!==null;){if(s.tag===13){var u=s.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||ku(u)))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}function rd(i,s,u,p){s=i.memoizedState,u=u(p,s),u=u==null?s:re({},s,u),i.memoizedState=u,i.lanes===0&&(i.updateQueue.baseState=u)}var $o={enqueueSetState:function(i,s,u){i=i._reactInternals;var p=ya(),b=Ka(p);b.payload=s,u!=null&&(b.callback=u),s=Ts(i,b,p),s!==null&&(ja(s,i,p),eo(s,i,p))},enqueueReplaceState:function(i,s,u){i=i._reactInternals;var p=ya(),b=Ka(p);b.tag=1,b.payload=s,u!=null&&(b.callback=u),s=Ts(i,b,p),s!==null&&(ja(s,i,p),eo(s,i,p))},enqueueForceUpdate:function(i,s){i=i._reactInternals;var u=ya(),p=Ka(u);p.tag=2,s!=null&&(p.callback=s),s=Ts(i,p,u),s!==null&&(ja(s,i,u),eo(s,i,u))}};function kl(i,s,u,p,b,C,G){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(p,C,G):s.prototype&&s.prototype.isPureReactComponent?!Sl(u,p)||!Sl(b,C):!0}function Jd(i,s,u,p){i=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(u,p),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(u,p),s.state!==i&&$o.enqueueReplaceState(s,s.state,null)}function Ac(i,s){var u=s;if("ref"in s){u={};for(var p in s)p!=="ref"&&(u[p]=s[p])}if(i=i.defaultProps){u===s&&(u=re({},u));for(var b in i)u[b]===void 0&&(u[b]=i[b])}return u}var _u=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)};function ef(i){_u(i)}function Ep(i){console.error(i)}function tf(i){_u(i)}function ad(i,s){try{var u=i.onUncaughtError;u(s.value,{componentStack:s.stack})}catch(p){setTimeout(function(){throw p})}}function sd(i,s,u){try{var p=i.onCaughtError;p(u.value,{componentStack:u.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function nf(i,s,u){return u=Ka(u),u.tag=3,u.payload={element:null},u.callback=function(){ad(i,s)},u}function od(i){return i=Ka(i),i.tag=3,i}function rf(i,s,u,p){var b=u.type.getDerivedStateFromError;if(typeof b=="function"){var C=p.value;i.payload=function(){return b(C)},i.callback=function(){sd(s,u,p)}}var G=u.stateNode;G!==null&&typeof G.componentDidCatch=="function"&&(i.callback=function(){sd(s,u,p),typeof b!="function"&&(Wo===null?Wo=new Set([this]):Wo.add(this));var K=p.stack;this.componentDidCatch(p.value,{componentStack:K!==null?K:""})})}function Cp(i,s,u,p,b){if(u.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){if(s=u.alternate,s!==null&&Oo(s,u,b,!0),u=Nn.current,u!==null){switch(u.tag){case 13:return Wi===null?Af():u.alternate===null&&jn===0&&(jn=3),u.flags&=-257,u.flags|=65536,u.lanes=b,p===Js?u.flags|=16384:(s=u.updateQueue,s===null?u.updateQueue=new Set([p]):s.add(p),Lf(i,p,b)),!1;case 22:return u.flags|=65536,p===Js?u.flags|=16384:(s=u.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([p])},u.updateQueue=s):(u=s.retryQueue,u===null?s.retryQueue=new Set([p]):u.add(p)),Lf(i,p,b)),!1}throw Error(E(435,u.tag))}return Lf(i,p,b),Af(),!1}if(Si)return s=Nn.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=b,p!==au&&(i=Error(E(422),{cause:p}),da(Xr(i,u)))):(p!==au&&(s=Error(E(423),{cause:p}),da(Xr(s,u))),i=i.current.alternate,i.flags|=65536,b&=-b,i.lanes|=b,p=Xr(p,u),b=nf(i.stateNode,p,b),oh(i,b),jn!==4&&(jn=2)),!1;var C=Error(E(520),{cause:p});if(C=Xr(C,u),Mh===null?Mh=[C]:Mh.push(C),jn!==4&&(jn=2),s===null)return!0;p=Xr(p,u),u=s;do{switch(u.tag){case 3:return u.flags|=65536,i=b&-b,u.lanes|=i,i=nf(u.stateNode,p,i),oh(u,i),!1;case 1:if(s=u.type,C=u.stateNode,(u.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||C!==null&&typeof C.componentDidCatch=="function"&&(Wo===null||!Wo.has(C))))return u.flags|=65536,b&=-b,u.lanes|=b,b=od(b),rf(b,i,u,p),oh(u,b),!1}u=u.return}while(u!==null);return!1}var zc=Error(E(461)),yr=!1;function Zn(i,s,u,p){s.child=i===null?Zo(s,null,u,p):es(s,i.child,u,p)}function hh(i,s,u,p,b){u=u.render;var C=s.ref;if("ref"in p){var G={};for(var K in p)K!=="ref"&&(G[K]=p[K])}else G=p;return Xs(s),p=lr(i,s,u,G,C,b),K=Ms(),i!==null&&!yr?(Ki(i,s,b),Ho(i,s,b)):(Si&&K&&ko(s),s.flags|=1,Zn(i,s,p,b),s.child)}function dh(i,s,u,p,b){if(i===null){var C=u.type;return typeof C=="function"&&!ti(C)&&C.defaultProps===void 0&&u.compare===null?(s.tag=15,s.type=C,af(i,s,C,p,b)):(i=_c(u.type,null,p,s,s.mode,b),i.ref=s.ref,i.return=s,s.child=i)}if(C=i.child,!dd(i,b)){var G=C.memoizedProps;if(u=u.compare,u=u!==null?u:Sl,u(G,p)&&i.ref===s.ref)return Ho(i,s,b)}return s.flags|=1,i=Tr(C,p),i.ref=s.ref,i.return=s,s.child=i}function af(i,s,u,p,b){if(i!==null){var C=i.memoizedProps;if(Sl(C,p)&&i.ref===s.ref)if(yr=!1,s.pendingProps=p=C,dd(i,b))(i.flags&131072)!==0&&(yr=!0);else return s.lanes=i.lanes,Ho(i,s,b)}return cd(i,s,u,p,b)}function sf(i,s,u){var p=s.pendingProps,b=p.children,C=i!==null?i.memoizedState:null;if(p.mode==="hidden"){if((s.flags&128)!==0){if(p=C!==null?C.baseLanes|u:u,i!==null){for(b=s.child=i.child,C=0;b!==null;)C=C|b.lanes|b.childLanes,b=b.sibling;s.childLanes=C&~p}else s.childLanes=0,s.child=null;return Ap(i,s,p,u)}if((u&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},i!==null&&ou(s,C!==null?C.cachePool:null),C!==null?fu(s,C):Qa(),gu(s);else return s.lanes=s.childLanes=536870912,Ap(i,s,C!==null?C.baseLanes|u:u,u)}else C!==null?(ou(s,C.cachePool),fu(s,C),Ar(),s.memoizedState=null):(i!==null&&ou(s,null),Qa(),Ar());return Zn(i,s,b,u),s.child}function Ap(i,s,u,p){var b=Ws();return b=b===null?null:{parent:Fn._currentValue,pool:b},s.memoizedState={baseLanes:u,cachePool:b},i!==null&&ou(s,null),Qa(),gu(s),i!==null&&Oo(i,s,p,!0),null}function ld(i,s){var u=s.ref;if(u===null)i!==null&&i.ref!==null&&(s.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(E(284));(i===null||i.ref!==u)&&(s.flags|=4194816)}}function cd(i,s,u,p,b){return Xs(s),u=lr(i,s,u,p,void 0,b),p=Ms(),i!==null&&!yr?(Ki(i,s,b),Ho(i,s,b)):(Si&&p&&ko(s),s.flags|=1,Zn(i,s,u,b),s.child)}function of(i,s,u,p,b,C){return Xs(s),s.updateQueue=null,u=er(s,p,u,b),uh(i),p=Ms(),i!==null&&!yr?(Ki(i,s,C),Ho(i,s,C)):(Si&&p&&ko(s),s.flags|=1,Zn(i,s,u,C),s.child)}function lf(i,s,u,p,b){if(Xs(s),s.stateNode===null){var C=Ra,G=u.contextType;typeof G=="object"&&G!==null&&(C=Tn(G)),C=new u(p,C),s.memoizedState=C.state!==null&&C.state!==void 0?C.state:null,C.updater=$o,s.stateNode=C,C._reactInternals=s,C=s.stateNode,C.props=p,C.state=s.memoizedState,C.refs={},Tc(s),G=u.contextType,C.context=typeof G=="object"&&G!==null?Tn(G):Ra,C.state=s.memoizedState,G=u.getDerivedStateFromProps,typeof G=="function"&&(rd(s,u,G,p),C.state=s.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof C.getSnapshotBeforeUpdate=="function"||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(G=C.state,typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount(),G!==C.state&&$o.enqueueReplaceState(C,C.state,null),to(s,p,C,b),Fo(),C.state=s.memoizedState),typeof C.componentDidMount=="function"&&(s.flags|=4194308),p=!0}else if(i===null){C=s.stateNode;var K=s.memoizedProps,me=Ac(u,K);C.props=me;var Fe=C.context,tt=u.contextType;G=Ra,typeof tt=="object"&&tt!==null&&(G=Tn(tt));var at=u.getDerivedStateFromProps;tt=typeof at=="function"||typeof C.getSnapshotBeforeUpdate=="function",K=s.pendingProps!==K,tt||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(K||Fe!==G)&&Jd(s,C,p,G),ea=!1;var Ue=s.memoizedState;C.state=Ue,to(s,p,C,b),Fo(),Fe=s.memoizedState,K||Ue!==Fe||ea?(typeof at=="function"&&(rd(s,u,at,p),Fe=s.memoizedState),(me=ea||kl(s,u,me,p,Ue,Fe,G))?(tt||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount()),typeof C.componentDidMount=="function"&&(s.flags|=4194308)):(typeof C.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=p,s.memoizedState=Fe),C.props=p,C.state=Fe,C.context=G,p=me):(typeof C.componentDidMount=="function"&&(s.flags|=4194308),p=!1)}else{C=s.stateNode,ii(i,s),G=s.memoizedProps,tt=Ac(u,G),C.props=tt,at=s.pendingProps,Ue=C.context,Fe=u.contextType,me=Ra,typeof Fe=="object"&&Fe!==null&&(me=Tn(Fe)),K=u.getDerivedStateFromProps,(Fe=typeof K=="function"||typeof C.getSnapshotBeforeUpdate=="function")||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(G!==at||Ue!==me)&&Jd(s,C,p,me),ea=!1,Ue=s.memoizedState,C.state=Ue,to(s,p,C,b),Fo();var Ge=s.memoizedState;G!==at||Ue!==Ge||ea||i!==null&&i.dependencies!==null&&bc(i.dependencies)?(typeof K=="function"&&(rd(s,u,K,p),Ge=s.memoizedState),(tt=ea||kl(s,u,tt,p,Ue,Ge,me)||i!==null&&i.dependencies!==null&&bc(i.dependencies))?(Fe||typeof C.UNSAFE_componentWillUpdate!="function"&&typeof C.componentWillUpdate!="function"||(typeof C.componentWillUpdate=="function"&&C.componentWillUpdate(p,Ge,me),typeof C.UNSAFE_componentWillUpdate=="function"&&C.UNSAFE_componentWillUpdate(p,Ge,me)),typeof C.componentDidUpdate=="function"&&(s.flags|=4),typeof C.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof C.componentDidUpdate!="function"||G===i.memoizedProps&&Ue===i.memoizedState||(s.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||G===i.memoizedProps&&Ue===i.memoizedState||(s.flags|=1024),s.memoizedProps=p,s.memoizedState=Ge),C.props=p,C.state=Ge,C.context=me,p=tt):(typeof C.componentDidUpdate!="function"||G===i.memoizedProps&&Ue===i.memoizedState||(s.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||G===i.memoizedProps&&Ue===i.memoizedState||(s.flags|=1024),p=!1)}return C=p,ld(i,s),p=(s.flags&128)!==0,C||p?(C=s.stateNode,u=p&&typeof u.getDerivedStateFromError!="function"?null:C.render(),s.flags|=1,i!==null&&p?(s.child=es(s,i.child,null,b),s.child=es(s,null,u,b)):Zn(i,s,u,b),s.memoizedState=C.state,i=s.child):i=Ho(i,s,b),i}function zp(i,s,u,p){return Cl(),s.flags|=256,Zn(i,s,u,p),s.child}var fh={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function ud(i){return{baseLanes:i,cachePool:wc()}}function ph(i,s,u){return i=i!==null?i.childLanes&~u:0,s&&(i|=rs),i}function yu(i,s,u){var p=s.pendingProps,b=!1,C=(s.flags&128)!==0,G;if((G=C)||(G=i!==null&&i.memoizedState===null?!1:(Cn.current&2)!==0),G&&(b=!0,s.flags&=-129),G=(s.flags&32)!==0,s.flags&=-33,i===null){if(Si){if(b?_r(s):Ar(),Si){var K=xn,me;if(me=K){e:{for(me=K,K=ha;me.nodeType!==8;){if(!K){K=null;break e}if(me=va(me.nextSibling),me===null){K=null;break e}}K=me}K!==null?(s.memoizedState={dehydrated:K,treeContext:Ha!==null?{id:Ia,overflow:Kr}:null,retryLane:536870912,hydrationErrors:null},me=Sr(18,null,null,0),me.stateNode=K,me.return=s,s.child=me,vn=s,xn=null,me=!0):me=!1}me||$s(s)}if(K=s.memoizedState,K!==null&&(K=K.dehydrated,K!==null))return ku(K)?s.lanes=32:s.lanes=536870912,null;Ba(s)}return K=p.children,p=p.fallback,b?(Ar(),b=s.mode,K=mh({mode:"hidden",children:K},b),p=Da(p,b,u,null),K.return=s,p.return=s,K.sibling=p,s.child=K,b=s.child,b.memoizedState=ud(u),b.childLanes=ph(i,G,u),s.memoizedState=fh,p):(_r(s),zr(s,K))}if(me=i.memoizedState,me!==null&&(K=me.dehydrated,K!==null)){if(C)s.flags&256?(_r(s),s.flags&=-257,s=gh(i,s,u)):s.memoizedState!==null?(Ar(),s.child=i.child,s.flags|=128,s=null):(Ar(),b=p.fallback,K=s.mode,p=mh({mode:"visible",children:p.children},K),b=Da(b,K,u,null),b.flags|=2,p.return=s,b.return=s,p.sibling=b,s.child=p,es(s,i.child,null,u),p=s.child,p.memoizedState=ud(u),p.childLanes=ph(i,G,u),s.memoizedState=fh,s=b);else if(_r(s),ku(K)){if(G=K.nextSibling&&K.nextSibling.dataset,G)var Fe=G.dgst;G=Fe,p=Error(E(419)),p.stack="",p.digest=G,da({value:p,source:null,stack:null}),s=gh(i,s,u)}else if(yr||Oo(i,s,u,!1),G=(u&i.childLanes)!==0,yr||G){if(G=Oi,G!==null&&(p=u&-u,p=(p&42)!==0?1:mt(p),p=(p&(G.suspendedLanes|u))!==0?0:p,p!==0&&p!==me.retryLane))throw me.retryLane=p,Pa(i,p),ja(G,i,p),zc;K.data==="$?"||Af(),s=gh(i,s,u)}else K.data==="$?"?(s.flags|=192,s.child=i.child,s=null):(i=me.treeContext,xn=va(K.nextSibling),vn=s,Si=!0,Xa=null,ha=!1,i!==null&&(Mr[mr++]=Ia,Mr[mr++]=Kr,Mr[mr++]=Ha,Ia=i.id,Kr=i.overflow,Ha=s),s=zr(s,p.children),s.flags|=4096);return s}return b?(Ar(),b=p.fallback,K=s.mode,me=i.child,Fe=me.sibling,p=Tr(me,{mode:"hidden",children:p.children}),p.subtreeFlags=me.subtreeFlags&65011712,Fe!==null?b=Tr(Fe,b):(b=Da(b,K,u,null),b.flags|=2),b.return=s,p.return=s,p.sibling=b,s.child=p,p=b,b=s.child,K=i.child.memoizedState,K===null?K=ud(u):(me=K.cachePool,me!==null?(Fe=Fn._currentValue,me=me.parent!==Fe?{parent:Fe,pool:Fe}:me):me=wc(),K={baseLanes:K.baseLanes|u,cachePool:me}),b.memoizedState=K,b.childLanes=ph(i,G,u),s.memoizedState=fh,p):(_r(s),u=i.child,i=u.sibling,u=Tr(u,{mode:"visible",children:p.children}),u.return=s,u.sibling=null,i!==null&&(G=s.deletions,G===null?(s.deletions=[i],s.flags|=16):G.push(i)),s.child=u,s.memoizedState=null,u)}function zr(i,s){return s=mh({mode:"visible",children:s},i.mode),s.return=i,i.child=s}function mh(i,s){return i=Sr(22,i,null,s),i.lanes=0,i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},i}function gh(i,s,u){return es(s,i.child,null,u),i=zr(s,s.pendingProps.children),i.flags|=2,s.memoizedState=null,i}function Pp(i,s,u){i.lanes|=s;var p=i.alternate;p!==null&&(p.lanes|=s),xc(i.return,s,u)}function hd(i,s,u,p,b){var C=i.memoizedState;C===null?i.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:p,tail:u,tailMode:b}:(C.isBackwards=s,C.rendering=null,C.renderingStartTime=0,C.last=p,C.tail=u,C.tailMode=b)}function Rp(i,s,u){var p=s.pendingProps,b=p.revealOrder,C=p.tail;if(Zn(i,s,p.children,u),p=Cn.current,(p&2)!==0)p=p&1|2,s.flags|=128;else{if(i!==null&&(i.flags&128)!==0)e:for(i=s.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&Pp(i,u,s);else if(i.tag===19)Pp(i,u,s);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break e;for(;i.sibling===null;){if(i.return===null||i.return===s)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}p&=1}switch(gt(Cn,p),b){case"forwards":for(u=s.child,b=null;u!==null;)i=u.alternate,i!==null&&ro(i)===null&&(b=u),u=u.sibling;u=b,u===null?(b=s.child,s.child=null):(b=u.sibling,u.sibling=null),hd(s,!1,b,u,C);break;case"backwards":for(u=null,b=s.child,s.child=null;b!==null;){if(i=b.alternate,i!==null&&ro(i)===null){s.child=b;break}i=b.sibling,b.sibling=u,u=b,b=i}hd(s,!0,u,null,C);break;case"together":hd(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function Ho(i,s,u){if(i!==null&&(s.dependencies=i.dependencies),Fl|=s.lanes,(u&s.childLanes)===0)if(i!==null){if(Oo(i,s,u,!1),(u&s.childLanes)===0)return null}else return null;if(i!==null&&s.child!==i.child)throw Error(E(153));if(s.child!==null){for(i=s.child,u=Tr(i,i.pendingProps),s.child=u,u.return=s;i.sibling!==null;)i=i.sibling,u=u.sibling=Tr(i,i.pendingProps),u.return=s;u.sibling=null}return s.child}function dd(i,s){return(i.lanes&s)!==0?!0:(i=i.dependencies,!!(i!==null&&bc(i)))}function Pm(i,s,u){switch(s.tag){case 3:Fi(s,s.stateNode.containerInfo),Qr(s,Fn,i.memoizedState.cache),Cl();break;case 27:case 5:po(s);break;case 4:Fi(s,s.stateNode.containerInfo);break;case 10:Qr(s,s.type,s.memoizedProps.value);break;case 13:var p=s.memoizedState;if(p!==null)return p.dehydrated!==null?(_r(s),s.flags|=128,null):(u&s.child.childLanes)!==0?yu(i,s,u):(_r(s),i=Ho(i,s,u),i!==null?i.sibling:null);_r(s);break;case 19:var b=(i.flags&128)!==0;if(p=(u&s.childLanes)!==0,p||(Oo(i,s,u,!1),p=(u&s.childLanes)!==0),b){if(p)return Rp(i,s,u);s.flags|=128}if(b=s.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),gt(Cn,Cn.current),p)break;return null;case 22:case 23:return s.lanes=0,sf(i,s,u);case 24:Qr(s,Fn,i.memoizedState.cache)}return Ho(i,s,u)}function fd(i,s,u){if(i!==null)if(i.memoizedProps!==s.pendingProps)yr=!0;else{if(!dd(i,u)&&(s.flags&128)===0)return yr=!1,Pm(i,s,u);yr=(i.flags&131072)!==0}else yr=!1,Si&&(s.flags&1048576)!==0&&Io(s,Do,s.index);switch(s.lanes=0,s.tag){case 16:e:{i=s.pendingProps;var p=s.elementType,b=p._init;if(p=b(p._payload),s.type=p,typeof p=="function")ti(p)?(i=Ac(p,i),s.tag=1,s=lf(null,s,p,i,u)):(s.tag=0,s=cd(null,s,p,i,u));else{if(p!=null){if(b=p.$$typeof,b===Ot){s.tag=11,s=hh(null,s,p,i,u);break e}else if(b===oi){s.tag=14,s=dh(null,s,p,i,u);break e}}throw s=Yn(p)||p,Error(E(306,s,""))}}return s;case 0:return cd(i,s,s.type,s.pendingProps,u);case 1:return p=s.type,b=Ac(p,s.pendingProps),lf(i,s,p,b,u);case 3:e:{if(Fi(s,s.stateNode.containerInfo),i===null)throw Error(E(387));p=s.pendingProps;var C=s.memoizedState;b=C.element,ii(i,s),to(s,p,null,u);var G=s.memoizedState;if(p=G.cache,Qr(s,Fn,p),p!==C.cache&&Lo(s,[Fn],u,!0),Fo(),p=G.element,C.isDehydrated)if(C={element:p,isDehydrated:!1,cache:G.cache},s.updateQueue.baseState=C,s.memoizedState=C,s.flags&256){s=zp(i,s,p,u);break e}else if(p!==b){b=Xr(Error(E(424)),s),da(b),s=zp(i,s,p,u);break e}else{switch(i=s.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(xn=va(i.firstChild),vn=s,Si=!0,Xa=null,ha=!0,u=Zo(s,null,p,u),s.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(Cl(),p===b){s=Ho(i,s,u);break e}Zn(i,s,p,u)}s=s.child}return s;case 26:return ld(i,s),i===null?(u=np(s.type,null,s.pendingProps,null))?s.memoizedState=u:Si||(u=s.type,i=s.pendingProps,p=Oh(Vt.current).createElement(u),p[ei]=s,p[Qt]=i,Gi(p,u,i),Dt(p),s.stateNode=p):s.memoizedState=np(s.type,i.memoizedProps,s.pendingProps,i.memoizedState),null;case 27:return po(s),i===null&&Si&&(p=s.stateNode=im(s.type,s.pendingProps,Vt.current),vn=s,ha=!0,b=xn,Vl(s.type)?(Wf=b,xn=va(p.firstChild)):xn=b),Zn(i,s,s.pendingProps.children,u),ld(i,s),i===null&&(s.flags|=4194304),s.child;case 5:return i===null&&Si&&((b=p=xn)&&(p=kd(p,s.type,s.pendingProps,ha),p!==null?(s.stateNode=p,vn=s,xn=va(p.firstChild),ha=!1,b=!0):b=!1),b||$s(s)),po(s),b=s.type,C=s.pendingProps,G=i!==null?i.memoizedProps:null,p=C.children,Hf(b,C)?p=null:G!==null&&Hf(b,G)&&(s.flags|=32),s.memoizedState!==null&&(b=lr(i,s,id,null,null,u),Q._currentValue=b),ld(i,s),Zn(i,s,p,u),s.child;case 6:return i===null&&Si&&((i=u=xn)&&(u=em(u,s.pendingProps,ha),u!==null?(s.stateNode=u,vn=s,xn=null,i=!0):i=!1),i||$s(s)),null;case 13:return yu(i,s,u);case 4:return Fi(s,s.stateNode.containerInfo),p=s.pendingProps,i===null?s.child=es(s,null,p,u):Zn(i,s,p,u),s.child;case 11:return hh(i,s,s.type,s.pendingProps,u);case 7:return Zn(i,s,s.pendingProps,u),s.child;case 8:return Zn(i,s,s.pendingProps.children,u),s.child;case 12:return Zn(i,s,s.pendingProps.children,u),s.child;case 10:return p=s.pendingProps,Qr(s,s.type,p.value),Zn(i,s,p.children,u),s.child;case 9:return b=s.type._context,p=s.pendingProps.children,Xs(s),b=Tn(b),p=p(b),s.flags|=1,Zn(i,s,p,u),s.child;case 14:return dh(i,s,s.type,s.pendingProps,u);case 15:return af(i,s,s.type,s.pendingProps,u);case 19:return Rp(i,s,u);case 31:return p=s.pendingProps,u=s.mode,p={mode:p.mode,children:p.children},i===null?(u=mh(p,u),u.ref=s.ref,s.child=u,u.return=s,s=u):(u=Tr(i.child,p),u.ref=s.ref,s.child=u,u.return=s,s=u),s;case 22:return sf(i,s,u);case 24:return Xs(s),p=Tn(Fn),i===null?(b=Ws(),b===null&&(b=Oi,C=Ys(),b.pooledCache=C,C.refCount++,C!==null&&(b.pooledCacheLanes|=u),b=C),s.memoizedState={parent:p,cache:b},Tc(s),Qr(s,Fn,b)):((i.lanes&u)!==0&&(ii(i,s),to(s,null,null,u),Fo()),b=i.memoizedState,C=s.memoizedState,b.parent!==p?(b={parent:p,cache:p},s.memoizedState=b,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=b),Qr(s,Fn,p)):(p=C.cache,Qr(s,Fn,p),p!==b.cache&&Lo(s,[Fn],u,!0))),Zn(i,s,s.pendingProps.children,u),s.child;case 29:throw s.pendingProps}throw Error(E(156,s.tag))}function ao(i){i.flags|=4}function cf(i,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!x(s)){if(s=Nn.current,s!==null&&((xi&4194048)===xi?Wi!==null:(xi&62914560)!==xi&&(xi&536870912)===0||s!==Wi))throw Ss=Js,lu;i.flags|=8192}}function pd(i,s){s!==null&&(i.flags|=4),i.flags&16384&&(s=i.tag!==22?Se():536870912,i.lanes|=s,Tu|=s)}function _h(i,s){if(!Si)switch(i.tailMode){case"hidden":s=i.tail;for(var u=null;s!==null;)s.alternate!==null&&(u=s),s=s.sibling;u===null?i.tail=null:u.sibling=null;break;case"collapsed":u=i.tail;for(var p=null;u!==null;)u.alternate!==null&&(p=u),u=u.sibling;p===null?s||i.tail===null?i.tail=null:i.tail.sibling=null:p.sibling=null}}function An(i){var s=i.alternate!==null&&i.alternate.child===i.child,u=0,p=0;if(s)for(var b=i.child;b!==null;)u|=b.lanes|b.childLanes,p|=b.subtreeFlags&65011712,p|=b.flags&65011712,b.return=i,b=b.sibling;else for(b=i.child;b!==null;)u|=b.lanes|b.childLanes,p|=b.subtreeFlags,p|=b.flags,b.return=i,b=b.sibling;return i.subtreeFlags|=p,i.childLanes=u,s}function uf(i,s,u){var p=s.pendingProps;switch(yc(s),s.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return An(s),null;case 1:return An(s),null;case 3:return u=s.stateNode,p=null,i!==null&&(p=i.memoizedState.cache),s.memoizedState.cache!==p&&(s.flags|=2048),Or(Fn),Hi(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(i===null||i.child===null)&&(Hs(s)?ao(s):i===null||i.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,cn())),An(s),null;case 26:return u=s.memoizedState,i===null?(ao(s),u!==null?(An(s),cf(s,u)):(An(s),s.flags&=-16777217)):u?u!==i.memoizedState?(ao(s),An(s),cf(s,u)):(An(s),s.flags&=-16777217):(i.memoizedProps!==p&&ao(s),An(s),s.flags&=-16777217),null;case 27:dr(s),u=Vt.current;var b=s.type;if(i!==null&&s.stateNode!=null)i.memoizedProps!==p&&ao(s);else{if(!p){if(s.stateNode===null)throw Error(E(166));return An(s),null}i=Ct.current,Hs(s)?El(s):(i=im(b,p,u),s.stateNode=i,ao(s))}return An(s),null;case 5:if(dr(s),u=s.type,i!==null&&s.stateNode!=null)i.memoizedProps!==p&&ao(s);else{if(!p){if(s.stateNode===null)throw Error(E(166));return An(s),null}if(i=Ct.current,Hs(s))El(s);else{switch(b=Oh(Vt.current),i){case 1:i=b.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:i=b.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":i=b.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":i=b.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":i=b.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild);break;case"select":i=typeof p.is=="string"?b.createElement("select",{is:p.is}):b.createElement("select"),p.multiple?i.multiple=!0:p.size&&(i.size=p.size);break;default:i=typeof p.is=="string"?b.createElement(u,{is:p.is}):b.createElement(u)}}i[ei]=s,i[Qt]=p;e:for(b=s.child;b!==null;){if(b.tag===5||b.tag===6)i.appendChild(b.stateNode);else if(b.tag!==4&&b.tag!==27&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===s)break e;for(;b.sibling===null;){if(b.return===null||b.return===s)break e;b=b.return}b.sibling.return=b.return,b=b.sibling}s.stateNode=i;e:switch(Gi(i,u,p),u){case"button":case"input":case"select":case"textarea":i=!!p.autoFocus;break e;case"img":i=!0;break e;default:i=!1}i&&ao(s)}}return An(s),s.flags&=-16777217,null;case 6:if(i&&s.stateNode!=null)i.memoizedProps!==p&&ao(s);else{if(typeof p!="string"&&s.stateNode===null)throw Error(E(166));if(i=Vt.current,Hs(s)){if(i=s.stateNode,u=s.memoizedProps,p=null,b=vn,b!==null)switch(b.tag){case 27:case 5:p=b.memoizedProps}i[ei]=s,i=!!(i.nodeValue===u||p!==null&&p.suppressHydrationWarning===!0||Du(i.nodeValue,u)),i||$s(s)}else i=Oh(i).createTextNode(p),i[ei]=s,s.stateNode=i}return An(s),null;case 13:if(p=s.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(b=Hs(s),p!==null&&p.dehydrated!==null){if(i===null){if(!b)throw Error(E(318));if(b=s.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(E(317));b[ei]=s}else Cl(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;An(s),b=!1}else b=cn(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=b),b=!0;if(!b)return s.flags&256?(Ba(s),s):(Ba(s),null)}if(Ba(s),(s.flags&128)!==0)return s.lanes=u,s;if(u=p!==null,i=i!==null&&i.memoizedState!==null,u){p=s.child,b=null,p.alternate!==null&&p.alternate.memoizedState!==null&&p.alternate.memoizedState.cachePool!==null&&(b=p.alternate.memoizedState.cachePool.pool);var C=null;p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(C=p.memoizedState.cachePool.pool),C!==b&&(p.flags|=2048)}return u!==i&&u&&(s.child.flags|=8192),pd(s,s.updateQueue),An(s),null;case 4:return Hi(),i===null&&Uf(s.stateNode.containerInfo),An(s),null;case 10:return Or(s.type),An(s),null;case 19:if(lt(Cn),b=s.memoizedState,b===null)return An(s),null;if(p=(s.flags&128)!==0,C=b.rendering,C===null)if(p)_h(b,!1);else{if(jn!==0||i!==null&&(i.flags&128)!==0)for(i=s.child;i!==null;){if(C=ro(i),C!==null){for(s.flags|=128,_h(b,!1),i=C.updateQueue,s.updateQueue=i,pd(s,i),s.subtreeFlags=0,i=u,u=s.child;u!==null;)ih(u,i),u=u.sibling;return gt(Cn,Cn.current&1|2),s.child}i=i.sibling}b.tail!==null&&Xi()>Eh&&(s.flags|=128,p=!0,_h(b,!1),s.lanes=4194304)}else{if(!p)if(i=ro(C),i!==null){if(s.flags|=128,p=!0,i=i.updateQueue,s.updateQueue=i,pd(s,i),_h(b,!0),b.tail===null&&b.tailMode==="hidden"&&!C.alternate&&!Si)return An(s),null}else 2*Xi()-b.renderingStartTime>Eh&&u!==536870912&&(s.flags|=128,p=!0,_h(b,!1),s.lanes=4194304);b.isBackwards?(C.sibling=s.child,s.child=C):(i=b.last,i!==null?i.sibling=C:s.child=C,b.last=C)}return b.tail!==null?(s=b.tail,b.rendering=s,b.tail=s.sibling,b.renderingStartTime=Xi(),s.sibling=null,i=Cn.current,gt(Cn,p?i&1|2:i&1),s):(An(s),null);case 22:case 23:return Ba(s),Ni(),p=s.memoizedState!==null,i!==null?i.memoizedState!==null!==p&&(s.flags|=8192):p&&(s.flags|=8192),p?(u&536870912)!==0&&(s.flags&128)===0&&(An(s),s.subtreeFlags&6&&(s.flags|=8192)):An(s),u=s.updateQueue,u!==null&&pd(s,u.retryQueue),u=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(u=i.memoizedState.cachePool.pool),p=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(p=s.memoizedState.cachePool.pool),p!==u&&(s.flags|=2048),i!==null&&lt(Mn),null;case 24:return u=null,i!==null&&(u=i.memoizedState.cache),s.memoizedState.cache!==u&&(s.flags|=2048),Or(Fn),An(s),null;case 25:return null;case 30:return null}throw Error(E(156,s.tag))}function hf(i,s){switch(yc(s),s.tag){case 1:return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 3:return Or(Fn),Hi(),i=s.flags,(i&65536)!==0&&(i&128)===0?(s.flags=i&-65537|128,s):null;case 26:case 27:case 5:return dr(s),null;case 13:if(Ba(s),i=s.memoizedState,i!==null&&i.dehydrated!==null){if(s.alternate===null)throw Error(E(340));Cl()}return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 19:return lt(Cn),null;case 4:return Hi(),null;case 10:return Or(s.type),null;case 22:case 23:return Ba(s),Ni(),i!==null&&lt(Mn),i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 24:return Or(Fn),null;case 25:return null;default:return null}}function df(i,s){switch(yc(s),s.tag){case 3:Or(Fn),Hi();break;case 26:case 27:case 5:dr(s);break;case 4:Hi();break;case 13:Ba(s);break;case 19:lt(Cn);break;case 10:Or(s.type);break;case 22:case 23:Ba(s),Ni(),i!==null&&lt(Mn);break;case 24:Or(Fn)}}function zs(i,s){try{var u=s.updateQueue,p=u!==null?u.lastEffect:null;if(p!==null){var b=p.next;u=b;do{if((u.tag&i)===i){p=void 0;var C=u.create,G=u.inst;p=C(),G.destroy=p}u=u.next}while(u!==b)}}catch(K){Vi(s,s.return,K)}}function ts(i,s,u){try{var p=s.updateQueue,b=p!==null?p.lastEffect:null;if(b!==null){var C=b.next;p=C;do{if((p.tag&i)===i){var G=p.inst,K=G.destroy;if(K!==void 0){G.destroy=void 0,b=s;var me=u,Fe=K;try{Fe()}catch(tt){Vi(b,me,tt)}}}p=p.next}while(p!==C)}}catch(tt){Vi(s,s.return,tt)}}function Dp(i){var s=i.updateQueue;if(s!==null){var u=i.stateNode;try{ch(s,u)}catch(p){Vi(i,i.return,p)}}}function Ip(i,s,u){u.props=Ac(i.type,i.memoizedProps),u.state=i.memoizedState;try{u.componentWillUnmount()}catch(p){Vi(i,s,p)}}function yh(i,s){try{var u=i.ref;if(u!==null){switch(i.tag){case 26:case 27:case 5:var p=i.stateNode;break;case 30:p=i.stateNode;break;default:p=i.stateNode}typeof u=="function"?i.refCleanup=u(p):u.current=p}}catch(b){Vi(i,s,b)}}function so(i,s){var u=i.ref,p=i.refCleanup;if(u!==null)if(typeof p=="function")try{p()}catch(b){Vi(i,s,b)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(b){Vi(i,s,b)}else u.current=null}function kp(i){var s=i.type,u=i.memoizedProps,p=i.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":u.autoFocus&&p.focus();break e;case"img":u.src?p.src=u.src:u.srcSet&&(p.srcset=u.srcSet)}}catch(b){Vi(i,i.return,b)}}function ff(i,s,u){try{var p=i.stateNode;Iu(p,i.type,u,s),p[Qt]=s}catch(b){Vi(i,i.return,b)}}function Lp(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&Vl(i.type)||i.tag===4}function vh(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||Lp(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&Vl(i.type)||i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function pf(i,s,u){var p=i.tag;if(p===5||p===6)i=i.stateNode,s?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(i,s):(s=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,s.appendChild(i),u=u._reactRootContainer,u!=null||s.onclick!==null||(s.onclick=Lh));else if(p!==4&&(p===27&&Vl(i.type)&&(u=i.stateNode,s=null),i=i.child,i!==null))for(pf(i,s,u),i=i.sibling;i!==null;)pf(i,s,u),i=i.sibling}function xh(i,s,u){var p=i.tag;if(p===5||p===6)i=i.stateNode,s?u.insertBefore(i,s):u.appendChild(i);else if(p!==4&&(p===27&&Vl(i.type)&&(u=i.stateNode),i=i.child,i!==null))for(xh(i,s,u),i=i.sibling;i!==null;)xh(i,s,u),i=i.sibling}function vu(i){var s=i.stateNode,u=i.memoizedProps;try{for(var p=i.type,b=s.attributes;b.length;)s.removeAttributeNode(b[0]);Gi(s,p,u),s[ei]=i,s[Qt]=u}catch(C){Vi(i,i.return,C)}}var Xo=!1,ai=!1,Ll=!1,mf=typeof WeakSet=="function"?WeakSet:Set,$n=null;function md(i,s){if(i=i.containerInfo,il=Je,i=pc(i),za(i)){if("selectionStart"in i)var u={start:i.selectionStart,end:i.selectionEnd};else e:{u=(u=i.ownerDocument)&&u.defaultView||window;var p=u.getSelection&&u.getSelection();if(p&&p.rangeCount!==0){u=p.anchorNode;var b=p.anchorOffset,C=p.focusNode;p=p.focusOffset;try{u.nodeType,C.nodeType}catch{u=null;break e}var G=0,K=-1,me=-1,Fe=0,tt=0,at=i,Ue=null;t:for(;;){for(var Ge;at!==u||b!==0&&at.nodeType!==3||(K=G+b),at!==C||p!==0&&at.nodeType!==3||(me=G+p),at.nodeType===3&&(G+=at.nodeValue.length),(Ge=at.firstChild)!==null;)Ue=at,at=Ge;for(;;){if(at===i)break t;if(Ue===u&&++Fe===b&&(K=G),Ue===C&&++tt===p&&(me=G),(Ge=at.nextSibling)!==null)break;at=Ue,Ue=at.parentNode}at=Ge}u=K===-1||me===-1?null:{start:K,end:me}}else u=null}u=u||{start:0,end:0}}else u=null;for(Rd={focusedElem:i,selectionRange:u},Je=!1,$n=s;$n!==null;)if(s=$n,i=s.child,(s.subtreeFlags&1024)!==0&&i!==null)i.return=s,$n=i;else for(;$n!==null;){switch(s=$n,C=s.alternate,i=s.flags,s.tag){case 0:break;case 11:case 15:break;case 1:if((i&1024)!==0&&C!==null){i=void 0,u=s,b=C.memoizedProps,C=C.memoizedState,p=u.stateNode;try{var jt=Ac(u.type,b,u.elementType===u.type);i=p.getSnapshotBeforeUpdate(jt,C),p.__reactInternalSnapshotBeforeUpdate=i}catch(Gt){Vi(u,u.return,Gt)}}break;case 3:if((i&1024)!==0){if(i=s.stateNode.containerInfo,u=i.nodeType,u===9)Id(i);else if(u===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":Id(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(E(163))}if(i=s.sibling,i!==null){i.return=s.return,$n=i;break}$n=s.return}}function xu(i,s,u){var p=u.flags;switch(u.tag){case 0:case 11:case 15:ns(i,u),p&4&&zs(5,u);break;case 1:if(ns(i,u),p&4)if(i=u.stateNode,s===null)try{i.componentDidMount()}catch(G){Vi(u,u.return,G)}else{var b=Ac(u.type,s.memoizedProps);s=s.memoizedState;try{i.componentDidUpdate(b,s,i.__reactInternalSnapshotBeforeUpdate)}catch(G){Vi(u,u.return,G)}}p&64&&Dp(u),p&512&&yh(u,u.return);break;case 3:if(ns(i,u),p&64&&(i=u.updateQueue,i!==null)){if(s=null,u.child!==null)switch(u.child.tag){case 27:case 5:s=u.child.stateNode;break;case 1:s=u.child.stateNode}try{ch(i,s)}catch(G){Vi(u,u.return,G)}}break;case 27:s===null&&p&4&&vu(u);case 26:case 5:ns(i,u),s===null&&p&4&&kp(u),p&512&&yh(u,u.return);break;case 12:ns(i,u);break;case 13:ns(i,u),p&4&&bh(i,u),p&64&&(i=u.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(u=Dm.bind(null,u),Ld(i,u))));break;case 22:if(p=u.memoizedState!==null||Xo,!p){s=s!==null&&s.memoizedState!==null||ai,b=Xo;var C=ai;Xo=p,(ai=s)&&!C?Ko(i,u,(u.subtreeFlags&8772)!==0):ns(i,u),Xo=b,ai=C}break;case 30:break;default:ns(i,u)}}function gf(i){var s=i.alternate;s!==null&&(i.alternate=null,gf(s)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(s=i.stateNode,s!==null&&Yi(s)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var pn=null,vr=!1;function Ps(i,s,u){for(u=u.child;u!==null;)Pc(i,s,u),u=u.sibling}function Pc(i,s,u){if(nn&&typeof nn.onCommitFiberUnmount=="function")try{nn.onCommitFiberUnmount(Vr,u)}catch{}switch(u.tag){case 26:ai||so(u,s),Ps(i,s,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:ai||so(u,s);var p=pn,b=vr;Vl(u.type)&&(pn=u.stateNode,vr=!1),Ps(i,s,u),ho(u.stateNode),pn=p,vr=b;break;case 5:ai||so(u,s);case 6:if(p=pn,b=vr,pn=null,Ps(i,s,u),pn=p,vr=b,pn!==null)if(vr)try{(pn.nodeType===9?pn.body:pn.nodeName==="HTML"?pn.ownerDocument.body:pn).removeChild(u.stateNode)}catch(C){Vi(u,s,C)}else try{pn.removeChild(u.stateNode)}catch(C){Vi(u,s,C)}break;case 18:pn!==null&&(vr?(i=pn,Kf(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,u.stateNode),_n(i)):Kf(pn,u.stateNode));break;case 4:p=pn,b=vr,pn=u.stateNode.containerInfo,vr=!0,Ps(i,s,u),pn=p,vr=b;break;case 0:case 11:case 14:case 15:ai||ts(2,u,s),ai||ts(4,u,s),Ps(i,s,u);break;case 1:ai||(so(u,s),p=u.stateNode,typeof p.componentWillUnmount=="function"&&Ip(u,s,p)),Ps(i,s,u);break;case 21:Ps(i,s,u);break;case 22:ai=(p=ai)||u.memoizedState!==null,Ps(i,s,u),ai=p;break;default:Ps(i,s,u)}}function bh(i,s){if(s.memoizedState===null&&(i=s.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{_n(i)}catch(u){Vi(s,s.return,u)}}function bu(i){switch(i.tag){case 13:case 19:var s=i.stateNode;return s===null&&(s=i.stateNode=new mf),s;case 22:return i=i.stateNode,s=i._retryCache,s===null&&(s=i._retryCache=new mf),s;default:throw Error(E(435,i.tag))}}function Rc(i,s){var u=bu(i);s.forEach(function(p){var b=Im.bind(null,i,p);u.has(p)||(u.add(p),p.then(b,b))})}function Fa(i,s){var u=s.deletions;if(u!==null)for(var p=0;p<u.length;p++){var b=u[p],C=i,G=s,K=G;e:for(;K!==null;){switch(K.tag){case 27:if(Vl(K.type)){pn=K.stateNode,vr=!1;break e}break;case 5:pn=K.stateNode,vr=!1;break e;case 3:case 4:pn=K.stateNode.containerInfo,vr=!0;break e}K=K.return}if(pn===null)throw Error(E(160));Pc(C,G,b),pn=null,vr=!1,C=b.alternate,C!==null&&(C.return=null),b.return=null}if(s.subtreeFlags&13878)for(s=s.child;s!==null;)Ol(s,i),s=s.sibling}var is=null;function Ol(i,s){var u=i.alternate,p=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:Fa(s,i),Na(i),p&4&&(ts(3,i,i.return),zs(3,i),ts(5,i,i.return));break;case 1:Fa(s,i),Na(i),p&512&&(ai||u===null||so(u,u.return)),p&64&&Xo&&(i=i.updateQueue,i!==null&&(p=i.callbacks,p!==null&&(u=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=u===null?p:u.concat(p))));break;case 26:var b=is;if(Fa(s,i),Na(i),p&512&&(ai||u===null||so(u,u.return)),p&4){var C=u!==null?u.memoizedState:null;if(p=i.memoizedState,u===null)if(p===null)if(i.stateNode===null){e:{p=i.type,u=i.memoizedProps,b=b.ownerDocument||b;t:switch(p){case"title":C=b.getElementsByTagName("title")[0],(!C||C[wn]||C[ei]||C.namespaceURI==="http://www.w3.org/2000/svg"||C.hasAttribute("itemprop"))&&(C=b.createElement(p),b.head.insertBefore(C,b.querySelector("head > title"))),Gi(C,p,u),C[ei]=i,Dt(C),p=C;break e;case"link":var G=d("link","href",b).get(p+(u.href||""));if(G){for(var K=0;K<G.length;K++)if(C=G[K],C.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&C.getAttribute("rel")===(u.rel==null?null:u.rel)&&C.getAttribute("title")===(u.title==null?null:u.title)&&C.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){G.splice(K,1);break t}}C=b.createElement(p),Gi(C,p,u),b.head.appendChild(C);break;case"meta":if(G=d("meta","content",b).get(p+(u.content||""))){for(K=0;K<G.length;K++)if(C=G[K],C.getAttribute("content")===(u.content==null?null:""+u.content)&&C.getAttribute("name")===(u.name==null?null:u.name)&&C.getAttribute("property")===(u.property==null?null:u.property)&&C.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&C.getAttribute("charset")===(u.charSet==null?null:u.charSet)){G.splice(K,1);break t}}C=b.createElement(p),Gi(C,p,u),b.head.appendChild(C);break;default:throw Error(E(468,p))}C[ei]=i,Dt(C),p=C}i.stateNode=p}else g(b,i.type,i.stateNode);else i.stateNode=am(b,p,i.memoizedProps);else C!==p?(C===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):C.count--,p===null?g(b,i.type,i.stateNode):am(b,p,i.memoizedProps)):p===null&&i.stateNode!==null&&ff(i,i.memoizedProps,u.memoizedProps)}break;case 27:Fa(s,i),Na(i),p&512&&(ai||u===null||so(u,u.return)),u!==null&&p&4&&ff(i,i.memoizedProps,u.memoizedProps);break;case 5:if(Fa(s,i),Na(i),p&512&&(ai||u===null||so(u,u.return)),i.flags&32){b=i.stateNode;try{ps(b,"")}catch(Ge){Vi(i,i.return,Ge)}}p&4&&i.stateNode!=null&&(b=i.memoizedProps,ff(i,b,u!==null?u.memoizedProps:b)),p&1024&&(Ll=!0);break;case 6:if(Fa(s,i),Na(i),p&4){if(i.stateNode===null)throw Error(E(162));p=i.memoizedProps,u=i.stateNode;try{u.nodeValue=p}catch(Ge){Vi(i,i.return,Ge)}}break;case 3:if(o=null,b=is,is=Bh(s.containerInfo),Fa(s,i),is=b,Na(i),p&4&&u!==null&&u.memoizedState.isDehydrated)try{_n(s.containerInfo)}catch(Ge){Vi(i,i.return,Ge)}Ll&&(Ll=!1,_f(i));break;case 4:p=is,is=Bh(i.stateNode.containerInfo),Fa(s,i),Na(i),is=p;break;case 12:Fa(s,i),Na(i);break;case 13:Fa(s,i),Na(i),i.child.flags&8192&&i.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(wf=Xi()),p&4&&(p=i.updateQueue,p!==null&&(i.updateQueue=null,Rc(i,p)));break;case 22:b=i.memoizedState!==null;var me=u!==null&&u.memoizedState!==null,Fe=Xo,tt=ai;if(Xo=Fe||b,ai=tt||me,Fa(s,i),ai=tt,Xo=Fe,Na(i),p&8192)e:for(s=i.stateNode,s._visibility=b?s._visibility&-2:s._visibility|1,b&&(u===null||me||Xo||ai||Yo(i)),u=null,s=i;;){if(s.tag===5||s.tag===26){if(u===null){me=u=s;try{if(C=me.stateNode,b)G=C.style,typeof G.setProperty=="function"?G.setProperty("display","none","important"):G.display="none";else{K=me.stateNode;var at=me.memoizedProps.style,Ue=at!=null&&at.hasOwnProperty("display")?at.display:null;K.style.display=Ue==null||typeof Ue=="boolean"?"":(""+Ue).trim()}}catch(Ge){Vi(me,me.return,Ge)}}}else if(s.tag===6){if(u===null){me=s;try{me.stateNode.nodeValue=b?"":me.memoizedProps}catch(Ge){Vi(me,me.return,Ge)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===i)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break e;for(;s.sibling===null;){if(s.return===null||s.return===i)break e;u===s&&(u=null),s=s.return}u===s&&(u=null),s.sibling.return=s.return,s=s.sibling}p&4&&(p=i.updateQueue,p!==null&&(u=p.retryQueue,u!==null&&(p.retryQueue=null,Rc(i,u))));break;case 19:Fa(s,i),Na(i),p&4&&(p=i.updateQueue,p!==null&&(i.updateQueue=null,Rc(i,p)));break;case 30:break;case 21:break;default:Fa(s,i),Na(i)}}function Na(i){var s=i.flags;if(s&2){try{for(var u,p=i.return;p!==null;){if(Lp(p)){u=p;break}p=p.return}if(u==null)throw Error(E(160));switch(u.tag){case 27:var b=u.stateNode,C=vh(i);xh(i,C,b);break;case 5:var G=u.stateNode;u.flags&32&&(ps(G,""),u.flags&=-33);var K=vh(i);xh(i,K,G);break;case 3:case 4:var me=u.stateNode.containerInfo,Fe=vh(i);pf(i,Fe,me);break;default:throw Error(E(161))}}catch(tt){Vi(i,i.return,tt)}i.flags&=-3}s&4096&&(i.flags&=-4097)}function _f(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var s=i;_f(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),i=i.sibling}}function ns(i,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)xu(i,s.alternate,s),s=s.sibling}function Yo(i){for(i=i.child;i!==null;){var s=i;switch(s.tag){case 0:case 11:case 14:case 15:ts(4,s,s.return),Yo(s);break;case 1:so(s,s.return);var u=s.stateNode;typeof u.componentWillUnmount=="function"&&Ip(s,s.return,u),Yo(s);break;case 27:ho(s.stateNode);case 26:case 5:so(s,s.return),Yo(s);break;case 22:s.memoizedState===null&&Yo(s);break;case 30:Yo(s);break;default:Yo(s)}i=i.sibling}}function Ko(i,s,u){for(u=u&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var p=s.alternate,b=i,C=s,G=C.flags;switch(C.tag){case 0:case 11:case 15:Ko(b,C,u),zs(4,C);break;case 1:if(Ko(b,C,u),p=C,b=p.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(Fe){Vi(p,p.return,Fe)}if(p=C,b=p.updateQueue,b!==null){var K=p.stateNode;try{var me=b.shared.hiddenCallbacks;if(me!==null)for(b.shared.hiddenCallbacks=null,b=0;b<me.length;b++)hu(me[b],K)}catch(Fe){Vi(p,p.return,Fe)}}u&&G&64&&Dp(C),yh(C,C.return);break;case 27:vu(C);case 26:case 5:Ko(b,C,u),u&&p===null&&G&4&&kp(C),yh(C,C.return);break;case 12:Ko(b,C,u);break;case 13:Ko(b,C,u),u&&G&4&&bh(b,C);break;case 22:C.memoizedState===null&&Ko(b,C,u),yh(C,C.return);break;case 30:break;default:Ko(b,C,u)}s=s.sibling}}function gd(i,s){var u=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(u=i.memoizedState.cachePool.pool),i=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(i=s.memoizedState.cachePool.pool),i!==u&&(i!=null&&i.refCount++,u!=null&&Bo(u))}function yf(i,s){i=null,s.alternate!==null&&(i=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==i&&(s.refCount++,i!=null&&Bo(i))}function oo(i,s,u,p){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Op(i,s,u,p),s=s.sibling}function Op(i,s,u,p){var b=s.flags;switch(s.tag){case 0:case 11:case 15:oo(i,s,u,p),b&2048&&zs(9,s);break;case 1:oo(i,s,u,p);break;case 3:oo(i,s,u,p),b&2048&&(i=null,s.alternate!==null&&(i=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==i&&(s.refCount++,i!=null&&Bo(i)));break;case 12:if(b&2048){oo(i,s,u,p),i=s.stateNode;try{var C=s.memoizedProps,G=C.id,K=C.onPostCommit;typeof K=="function"&&K(G,s.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(me){Vi(s,s.return,me)}}else oo(i,s,u,p);break;case 13:oo(i,s,u,p);break;case 23:break;case 22:C=s.stateNode,G=s.alternate,s.memoizedState!==null?C._visibility&2?oo(i,s,u,p):wh(i,s):C._visibility&2?oo(i,s,u,p):(C._visibility|=2,wu(i,s,u,p,(s.subtreeFlags&10256)!==0)),b&2048&&gd(G,s);break;case 24:oo(i,s,u,p),b&2048&&yf(s.alternate,s);break;default:oo(i,s,u,p)}}function wu(i,s,u,p,b){for(b=b&&(s.subtreeFlags&10256)!==0,s=s.child;s!==null;){var C=i,G=s,K=u,me=p,Fe=G.flags;switch(G.tag){case 0:case 11:case 15:wu(C,G,K,me,b),zs(8,G);break;case 23:break;case 22:var tt=G.stateNode;G.memoizedState!==null?tt._visibility&2?wu(C,G,K,me,b):wh(C,G):(tt._visibility|=2,wu(C,G,K,me,b)),b&&Fe&2048&&gd(G.alternate,G);break;case 24:wu(C,G,K,me,b),b&&Fe&2048&&yf(G.alternate,G);break;default:wu(C,G,K,me,b)}s=s.sibling}}function wh(i,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var u=i,p=s,b=p.flags;switch(p.tag){case 22:wh(u,p),b&2048&&gd(p.alternate,p);break;case 24:wh(u,p),b&2048&&yf(p.alternate,p);break;default:wh(u,p)}s=s.sibling}}var Dc=8192;function Ic(i){if(i.subtreeFlags&Dc)for(i=i.child;i!==null;)_d(i),i=i.sibling}function _d(i){switch(i.tag){case 26:Ic(i),i.flags&Dc&&i.memoizedState!==null&&D(is,i.memoizedState,i.memoizedProps);break;case 5:Ic(i);break;case 3:case 4:var s=is;is=Bh(i.stateNode.containerInfo),Ic(i),is=s;break;case 22:i.memoizedState===null&&(s=i.alternate,s!==null&&s.memoizedState!==null?(s=Dc,Dc=16777216,Ic(i),Dc=s):Ic(i));break;default:Ic(i)}}function vf(i){var s=i.alternate;if(s!==null&&(i=s.child,i!==null)){s.child=null;do s=i.sibling,i.sibling=null,i=s;while(i!==null)}}function kc(i){var s=i.deletions;if((i.flags&16)!==0){if(s!==null)for(var u=0;u<s.length;u++){var p=s[u];$n=p,Th(p,i)}vf(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)xf(i),i=i.sibling}function xf(i){switch(i.tag){case 0:case 11:case 15:kc(i),i.flags&2048&&ts(9,i,i.return);break;case 3:kc(i);break;case 12:kc(i);break;case 22:var s=i.stateNode;i.memoizedState!==null&&s._visibility&2&&(i.return===null||i.return.tag!==13)?(s._visibility&=-3,Sh(i)):kc(i);break;default:kc(i)}}function Sh(i){var s=i.deletions;if((i.flags&16)!==0){if(s!==null)for(var u=0;u<s.length;u++){var p=s[u];$n=p,Th(p,i)}vf(i)}for(i=i.child;i!==null;){switch(s=i,s.tag){case 0:case 11:case 15:ts(8,s,s.return),Sh(s);break;case 22:u=s.stateNode,u._visibility&2&&(u._visibility&=-3,Sh(s));break;default:Sh(s)}i=i.sibling}}function Th(i,s){for(;$n!==null;){var u=$n;switch(u.tag){case 0:case 11:case 15:ts(8,u,s);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var p=u.memoizedState.cachePool.pool;p!=null&&p.refCount++}break;case 24:Bo(u.memoizedState.cache)}if(p=u.child,p!==null)p.return=u,$n=p;else e:for(u=i;$n!==null;){p=$n;var b=p.sibling,C=p.return;if(gf(p),p===u){$n=null;break e}if(b!==null){b.return=C,$n=b;break e}$n=C}}}var Bp={getCacheForType:function(i){var s=Tn(Fn),u=s.data.get(i);return u===void 0&&(u=i(),s.data.set(i,u)),u}},Fp=typeof WeakMap=="function"?WeakMap:Map,Li=0,Oi=null,_i=null,xi=0,Ti=0,ia=null,Bl=!1,Su=!1,yd=!1,lo=0,jn=0,Fl=0,Rs=0,vd=0,rs=0,Tu=0,Mh=null,_a=null,bf=!1,wf=0,Eh=1/0,Mu=null,Wo=null,xr=0,Qo=null,Eu=null,Jo=0,Sf=0,xd=null,Np=null,Ch=0,Tf=null;function ya(){if((Li&2)!==0&&xi!==0)return xi&-xi;if(Ke.T!==null){var i=bs;return i!==0?i:jl()}return vt()}function jp(){rs===0&&(rs=(xi&536870912)===0||Si?ke():536870912);var i=Nn.current;return i!==null&&(i.flags|=32),rs}function ja(i,s,u){(i===Oi&&(Ti===2||Ti===9)||i.cancelPendingCommit!==null)&&(Au(i,0),el(i,xi,rs,!1)),je(i,u),((Li&2)===0||i!==Oi)&&(i===Oi&&((Li&2)===0&&(Rs|=u),jn===4&&el(i,xi,rs,!1)),ss(i))}function Cu(i,s,u){if((Li&6)!==0)throw Error(E(327));var p=!u&&(s&124)===0&&(s&i.expiredLanes)===0||ye(i,s),b=p?Up(i,s):zf(i,s,!0),C=p;do{if(b===0){Su&&!p&&el(i,s,0,!1);break}else{if(u=i.current.alternate,C&&!Ef(u)){b=zf(i,s,!1),C=!1;continue}if(b===2){if(C=s,i.errorRecoveryDisabledLanes&C)var G=0;else G=i.pendingLanes&-536870913,G=G!==0?G:G&536870912?536870912:0;if(G!==0){s=G;e:{var K=i;b=Mh;var me=K.current.memoizedState.isDehydrated;if(me&&(Au(K,G).flags|=256),G=zf(K,G,!1),G!==2){if(yd&&!me){K.errorRecoveryDisabledLanes|=C,Rs|=C,b=4;break e}C=_a,_a=b,C!==null&&(_a===null?_a=C:_a.push.apply(_a,C))}b=G}if(C=!1,b!==2)continue}}if(b===1){Au(i,0),el(i,s,0,!0);break}e:{switch(p=i,C=b,C){case 0:case 1:throw Error(E(345));case 4:if((s&4194048)!==s)break;case 6:el(p,s,rs,!Bl);break e;case 2:_a=null;break;case 3:case 5:break;default:throw Error(E(329))}if((s&62914560)===s&&(b=wf+300-Xi(),10<b)){if(el(p,s,rs,!Bl),ce(p,0,!0)!==0)break e;p.timeoutHandle=Xf(Mf.bind(null,p,u,_a,Mu,bf,s,rs,Rs,Tu,Bl,C,2,-0,0),b);break e}Mf(p,u,_a,Mu,bf,s,rs,Rs,Tu,Bl,C,0,-0,0)}}break}while(!0);ss(i)}function Mf(i,s,u,p,b,C,G,K,me,Fe,tt,at,Ue,Ge){if(i.timeoutHandle=-1,at=s.subtreeFlags,(at&8192||(at&16785408)===16785408)&&(T={stylesheets:null,count:0,unsuspend:P},_d(s),at=k(),at!==null)){i.cancelPendingCommit=at(Vp.bind(null,i,s,C,u,p,b,G,K,me,tt,1,Ue,Ge)),el(i,C,G,!Fe);return}Vp(i,s,C,u,p,b,G,K,me)}function Ef(i){for(var s=i;;){var u=s.tag;if((u===0||u===11||u===15)&&s.flags&16384&&(u=s.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var p=0;p<u.length;p++){var b=u[p],C=b.getSnapshot;b=b.value;try{if(!kr(C(),b))return!1}catch{return!1}}if(u=s.child,s.subtreeFlags&16384&&u!==null)u.return=s,s=u;else{if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function el(i,s,u,p){s&=~vd,s&=~Rs,i.suspendedLanes|=s,i.pingedLanes&=~s,p&&(i.warmLanes|=s),p=i.expirationTimes;for(var b=s;0<b;){var C=31-rr(b),G=1<<C;p[C]=-1,b&=~G}u!==0&&Xe(i,u,s)}function zn(){return(Li&6)===0?(Rh(0),!1):!0}function Ah(){if(_i!==null){if(Ti===0)var i=_i.return;else i=_i,Wr=Ya=null,an(i),Ui=null,Ri=0,i=_i;for(;i!==null;)df(i.alternate,i),i=i.return;_i=null}}function Au(i,s){var u=i.timeoutHandle;u!==-1&&(i.timeoutHandle=-1,Qp(u)),u=i.cancelPendingCommit,u!==null&&(i.cancelPendingCommit=null,u()),Ah(),Oi=i,_i=u=Tr(i.current,null),xi=s,Ti=0,ia=null,Bl=!1,Su=ye(i,s),yd=!1,Tu=rs=vd=Rs=Fl=jn=0,_a=Mh=null,bf=!1,(s&8)!==0&&(s|=s&32);var p=i.entangledLanes;if(p!==0)for(i=i.entanglements,p&=s;0<p;){var b=31-rr(p),C=1<<b;s|=i[b],p&=~C}return lo=s,Eo(),u}function Cf(i,s){ni=null,Ke.H=ur,s===Sc||s===Qs?(s=uu(),Ti=3):s===lu?(s=uu(),Ti=4):Ti=s===zc?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,ia=s,_i===null&&(jn=1,ad(i,Xr(s,i.current)))}function tl(){var i=Ke.H;return Ke.H=ur,i===null?ur:i}function bd(){var i=Ke.A;return Ke.A=Bp,i}function Af(){jn=4,Bl||(xi&4194048)!==xi&&Nn.current!==null||(Su=!0),(Fl&134217727)===0&&(Rs&134217727)===0||Oi===null||el(Oi,xi,rs,!1)}function zf(i,s,u){var p=Li;Li|=2;var b=tl(),C=bd();(Oi!==i||xi!==s)&&(Mu=null,Au(i,s)),s=!1;var G=jn;e:do try{if(Ti!==0&&_i!==null){var K=_i,me=ia;switch(Ti){case 8:Ah(),G=6;break e;case 3:case 2:case 9:case 6:Nn.current===null&&(s=!0);var Fe=Ti;if(Ti=0,ia=null,Ds(i,K,me,Fe),u&&Su){G=0;break e}break;default:Fe=Ti,Ti=0,ia=null,Ds(i,K,me,Fe)}}Rm(),G=jn;break}catch(tt){Cf(i,tt)}while(!0);return s&&i.shellSuspendCounter++,Wr=Ya=null,Li=p,Ke.H=b,Ke.A=C,_i===null&&(Oi=null,xi=0,Eo()),G}function Rm(){for(;_i!==null;)Rf(_i)}function Up(i,s){var u=Li;Li|=2;var p=tl(),b=bd();Oi!==i||xi!==s?(Mu=null,Eh=Xi()+500,Au(i,s)):Su=ye(i,s);e:do try{if(Ti!==0&&_i!==null){s=_i;var C=ia;t:switch(Ti){case 1:Ti=0,ia=null,Ds(i,s,C,1);break;case 2:case 9:if(Oa(C)){Ti=0,ia=null,zu(s);break}s=function(){Ti!==2&&Ti!==9||Oi!==i||(Ti=7),ss(i)},C.then(s,s);break e;case 3:Ti=7;break e;case 4:Ti=5;break e;case 7:Oa(C)?(Ti=0,ia=null,zu(s)):(Ti=0,ia=null,Ds(i,s,C,7));break;case 5:var G=null;switch(_i.tag){case 26:G=_i.memoizedState;case 5:case 27:var K=_i;if(!G||x(G)){Ti=0,ia=null;var me=K.sibling;if(me!==null)_i=me;else{var Fe=K.return;Fe!==null?(_i=Fe,Lc(Fe)):_i=null}break t}}Ti=0,ia=null,Ds(i,s,C,5);break;case 6:Ti=0,ia=null,Ds(i,s,C,6);break;case 8:Ah(),jn=6;break e;default:throw Error(E(462))}}Pf();break}catch(tt){Cf(i,tt)}while(!0);return Wr=Ya=null,Ke.H=p,Ke.A=b,Li=u,_i!==null?0:(Oi=null,xi=0,Eo(),jn)}function Pf(){for(;_i!==null&&!aa();)Rf(_i)}function Rf(i){var s=fd(i.alternate,i,lo);i.memoizedProps=i.pendingProps,s===null?Lc(i):_i=s}function zu(i){var s=i,u=s.alternate;switch(s.tag){case 15:case 0:s=of(u,s,s.pendingProps,s.type,void 0,xi);break;case 11:s=of(u,s,s.pendingProps,s.type.render,s.ref,xi);break;case 5:an(s);default:df(u,s),s=_i=ih(s,lo),s=fd(u,s,lo)}i.memoizedProps=i.pendingProps,s===null?Lc(i):_i=s}function Ds(i,s,u,p){Wr=Ya=null,an(s),Ui=null,Ri=0;var b=s.return;try{if(Cp(i,b,s,u,xi)){jn=1,ad(i,Xr(u,i.current)),_i=null;return}}catch(C){if(b!==null)throw _i=b,C;jn=1,ad(i,Xr(u,i.current)),_i=null;return}s.flags&32768?(Si||p===1?i=!0:Su||(xi&536870912)!==0?i=!1:(Bl=i=!0,(p===2||p===9||p===3||p===6)&&(p=Nn.current,p!==null&&p.tag===13&&(p.flags|=16384))),zh(s,i)):Lc(s)}function Lc(i){var s=i;do{if((s.flags&32768)!==0){zh(s,Bl);return}i=s.return;var u=uf(s.alternate,s,lo);if(u!==null){_i=u;return}if(s=s.sibling,s!==null){_i=s;return}_i=s=i}while(s!==null);jn===0&&(jn=5)}function zh(i,s){do{var u=hf(i.alternate,i);if(u!==null){u.flags&=32767,_i=u;return}if(u=i.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!s&&(i=i.sibling,i!==null)){_i=i;return}_i=i=u}while(i!==null);jn=6,_i=null}function Vp(i,s,u,p,b,C,G,K,me){i.cancelPendingCommit=null;do Ph();while(xr!==0);if((Li&6)!==0)throw Error(E(327));if(s!==null){if(s===i.current)throw Error(E(177));if(C=s.lanes|s.childLanes,C|=ys,ze(i,u,C,G,K,me),i===Oi&&(_i=Oi=null,xi=0),Eu=s,Qo=i,Jo=u,Sf=C,xd=b,Np=p,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,km(Sa,function(){return kf(),null})):(i.callbackNode=null,i.callbackPriority=0),p=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||p){p=Ke.T,Ke.T=null,b=yt.p,yt.p=2,G=Li,Li|=4;try{md(i,s,u)}finally{Li=G,yt.p=b,Ke.T=p}}xr=1,Gp(),Df(),If()}}function Gp(){if(xr===1){xr=0;var i=Qo,s=Eu,u=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||u){u=Ke.T,Ke.T=null;var p=yt.p;yt.p=2;var b=Li;Li|=4;try{Ol(s,i);var C=Rd,G=pc(i.containerInfo),K=C.focusedElem,me=C.selectionRange;if(G!==K&&K&&K.ownerDocument&&vi(K.ownerDocument.documentElement,K)){if(me!==null&&za(K)){var Fe=me.start,tt=me.end;if(tt===void 0&&(tt=Fe),"selectionStart"in K)K.selectionStart=Fe,K.selectionEnd=Math.min(tt,K.value.length);else{var at=K.ownerDocument||document,Ue=at&&at.defaultView||window;if(Ue.getSelection){var Ge=Ue.getSelection(),jt=K.textContent.length,Gt=Math.min(me.start,jt),$i=me.end===void 0?Gt:Math.min(me.end,jt);!Ge.extend&&Gt>$i&&(G=$i,$i=Gt,Gt=G);var Pe=eu(K,Gt),Me=eu(K,$i);if(Pe&&Me&&(Ge.rangeCount!==1||Ge.anchorNode!==Pe.node||Ge.anchorOffset!==Pe.offset||Ge.focusNode!==Me.node||Ge.focusOffset!==Me.offset)){var Le=at.createRange();Le.setStart(Pe.node,Pe.offset),Ge.removeAllRanges(),Gt>$i?(Ge.addRange(Le),Ge.extend(Me.node,Me.offset)):(Le.setEnd(Me.node,Me.offset),Ge.addRange(Le))}}}}for(at=[],Ge=K;Ge=Ge.parentNode;)Ge.nodeType===1&&at.push({element:Ge,left:Ge.scrollLeft,top:Ge.scrollTop});for(typeof K.focus=="function"&&K.focus(),K=0;K<at.length;K++){var rt=at[K];rt.element.scrollLeft=rt.left,rt.element.scrollTop=rt.top}}Je=!!il,Rd=il=null}finally{Li=b,yt.p=p,Ke.T=u}}i.current=s,xr=2}}function Df(){if(xr===2){xr=0;var i=Qo,s=Eu,u=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||u){u=Ke.T,Ke.T=null;var p=yt.p;yt.p=2;var b=Li;Li|=4;try{xu(i,s.alternate,s)}finally{Li=b,yt.p=p,Ke.T=u}}xr=3}}function If(){if(xr===4||xr===3){xr=0,ol();var i=Qo,s=Eu,u=Jo,p=Np;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?xr=5:(xr=0,Eu=Qo=null,qp(i,i.pendingLanes));var b=i.pendingLanes;if(b===0&&(Wo=null),Lt(u),s=s.stateNode,nn&&typeof nn.onCommitFiberRoot=="function")try{nn.onCommitFiberRoot(Vr,s,void 0,(s.current.flags&128)===128)}catch{}if(p!==null){s=Ke.T,b=yt.p,yt.p=2,Ke.T=null;try{for(var C=i.onRecoverableError,G=0;G<p.length;G++){var K=p[G];C(K.value,{componentStack:K.stack})}}finally{Ke.T=s,yt.p=b}}(Jo&3)!==0&&Ph(),ss(i),b=i.pendingLanes,(u&4194090)!==0&&(b&42)!==0?i===Tf?Ch++:(Ch=0,Tf=i):Ch=0,Rh(0)}}function qp(i,s){(i.pooledCacheLanes&=s)===0&&(s=i.pooledCache,s!=null&&(i.pooledCache=null,Bo(s)))}function Ph(i){return Gp(),Df(),If(),kf()}function kf(){if(xr!==5)return!1;var i=Qo,s=Sf;Sf=0;var u=Lt(Jo),p=Ke.T,b=yt.p;try{yt.p=32>u?32:u,Ke.T=null,u=xd,xd=null;var C=Qo,G=Jo;if(xr=0,Eu=Qo=null,Jo=0,(Li&6)!==0)throw Error(E(331));var K=Li;if(Li|=4,xf(C.current),Op(C,C.current,G,u),Li=K,Rh(0,!1),nn&&typeof nn.onPostCommitFiberRoot=="function")try{nn.onPostCommitFiberRoot(Vr,C)}catch{}return!0}finally{yt.p=b,Ke.T=p,qp(i,s)}}function wd(i,s,u){s=Xr(u,s),s=nf(i.stateNode,s,2),i=Ts(i,s,2),i!==null&&(je(i,2),ss(i))}function Vi(i,s,u){if(i.tag===3)wd(i,i,u);else for(;s!==null;){if(s.tag===3){wd(s,i,u);break}else if(s.tag===1){var p=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(Wo===null||!Wo.has(p))){i=Xr(u,i),u=od(2),p=Ts(s,u,2),p!==null&&(rf(u,p,s,i),je(p,2),ss(p));break}}s=s.return}}function Lf(i,s,u){var p=i.pingCache;if(p===null){p=i.pingCache=new Fp;var b=new Set;p.set(s,b)}else b=p.get(s),b===void 0&&(b=new Set,p.set(s,b));b.has(u)||(yd=!0,b.add(u),i=Zp.bind(null,i,s,u),s.then(i,i))}function Zp(i,s,u){var p=i.pingCache;p!==null&&p.delete(s),i.pingedLanes|=i.suspendedLanes&u,i.warmLanes&=~u,Oi===i&&(xi&u)===u&&(jn===4||jn===3&&(xi&62914560)===xi&&300>Xi()-wf?(Li&2)===0&&Au(i,0):vd|=u,Tu===xi&&(Tu=0)),ss(i)}function $p(i,s){s===0&&(s=Se()),i=Pa(i,s),i!==null&&(je(i,s),ss(i))}function Dm(i){var s=i.memoizedState,u=0;s!==null&&(u=s.retryLane),$p(i,u)}function Im(i,s){var u=0;switch(i.tag){case 13:var p=i.stateNode,b=i.memoizedState;b!==null&&(u=b.retryLane);break;case 19:p=i.stateNode;break;case 22:p=i.stateNode._retryCache;break;default:throw Error(E(314))}p!==null&&p.delete(s),$p(i,u)}function km(i,s){return tn(i,s)}var Sd=null,Oc=null,Td=!1,as=!1,co=!1,Nl=0;function ss(i){i!==Oc&&i.next===null&&(Oc===null?Sd=Oc=i:Oc=Oc.next=i),as=!0,Td||(Td=!0,Of())}function Rh(i,s){if(!co&&as){co=!0;do for(var u=!1,p=Sd;p!==null;){if(i!==0){var b=p.pendingLanes;if(b===0)var C=0;else{var G=p.suspendedLanes,K=p.pingedLanes;C=(1<<31-rr(42|i)+1)-1,C&=b&~(G&~K),C=C&201326741?C&201326741|1:C?C|2:0}C!==0&&(u=!0,Ed(p,C))}else C=xi,C=ce(p,p===Oi?C:0,p.cancelPendingCommit!==null||p.timeoutHandle!==-1),(C&3)===0||ye(p,C)||(u=!0,Ed(p,C));p=p.next}while(u);co=!1}}function Lm(){Dh()}function Dh(){as=Td=!1;var i=0;Nl!==0&&(Ul()&&(i=Nl),Nl=0);for(var s=Xi(),u=null,p=Sd;p!==null;){var b=p.next,C=Md(p,s);C===0?(p.next=null,u===null?Sd=b:u.next=b,b===null&&(Oc=u)):(u=p,(i!==0||(C&3)!==0)&&(as=!0)),p=b}Rh(i)}function Md(i,s){for(var u=i.suspendedLanes,p=i.pingedLanes,b=i.expirationTimes,C=i.pendingLanes&-62914561;0<C;){var G=31-rr(C),K=1<<G,me=b[G];me===-1?((K&u)===0||(K&p)!==0)&&(b[G]=Ce(K,s)):me<=s&&(i.expiredLanes|=K),C&=~K}if(s=Oi,u=xi,u=ce(i,i===s?u:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),p=i.callbackNode,u===0||i===s&&(Ti===2||Ti===9)||i.cancelPendingCommit!==null)return p!==null&&p!==null&&ra(p),i.callbackNode=null,i.callbackPriority=0;if((u&3)===0||ye(i,u)){if(s=u&-u,s===i.callbackPriority)return s;switch(p!==null&&ra(p),Lt(u)){case 2:case 8:u=ks;break;case 32:u=Sa;break;case 268435456:u=Ls;break;default:u=Sa}return p=Hp.bind(null,i),u=tn(u,p),i.callbackPriority=s,i.callbackNode=u,s}return p!==null&&p!==null&&ra(p),i.callbackPriority=2,i.callbackNode=null,2}function Hp(i,s){if(xr!==0&&xr!==5)return i.callbackNode=null,i.callbackPriority=0,null;var u=i.callbackNode;if(Ph()&&i.callbackNode!==u)return null;var p=xi;return p=ce(i,i===Oi?p:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),p===0?null:(Cu(i,p,s),Md(i,Xi()),i.callbackNode!=null&&i.callbackNode===u?Hp.bind(null,i):null)}function Ed(i,s){if(Ph())return null;Cu(i,s,!0)}function Of(){Jp(function(){(Li&6)!==0?tn(br,Lm):Dh()})}function jl(){return Nl===0&&(Nl=ke()),Nl}function Bf(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:cl(""+i)}function Ff(i,s){var u=s.ownerDocument.createElement("input");return u.name=s.name,u.value=s.value,i.id&&u.setAttribute("form",i.id),s.parentNode.insertBefore(u,s),i=new FormData(i),u.parentNode.removeChild(u),i}function Nf(i,s,u,p,b){if(s==="submit"&&u&&u.stateNode===b){var C=Bf((b[Qt]||null).action),G=p.submitter;G&&(s=(s=G[Qt]||null)?Bf(s.formAction):G.getAttribute("formAction"),s!==null&&(C=s,G=null));var K=new ms("action","action",null,p,b);i.push({event:K,listeners:[{instance:null,listener:function(){if(p.defaultPrevented){if(Nl!==0){var me=G?Ff(b,G):new FormData(b);zi(u,{pending:!0,data:me,method:b.method,action:C},null,me)}}else typeof C=="function"&&(K.preventDefault(),me=G?Ff(b,G):new FormData(b),zi(u,{pending:!0,data:me,method:b.method,action:C},C,me))},currentTarget:b}]})}}for(var Cd=0;Cd<Mo.length;Cd++){var Pu=Mo[Cd],Xp=Pu.toLowerCase(),Om=Pu[0].toUpperCase()+Pu.slice(1);pr(Xp,"on"+Om)}pr(Qu,"onAnimationEnd"),pr(ed,"onAnimationIteration"),pr(Ju,"onAnimationStart"),pr("dblclick","onDoubleClick"),pr("focusin","onFocus"),pr("focusout","onBlur"),pr(tu,"onTransitionRun"),pr(iu,"onTransitionStart"),pr(nu,"onTransitionCancel"),pr(ru,"onTransitionEnd"),Zt("onMouseEnter",["mouseout","mouseover"]),Zt("onMouseLeave",["mouseout","mouseover"]),Zt("onPointerEnter",["pointerout","pointerover"]),Zt("onPointerLeave",["pointerout","pointerover"]),fr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),fr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),fr("onBeforeInput",["compositionend","keypress","textInput","paste"]),fr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),fr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),fr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ih="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Yp=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ih));function Kp(i,s){s=(s&4)!==0;for(var u=0;u<i.length;u++){var p=i[u],b=p.event;p=p.listeners;e:{var C=void 0;if(s)for(var G=p.length-1;0<=G;G--){var K=p[G],me=K.instance,Fe=K.currentTarget;if(K=K.listener,me!==C&&b.isPropagationStopped())break e;C=K,b.currentTarget=Fe;try{C(b)}catch(tt){_u(tt)}b.currentTarget=null,C=me}else for(G=0;G<p.length;G++){if(K=p[G],me=K.instance,Fe=K.currentTarget,K=K.listener,me!==C&&b.isPropagationStopped())break e;C=K,b.currentTarget=Fe;try{C(b)}catch(tt){_u(tt)}b.currentTarget=null,C=me}}}}function yi(i,s){var u=s[Bt];u===void 0&&(u=s[Bt]=new Set);var p=i+"__bubble";u.has(p)||(zd(s,i,2,!1),u.add(p))}function jf(i,s,u){var p=0;s&&(p|=4),zd(u,i,p,s)}var Ad="_reactListening"+Math.random().toString(36).slice(2);function Uf(i){if(!i[Ad]){i[Ad]=!0,Rr.forEach(function(u){u!=="selectionchange"&&(Yp.has(u)||jf(u,!1,i),jf(u,!0,i))});var s=i.nodeType===9?i:i.ownerDocument;s===null||s[Ad]||(s[Ad]=!0,jf("selectionchange",!1,s))}}function zd(i,s,u,p){switch(St(s)){case 2:var b=Ne;break;case 8:b=qe;break;default:b=st}u=b.bind(null,s,u,i),b=void 0,!Ln||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(b=!0),p?b!==void 0?i.addEventListener(s,u,{capture:!0,passive:b}):i.addEventListener(s,u,!0):b!==void 0?i.addEventListener(s,u,{passive:b}):i.addEventListener(s,u,!1)}function uo(i,s,u,p,b){var C=p;if((s&1)===0&&(s&2)===0&&p!==null)e:for(;;){if(p===null)return;var G=p.tag;if(G===3||G===4){var K=p.stateNode.containerInfo;if(K===b)break;if(G===4)for(G=p.return;G!==null;){var me=G.tag;if((me===3||me===4)&&G.stateNode.containerInfo===b)return;G=G.return}for(;K!==null;){if(G=Gr(K),G===null)return;if(me=G.tag,me===5||me===6||me===26||me===27){p=C=G;continue e}K=K.parentNode}}p=p.return}ar(function(){var Fe=C,tt=Ma(u),at=[];e:{var Ue=qs.get(i);if(Ue!==void 0){var Ge=ms,jt=i;switch(i){case"keypress":if(Xt(u)===0)break e;case"keydown":case"keyup":Ge=$r;break;case"focusin":jt="focus",Ge=wo;break;case"focusout":jt="blur",Ge=wo;break;case"beforeblur":case"afterblur":Ge=wo;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ge=hl;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ge=Jn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ge=_l;break;case Qu:case ed:case Ju:Ge=Bn;break;case ru:Ge=Hd;break;case"scroll":case"scrollend":Ge=Vu;break;case"wheel":Ge=Yd;break;case"copy":case"cut":case"paste":Ge=pl;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ge=Hc;break;case"toggle":case"beforetoggle":Ge=Xc}var Gt=(s&4)!==0,$i=!Gt&&(i==="scroll"||i==="scrollend"),Pe=Gt?Ue!==null?Ue+"Capture":null:Ue;Gt=[];for(var Me=Fe,Le;Me!==null;){var rt=Me;if(Le=rt.stateNode,rt=rt.tag,rt!==5&&rt!==26&&rt!==27||Le===null||Pe===null||(rt=on(Me,Pe),rt!=null&&Gt.push(Ru(Me,rt,Le))),$i)break;Me=Me.return}0<Gt.length&&(Ue=new Ge(Ue,jt,null,u,tt),at.push({event:Ue,listeners:Gt}))}}if((s&7)===0){e:{if(Ue=i==="mouseover"||i==="pointerover",Ge=i==="mouseout"||i==="pointerout",Ue&&u!==Dr&&(jt=u.relatedTarget||u.fromElement)&&(Gr(jt)||jt[ci]))break e;if((Ge||Ue)&&(Ue=tt.window===tt?tt:(Ue=tt.ownerDocument)?Ue.defaultView||Ue.parentWindow:window,Ge?(jt=u.relatedTarget||u.toElement,Ge=Fe,jt=jt?Gr(jt):null,jt!==null&&($i=F(jt),Gt=jt.tag,jt!==$i||Gt!==5&&Gt!==27&&Gt!==6)&&(jt=null)):(Ge=null,jt=Fe),Ge!==jt)){if(Gt=hl,rt="onMouseLeave",Pe="onMouseEnter",Me="mouse",(i==="pointerout"||i==="pointerover")&&(Gt=Hc,rt="onPointerLeave",Pe="onPointerEnter",Me="pointer"),$i=Ge==null?Ue:ht(Ge),Le=jt==null?Ue:ht(jt),Ue=new Gt(rt,Me+"leave",Ge,u,tt),Ue.target=$i,Ue.relatedTarget=Le,rt=null,Gr(tt)===Fe&&(Gt=new Gt(Pe,Me+"enter",jt,u,tt),Gt.target=Le,Gt.relatedTarget=$i,rt=Gt),$i=rt,Ge&&jt)t:{for(Gt=Ge,Pe=jt,Me=0,Le=Gt;Le;Le=Bc(Le))Me++;for(Le=0,rt=Pe;rt;rt=Bc(rt))Le++;for(;0<Me-Le;)Gt=Bc(Gt),Me--;for(;0<Le-Me;)Pe=Bc(Pe),Le--;for(;Me--;){if(Gt===Pe||Pe!==null&&Gt===Pe.alternate)break t;Gt=Bc(Gt),Pe=Bc(Pe)}Gt=null}else Gt=null;Ge!==null&&Vf(at,Ue,Ge,Gt,!1),jt!==null&&$i!==null&&Vf(at,$i,jt,Gt,!0)}}e:{if(Ue=Fe?ht(Fe):window,Ge=Ue.nodeName&&Ue.nodeName.toLowerCase(),Ge==="select"||Ge==="input"&&Ue.type==="file")var Pt=$u;else if(So(Ue))if(Hu)Pt=Qd;else{Pt=Wd;var pi=wl}else Ge=Ue.nodeName,!Ge||Ge.toLowerCase()!=="input"||Ue.type!=="checkbox"&&Ue.type!=="radio"?Fe&&Ta(Fe.elementType)&&(Pt=$u):Pt=Jc;if(Pt&&(Pt=Pt(i,Fe))){Wh(at,Pt,u,tt);break e}pi&&pi(i,Ue,Fe),i==="focusout"&&Fe&&Ue.type==="number"&&Fe.memoizedProps.value!=null&&ic(Ue,"number",Ue.value)}switch(pi=Fe?ht(Fe):window,i){case"focusin":(So(pi)||pi.contentEditable==="true")&&(Vs=pi,mc=Fe,Tl=null);break;case"focusout":Tl=mc=Vs=null;break;case"mousedown":gc=!0;break;case"contextmenu":case"mouseup":case"dragend":gc=!1,Gs(at,u,tt);break;case"selectionchange":if(Ku)break;case"keydown":case"keyup":Gs(at,u,tt)}var Nt;if(yl)e:{switch(i){case"compositionstart":var Ht="onCompositionStart";break e;case"compositionend":Ht="onCompositionEnd";break e;case"compositionupdate":Ht="onCompositionUpdate";break e}Ht=void 0}else $a?Kc(i,u)&&(Ht="onCompositionEnd"):i==="keydown"&&u.keyCode===229&&(Ht="onCompositionStart");Ht&&(cc&&u.locale!=="ko"&&($a||Ht!=="onCompositionStart"?Ht==="onCompositionEnd"&&$a&&(Nt=$t()):(Ea=tt,si="value"in Ea?Ea.value:Ea.textContent,$a=!0)),pi=kh(Fe,Ht),0<pi.length&&(Ht=new Hh(Ht,i,null,u,tt),at.push({event:Ht,listeners:pi}),Nt?Ht.data=Nt:(Nt=vl(u),Nt!==null&&(Ht.data=Nt)))),(Nt=Zu?Yh(i,u):uc(i,u))&&(Ht=kh(Fe,"onBeforeInput"),0<Ht.length&&(pi=new Hh("onBeforeInput","beforeinput",null,u,tt),at.push({event:pi,listeners:Ht}),pi.data=Nt)),Nf(at,i,Fe,u,tt)}Kp(at,s)})}function Ru(i,s,u){return{instance:i,listener:s,currentTarget:u}}function kh(i,s){for(var u=s+"Capture",p=[];i!==null;){var b=i,C=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||C===null||(b=on(i,u),b!=null&&p.unshift(Ru(i,b,C)),b=on(i,s),b!=null&&p.push(Ru(i,b,C))),i.tag===3)return p;i=i.return}return[]}function Bc(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function Vf(i,s,u,p,b){for(var C=s._reactName,G=[];u!==null&&u!==p;){var K=u,me=K.alternate,Fe=K.stateNode;if(K=K.tag,me!==null&&me===p)break;K!==5&&K!==26&&K!==27||Fe===null||(me=Fe,b?(Fe=on(u,C),Fe!=null&&G.unshift(Ru(u,Fe,me))):b||(Fe=on(u,C),Fe!=null&&G.push(Ru(u,Fe,me)))),u=u.return}G.length!==0&&i.push({event:s,listeners:G})}var Wp=/\r\n?/g,Gf=/\u0000|\uFFFD/g;function qf(i){return(typeof i=="string"?i:""+i).replace(Wp,`
`).replace(Gf,"")}function Du(i,s){return s=qf(s),qf(i)===s}function Lh(){}function Bi(i,s,u,p,b,C){switch(u){case"children":typeof p=="string"?s==="body"||s==="textarea"&&p===""||ps(i,p):(typeof p=="number"||typeof p=="bigint")&&s!=="body"&&ps(i,""+p);break;case"className":oa(i,"class",p);break;case"tabIndex":oa(i,"tabindex",p);break;case"dir":case"role":case"viewBox":case"width":case"height":oa(i,u,p);break;case"style":Ga(i,p,C);break;case"data":if(s!=="object"){oa(i,"data",p);break}case"src":case"href":if(p===""&&(s!=="a"||u!=="href")){i.removeAttribute(u);break}if(p==null||typeof p=="function"||typeof p=="symbol"||typeof p=="boolean"){i.removeAttribute(u);break}p=cl(""+p),i.setAttribute(u,p);break;case"action":case"formAction":if(typeof p=="function"){i.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof C=="function"&&(u==="formAction"?(s!=="input"&&Bi(i,s,"name",b.name,b,null),Bi(i,s,"formEncType",b.formEncType,b,null),Bi(i,s,"formMethod",b.formMethod,b,null),Bi(i,s,"formTarget",b.formTarget,b,null)):(Bi(i,s,"encType",b.encType,b,null),Bi(i,s,"method",b.method,b,null),Bi(i,s,"target",b.target,b,null)));if(p==null||typeof p=="symbol"||typeof p=="boolean"){i.removeAttribute(u);break}p=cl(""+p),i.setAttribute(u,p);break;case"onClick":p!=null&&(i.onclick=Lh);break;case"onScroll":p!=null&&yi("scroll",i);break;case"onScrollEnd":p!=null&&yi("scrollend",i);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(E(61));if(u=p.__html,u!=null){if(b.children!=null)throw Error(E(60));i.innerHTML=u}}break;case"multiple":i.multiple=p&&typeof p!="function"&&typeof p!="symbol";break;case"muted":i.muted=p&&typeof p!="function"&&typeof p!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(p==null||typeof p=="function"||typeof p=="boolean"||typeof p=="symbol"){i.removeAttribute("xlink:href");break}u=cl(""+p),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":p!=null&&typeof p!="function"&&typeof p!="symbol"?i.setAttribute(u,""+p):i.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":p&&typeof p!="function"&&typeof p!="symbol"?i.setAttribute(u,""):i.removeAttribute(u);break;case"capture":case"download":p===!0?i.setAttribute(u,""):p!==!1&&p!=null&&typeof p!="function"&&typeof p!="symbol"?i.setAttribute(u,p):i.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":p!=null&&typeof p!="function"&&typeof p!="symbol"&&!isNaN(p)&&1<=p?i.setAttribute(u,p):i.removeAttribute(u);break;case"rowSpan":case"start":p==null||typeof p=="function"||typeof p=="symbol"||isNaN(p)?i.removeAttribute(u):i.setAttribute(u,p);break;case"popover":yi("beforetoggle",i),yi("toggle",i),Bs(i,"popover",p);break;case"xlinkActuate":qr(i,"http://www.w3.org/1999/xlink","xlink:actuate",p);break;case"xlinkArcrole":qr(i,"http://www.w3.org/1999/xlink","xlink:arcrole",p);break;case"xlinkRole":qr(i,"http://www.w3.org/1999/xlink","xlink:role",p);break;case"xlinkShow":qr(i,"http://www.w3.org/1999/xlink","xlink:show",p);break;case"xlinkTitle":qr(i,"http://www.w3.org/1999/xlink","xlink:title",p);break;case"xlinkType":qr(i,"http://www.w3.org/1999/xlink","xlink:type",p);break;case"xmlBase":qr(i,"http://www.w3.org/XML/1998/namespace","xml:base",p);break;case"xmlLang":qr(i,"http://www.w3.org/XML/1998/namespace","xml:lang",p);break;case"xmlSpace":qr(i,"http://www.w3.org/XML/1998/namespace","xml:space",p);break;case"is":Bs(i,"is",p);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=bo.get(u)||u,Bs(i,u,p))}}function Pd(i,s,u,p,b,C){switch(u){case"style":Ga(i,p,C);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(E(61));if(u=p.__html,u!=null){if(b.children!=null)throw Error(E(60));i.innerHTML=u}}break;case"children":typeof p=="string"?ps(i,p):(typeof p=="number"||typeof p=="bigint")&&ps(i,""+p);break;case"onScroll":p!=null&&yi("scroll",i);break;case"onScrollEnd":p!=null&&yi("scrollend",i);break;case"onClick":p!=null&&(i.onclick=Lh);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ql.hasOwnProperty(u))e:{if(u[0]==="o"&&u[1]==="n"&&(b=u.endsWith("Capture"),s=u.slice(2,b?u.length-7:void 0),C=i[Qt]||null,C=C!=null?C[u]:null,typeof C=="function"&&i.removeEventListener(s,C,b),typeof p=="function")){typeof C!="function"&&C!==null&&(u in i?i[u]=null:i.hasAttribute(u)&&i.removeAttribute(u)),i.addEventListener(s,p,b);break e}u in i?i[u]=p:p===!0?i.setAttribute(u,""):Bs(i,u,p)}}}function Gi(i,s,u){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":yi("error",i),yi("load",i);var p=!1,b=!1,C;for(C in u)if(u.hasOwnProperty(C)){var G=u[C];if(G!=null)switch(C){case"src":p=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(E(137,s));default:Bi(i,s,C,G,u,null)}}b&&Bi(i,s,"srcSet",u.srcSet,u,null),p&&Bi(i,s,"src",u.src,u,null);return;case"input":yi("invalid",i);var K=C=G=b=null,me=null,Fe=null;for(p in u)if(u.hasOwnProperty(p)){var tt=u[p];if(tt!=null)switch(p){case"name":b=tt;break;case"type":G=tt;break;case"checked":me=tt;break;case"defaultChecked":Fe=tt;break;case"value":C=tt;break;case"defaultValue":K=tt;break;case"children":case"dangerouslySetInnerHTML":if(tt!=null)throw Error(E(137,s));break;default:Bi(i,s,p,tt,u,null)}}xo(i,C,K,me,Fe,G,b,!1),fs(i);return;case"select":yi("invalid",i),p=G=C=null;for(b in u)if(u.hasOwnProperty(b)&&(K=u[b],K!=null))switch(b){case"value":C=K;break;case"defaultValue":G=K;break;case"multiple":p=K;default:Bi(i,s,b,K,u,null)}s=C,u=G,i.multiple=!!p,s!=null?Fs(i,!!p,s,!1):u!=null&&Fs(i,!!p,u,!0);return;case"textarea":yi("invalid",i),C=b=p=null;for(G in u)if(u.hasOwnProperty(G)&&(K=u[G],K!=null))switch(G){case"value":p=K;break;case"defaultValue":b=K;break;case"children":C=K;break;case"dangerouslySetInnerHTML":if(K!=null)throw Error(E(91));break;default:Bi(i,s,G,K,u,null)}nc(i,p,b,C),fs(i);return;case"option":for(me in u)if(u.hasOwnProperty(me)&&(p=u[me],p!=null))switch(me){case"selected":i.selected=p&&typeof p!="function"&&typeof p!="symbol";break;default:Bi(i,s,me,p,u,null)}return;case"dialog":yi("beforetoggle",i),yi("toggle",i),yi("cancel",i),yi("close",i);break;case"iframe":case"object":yi("load",i);break;case"video":case"audio":for(p=0;p<Ih.length;p++)yi(Ih[p],i);break;case"image":yi("error",i),yi("load",i);break;case"details":yi("toggle",i);break;case"embed":case"source":case"link":yi("error",i),yi("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Fe in u)if(u.hasOwnProperty(Fe)&&(p=u[Fe],p!=null))switch(Fe){case"children":case"dangerouslySetInnerHTML":throw Error(E(137,s));default:Bi(i,s,Fe,p,u,null)}return;default:if(Ta(s)){for(tt in u)u.hasOwnProperty(tt)&&(p=u[tt],p!==void 0&&Pd(i,s,tt,p,u,void 0));return}}for(K in u)u.hasOwnProperty(K)&&(p=u[K],p!=null&&Bi(i,s,K,p,u,null))}function Iu(i,s,u,p){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,C=null,G=null,K=null,me=null,Fe=null,tt=null;for(Ge in u){var at=u[Ge];if(u.hasOwnProperty(Ge)&&at!=null)switch(Ge){case"checked":break;case"value":break;case"defaultValue":me=at;default:p.hasOwnProperty(Ge)||Bi(i,s,Ge,null,p,at)}}for(var Ue in p){var Ge=p[Ue];if(at=u[Ue],p.hasOwnProperty(Ue)&&(Ge!=null||at!=null))switch(Ue){case"type":C=Ge;break;case"name":b=Ge;break;case"checked":Fe=Ge;break;case"defaultChecked":tt=Ge;break;case"value":G=Ge;break;case"defaultValue":K=Ge;break;case"children":case"dangerouslySetInnerHTML":if(Ge!=null)throw Error(E(137,s));break;default:Ge!==at&&Bi(i,s,Ue,Ge,p,at)}}Zc(i,G,K,me,Fe,tt,C,b);return;case"select":Ge=G=K=Ue=null;for(C in u)if(me=u[C],u.hasOwnProperty(C)&&me!=null)switch(C){case"value":break;case"multiple":Ge=me;default:p.hasOwnProperty(C)||Bi(i,s,C,null,p,me)}for(b in p)if(C=p[b],me=u[b],p.hasOwnProperty(b)&&(C!=null||me!=null))switch(b){case"value":Ue=C;break;case"defaultValue":K=C;break;case"multiple":G=C;default:C!==me&&Bi(i,s,b,C,p,me)}s=K,u=G,p=Ge,Ue!=null?Fs(i,!!u,Ue,!1):!!p!=!!u&&(s!=null?Fs(i,!!u,s,!0):Fs(i,!!u,u?[]:"",!1));return;case"textarea":Ge=Ue=null;for(K in u)if(b=u[K],u.hasOwnProperty(K)&&b!=null&&!p.hasOwnProperty(K))switch(K){case"value":break;case"children":break;default:Bi(i,s,K,null,p,b)}for(G in p)if(b=p[G],C=u[G],p.hasOwnProperty(G)&&(b!=null||C!=null))switch(G){case"value":Ue=b;break;case"defaultValue":Ge=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(E(91));break;default:b!==C&&Bi(i,s,G,b,p,C)}ju(i,Ue,Ge);return;case"option":for(var jt in u)if(Ue=u[jt],u.hasOwnProperty(jt)&&Ue!=null&&!p.hasOwnProperty(jt))switch(jt){case"selected":i.selected=!1;break;default:Bi(i,s,jt,null,p,Ue)}for(me in p)if(Ue=p[me],Ge=u[me],p.hasOwnProperty(me)&&Ue!==Ge&&(Ue!=null||Ge!=null))switch(me){case"selected":i.selected=Ue&&typeof Ue!="function"&&typeof Ue!="symbol";break;default:Bi(i,s,me,Ue,p,Ge)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Gt in u)Ue=u[Gt],u.hasOwnProperty(Gt)&&Ue!=null&&!p.hasOwnProperty(Gt)&&Bi(i,s,Gt,null,p,Ue);for(Fe in p)if(Ue=p[Fe],Ge=u[Fe],p.hasOwnProperty(Fe)&&Ue!==Ge&&(Ue!=null||Ge!=null))switch(Fe){case"children":case"dangerouslySetInnerHTML":if(Ue!=null)throw Error(E(137,s));break;default:Bi(i,s,Fe,Ue,p,Ge)}return;default:if(Ta(s)){for(var $i in u)Ue=u[$i],u.hasOwnProperty($i)&&Ue!==void 0&&!p.hasOwnProperty($i)&&Pd(i,s,$i,void 0,p,Ue);for(tt in p)Ue=p[tt],Ge=u[tt],!p.hasOwnProperty(tt)||Ue===Ge||Ue===void 0&&Ge===void 0||Pd(i,s,tt,Ue,p,Ge);return}}for(var Pe in u)Ue=u[Pe],u.hasOwnProperty(Pe)&&Ue!=null&&!p.hasOwnProperty(Pe)&&Bi(i,s,Pe,null,p,Ue);for(at in p)Ue=p[at],Ge=u[at],!p.hasOwnProperty(at)||Ue===Ge||Ue==null&&Ge==null||Bi(i,s,at,Ue,p,Ge)}var il=null,Rd=null;function Oh(i){return i.nodeType===9?i:i.ownerDocument}function Zf(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function $f(i,s){if(i===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&s==="foreignObject"?0:i}function Hf(i,s){return i==="textarea"||i==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var Dd=null;function Ul(){var i=window.event;return i&&i.type==="popstate"?i===Dd?!1:(Dd=i,!0):(Dd=null,!1)}var Xf=typeof setTimeout=="function"?setTimeout:void 0,Qp=typeof clearTimeout=="function"?clearTimeout:void 0,Yf=typeof Promise=="function"?Promise:void 0,Jp=typeof queueMicrotask=="function"?queueMicrotask:typeof Yf<"u"?function(i){return Yf.resolve(null).then(i).catch(Bm)}:Xf;function Bm(i){setTimeout(function(){throw i})}function Vl(i){return i==="head"}function Kf(i,s){var u=s,p=0,b=0;do{var C=u.nextSibling;if(i.removeChild(u),C&&C.nodeType===8)if(u=C.data,u==="/$"){if(0<p&&8>p){u=p;var G=i.ownerDocument;if(u&1&&ho(G.documentElement),u&2&&ho(G.body),u&4)for(u=G.head,ho(u),G=u.firstChild;G;){var K=G.nextSibling,me=G.nodeName;G[wn]||me==="SCRIPT"||me==="STYLE"||me==="LINK"&&G.rel.toLowerCase()==="stylesheet"||u.removeChild(G),G=K}}if(b===0){i.removeChild(C),_n(s);return}b--}else u==="$"||u==="$?"||u==="$!"?b++:p=u.charCodeAt(0)-48;else p=0;u=C}while(u);_n(s)}function Id(i){var s=i.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var u=s;switch(s=s.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":Id(u),Yi(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}i.removeChild(u)}}function kd(i,s,u,p){for(;i.nodeType===1;){var b=u;if(i.nodeName.toLowerCase()!==s.toLowerCase()){if(!p&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(p){if(!i[wn])switch(s){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(C=i.getAttribute("rel"),C==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(C!==b.rel||i.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||i.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||i.getAttribute("title")!==(b.title==null?null:b.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(C=i.getAttribute("src"),(C!==(b.src==null?null:b.src)||i.getAttribute("type")!==(b.type==null?null:b.type)||i.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&C&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(s==="input"&&i.type==="hidden"){var C=b.name==null?null:""+b.name;if(b.type==="hidden"&&i.getAttribute("name")===C)return i}else return i;if(i=va(i.nextSibling),i===null)break}return null}function em(i,s,u){if(s==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!u||(i=va(i.nextSibling),i===null))return null;return i}function ku(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState==="complete"}function Ld(i,s){var u=i.ownerDocument;if(i.data!=="$?"||u.readyState==="complete")s();else{var p=function(){s(),u.removeEventListener("DOMContentLoaded",p)};u.addEventListener("DOMContentLoaded",p),i._reactRetry=p}}function va(i){for(;i!=null;i=i.nextSibling){var s=i.nodeType;if(s===1||s===3)break;if(s===8){if(s=i.data,s==="$"||s==="$!"||s==="$?"||s==="F!"||s==="F")break;if(s==="/$")return null}}return i}var Wf=null;function tm(i){i=i.previousSibling;for(var s=0;i;){if(i.nodeType===8){var u=i.data;if(u==="$"||u==="$!"||u==="$?"){if(s===0)return i;s--}else u==="/$"&&s++}i=i.previousSibling}return null}function im(i,s,u){switch(s=Oh(u),i){case"html":if(i=s.documentElement,!i)throw Error(E(452));return i;case"head":if(i=s.head,!i)throw Error(E(453));return i;case"body":if(i=s.body,!i)throw Error(E(454));return i;default:throw Error(E(451))}}function ho(i){for(var s=i.attributes;s.length;)i.removeAttributeNode(s[0]);Yi(i)}var qi=new Map,Od=new Set;function Bh(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var fo=yt.d;yt.d={f:Qf,r:Fm,D:Nm,C:nm,L:ep,m:tp,X:Fh,S:rm,M:ip};function Qf(){var i=fo.f(),s=zn();return i||s}function Fm(i){var s=sa(i);s!==null&&s.tag===5&&s.type==="form"?Ii(s):fo.r(i)}var Fc=typeof document>"u"?null:document;function Jf(i,s,u){var p=Fc;if(p&&typeof s=="string"&&s){var b=la(s);b='link[rel="'+i+'"][href="'+b+'"]',typeof u=="string"&&(b+='[crossorigin="'+u+'"]'),Od.has(b)||(Od.add(b),i={rel:i,crossOrigin:u,href:s},p.querySelector(b)===null&&(s=p.createElement("link"),Gi(s,"link",i),Dt(s),p.head.appendChild(s)))}}function Nm(i){fo.D(i),Jf("dns-prefetch",i,null)}function nm(i,s){fo.C(i,s),Jf("preconnect",i,s)}function ep(i,s,u){fo.L(i,s,u);var p=Fc;if(p&&i&&s){var b='link[rel="preload"][as="'+la(s)+'"]';s==="image"&&u&&u.imageSrcSet?(b+='[imagesrcset="'+la(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(b+='[imagesizes="'+la(u.imageSizes)+'"]')):b+='[href="'+la(i)+'"]';var C=b;switch(s){case"style":C=Gl(i);break;case"script":C=Zl(i)}qi.has(C)||(i=re({rel:"preload",href:s==="image"&&u&&u.imageSrcSet?void 0:i,as:s},u),qi.set(C,i),p.querySelector(b)!==null||s==="style"&&p.querySelector(ql(C))||s==="script"&&p.querySelector(Nc(C))||(s=p.createElement("link"),Gi(s,"link",i),Dt(s),p.head.appendChild(s)))}}function tp(i,s){fo.m(i,s);var u=Fc;if(u&&i){var p=s&&typeof s.as=="string"?s.as:"script",b='link[rel="modulepreload"][as="'+la(p)+'"][href="'+la(i)+'"]',C=b;switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":C=Zl(i)}if(!qi.has(C)&&(i=re({rel:"modulepreload",href:i},s),qi.set(C,i),u.querySelector(b)===null)){switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(Nc(C)))return}p=u.createElement("link"),Gi(p,"link",i),Dt(p),u.head.appendChild(p)}}}function rm(i,s,u){fo.S(i,s,u);var p=Fc;if(p&&i){var b=qt(p).hoistableStyles,C=Gl(i);s=s||"default";var G=b.get(C);if(!G){var K={loading:0,preload:null};if(G=p.querySelector(ql(C)))K.loading=5;else{i=re({rel:"stylesheet",href:i,"data-precedence":s},u),(u=qi.get(C))&&t(i,u);var me=G=p.createElement("link");Dt(me),Gi(me,"link",i),me._p=new Promise(function(Fe,tt){me.onload=Fe,me.onerror=tt}),me.addEventListener("load",function(){K.loading|=1}),me.addEventListener("error",function(){K.loading|=2}),K.loading|=4,a(G,s,p)}G={type:"stylesheet",instance:G,count:1,state:K},b.set(C,G)}}}function Fh(i,s){fo.X(i,s);var u=Fc;if(u&&i){var p=qt(u).hoistableScripts,b=Zl(i),C=p.get(b);C||(C=u.querySelector(Nc(b)),C||(i=re({src:i,async:!0},s),(s=qi.get(b))&&r(i,s),C=u.createElement("script"),Dt(C),Gi(C,"link",i),u.head.appendChild(C)),C={type:"script",instance:C,count:1,state:null},p.set(b,C))}}function ip(i,s){fo.M(i,s);var u=Fc;if(u&&i){var p=qt(u).hoistableScripts,b=Zl(i),C=p.get(b);C||(C=u.querySelector(Nc(b)),C||(i=re({src:i,async:!0,type:"module"},s),(s=qi.get(b))&&r(i,s),C=u.createElement("script"),Dt(C),Gi(C,"link",i),u.head.appendChild(C)),C={type:"script",instance:C,count:1,state:null},p.set(b,C))}}function np(i,s,u,p){var b=(b=Vt.current)?Bh(b):null;if(!b)throw Error(E(446));switch(i){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(s=Gl(u.href),u=qt(b).hoistableStyles,p=u.get(s),p||(p={type:"style",instance:null,count:0,state:null},u.set(s,p)),p):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){i=Gl(u.href);var C=qt(b).hoistableStyles,G=C.get(i);if(G||(b=b.ownerDocument||b,G={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},C.set(i,G),(C=b.querySelector(ql(i)))&&!C._p&&(G.instance=C,G.state.loading=5),qi.has(i)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},qi.set(i,u),C||rp(b,i,u,G.state))),s&&p===null)throw Error(E(528,""));return G}if(s&&p!==null)throw Error(E(529,""));return null;case"script":return s=u.async,u=u.src,typeof u=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=Zl(u),u=qt(b).hoistableScripts,p=u.get(s),p||(p={type:"script",instance:null,count:0,state:null},u.set(s,p)),p):{type:"void",instance:null,count:0,state:null};default:throw Error(E(444,i))}}function Gl(i){return'href="'+la(i)+'"'}function ql(i){return'link[rel="stylesheet"]['+i+"]"}function Lu(i){return re({},i,{"data-precedence":i.precedence,precedence:null})}function rp(i,s,u,p){i.querySelector('link[rel="preload"][as="style"]['+s+"]")?p.loading=1:(s=i.createElement("link"),p.preload=s,s.addEventListener("load",function(){return p.loading|=1}),s.addEventListener("error",function(){return p.loading|=2}),Gi(s,"link",u),Dt(s),i.head.appendChild(s))}function Zl(i){return'[src="'+la(i)+'"]'}function Nc(i){return"script[async]"+i}function am(i,s,u){if(s.count++,s.instance===null)switch(s.type){case"style":var p=i.querySelector('style[data-href~="'+la(u.href)+'"]');if(p)return s.instance=p,Dt(p),p;var b=re({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return p=(i.ownerDocument||i).createElement("style"),Dt(p),Gi(p,"style",b),a(p,u.precedence,i),s.instance=p;case"stylesheet":b=Gl(u.href);var C=i.querySelector(ql(b));if(C)return s.state.loading|=4,s.instance=C,Dt(C),C;p=Lu(u),(b=qi.get(b))&&t(p,b),C=(i.ownerDocument||i).createElement("link"),Dt(C);var G=C;return G._p=new Promise(function(K,me){G.onload=K,G.onerror=me}),Gi(C,"link",p),s.state.loading|=4,a(C,u.precedence,i),s.instance=C;case"script":return C=Zl(u.src),(b=i.querySelector(Nc(C)))?(s.instance=b,Dt(b),b):(p=u,(b=qi.get(C))&&(p=re({},u),r(p,b)),i=i.ownerDocument||i,b=i.createElement("script"),Dt(b),Gi(b,"link",p),i.head.appendChild(b),s.instance=b);case"void":return null;default:throw Error(E(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(p=s.instance,s.state.loading|=4,a(p,u.precedence,i));return s.instance}function a(i,s,u){for(var p=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=p.length?p[p.length-1]:null,C=b,G=0;G<p.length;G++){var K=p[G];if(K.dataset.precedence===s)C=K;else if(C!==b)break}C?C.parentNode.insertBefore(i,C.nextSibling):(s=u.nodeType===9?u.head:u,s.insertBefore(i,s.firstChild))}function t(i,s){i.crossOrigin==null&&(i.crossOrigin=s.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=s.referrerPolicy),i.title==null&&(i.title=s.title)}function r(i,s){i.crossOrigin==null&&(i.crossOrigin=s.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=s.referrerPolicy),i.integrity==null&&(i.integrity=s.integrity)}var o=null;function d(i,s,u){if(o===null){var p=new Map,b=o=new Map;b.set(u,p)}else b=o,p=b.get(u),p||(p=new Map,b.set(u,p));if(p.has(i))return p;for(p.set(i,null),u=u.getElementsByTagName(i),b=0;b<u.length;b++){var C=u[b];if(!(C[wn]||C[ei]||i==="link"&&C.getAttribute("rel")==="stylesheet")&&C.namespaceURI!=="http://www.w3.org/2000/svg"){var G=C.getAttribute(s)||"";G=i+G;var K=p.get(G);K?K.push(C):p.set(G,[C])}}return p}function g(i,s,u){i=i.ownerDocument||i,i.head.insertBefore(u,s==="title"?i.querySelector("head > title"):null)}function _(i,s,u){if(u===1||s.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return i=s.disabled,typeof s.precedence=="string"&&i==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function x(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}var T=null;function P(){}function D(i,s,u){if(T===null)throw Error(E(475));var p=T;if(s.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var b=Gl(u.href),C=i.querySelector(ql(b));if(C){i=C._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(p.count++,p=N.bind(p),i.then(p,p)),s.state.loading|=4,s.instance=C,Dt(C);return}C=i.ownerDocument||i,u=Lu(u),(b=qi.get(b))&&t(u,b),C=C.createElement("link"),Dt(C);var G=C;G._p=new Promise(function(K,me){G.onload=K,G.onerror=me}),Gi(C,"link",u),s.instance=C}p.stylesheets===null&&(p.stylesheets=new Map),p.stylesheets.set(s,i),(i=s.state.preload)&&(s.state.loading&3)===0&&(p.count++,s=N.bind(p),i.addEventListener("load",s),i.addEventListener("error",s))}}function k(){if(T===null)throw Error(E(475));var i=T;return i.stylesheets&&i.count===0&&q(i,i.stylesheets),0<i.count?function(s){var u=setTimeout(function(){if(i.stylesheets&&q(i,i.stylesheets),i.unsuspend){var p=i.unsuspend;i.unsuspend=null,p()}},6e4);return i.unsuspend=s,function(){i.unsuspend=null,clearTimeout(u)}}:null}function N(){if(this.count--,this.count===0){if(this.stylesheets)q(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var V=null;function q(i,s){i.stylesheets=null,i.unsuspend!==null&&(i.count++,V=new Map,s.forEach($,i),V=null,N.call(i))}function $(i,s){if(!(s.state.loading&4)){var u=V.get(i);if(u)var p=u.get(null);else{u=new Map,V.set(i,u);for(var b=i.querySelectorAll("link[data-precedence],style[data-precedence]"),C=0;C<b.length;C++){var G=b[C];(G.nodeName==="LINK"||G.getAttribute("media")!=="not all")&&(u.set(G.dataset.precedence,G),p=G)}p&&u.set(null,p)}b=s.instance,G=b.getAttribute("data-precedence"),C=u.get(G)||p,C===p&&u.set(null,b),u.set(G,b),this.count++,p=N.bind(this),b.addEventListener("load",p),b.addEventListener("error",p),C?C.parentNode.insertBefore(b,C.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(b,i.firstChild)),s.state.loading|=4}}var Q={$$typeof:Tt,Provider:null,Consumer:null,_currentValue:It,_currentValue2:It,_threadCount:0};function ae(i,s,u,p,b,C,G,K){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ze(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ze(0),this.hiddenUpdates=Ze(null),this.identifierPrefix=p,this.onUncaughtError=b,this.onCaughtError=C,this.onRecoverableError=G,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=K,this.incompleteTransitions=new Map}function ve(i,s,u,p,b,C,G,K,me,Fe,tt,at){return i=new ae(i,s,u,G,K,me,Fe,at),s=1,C===!0&&(s|=24),C=Sr(3,null,null,s),i.current=C,C.stateNode=i,s=Ys(),s.refCount++,i.pooledCache=s,s.refCount++,C.memoizedState={element:p,isDehydrated:u,cache:s},Tc(C),i}function he(i){return i?(i=Ra,i):Ra}function U(i,s,u,p,b,C){b=he(b),p.context===null?p.context=b:p.pendingContext=b,p=Ka(s),p.payload={element:u},C=C===void 0?null:C,C!==null&&(p.callback=C),u=Ts(i,p,s),u!==null&&(ja(u,i,s),eo(u,i,s))}function W(i,s){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var u=i.retryLane;i.retryLane=u!==0&&u<s?u:s}}function fe(i,s){W(i,s),(i=i.alternate)&&W(i,s)}function Ie(i){if(i.tag===13){var s=Pa(i,67108864);s!==null&&ja(s,i,67108864),fe(i,67108864)}}var Je=!0;function Ne(i,s,u,p){var b=Ke.T;Ke.T=null;var C=yt.p;try{yt.p=2,st(i,s,u,p)}finally{yt.p=C,Ke.T=b}}function qe(i,s,u,p){var b=Ke.T;Ke.T=null;var C=yt.p;try{yt.p=8,st(i,s,u,p)}finally{yt.p=C,Ke.T=b}}function st(i,s,u,p){if(Je){var b=nt(p);if(b===null)uo(i,s,p,ot,u),Br(i,p);else if(hn(b,i,s,u,p))p.stopPropagation();else if(Br(i,p),s&4&&-1<Ua.indexOf(i)){for(;b!==null;){var C=sa(b);if(C!==null)switch(C.tag){case 3:if(C=C.stateNode,C.current.memoizedState.isDehydrated){var G=ee(C.pendingLanes);if(G!==0){var K=C;for(K.pendingLanes|=2,K.entangledLanes|=2;G;){var me=1<<31-rr(G);K.entanglements[1]|=me,G&=~me}ss(C),(Li&6)===0&&(Eh=Xi()+500,Rh(0))}}break;case 13:K=Pa(C,2),K!==null&&ja(K,C,2),zn(),fe(C,2)}if(C=nt(p),C===null&&uo(i,s,p,ot,u),C===b)break;b=C}b!==null&&p.stopPropagation()}else uo(i,s,p,null,u)}}function nt(i){return i=Ma(i),$e(i)}var ot=null;function $e(i){if(ot=null,i=Gr(i),i!==null){var s=F(i);if(s===null)i=null;else{var u=s.tag;if(u===13){if(i=A(s),i!==null)return i;i=null}else if(u===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;i=null}else s!==i&&(i=null)}}return ot=i,null}function St(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ur()){case br:return 2;case ks:return 8;case Sa:case Wl:return 32;case Ls:return 268435456;default:return 32}default:return 32}}var Rt=!1,Mt=null,bt=null,Yt=null,Zi=new Map,mn=new Map,gn=[],Ua="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Br(i,s){switch(i){case"focusin":case"focusout":Mt=null;break;case"dragenter":case"dragleave":bt=null;break;case"mouseover":case"mouseout":Yt=null;break;case"pointerover":case"pointerout":Zi.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":mn.delete(s.pointerId)}}function Pn(i,s,u,p,b,C){return i===null||i.nativeEvent!==C?(i={blockedOn:s,domEventName:u,eventSystemFlags:p,nativeEvent:C,targetContainers:[b]},s!==null&&(s=sa(s),s!==null&&Ie(s)),i):(i.eventSystemFlags|=p,s=i.targetContainers,b!==null&&s.indexOf(b)===-1&&s.push(b),i)}function hn(i,s,u,p,b){switch(s){case"focusin":return Mt=Pn(Mt,i,s,u,p,b),!0;case"dragenter":return bt=Pn(bt,i,s,u,p,b),!0;case"mouseover":return Yt=Pn(Yt,i,s,u,p,b),!0;case"pointerover":var C=b.pointerId;return Zi.set(C,Pn(Zi.get(C)||null,i,s,u,p,b)),!0;case"gotpointercapture":return C=b.pointerId,mn.set(C,Pn(mn.get(C)||null,i,s,u,p,b)),!0}return!1}function Hn(i){var s=Gr(i.target);if(s!==null){var u=F(s);if(u!==null){if(s=u.tag,s===13){if(s=A(u),s!==null){i.blockedOn=s,At(i.priority,function(){if(u.tag===13){var p=ya();p=mt(p);var b=Pa(u,p);b!==null&&ja(b,u,p),fe(u,p)}});return}}else if(s===3&&u.stateNode.current.memoizedState.isDehydrated){i.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Un(i){if(i.blockedOn!==null)return!1;for(var s=i.targetContainers;0<s.length;){var u=nt(i.nativeEvent);if(u===null){u=i.nativeEvent;var p=new u.constructor(u.type,u);Dr=p,u.target.dispatchEvent(p),Dr=null}else return s=sa(u),s!==null&&Ie(s),i.blockedOn=u,!1;s.shift()}return!0}function ir(i,s,u){Un(i)&&u.delete(s)}function Fr(){Rt=!1,Mt!==null&&Un(Mt)&&(Mt=null),bt!==null&&Un(bt)&&(bt=null),Yt!==null&&Un(Yt)&&(Yt=null),Zi.forEach(ir),mn.forEach(ir)}function Nr(i,s){i.blockedOn===s&&(i.blockedOn=null,Rt||(Rt=!0,v.unstable_scheduleCallback(v.unstable_NormalPriority,Fr)))}var Rn=null;function jr(i){Rn!==i&&(Rn=i,v.unstable_scheduleCallback(v.unstable_NormalPriority,function(){Rn===i&&(Rn=null);for(var s=0;s<i.length;s+=3){var u=i[s],p=i[s+1],b=i[s+2];if(typeof p!="function"){if($e(p||u)===null)continue;break}var C=sa(u);C!==null&&(i.splice(s,3),s-=3,zi(C,{pending:!0,data:b,method:u.method,action:p},p,b))}}))}function _n(i){function s(me){return Nr(me,i)}Mt!==null&&Nr(Mt,i),bt!==null&&Nr(bt,i),Yt!==null&&Nr(Yt,i),Zi.forEach(s),mn.forEach(s);for(var u=0;u<gn.length;u++){var p=gn[u];p.blockedOn===i&&(p.blockedOn=null)}for(;0<gn.length&&(u=gn[0],u.blockedOn===null);)Hn(u),u.blockedOn===null&&gn.shift();if(u=(i.ownerDocument||i).$$reactFormReplay,u!=null)for(p=0;p<u.length;p+=3){var b=u[p],C=u[p+1],G=b[Qt]||null;if(typeof C=="function")G||jr(u);else if(G){var K=null;if(C&&C.hasAttribute("formAction")){if(b=C,G=C[Qt]||null)K=G.formAction;else if($e(b)!==null)continue}else K=G.action;typeof K=="function"?u[p+1]=K:(u.splice(p,3),p-=3),jr(u)}}}function Vn(i){this._internalRoot=i}Dn.prototype.render=Vn.prototype.render=function(i){var s=this._internalRoot;if(s===null)throw Error(E(409));var u=s.current,p=ya();U(u,p,i,s,null,null)},Dn.prototype.unmount=Vn.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var s=i.containerInfo;U(i.current,2,null,i,null,null),zn(),s[ci]=null}};function Dn(i){this._internalRoot=i}Dn.prototype.unstable_scheduleHydration=function(i){if(i){var s=vt();i={blockedOn:null,target:i,priority:s};for(var u=0;u<gn.length&&s!==0&&s<gn[u].priority;u++);gn.splice(u,0,i),u===0&&Hn(i)}};var In=w.version;if(In!=="19.1.1")throw Error(E(527,In,"19.1.1"));yt.findDOMNode=function(i){var s=i._reactInternals;if(s===void 0)throw typeof i.render=="function"?Error(E(188)):(i=Object.keys(i).join(","),Error(E(268,i)));return i=J(s),i=i!==null?X(i):null,i=i===null?null:i.stateNode,i};var Qi={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:Ke,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var xa=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!xa.isDisabled&&xa.supportsFiber)try{Vr=xa.inject(Qi),nn=xa}catch{}}return sp.createRoot=function(i,s){if(!L(i))throw Error(E(299));var u=!1,p="",b=ef,C=Ep,G=tf,K=null;return s!=null&&(s.unstable_strictMode===!0&&(u=!0),s.identifierPrefix!==void 0&&(p=s.identifierPrefix),s.onUncaughtError!==void 0&&(b=s.onUncaughtError),s.onCaughtError!==void 0&&(C=s.onCaughtError),s.onRecoverableError!==void 0&&(G=s.onRecoverableError),s.unstable_transitionCallbacks!==void 0&&(K=s.unstable_transitionCallbacks)),s=ve(i,1,!1,null,null,u,p,b,C,G,K,null),i[ci]=s.current,Uf(i),new Vn(s)},sp.hydrateRoot=function(i,s,u){if(!L(i))throw Error(E(299));var p=!1,b="",C=ef,G=Ep,K=tf,me=null,Fe=null;return u!=null&&(u.unstable_strictMode===!0&&(p=!0),u.identifierPrefix!==void 0&&(b=u.identifierPrefix),u.onUncaughtError!==void 0&&(C=u.onUncaughtError),u.onCaughtError!==void 0&&(G=u.onCaughtError),u.onRecoverableError!==void 0&&(K=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(me=u.unstable_transitionCallbacks),u.formState!==void 0&&(Fe=u.formState)),s=ve(i,1,!0,s,u??null,p,b,C,G,K,me,Fe),s.context=he(null),u=s.current,p=ya(),p=mt(p),b=Ka(p),b.callback=null,Ts(u,b,p),u=p,s.current.lanes=u,je(s,u),ss(s),i[ci]=s.current,Uf(i),new Dn(s)},sp.version="19.1.1",sp}var Yg;function Hy(){if(Yg)return Zm.exports;Yg=1;function v(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(v)}catch(w){console.error(w)}}return v(),Zm.exports=$y(),Zm.exports}var Xy=Hy();/**
 * react-router v7.7.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Kg="popstate";function Yy(v={}){function w(E,L){let{pathname:F,search:A,hash:c}=E.location;return og("",{pathname:F,search:A,hash:c},L.state&&L.state.usr||null,L.state&&L.state.key||"default")}function z(E,L){return typeof L=="string"?L:fp(L)}return Wy(w,z,null,v)}function Xn(v,w){if(v===!1||v===null||typeof v>"u")throw new Error(w)}function Yl(v,w){if(!v){typeof console<"u"&&console.warn(w);try{throw new Error(w)}catch{}}}function Ky(){return Math.random().toString(36).substring(2,10)}function Wg(v,w){return{usr:v.state,key:v.key,idx:w}}function og(v,w,z=null,E){return{pathname:typeof v=="string"?v:v.pathname,search:"",hash:"",...typeof w=="string"?jd(w):w,state:z,key:w&&w.key||E||Ky()}}function fp({pathname:v="/",search:w="",hash:z=""}){return w&&w!=="?"&&(v+=w.charAt(0)==="?"?w:"?"+w),z&&z!=="#"&&(v+=z.charAt(0)==="#"?z:"#"+z),v}function jd(v){let w={};if(v){let z=v.indexOf("#");z>=0&&(w.hash=v.substring(z),v=v.substring(0,z));let E=v.indexOf("?");E>=0&&(w.search=v.substring(E),v=v.substring(0,E)),v&&(w.pathname=v)}return w}function Wy(v,w,z,E={}){let{window:L=document.defaultView,v5Compat:F=!1}=E,A=L.history,c="POP",J=null,X=re();X==null&&(X=0,A.replaceState({...A.state,idx:X},""));function re(){return(A.state||{idx:null}).idx}function Te(){c="POP";let Ve=re(),et=Ve==null?null:Ve-X;X=Ve,J&&J({action:c,location:We.location,delta:et})}function xe(Ve,et){c="PUSH";let ft=og(We.location,Ve,et);X=re()+1;let Tt=Wg(ft,X),Ot=We.createHref(ft);try{A.pushState(Tt,"",Ot)}catch(pt){if(pt instanceof DOMException&&pt.name==="DataCloneError")throw pt;L.location.assign(Ot)}F&&J&&J({action:c,location:We.location,delta:1})}function de(Ve,et){c="REPLACE";let ft=og(We.location,Ve,et);X=re();let Tt=Wg(ft,X),Ot=We.createHref(ft);A.replaceState(Tt,"",Ot),F&&J&&J({action:c,location:We.location,delta:0})}function Ee(Ve){return Qy(Ve)}let We={get action(){return c},get location(){return v(L,A)},listen(Ve){if(J)throw new Error("A history only accepts one active listener");return L.addEventListener(Kg,Te),J=Ve,()=>{L.removeEventListener(Kg,Te),J=null}},createHref(Ve){return w(L,Ve)},createURL:Ee,encodeLocation(Ve){let et=Ee(Ve);return{pathname:et.pathname,search:et.search,hash:et.hash}},push:xe,replace:de,go(Ve){return A.go(Ve)}};return We}function Qy(v,w=!1){let z="http://localhost";typeof window<"u"&&(z=window.location.origin!=="null"?window.location.origin:window.location.href),Xn(z,"No window.location.(origin|href) available to create URL");let E=typeof v=="string"?v:fp(v);return E=E.replace(/ $/,"%20"),!w&&E.startsWith("//")&&(E=z+E),new URL(E,z)}function C_(v,w,z="/"){return Jy(v,w,z,!1)}function Jy(v,w,z,E){let L=typeof w=="string"?jd(w):w,F=Vc(L.pathname||"/",z);if(F==null)return null;let A=A_(v);ev(A);let c=null;for(let J=0;c==null&&J<A.length;++J){let X=hv(F);c=cv(A[J],X,E)}return c}function A_(v,w=[],z=[],E=""){let L=(F,A,c)=>{let J={relativePath:c===void 0?F.path||"":c,caseSensitive:F.caseSensitive===!0,childrenIndex:A,route:F};J.relativePath.startsWith("/")&&(Xn(J.relativePath.startsWith(E),`Absolute route path "${J.relativePath}" nested under path "${E}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),J.relativePath=J.relativePath.slice(E.length));let X=jc([E,J.relativePath]),re=z.concat(J);F.children&&F.children.length>0&&(Xn(F.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${X}".`),A_(F.children,w,re,X)),!(F.path==null&&!F.index)&&w.push({path:X,score:ov(X,F.index),routesMeta:re})};return v.forEach((F,A)=>{var c;if(F.path===""||!((c=F.path)!=null&&c.includes("?")))L(F,A);else for(let J of z_(F.path))L(F,A,J)}),w}function z_(v){let w=v.split("/");if(w.length===0)return[];let[z,...E]=w,L=z.endsWith("?"),F=z.replace(/\?$/,"");if(E.length===0)return L?[F,""]:[F];let A=z_(E.join("/")),c=[];return c.push(...A.map(J=>J===""?F:[F,J].join("/"))),L&&c.push(...A),c.map(J=>v.startsWith("/")&&J===""?"/":J)}function ev(v){v.sort((w,z)=>w.score!==z.score?z.score-w.score:lv(w.routesMeta.map(E=>E.childrenIndex),z.routesMeta.map(E=>E.childrenIndex)))}var tv=/^:[\w-]+$/,iv=3,nv=2,rv=1,av=10,sv=-2,Qg=v=>v==="*";function ov(v,w){let z=v.split("/"),E=z.length;return z.some(Qg)&&(E+=sv),w&&(E+=nv),z.filter(L=>!Qg(L)).reduce((L,F)=>L+(tv.test(F)?iv:F===""?rv:av),E)}function lv(v,w){return v.length===w.length&&v.slice(0,-1).every((E,L)=>E===w[L])?v[v.length-1]-w[w.length-1]:0}function cv(v,w,z=!1){let{routesMeta:E}=v,L={},F="/",A=[];for(let c=0;c<E.length;++c){let J=E[c],X=c===E.length-1,re=F==="/"?w:w.slice(F.length)||"/",Te=pm({path:J.relativePath,caseSensitive:J.caseSensitive,end:X},re),xe=J.route;if(!Te&&X&&z&&!E[E.length-1].route.index&&(Te=pm({path:J.relativePath,caseSensitive:J.caseSensitive,end:!1},re)),!Te)return null;Object.assign(L,Te.params),A.push({params:L,pathname:jc([F,Te.pathname]),pathnameBase:mv(jc([F,Te.pathnameBase])),route:xe}),Te.pathnameBase!=="/"&&(F=jc([F,Te.pathnameBase]))}return A}function pm(v,w){typeof v=="string"&&(v={path:v,caseSensitive:!1,end:!0});let[z,E]=uv(v.path,v.caseSensitive,v.end),L=w.match(z);if(!L)return null;let F=L[0],A=F.replace(/(.)\/+$/,"$1"),c=L.slice(1);return{params:E.reduce((X,{paramName:re,isOptional:Te},xe)=>{if(re==="*"){let Ee=c[xe]||"";A=F.slice(0,F.length-Ee.length).replace(/(.)\/+$/,"$1")}const de=c[xe];return Te&&!de?X[re]=void 0:X[re]=(de||"").replace(/%2F/g,"/"),X},{}),pathname:F,pathnameBase:A,pattern:v}}function uv(v,w=!1,z=!0){Yl(v==="*"||!v.endsWith("*")||v.endsWith("/*"),`Route path "${v}" will be treated as if it were "${v.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${v.replace(/\*$/,"/*")}".`);let E=[],L="^"+v.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(A,c,J)=>(E.push({paramName:c,isOptional:J!=null}),J?"/?([^\\/]+)?":"/([^\\/]+)"));return v.endsWith("*")?(E.push({paramName:"*"}),L+=v==="*"||v==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):z?L+="\\/*$":v!==""&&v!=="/"&&(L+="(?:(?=\\/|$))"),[new RegExp(L,w?void 0:"i"),E]}function hv(v){try{return v.split("/").map(w=>decodeURIComponent(w).replace(/\//g,"%2F")).join("/")}catch(w){return Yl(!1,`The URL path "${v}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${w}).`),v}}function Vc(v,w){if(w==="/")return v;if(!v.toLowerCase().startsWith(w.toLowerCase()))return null;let z=w.endsWith("/")?w.length-1:w.length,E=v.charAt(z);return E&&E!=="/"?null:v.slice(z)||"/"}function dv(v,w="/"){let{pathname:z,search:E="",hash:L=""}=typeof v=="string"?jd(v):v;return{pathname:z?z.startsWith("/")?z:fv(z,w):w,search:gv(E),hash:_v(L)}}function fv(v,w){let z=w.replace(/\/+$/,"").split("/");return v.split("/").forEach(L=>{L===".."?z.length>1&&z.pop():L!=="."&&z.push(L)}),z.length>1?z.join("/"):"/"}function Ym(v,w,z,E){return`Cannot include a '${v}' character in a manually specified \`to.${w}\` field [${JSON.stringify(E)}].  Please separate it out to the \`to.${z}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function pv(v){return v.filter((w,z)=>z===0||w.route.path&&w.route.path.length>0)}function P_(v){let w=pv(v);return w.map((z,E)=>E===w.length-1?z.pathname:z.pathnameBase)}function R_(v,w,z,E=!1){let L;typeof v=="string"?L=jd(v):(L={...v},Xn(!L.pathname||!L.pathname.includes("?"),Ym("?","pathname","search",L)),Xn(!L.pathname||!L.pathname.includes("#"),Ym("#","pathname","hash",L)),Xn(!L.search||!L.search.includes("#"),Ym("#","search","hash",L)));let F=v===""||L.pathname==="",A=F?"/":L.pathname,c;if(A==null)c=z;else{let Te=w.length-1;if(!E&&A.startsWith("..")){let xe=A.split("/");for(;xe[0]==="..";)xe.shift(),Te-=1;L.pathname=xe.join("/")}c=Te>=0?w[Te]:"/"}let J=dv(L,c),X=A&&A!=="/"&&A.endsWith("/"),re=(F||A===".")&&z.endsWith("/");return!J.pathname.endsWith("/")&&(X||re)&&(J.pathname+="/"),J}var jc=v=>v.join("/").replace(/\/\/+/g,"/"),mv=v=>v.replace(/\/+$/,"").replace(/^\/*/,"/"),gv=v=>!v||v==="?"?"":v.startsWith("?")?v:"?"+v,_v=v=>!v||v==="#"?"":v.startsWith("#")?v:"#"+v;function yv(v){return v!=null&&typeof v.status=="number"&&typeof v.statusText=="string"&&typeof v.internal=="boolean"&&"data"in v}var D_=["POST","PUT","PATCH","DELETE"];new Set(D_);var vv=["GET",...D_];new Set(vv);var Ud=Ye.createContext(null);Ud.displayName="DataRouter";var vm=Ye.createContext(null);vm.displayName="DataRouterState";Ye.createContext(!1);var I_=Ye.createContext({isTransitioning:!1});I_.displayName="ViewTransition";var xv=Ye.createContext(new Map);xv.displayName="Fetchers";var bv=Ye.createContext(null);bv.displayName="Await";var Kl=Ye.createContext(null);Kl.displayName="Navigation";var _p=Ye.createContext(null);_p.displayName="Location";var Gc=Ye.createContext({outlet:null,matches:[],isDataRoute:!1});Gc.displayName="Route";var bg=Ye.createContext(null);bg.displayName="RouteError";function wv(v,{relative:w}={}){Xn(yp(),"useHref() may be used only in the context of a <Router> component.");let{basename:z,navigator:E}=Ye.useContext(Kl),{hash:L,pathname:F,search:A}=vp(v,{relative:w}),c=F;return z!=="/"&&(c=F==="/"?z:jc([z,F])),E.createHref({pathname:c,search:A,hash:L})}function yp(){return Ye.useContext(_p)!=null}function Zh(){return Xn(yp(),"useLocation() may be used only in the context of a <Router> component."),Ye.useContext(_p).location}var k_="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function L_(v){Ye.useContext(Kl).static||Ye.useLayoutEffect(v)}function Sv(){let{isDataRoute:v}=Ye.useContext(Gc);return v?Ov():Tv()}function Tv(){Xn(yp(),"useNavigate() may be used only in the context of a <Router> component.");let v=Ye.useContext(Ud),{basename:w,navigator:z}=Ye.useContext(Kl),{matches:E}=Ye.useContext(Gc),{pathname:L}=Zh(),F=JSON.stringify(P_(E)),A=Ye.useRef(!1);return L_(()=>{A.current=!0}),Ye.useCallback((J,X={})=>{if(Yl(A.current,k_),!A.current)return;if(typeof J=="number"){z.go(J);return}let re=R_(J,JSON.parse(F),L,X.relative==="path");v==null&&w!=="/"&&(re.pathname=re.pathname==="/"?w:jc([w,re.pathname])),(X.replace?z.replace:z.push)(re,X.state,X)},[w,z,F,L,v])}Ye.createContext(null);function vp(v,{relative:w}={}){let{matches:z}=Ye.useContext(Gc),{pathname:E}=Zh(),L=JSON.stringify(P_(z));return Ye.useMemo(()=>R_(v,JSON.parse(L),E,w==="path"),[v,L,E,w])}function Mv(v,w){return O_(v,w)}function O_(v,w,z,E){var et;Xn(yp(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:L}=Ye.useContext(Kl),{matches:F}=Ye.useContext(Gc),A=F[F.length-1],c=A?A.params:{},J=A?A.pathname:"/",X=A?A.pathnameBase:"/",re=A&&A.route;{let ft=re&&re.path||"";B_(J,!re||ft.endsWith("*")||ft.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${J}" (under <Route path="${ft}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${ft}"> to <Route path="${ft==="/"?"*":`${ft}/*`}">.`)}let Te=Zh(),xe;if(w){let ft=typeof w=="string"?jd(w):w;Xn(X==="/"||((et=ft.pathname)==null?void 0:et.startsWith(X)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${X}" but pathname "${ft.pathname}" was given in the \`location\` prop.`),xe=ft}else xe=Te;let de=xe.pathname||"/",Ee=de;if(X!=="/"){let ft=X.replace(/^\//,"").split("/");Ee="/"+de.replace(/^\//,"").split("/").slice(ft.length).join("/")}let We=C_(v,{pathname:Ee});Yl(re||We!=null,`No routes matched location "${xe.pathname}${xe.search}${xe.hash}" `),Yl(We==null||We[We.length-1].route.element!==void 0||We[We.length-1].route.Component!==void 0||We[We.length-1].route.lazy!==void 0,`Matched leaf route at location "${xe.pathname}${xe.search}${xe.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let Ve=Pv(We&&We.map(ft=>Object.assign({},ft,{params:Object.assign({},c,ft.params),pathname:jc([X,L.encodeLocation?L.encodeLocation(ft.pathname).pathname:ft.pathname]),pathnameBase:ft.pathnameBase==="/"?X:jc([X,L.encodeLocation?L.encodeLocation(ft.pathnameBase).pathname:ft.pathnameBase])})),F,z,E);return w&&Ve?Ye.createElement(_p.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...xe},navigationType:"POP"}},Ve):Ve}function Ev(){let v=Lv(),w=yv(v)?`${v.status} ${v.statusText}`:v instanceof Error?v.message:JSON.stringify(v),z=v instanceof Error?v.stack:null,E="rgba(200,200,200, 0.5)",L={padding:"0.5rem",backgroundColor:E},F={padding:"2px 4px",backgroundColor:E},A=null;return console.error("Error handled by React Router default ErrorBoundary:",v),A=Ye.createElement(Ye.Fragment,null,Ye.createElement("p",null,"💿 Hey developer 👋"),Ye.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Ye.createElement("code",{style:F},"ErrorBoundary")," or"," ",Ye.createElement("code",{style:F},"errorElement")," prop on your route.")),Ye.createElement(Ye.Fragment,null,Ye.createElement("h2",null,"Unexpected Application Error!"),Ye.createElement("h3",{style:{fontStyle:"italic"}},w),z?Ye.createElement("pre",{style:L},z):null,A)}var Cv=Ye.createElement(Ev,null),Av=class extends Ye.Component{constructor(v){super(v),this.state={location:v.location,revalidation:v.revalidation,error:v.error}}static getDerivedStateFromError(v){return{error:v}}static getDerivedStateFromProps(v,w){return w.location!==v.location||w.revalidation!=="idle"&&v.revalidation==="idle"?{error:v.error,location:v.location,revalidation:v.revalidation}:{error:v.error!==void 0?v.error:w.error,location:w.location,revalidation:v.revalidation||w.revalidation}}componentDidCatch(v,w){console.error("React Router caught the following error during render",v,w)}render(){return this.state.error!==void 0?Ye.createElement(Gc.Provider,{value:this.props.routeContext},Ye.createElement(bg.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function zv({routeContext:v,match:w,children:z}){let E=Ye.useContext(Ud);return E&&E.static&&E.staticContext&&(w.route.errorElement||w.route.ErrorBoundary)&&(E.staticContext._deepestRenderedBoundaryId=w.route.id),Ye.createElement(Gc.Provider,{value:v},z)}function Pv(v,w=[],z=null,E=null){if(v==null){if(!z)return null;if(z.errors)v=z.matches;else if(w.length===0&&!z.initialized&&z.matches.length>0)v=z.matches;else return null}let L=v,F=z==null?void 0:z.errors;if(F!=null){let J=L.findIndex(X=>X.route.id&&(F==null?void 0:F[X.route.id])!==void 0);Xn(J>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(F).join(",")}`),L=L.slice(0,Math.min(L.length,J+1))}let A=!1,c=-1;if(z)for(let J=0;J<L.length;J++){let X=L[J];if((X.route.HydrateFallback||X.route.hydrateFallbackElement)&&(c=J),X.route.id){let{loaderData:re,errors:Te}=z,xe=X.route.loader&&!re.hasOwnProperty(X.route.id)&&(!Te||Te[X.route.id]===void 0);if(X.route.lazy||xe){A=!0,c>=0?L=L.slice(0,c+1):L=[L[0]];break}}}return L.reduceRight((J,X,re)=>{let Te,xe=!1,de=null,Ee=null;z&&(Te=F&&X.route.id?F[X.route.id]:void 0,de=X.route.errorElement||Cv,A&&(c<0&&re===0?(B_("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),xe=!0,Ee=null):c===re&&(xe=!0,Ee=X.route.hydrateFallbackElement||null)));let We=w.concat(L.slice(0,re+1)),Ve=()=>{let et;return Te?et=de:xe?et=Ee:X.route.Component?et=Ye.createElement(X.route.Component,null):X.route.element?et=X.route.element:et=J,Ye.createElement(zv,{match:X,routeContext:{outlet:J,matches:We,isDataRoute:z!=null},children:et})};return z&&(X.route.ErrorBoundary||X.route.errorElement||re===0)?Ye.createElement(Av,{location:z.location,revalidation:z.revalidation,component:de,error:Te,children:Ve(),routeContext:{outlet:null,matches:We,isDataRoute:!0}}):Ve()},null)}function wg(v){return`${v} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Rv(v){let w=Ye.useContext(Ud);return Xn(w,wg(v)),w}function Dv(v){let w=Ye.useContext(vm);return Xn(w,wg(v)),w}function Iv(v){let w=Ye.useContext(Gc);return Xn(w,wg(v)),w}function Sg(v){let w=Iv(v),z=w.matches[w.matches.length-1];return Xn(z.route.id,`${v} can only be used on routes that contain a unique "id"`),z.route.id}function kv(){return Sg("useRouteId")}function Lv(){var E;let v=Ye.useContext(bg),w=Dv("useRouteError"),z=Sg("useRouteError");return v!==void 0?v:(E=w.errors)==null?void 0:E[z]}function Ov(){let{router:v}=Rv("useNavigate"),w=Sg("useNavigate"),z=Ye.useRef(!1);return L_(()=>{z.current=!0}),Ye.useCallback(async(L,F={})=>{Yl(z.current,k_),z.current&&(typeof L=="number"?v.navigate(L):await v.navigate(L,{fromRouteId:w,...F}))},[v,w])}var Jg={};function B_(v,w,z){!w&&!Jg[v]&&(Jg[v]=!0,Yl(!1,z))}Ye.memo(Bv);function Bv({routes:v,future:w,state:z}){return O_(v,void 0,z,w)}function cp(v){Xn(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Fv({basename:v="/",children:w=null,location:z,navigationType:E="POP",navigator:L,static:F=!1}){Xn(!yp(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let A=v.replace(/^\/*/,"/"),c=Ye.useMemo(()=>({basename:A,navigator:L,static:F,future:{}}),[A,L,F]);typeof z=="string"&&(z=jd(z));let{pathname:J="/",search:X="",hash:re="",state:Te=null,key:xe="default"}=z,de=Ye.useMemo(()=>{let Ee=Vc(J,A);return Ee==null?null:{location:{pathname:Ee,search:X,hash:re,state:Te,key:xe},navigationType:E}},[A,J,X,re,Te,xe,E]);return Yl(de!=null,`<Router basename="${A}"> is not able to match the URL "${J}${X}${re}" because it does not start with the basename, so the <Router> won't render anything.`),de==null?null:Ye.createElement(Kl.Provider,{value:c},Ye.createElement(_p.Provider,{children:w,value:de}))}function Nv({children:v,location:w}){return Mv(lg(v),w)}function lg(v,w=[]){let z=[];return Ye.Children.forEach(v,(E,L)=>{if(!Ye.isValidElement(E))return;let F=[...w,L];if(E.type===Ye.Fragment){z.push.apply(z,lg(E.props.children,F));return}Xn(E.type===cp,`[${typeof E.type=="string"?E.type:E.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Xn(!E.props.index||!E.props.children,"An index route cannot have child routes.");let A={id:E.props.id||F.join("-"),caseSensitive:E.props.caseSensitive,element:E.props.element,Component:E.props.Component,index:E.props.index,path:E.props.path,loader:E.props.loader,action:E.props.action,hydrateFallbackElement:E.props.hydrateFallbackElement,HydrateFallback:E.props.HydrateFallback,errorElement:E.props.errorElement,ErrorBoundary:E.props.ErrorBoundary,hasErrorBoundary:E.props.hasErrorBoundary===!0||E.props.ErrorBoundary!=null||E.props.errorElement!=null,shouldRevalidate:E.props.shouldRevalidate,handle:E.props.handle,lazy:E.props.lazy};E.props.children&&(A.children=lg(E.props.children,F)),z.push(A)}),z}var om="get",lm="application/x-www-form-urlencoded";function xm(v){return v!=null&&typeof v.tagName=="string"}function jv(v){return xm(v)&&v.tagName.toLowerCase()==="button"}function Uv(v){return xm(v)&&v.tagName.toLowerCase()==="form"}function Vv(v){return xm(v)&&v.tagName.toLowerCase()==="input"}function Gv(v){return!!(v.metaKey||v.altKey||v.ctrlKey||v.shiftKey)}function qv(v,w){return v.button===0&&(!w||w==="_self")&&!Gv(v)}var sm=null;function Zv(){if(sm===null)try{new FormData(document.createElement("form"),0),sm=!1}catch{sm=!0}return sm}var $v=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Km(v){return v!=null&&!$v.has(v)?(Yl(!1,`"${v}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${lm}"`),null):v}function Hv(v,w){let z,E,L,F,A;if(Uv(v)){let c=v.getAttribute("action");E=c?Vc(c,w):null,z=v.getAttribute("method")||om,L=Km(v.getAttribute("enctype"))||lm,F=new FormData(v)}else if(jv(v)||Vv(v)&&(v.type==="submit"||v.type==="image")){let c=v.form;if(c==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let J=v.getAttribute("formaction")||c.getAttribute("action");if(E=J?Vc(J,w):null,z=v.getAttribute("formmethod")||c.getAttribute("method")||om,L=Km(v.getAttribute("formenctype"))||Km(c.getAttribute("enctype"))||lm,F=new FormData(c,v),!Zv()){let{name:X,type:re,value:Te}=v;if(re==="image"){let xe=X?`${X}.`:"";F.append(`${xe}x`,"0"),F.append(`${xe}y`,"0")}else X&&F.append(X,Te)}}else{if(xm(v))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');z=om,E=null,L=lm,A=v}return F&&L==="text/plain"&&(A=F,F=void 0),{action:E,method:z.toLowerCase(),encType:L,formData:F,body:A}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Tg(v,w){if(v===!1||v===null||typeof v>"u")throw new Error(w)}function Xv(v,w,z){let E=typeof v=="string"?new URL(v,typeof window>"u"?"server://singlefetch/":window.location.origin):v;return E.pathname==="/"?E.pathname=`_root.${z}`:w&&Vc(E.pathname,w)==="/"?E.pathname=`${w.replace(/\/$/,"")}/_root.${z}`:E.pathname=`${E.pathname.replace(/\/$/,"")}.${z}`,E}async function Yv(v,w){if(v.id in w)return w[v.id];try{let z=await import(v.module);return w[v.id]=z,z}catch(z){return console.error(`Error loading route module \`${v.module}\`, reloading page...`),console.error(z),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Kv(v){return v==null?!1:v.href==null?v.rel==="preload"&&typeof v.imageSrcSet=="string"&&typeof v.imageSizes=="string":typeof v.rel=="string"&&typeof v.href=="string"}async function Wv(v,w,z){let E=await Promise.all(v.map(async L=>{let F=w.routes[L.route.id];if(F){let A=await Yv(F,z);return A.links?A.links():[]}return[]}));return t0(E.flat(1).filter(Kv).filter(L=>L.rel==="stylesheet"||L.rel==="preload").map(L=>L.rel==="stylesheet"?{...L,rel:"prefetch",as:"style"}:{...L,rel:"prefetch"}))}function e_(v,w,z,E,L,F){let A=(J,X)=>z[X]?J.route.id!==z[X].route.id:!0,c=(J,X)=>{var re;return z[X].pathname!==J.pathname||((re=z[X].route.path)==null?void 0:re.endsWith("*"))&&z[X].params["*"]!==J.params["*"]};return F==="assets"?w.filter((J,X)=>A(J,X)||c(J,X)):F==="data"?w.filter((J,X)=>{var Te;let re=E.routes[J.route.id];if(!re||!re.hasLoader)return!1;if(A(J,X)||c(J,X))return!0;if(J.route.shouldRevalidate){let xe=J.route.shouldRevalidate({currentUrl:new URL(L.pathname+L.search+L.hash,window.origin),currentParams:((Te=z[0])==null?void 0:Te.params)||{},nextUrl:new URL(v,window.origin),nextParams:J.params,defaultShouldRevalidate:!0});if(typeof xe=="boolean")return xe}return!0}):[]}function Qv(v,w,{includeHydrateFallback:z}={}){return Jv(v.map(E=>{let L=w.routes[E.route.id];if(!L)return[];let F=[L.module];return L.clientActionModule&&(F=F.concat(L.clientActionModule)),L.clientLoaderModule&&(F=F.concat(L.clientLoaderModule)),z&&L.hydrateFallbackModule&&(F=F.concat(L.hydrateFallbackModule)),L.imports&&(F=F.concat(L.imports)),F}).flat(1))}function Jv(v){return[...new Set(v)]}function e0(v){let w={},z=Object.keys(v).sort();for(let E of z)w[E]=v[E];return w}function t0(v,w){let z=new Set;return new Set(w),v.reduce((E,L)=>{let F=JSON.stringify(e0(L));return z.has(F)||(z.add(F),E.push({key:F,link:L})),E},[])}function F_(){let v=Ye.useContext(Ud);return Tg(v,"You must render this element inside a <DataRouterContext.Provider> element"),v}function i0(){let v=Ye.useContext(vm);return Tg(v,"You must render this element inside a <DataRouterStateContext.Provider> element"),v}var Mg=Ye.createContext(void 0);Mg.displayName="FrameworkContext";function N_(){let v=Ye.useContext(Mg);return Tg(v,"You must render this element inside a <HydratedRouter> element"),v}function n0(v,w){let z=Ye.useContext(Mg),[E,L]=Ye.useState(!1),[F,A]=Ye.useState(!1),{onFocus:c,onBlur:J,onMouseEnter:X,onMouseLeave:re,onTouchStart:Te}=w,xe=Ye.useRef(null);Ye.useEffect(()=>{if(v==="render"&&A(!0),v==="viewport"){let We=et=>{et.forEach(ft=>{A(ft.isIntersecting)})},Ve=new IntersectionObserver(We,{threshold:.5});return xe.current&&Ve.observe(xe.current),()=>{Ve.disconnect()}}},[v]),Ye.useEffect(()=>{if(E){let We=setTimeout(()=>{A(!0)},100);return()=>{clearTimeout(We)}}},[E]);let de=()=>{L(!0)},Ee=()=>{L(!1),A(!1)};return z?v!=="intent"?[F,xe,{}]:[F,xe,{onFocus:op(c,de),onBlur:op(J,Ee),onMouseEnter:op(X,de),onMouseLeave:op(re,Ee),onTouchStart:op(Te,de)}]:[!1,xe,{}]}function op(v,w){return z=>{v&&v(z),z.defaultPrevented||w(z)}}function r0({page:v,...w}){let{router:z}=F_(),E=Ye.useMemo(()=>C_(z.routes,v,z.basename),[z.routes,v,z.basename]);return E?Ye.createElement(s0,{page:v,matches:E,...w}):null}function a0(v){let{manifest:w,routeModules:z}=N_(),[E,L]=Ye.useState([]);return Ye.useEffect(()=>{let F=!1;return Wv(v,w,z).then(A=>{F||L(A)}),()=>{F=!0}},[v,w,z]),E}function s0({page:v,matches:w,...z}){let E=Zh(),{manifest:L,routeModules:F}=N_(),{basename:A}=F_(),{loaderData:c,matches:J}=i0(),X=Ye.useMemo(()=>e_(v,w,J,L,E,"data"),[v,w,J,L,E]),re=Ye.useMemo(()=>e_(v,w,J,L,E,"assets"),[v,w,J,L,E]),Te=Ye.useMemo(()=>{if(v===E.pathname+E.search+E.hash)return[];let Ee=new Set,We=!1;if(w.forEach(et=>{var Tt;let ft=L.routes[et.route.id];!ft||!ft.hasLoader||(!X.some(Ot=>Ot.route.id===et.route.id)&&et.route.id in c&&((Tt=F[et.route.id])!=null&&Tt.shouldRevalidate)||ft.hasClientLoader?We=!0:Ee.add(et.route.id))}),Ee.size===0)return[];let Ve=Xv(v,A,"data");return We&&Ee.size>0&&Ve.searchParams.set("_routes",w.filter(et=>Ee.has(et.route.id)).map(et=>et.route.id).join(",")),[Ve.pathname+Ve.search]},[A,c,E,L,X,w,v,F]),xe=Ye.useMemo(()=>Qv(re,L),[re,L]),de=a0(re);return Ye.createElement(Ye.Fragment,null,Te.map(Ee=>Ye.createElement("link",{key:Ee,rel:"prefetch",as:"fetch",href:Ee,...z})),xe.map(Ee=>Ye.createElement("link",{key:Ee,rel:"modulepreload",href:Ee,...z})),de.map(({key:Ee,link:We})=>Ye.createElement("link",{key:Ee,...We})))}function o0(...v){return w=>{v.forEach(z=>{typeof z=="function"?z(w):z!=null&&(z.current=w)})}}var j_=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{j_&&(window.__reactRouterVersion="7.7.1")}catch{}function l0({basename:v,children:w,window:z}){let E=Ye.useRef();E.current==null&&(E.current=Yy({window:z,v5Compat:!0}));let L=E.current,[F,A]=Ye.useState({action:L.action,location:L.location}),c=Ye.useCallback(J=>{Ye.startTransition(()=>A(J))},[A]);return Ye.useLayoutEffect(()=>L.listen(c),[L,c]),Ye.createElement(Fv,{basename:v,children:w,location:F.location,navigationType:F.action,navigator:L})}var U_=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,V_=Ye.forwardRef(function({onClick:w,discover:z="render",prefetch:E="none",relative:L,reloadDocument:F,replace:A,state:c,target:J,to:X,preventScrollReset:re,viewTransition:Te,...xe},de){let{basename:Ee}=Ye.useContext(Kl),We=typeof X=="string"&&U_.test(X),Ve,et=!1;if(typeof X=="string"&&We&&(Ve=X,j_))try{let Mi=new URL(window.location.href),Jt=X.startsWith("//")?new URL(Mi.protocol+X):new URL(X),wi=Vc(Jt.pathname,Ee);Jt.origin===Mi.origin&&wi!=null?X=wi+Jt.search+Jt.hash:et=!0}catch{Yl(!1,`<Link to="${X}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let ft=wv(X,{relative:L}),[Tt,Ot,pt]=n0(E,xe),Ut=d0(X,{replace:A,state:c,target:J,preventScrollReset:re,relative:L,viewTransition:Te});function oi(Mi){w&&w(Mi),Mi.defaultPrevented||Ut(Mi)}let Di=Ye.createElement("a",{...xe,...pt,href:Ve||ft,onClick:et||F?w:oi,ref:o0(de,Ot),target:J,"data-discover":!We&&z==="render"?"true":void 0});return Tt&&!We?Ye.createElement(Ye.Fragment,null,Di,Ye.createElement(r0,{page:ft})):Di});V_.displayName="Link";var c0=Ye.forwardRef(function({"aria-current":w="page",caseSensitive:z=!1,className:E="",end:L=!1,style:F,to:A,viewTransition:c,children:J,...X},re){let Te=vp(A,{relative:X.relative}),xe=Zh(),de=Ye.useContext(vm),{navigator:Ee,basename:We}=Ye.useContext(Kl),Ve=de!=null&&_0(Te)&&c===!0,et=Ee.encodeLocation?Ee.encodeLocation(Te).pathname:Te.pathname,ft=xe.pathname,Tt=de&&de.navigation&&de.navigation.location?de.navigation.location.pathname:null;z||(ft=ft.toLowerCase(),Tt=Tt?Tt.toLowerCase():null,et=et.toLowerCase()),Tt&&We&&(Tt=Vc(Tt,We)||Tt);const Ot=et!=="/"&&et.endsWith("/")?et.length-1:et.length;let pt=ft===et||!L&&ft.startsWith(et)&&ft.charAt(Ot)==="/",Ut=Tt!=null&&(Tt===et||!L&&Tt.startsWith(et)&&Tt.charAt(et.length)==="/"),oi={isActive:pt,isPending:Ut,isTransitioning:Ve},Di=pt?w:void 0,Mi;typeof E=="function"?Mi=E(oi):Mi=[E,pt?"active":null,Ut?"pending":null,Ve?"transitioning":null].filter(Boolean).join(" ");let Jt=typeof F=="function"?F(oi):F;return Ye.createElement(V_,{...X,"aria-current":Di,className:Mi,ref:re,style:Jt,to:A,viewTransition:c},typeof J=="function"?J(oi):J)});c0.displayName="NavLink";var u0=Ye.forwardRef(({discover:v="render",fetcherKey:w,navigate:z,reloadDocument:E,replace:L,state:F,method:A=om,action:c,onSubmit:J,relative:X,preventScrollReset:re,viewTransition:Te,...xe},de)=>{let Ee=m0(),We=g0(c,{relative:X}),Ve=A.toLowerCase()==="get"?"get":"post",et=typeof c=="string"&&U_.test(c),ft=Tt=>{if(J&&J(Tt),Tt.defaultPrevented)return;Tt.preventDefault();let Ot=Tt.nativeEvent.submitter,pt=(Ot==null?void 0:Ot.getAttribute("formmethod"))||A;Ee(Ot||Tt.currentTarget,{fetcherKey:w,method:pt,navigate:z,replace:L,state:F,relative:X,preventScrollReset:re,viewTransition:Te})};return Ye.createElement("form",{ref:de,method:Ve,action:We,onSubmit:E?J:ft,...xe,"data-discover":!et&&v==="render"?"true":void 0})});u0.displayName="Form";function h0(v){return`${v} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function G_(v){let w=Ye.useContext(Ud);return Xn(w,h0(v)),w}function d0(v,{target:w,replace:z,state:E,preventScrollReset:L,relative:F,viewTransition:A}={}){let c=Sv(),J=Zh(),X=vp(v,{relative:F});return Ye.useCallback(re=>{if(qv(re,w)){re.preventDefault();let Te=z!==void 0?z:fp(J)===fp(X);c(v,{replace:Te,state:E,preventScrollReset:L,relative:F,viewTransition:A})}},[J,c,X,z,E,w,v,L,F,A])}var f0=0,p0=()=>`__${String(++f0)}__`;function m0(){let{router:v}=G_("useSubmit"),{basename:w}=Ye.useContext(Kl),z=kv();return Ye.useCallback(async(E,L={})=>{let{action:F,method:A,encType:c,formData:J,body:X}=Hv(E,w);if(L.navigate===!1){let re=L.fetcherKey||p0();await v.fetch(re,z,L.action||F,{preventScrollReset:L.preventScrollReset,formData:J,body:X,formMethod:L.method||A,formEncType:L.encType||c,flushSync:L.flushSync})}else await v.navigate(L.action||F,{preventScrollReset:L.preventScrollReset,formData:J,body:X,formMethod:L.method||A,formEncType:L.encType||c,replace:L.replace,state:L.state,fromRouteId:z,flushSync:L.flushSync,viewTransition:L.viewTransition})},[v,w,z])}function g0(v,{relative:w}={}){let{basename:z}=Ye.useContext(Kl),E=Ye.useContext(Gc);Xn(E,"useFormAction must be used inside a RouteContext");let[L]=E.matches.slice(-1),F={...vp(v||".",{relative:w})},A=Zh();if(v==null){F.search=A.search;let c=new URLSearchParams(F.search),J=c.getAll("index");if(J.some(re=>re==="")){c.delete("index"),J.filter(Te=>Te).forEach(Te=>c.append("index",Te));let re=c.toString();F.search=re?`?${re}`:""}}return(!v||v===".")&&L.route.index&&(F.search=F.search?F.search.replace(/^\?/,"?index&"):"?index"),z!=="/"&&(F.pathname=F.pathname==="/"?z:jc([z,F.pathname])),fp(F)}function _0(v,{relative:w}={}){let z=Ye.useContext(I_);Xn(z!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:E}=G_("useViewTransitionState"),L=vp(v,{relative:w});if(!z.isTransitioning)return!1;let F=Vc(z.currentLocation.pathname,E)||z.currentLocation.pathname,A=Vc(z.nextLocation.pathname,E)||z.nextLocation.pathname;return pm(L.pathname,A)!=null||pm(L.pathname,F)!=null}const y0=()=>Et.jsx("div",{children:"Login"});var cm={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.6.1/LICENSE.txt
 */var v0=cm.exports,t_;function x0(){return t_||(t_=1,function(v,w){(function(z,E){v.exports=E()})(v0,function(){var z={},E={};function L(A,c,J){if(E[A]=J,A==="index"){var X="var sharedModule = {}; ("+E.shared+")(sharedModule); ("+E.worker+")(sharedModule);",re={};return E.shared(re),E.index(z,re),typeof window<"u"&&z.setWorkerUrl(window.URL.createObjectURL(new Blob([X],{type:"text/javascript"}))),z}}L("shared",["exports"],function(A){function c(a,t,r,o){return new(r||(r=Promise))(function(d,g){function _(P){try{T(o.next(P))}catch(D){g(D)}}function x(P){try{T(o.throw(P))}catch(D){g(D)}}function T(P){var D;P.done?d(P.value):(D=P.value,D instanceof r?D:new r(function(k){k(D)})).then(_,x)}T((o=o.apply(a,t||[])).next())})}function J(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var X,re;function Te(){if(re)return X;function a(t,r){this.x=t,this.y=r}return re=1,X=a,a.prototype={clone:function(){return new a(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,r){return this.clone()._rotateAround(t,r)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var r=t.x-this.x,o=t.y-this.y;return r*r+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,r){return Math.atan2(this.x*r-this.y*t,this.x*t+this.y*r)},_matMult:function(t){var r=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var r=Math.cos(t),o=Math.sin(t),d=o*this.x+r*this.y;return this.x=r*this.x-o*this.y,this.y=d,this},_rotateAround:function(t,r){var o=Math.cos(t),d=Math.sin(t),g=r.y+d*(this.x-r.x)+o*(this.y-r.y);return this.x=r.x+o*(this.x-r.x)-d*(this.y-r.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},a.convert=function(t){return t instanceof a?t:Array.isArray(t)?new a(t[0],t[1]):t},X}typeof SuppressedError=="function"&&SuppressedError;var xe,de,Ee=J(Te()),We=function(){if(de)return xe;function a(t,r,o,d){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(d-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=o,this.p2y=d}return de=1,xe=a,a.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,d=0;d<8;d++){var g=this.sampleCurveX(o)-t;if(Math.abs(g)<r)return o;var _=this.sampleCurveDerivativeX(o);if(Math.abs(_)<1e-6)break;o-=g/_}var x=0,T=1;for(o=t,d=0;d<20&&(g=this.sampleCurveX(o),!(Math.abs(g-t)<r));d++)t>g?x=o:T=o,o=.5*(T-x)+x;return o},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},xe}(),Ve=J(We);let et,ft;function Tt(){return et==null&&(et=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),et}function Ot(){if(ft==null&&(ft=!1,Tt())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let o=0;o<25;o++){const d=4*o;t.fillStyle=`rgb(${d},${d+1},${d+2})`,t.fillRect(o%5,Math.floor(o/5),1,1)}const r=t.getImageData(0,0,5,5).data;for(let o=0;o<100;o++)if(o%4!=3&&r[o]!==o){ft=!0;break}}}return ft||!1}var pt=1e-6,Ut=typeof Float32Array<"u"?Float32Array:Array;function oi(){var a=new Ut(9);return Ut!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function Di(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Mi(){var a=new Ut(3);return Ut!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function Jt(a){return Math.hypot(a[0],a[1],a[2])}function wi(a,t,r){var o=new Ut(3);return o[0]=a,o[1]=t,o[2]=r,o}function en(a,t,r){return a[0]=t[0]+r[0],a[1]=t[1]+r[1],a[2]=t[2]+r[2],a}function bn(a,t,r){return a[0]=t[0]*r,a[1]=t[1]*r,a[2]=t[2]*r,a}function Yn(a,t,r){var o=t[0],d=t[1],g=t[2],_=r[0],x=r[1],T=r[2];return a[0]=d*T-g*x,a[1]=g*_-o*T,a[2]=o*x-d*_,a}Math.hypot||(Math.hypot=function(){for(var a=0,t=arguments.length;t--;)a+=arguments[t]*arguments[t];return Math.sqrt(a)});var Ei,Ke=Jt;function yt(a,t,r){var o=t[0],d=t[1],g=t[2],_=t[3];return a[0]=r[0]*o+r[4]*d+r[8]*g+r[12]*_,a[1]=r[1]*o+r[5]*d+r[9]*g+r[13]*_,a[2]=r[2]*o+r[6]*d+r[10]*g+r[14]*_,a[3]=r[3]*o+r[7]*d+r[11]*g+r[15]*_,a}function It(){var a=new Ut(4);return Ut!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function mi(a,t,r,o){var d=.5*Math.PI/180;t*=d,r*=d,o*=d;var g=Math.sin(t),_=Math.cos(t),x=Math.sin(r),T=Math.cos(r),P=Math.sin(o),D=Math.cos(o);return a[0]=g*T*D-_*x*P,a[1]=_*x*D+g*T*P,a[2]=_*T*P-g*x*D,a[3]=_*T*D+g*x*P,a}function be(){var a=new Ut(2);return Ut!=Float32Array&&(a[0]=0,a[1]=0),a}function Qe(a,t){var r=new Ut(2);return r[0]=a,r[1]=t,r}Mi(),Ei=new Ut(4),Ut!=Float32Array&&(Ei[0]=0,Ei[1]=0,Ei[2]=0,Ei[3]=0),Mi(),wi(1,0,0),wi(0,1,0),It(),It(),oi(),be();const lt=8192;function gt(a,t,r){return t*(lt/(a.tileSize*Math.pow(2,r-a.tileID.overscaledZ)))}function Ct(a,t){return(a%t+t)%t}function li(a,t,r){return a*(1-r)+t*r}function Vt(a){if(a<=0)return 0;if(a>=1)return 1;const t=a*a,r=t*a;return 4*(a<.5?r:3*(a-t)+r-.75)}function Kn(a,t,r,o){const d=new Ve(a,t,r,o);return g=>d.solve(g)}const Fi=Kn(.25,.1,.25,1);function Hi(a,t,r){return Math.min(r,Math.max(t,a))}function po(a,t,r){const o=r-t,d=((a-t)%o+o)%o+t;return d===t?r:d}function dr(a,...t){for(const r of t)for(const o in r)a[o]=r[o];return a}let mo=1;function tn(a,t,r){const o={};for(const d in a)o[d]=t.call(this,a[d],d,a);return o}function ra(a,t,r){const o={};for(const d in a)t.call(this,a[d],d,a)&&(o[d]=a[d]);return o}function aa(a){return Array.isArray(a)?a.map(aa):typeof a=="object"&&a?tn(a,aa):a}const ol={};function Xi(a){ol[a]||(typeof console<"u"&&console.warn(a),ol[a]=!0)}function Ur(a,t,r){return(r.y-a.y)*(t.x-a.x)>(t.y-a.y)*(r.x-a.x)}function br(a){return typeof WorkerGlobalScope<"u"&&a!==void 0&&a instanceof WorkerGlobalScope}let ks=null;function Sa(a){return typeof ImageBitmap<"u"&&a instanceof ImageBitmap}const Wl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ls(a,t,r,o,d){return c(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const g=new VideoFrame(a,{timestamp:0});try{const _=g==null?void 0:g.format;if(!_||!_.startsWith("BGR")&&!_.startsWith("RGB"))throw new Error(`Unrecognized format ${_}`);const x=_.startsWith("BGR"),T=new Uint8ClampedArray(o*d*4);if(yield g.copyTo(T,function(P,D,k,N,V){const q=4*Math.max(-D,0),$=(Math.max(0,k)-k)*N*4+q,Q=4*N,ae=Math.max(0,D),ve=Math.max(0,k);return{rect:{x:ae,y:ve,width:Math.min(P.width,D+N)-ae,height:Math.min(P.height,k+V)-ve},layout:[{offset:$,stride:Q}]}}(a,t,r,o,d)),x)for(let P=0;P<T.length;P+=4){const D=T[P];T[P]=T[P+2],T[P+2]=D}return T}finally{g.close()}})}let cs,go;function Vr(a,t,r,o){return a.addEventListener(t,r,o),{unsubscribe:()=>{a.removeEventListener(t,r,o)}}}function nn(a){return a*Math.PI/180}function nr(a){return a/Math.PI*180}const rr={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},qc={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},us="AbortError";function Ae(){return new Error(us)}const H={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Y(a){return H.REGISTERED_PROTOCOLS[a.substring(0,a.indexOf("://"))]}const ee="global-dispatcher";class ce extends Error{constructor(t,r,o,d){super(`AJAXError: ${r} (${t}): ${o}`),this.status=t,this.statusText=r,this.url=o,this.body=d}}const ye=()=>br(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ce=function(a,t){if(/:\/\//.test(a.url)&&!/^https?:|^file:/.test(a.url)){const o=Y(a.url);if(o)return o(a,t);if(br(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:a,targetMapId:ee},t)}if(!(/^file:/.test(r=a.url)||/^file:/.test(ye())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(o,d){return c(this,void 0,void 0,function*(){const g=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:ye(),signal:d.signal});let _,x;o.type!=="json"||g.headers.has("Accept")||g.headers.set("Accept","application/json");try{_=yield fetch(g)}catch(P){throw new ce(0,P.message,o.url,new Blob)}if(!_.ok){const P=yield _.blob();throw new ce(_.status,_.statusText,o.url,P)}x=o.type==="arrayBuffer"||o.type==="image"?_.arrayBuffer():o.type==="json"?_.json():_.text();const T=yield x;if(d.signal.aborted)throw Ae();return{data:T,cacheControl:_.headers.get("Cache-Control"),expires:_.headers.get("Expires")}})}(a,t);if(br(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:a,mustQueue:!0,targetMapId:ee},t)}var r;return function(o,d){return new Promise((g,_)=>{var x;const T=new XMLHttpRequest;T.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(T.responseType="arraybuffer");for(const P in o.headers)T.setRequestHeader(P,o.headers[P]);o.type==="json"&&(T.responseType="text",!((x=o.headers)===null||x===void 0)&&x.Accept||T.setRequestHeader("Accept","application/json")),T.withCredentials=o.credentials==="include",T.onerror=()=>{_(new Error(T.statusText))},T.onload=()=>{if(!d.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let P=T.response;if(o.type==="json")try{P=JSON.parse(T.response)}catch(D){return void _(D)}g({data:P,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{const P=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});_(new ce(T.status,T.statusText,o.url,P))}},d.signal.addEventListener("abort",()=>{T.abort(),_(Ae())}),T.send(o.body)})}(a,t)};function ke(a){if(!a||a.indexOf("://")<=0||a.indexOf("data:image/")===0||a.indexOf("blob:")===0)return!0;const t=new URL(a),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function Se(a,t,r){r[a]&&r[a].indexOf(t)!==-1||(r[a]=r[a]||[],r[a].push(t))}function Ze(a,t,r){if(r&&r[a]){const o=r[a].indexOf(t);o!==-1&&r[a].splice(o,1)}}class je{constructor(t,r={}){dr(this,r),this.type=t}}class ze extends je{constructor(t,r={}){super("error",dr({error:t},r))}}class Xe{on(t,r){return this._listeners=this._listeners||{},Se(t,r,this._listeners),{unsubscribe:()=>{this.off(t,r)}}}off(t,r){return Ze(t,r,this._listeners),Ze(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Se(t,r,this._oneTimeListeners),this):new Promise(o=>this.once(t,o))}fire(t,r){typeof t=="string"&&(t=new je(t,r||{}));const o=t.type;if(this.listens(o)){t.target=this;const d=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const x of d)x.call(this,t);const g=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const x of g)Ze(o,x,this._oneTimeListeners),x.call(this,t);const _=this._eventedParent;_&&(dr(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(t))}else t instanceof ze&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var _e={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const mt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Lt(a,t){const r={};for(const o in a)o!=="ref"&&(r[o]=a[o]);return mt.forEach(o=>{o in t&&(r[o]=t[o])}),r}function vt(a,t){if(Array.isArray(a)){if(!Array.isArray(t)||a.length!==t.length)return!1;for(let r=0;r<a.length;r++)if(!vt(a[r],t[r]))return!1;return!0}if(typeof a=="object"&&a!==null&&t!==null){if(typeof t!="object"||Object.keys(a).length!==Object.keys(t).length)return!1;for(const r in a)if(!vt(a[r],t[r]))return!1;return!0}return a===t}function At(a,t){a.push(t)}function kt(a,t,r){At(r,{command:"addSource",args:[a,t[a]]})}function ei(a,t,r){At(t,{command:"removeSource",args:[a]}),r[a]=!0}function Qt(a,t,r,o){ei(a,r,o),kt(a,t,r)}function ci(a,t,r){let o;for(o in a[r])if(Object.prototype.hasOwnProperty.call(a[r],o)&&o!=="data"&&!vt(a[r][o],t[r][o]))return!1;for(o in t[r])if(Object.prototype.hasOwnProperty.call(t[r],o)&&o!=="data"&&!vt(a[r][o],t[r][o]))return!1;return!0}function Bt(a,t,r,o,d,g){a=a||{},t=t||{};for(const _ in a)Object.prototype.hasOwnProperty.call(a,_)&&(vt(a[_],t[_])||r.push({command:g,args:[o,_,t[_],d]}));for(const _ in t)Object.prototype.hasOwnProperty.call(t,_)&&!Object.prototype.hasOwnProperty.call(a,_)&&(vt(a[_],t[_])||r.push({command:g,args:[o,_,t[_],d]}))}function ui(a){return a.id}function Wn(a,t){return a[t.id]=t,a}class ct{constructor(t,r,o,d){this.message=(t?`${t}: `:"")+o,d&&(this.identifier=d),r!=null&&r.__line__&&(this.line=r.__line__)}}function wn(a,...t){for(const r of t)for(const o in r)a[o]=r[o];return a}class Yi extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class Gr{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[o,d]of r)this.bindings[o]=d}concat(t){return new Gr(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const sa={kind:"null"},ht={kind:"number"},qt={kind:"string"},Dt={kind:"boolean"},Rr={kind:"color"},Ql={kind:"projectionDefinition"},fr={kind:"object"},Zt={kind:"value"},hs={kind:"collator"},Os={kind:"formatted"},yn={kind:"padding"},Jl={kind:"colorArray"},Bs={kind:"numberArray"},oa={kind:"resolvedImage"},qr={kind:"variableAnchorOffsetCollection"};function wr(a,t){return{kind:"array",itemType:a,N:t}}function rn(a){if(a.kind==="array"){const t=rn(a.itemType);return typeof a.N=="number"?`array<${t}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${t}>`}return a.kind}const _o=[sa,ht,qt,Dt,Rr,Ql,Os,fr,wr(Zt),yn,Bs,Jl,oa,qr];function yo(a,t){if(t.kind==="error")return null;if(a.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!yo(a.itemType,t.itemType))&&(typeof a.N!="number"||a.N===t.N))return null}else{if(a.kind===t.kind)return null;if(a.kind==="value"){for(const r of _o)if(!yo(r,t))return null}}return`Expected ${rn(a)} but found ${rn(t)} instead.`}function ll(a,t){return t.some(r=>r.kind===a.kind)}function vo(a,t){return t.some(r=>r==="null"?a===null:r==="array"?Array.isArray(a):r==="object"?a&&!Array.isArray(a)&&typeof a=="object":r===typeof a)}function ds(a,t){return a.kind==="array"&&t.kind==="array"?a.itemType.kind===t.itemType.kind&&typeof a.N=="number":a.kind===t.kind}const Zr=.96422,Fu=.82521,$h=4/29,fs=6/29,Nu=3*fs*fs,ec=fs*fs*fs,tc=Math.PI/180,la=180/Math.PI;function Zc(a){return(a%=360)<0&&(a+=360),a}function xo([a,t,r,o]){let d,g;const _=Fs((.2225045*(a=ic(a))+.7168786*(t=ic(t))+.0606169*(r=ic(r)))/1);a===t&&t===r?d=g=_:(d=Fs((.4360747*a+.3850649*t+.1430804*r)/Zr),g=Fs((.0139322*a+.0971045*t+.7141733*r)/Fu));const x=116*_-16;return[x<0?0:x,500*(d-_),200*(_-g),o]}function ic(a){return a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Fs(a){return a>ec?Math.pow(a,1/3):a/Nu+$h}function ju([a,t,r,o]){let d=(a+16)/116,g=isNaN(t)?d:d+t/500,_=isNaN(r)?d:d-r/200;return d=1*ps(d),g=Zr*ps(g),_=Fu*ps(_),[nc(3.1338561*g-1.6168667*d-.4906146*_),nc(-.9787684*g+1.9161415*d+.033454*_),nc(.0719453*g-.2289914*d+1.4052427*_),o]}function nc(a){return(a=a<=.00304?12.92*a:1.055*Math.pow(a,1/2.4)-.055)<0?0:a>1?1:a}function ps(a){return a>fs?a*a*a:Nu*(a-$h)}const Va=Object.hasOwn||function(a,t){return Object.prototype.hasOwnProperty.call(a,t)};function ri(a,t){return Va(a,t)?a[t]:void 0}function Ga(a){return parseInt(a.padEnd(2,a),16)/255}function Ta(a,t){return bo(t?a/100:a,0,1)}function bo(a,t,r){return Math.min(Math.max(t,a),r)}function Uu(a){return!a.some(Number.isNaN)}const cl={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Dr(a,t,r){return a+r*(t-a)}function Ma(a,t,r){return a.map((o,d)=>Dr(o,t[d],r))}class Kt{constructor(t,r,o,d=1,g=!0){this.r=t,this.g=r,this.b=o,this.a=d,g||(this.r*=d,this.g*=d,this.b*=d,d||this.overwriteGetter("rgb",[t,r,o,d]))}static parse(t){if(t instanceof Kt)return t;if(typeof t!="string")return;const r=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const d=ri(cl,o);if(d){const[_,x,T]=d;return[_/255,x/255,T/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const _=o.length<6?1:2;let x=1;return[Ga(o.slice(x,x+=_)),Ga(o.slice(x,x+=_)),Ga(o.slice(x,x+=_)),Ga(o.slice(x,x+_)||"ff")]}if(o.startsWith("rgb")){const _=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[x,T,P,D,k,N,V,q,$,Q,ae,ve]=_,he=[D||" ",V||" ",Q].join("");if(he==="  "||he==="  /"||he===",,"||he===",,,"){const U=[P,N,$].join(""),W=U==="%%%"?100:U===""?255:0;if(W){const fe=[bo(+T/W,0,1),bo(+k/W,0,1),bo(+q/W,0,1),ae?Ta(+ae,ve):1];if(Uu(fe))return fe}}return}}const g=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[_,x,T,P,D,k,N,V,q]=g,$=[T||" ",D||" ",N].join("");if($==="  "||$==="  /"||$===",,"||$===",,,"){const Q=[+x,bo(+P,0,100),bo(+k,0,100),V?Ta(+V,q):1];if(Uu(Q))return function([ae,ve,he,U]){function W(fe){const Ie=(fe+ae/30)%12,Je=ve*Math.min(he,1-he);return he-Je*Math.max(-1,Math.min(Ie-3,9-Ie,1))}return ae=Zc(ae),ve/=100,he/=100,[W(0),W(8),W(4),U]}(Q)}}}(t);return r?new Kt(...r,!1):void 0}get rgb(){const{r:t,g:r,b:o,a:d}=this,g=d||1/0;return this.overwriteGetter("rgb",[t/g,r/g,o/g,d])}get hcl(){return this.overwriteGetter("hcl",function(t){const[r,o,d,g]=xo(t),_=Math.sqrt(o*o+d*d);return[Math.round(1e4*_)?Zc(Math.atan2(d,o)*la):NaN,_,r,g]}(this.rgb))}get lab(){return this.overwriteGetter("lab",xo(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){const[t,r,o,d]=this.rgb;return`rgba(${[t,r,o].map(g=>Math.round(255*g)).join(",")},${d})`}static interpolate(t,r,o,d="rgb"){switch(d){case"rgb":{const[g,_,x,T]=Ma(t.rgb,r.rgb,o);return new Kt(g,_,x,T,!1)}case"hcl":{const[g,_,x,T]=t.hcl,[P,D,k,N]=r.hcl;let V,q;if(isNaN(g)||isNaN(P))isNaN(g)?isNaN(P)?V=NaN:(V=P,x!==1&&x!==0||(q=D)):(V=g,k!==1&&k!==0||(q=_));else{let he=P-g;P>g&&he>180?he-=360:P<g&&g-P>180&&(he+=360),V=g+o*he}const[$,Q,ae,ve]=function([he,U,W,fe]){return he=isNaN(he)?0:he*tc,ju([W,Math.cos(he)*U,Math.sin(he)*U,fe])}([V,q??Dr(_,D,o),Dr(x,k,o),Dr(T,N,o)]);return new Kt($,Q,ae,ve,!1)}case"lab":{const[g,_,x,T]=ju(Ma(t.lab,r.lab,o));return new Kt(g,_,x,T,!1)}}}}Kt.black=new Kt(0,0,0,1),Kt.white=new Kt(1,1,1,1),Kt.transparent=new Kt(0,0,0,0),Kt.red=new Kt(1,0,0,1);class qa{constructor(t,r,o){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const rc=["bottom","center","top"];class ac{constructor(t,r,o,d,g,_){this.text=t,this.image=r,this.scale=o,this.fontStack=d,this.textColor=g,this.verticalAlign=_}}class ar{constructor(t){this.sections=t}static fromString(t){return new ar([new ac(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof ar?t:ar.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class on{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof on)return t;if(typeof t=="number")return new on([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new on(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,o){return new on(Ma(t.values,r.values,o))}}class ln{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof ln)return t;if(typeof t=="number")return new ln([t]);if(Array.isArray(t)){for(const r of t)if(typeof r!="number")return;return new ln(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,o){return new ln(Ma(t.values,r.values,o))}}class Ln{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Ln)return t;if(typeof t=="string"){const o=Kt.parse(t);return o?new Ln([o]):void 0}if(!Array.isArray(t))return;const r=[];for(const o of t){if(typeof o!="string")return;const d=Kt.parse(o);if(!d)return;r.push(d)}return new Ln(r)}toString(){return JSON.stringify(this.values)}static interpolate(t,r,o,d="rgb"){const g=[];if(t.values.length!=r.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${r.values.length}), cannot interpolate.`);for(let _=0;_<t.values.length;_++)g.push(Kt.interpolate(t.values[_],r.values[_],o,d));return new Ln(g)}}class ki extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const Ea=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class si{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof si)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){const o=t[r],d=t[r+1];if(typeof o!="string"||!Ea.has(o)||!Array.isArray(d)||d.length!==2||typeof d[0]!="number"||typeof d[1]!="number")return}return new si(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,o){const d=t.values,g=r.values;if(d.length!==g.length)throw new ki(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${r.toString()}`);const _=[];for(let x=0;x<d.length;x+=2){if(d[x]!==g[x])throw new ki(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${d[x]}, to[${x}]: ${g[x]}`);_.push(d[x]);const[T,P]=d[x+1],[D,k]=g[x+1];_.push([Dr(T,D,o),Dr(P,k,o)])}return new si(_)}}class sr{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new sr({name:t,available:!1}):null}}class $t{constructor(t,r,o){this.from=t,this.to=r,this.transition=o}static interpolate(t,r,o){return new $t(t,r,o)}static parse(t){return t instanceof $t?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new $t(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new $t(t.from,t.to,t.transition):typeof t=="string"?new $t(t,t,1):void 0}}function Xt(a,t,r,o){return typeof a=="number"&&a>=0&&a<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[a,t,r,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[a,t,r,o]:[a,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Za(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof $t||a instanceof Kt||a instanceof qa||a instanceof ar||a instanceof on||a instanceof ln||a instanceof Ln||a instanceof si||a instanceof sr)return!0;if(Array.isArray(a)){for(const t of a)if(!Za(t))return!1;return!0}if(typeof a=="object"){for(const t in a)if(!Za(a[t]))return!1;return!0}return!1}function Ft(a){if(a===null)return sa;if(typeof a=="string")return qt;if(typeof a=="boolean")return Dt;if(typeof a=="number")return ht;if(a instanceof Kt)return Rr;if(a instanceof $t)return Ql;if(a instanceof qa)return hs;if(a instanceof ar)return Os;if(a instanceof on)return yn;if(a instanceof ln)return Bs;if(a instanceof Ln)return Jl;if(a instanceof si)return qr;if(a instanceof sr)return oa;if(Array.isArray(a)){const t=a.length;let r;for(const o of a){const d=Ft(o);if(r){if(r===d)continue;r=Zt;break}r=d}return wr(r||Zt,t)}return fr}function On(a){const t=typeof a;return a===null?"":t==="string"||t==="number"||t==="boolean"?String(a):a instanceof Kt||a instanceof $t||a instanceof ar||a instanceof on||a instanceof ln||a instanceof Ln||a instanceof si||a instanceof sr?a.toString():JSON.stringify(a)}class Sn{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Za(t[1]))return r.error("invalid value");const o=t[1];let d=Ft(o);const g=r.expectedType;return d.kind!=="array"||d.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(d=g),new Sn(d,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const ms={string:qt,number:ht,boolean:Dt,object:fr};class Qn{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let o,d=1;const g=t[0];if(g==="array"){let x,T;if(t.length>2){const P=t[1];if(typeof P!="string"||!(P in ms)||P==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);x=ms[P],d++}else x=Zt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);T=t[2],d++}o=wr(x,T)}else{if(!ms[g])throw new Error(`Types doesn't contain name = ${g}`);o=ms[g]}const _=[];for(;d<t.length;d++){const x=r.parse(t[d],d,Zt);if(!x)return null;_.push(x)}return new Qn(o,_)}evaluate(t){for(let r=0;r<this.args.length;r++){const o=this.args[r].evaluate(t);if(!yo(this.type,Ft(o)))return o;if(r===this.args.length-1)throw new ki(`Expected value to be of type ${rn(this.type)}, but found ${rn(Ft(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Vu={"to-boolean":Dt,"to-color":Rr,"to-number":ht,"to-string":qt};class ca{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const o=t[0];if(!Vu[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return r.error("Expected one argument.");const d=Vu[o],g=[];for(let _=1;_<t.length;_++){const x=r.parse(t[_],_,Zt);if(!x)return null;g.push(x)}return new ca(d,g)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,o;for(const d of this.args){if(r=d.evaluate(t),o=null,r instanceof Kt)return r;if(typeof r=="string"){const g=t.parseColor(r);if(g)return g}else if(Array.isArray(r)&&(o=r.length<3||r.length>4?`Invalid rgba value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Xt(r[0],r[1],r[2],r[3]),!o))return new Kt(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new ki(o||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const o of this.args){r=o.evaluate(t);const d=on.parse(r);if(d)return d}throw new ki(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"numberArray":{let r;for(const o of this.args){r=o.evaluate(t);const d=ln.parse(r);if(d)return d}throw new ki(`Could not parse numberArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"colorArray":{let r;for(const o of this.args){r=o.evaluate(t);const d=Ln.parse(r);if(d)return d}throw new ki(`Could not parse colorArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const o of this.args){r=o.evaluate(t);const d=si.parse(r);if(d)return d}throw new ki(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const o of this.args){if(r=o.evaluate(t),r===null)return 0;const d=Number(r);if(!isNaN(d))return d}throw new ki(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return ar.fromString(On(this.args[0].evaluate(t)));case"resolvedImage":return sr.fromString(On(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return On(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const $c=["Unknown","Point","LineString","Polygon"];class ul{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?$c[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache.get(t);return r||(r=Kt.parse(t),this._parseColorCache.set(t,r)),r}}class Ns{constructor(t,r,o=[],d,g=new Gr,_=[]){this.registry=t,this.path=o,this.key=o.map(x=>`[${x}]`).join(""),this.scope=g,this.errors=_,this.expectedType=d,this._isConstant=r}parse(t,r,o,d,g={}){return r?this.concat(r,o,d)._parse(t,g):this._parse(t,g)}_parse(t,r){function o(d,g,_){return _==="assert"?new Qn(g,[d]):_==="coerce"?new ca(g,[d]):d}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=t[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[d];if(g){let _=g.parse(t,this);if(!_)return null;if(this.expectedType){const x=this.expectedType,T=_.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||T.kind!=="value"){if(x.kind==="projectionDefinition"&&["string","array"].includes(T.kind)||["color","formatted","resolvedImage"].includes(x.kind)&&["value","string"].includes(T.kind)||["padding","numberArray"].includes(x.kind)&&["value","number","array"].includes(T.kind)||x.kind==="colorArray"&&["value","string","array"].includes(T.kind)||x.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(T.kind))_=o(_,x,r.typeAnnotation||"coerce");else if(this.checkSubtype(x,T))return null}else _=o(_,x,r.typeAnnotation||"assert")}if(!(_ instanceof Sn)&&_.type.kind!=="resolvedImage"&&this._isConstant(_)){const x=new ul;try{_=new Sn(_.type,_.evaluate(x))}catch(T){return this.error(T.message),null}}return _}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,o){const d=typeof t=="number"?this.path.concat(t):this.path,g=o?this.scope.concat(o):this.scope;return new Ns(this.registry,this._isConstant,d,r||null,g,this.errors)}error(t,...r){const o=`${this.key}${r.map(d=>`[${d}]`).join("")}`;this.errors.push(new Yi(o,t))}checkSubtype(t,r){const o=yo(t,r);return o&&this.error(o),o}}class hl{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let g=1;g<t.length-1;g+=2){const _=t[g];if(typeof _!="string")return r.error(`Expected string, but found ${typeof _} instead.`,g);if(/[^a-zA-Z0-9_]/.test(_))return r.error("Variable names must contain only alphanumeric characters or '_'.",g);const x=r.parse(t[g+1],g+1);if(!x)return null;o.push([_,x])}const d=r.parse(t[t.length-1],t.length-1,r.expectedType,o);return d?new hl(o,d):null}outputDefined(){return this.result.outputDefined()}}class Ca{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const o=t[1];return r.scope.has(o)?new Ca(o,r.scope.get(o)):r.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Jn{constructor(t,r,o){this.type=t,this.index=r,this.input=o}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,ht),d=r.parse(t[2],2,wr(r.expectedType||Zt));return o&&d?new Jn(d.type.itemType,o,d):null}evaluate(t){const r=this.index.evaluate(t),o=this.input.evaluate(t);if(r<0)throw new ki(`Array index out of bounds: ${r} < 0.`);if(r>=o.length)throw new ki(`Array index out of bounds: ${r} > ${o.length-1}.`);if(r!==Math.floor(r))throw new ki(`Array index must be an integer, but found ${r} instead.`);return o[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class dl{constructor(t,r){this.type=Dt,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,Zt),d=r.parse(t[2],2,Zt);return o&&d?ll(o.type,[Dt,qt,ht,sa,Zt])?new dl(o,d):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${rn(o.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!vo(r,["boolean","string","number","null"]))throw new ki(`Expected first argument to be of type boolean, string, number or null, but found ${rn(Ft(r))} instead.`);if(!vo(o,["string","array"]))throw new ki(`Expected second argument to be of type array or string, but found ${rn(Ft(o))} instead.`);return o.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class wo{constructor(t,r,o){this.type=ht,this.needle=t,this.haystack=r,this.fromIndex=o}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,Zt),d=r.parse(t[2],2,Zt);if(!o||!d)return null;if(!ll(o.type,[Dt,qt,ht,sa,Zt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${rn(o.type)} instead`);if(t.length===4){const g=r.parse(t[3],3,ht);return g?new wo(o,d,g):null}return new wo(o,d)}evaluate(t){const r=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!vo(r,["boolean","string","number","null"]))throw new ki(`Expected first argument to be of type boolean, string, number or null, but found ${rn(Ft(r))} instead.`);let d;if(this.fromIndex&&(d=this.fromIndex.evaluate(t)),vo(o,["string"])){const g=o.indexOf(r,d);return g===-1?-1:[...o.slice(0,g)].length}if(vo(o,["array"]))return o.indexOf(r,d);throw new ki(`Expected second argument to be of type array or string, but found ${rn(Ft(o))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class fl{constructor(t,r,o,d,g,_){this.inputType=t,this.type=r,this.input=o,this.cases=d,this.outputs=g,this.otherwise=_}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let o,d;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);const g={},_=[];for(let P=2;P<t.length-1;P+=2){let D=t[P];const k=t[P+1];Array.isArray(D)||(D=[D]);const N=r.concat(P);if(D.length===0)return N.error("Expected at least one branch label.");for(const q of D){if(typeof q!="number"&&typeof q!="string")return N.error("Branch labels must be numbers or strings.");if(typeof q=="number"&&Math.abs(q)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof q=="number"&&Math.floor(q)!==q)return N.error("Numeric branch labels must be integer values.");if(o){if(N.checkSubtype(o,Ft(q)))return null}else o=Ft(q);if(g[String(q)]!==void 0)return N.error("Branch labels must be unique.");g[String(q)]=_.length}const V=r.parse(k,P,d);if(!V)return null;d=d||V.type,_.push(V)}const x=r.parse(t[1],1,Zt);if(!x)return null;const T=r.parse(t[t.length-1],t.length-1,d);return T?x.type.kind!=="value"&&r.concat(1).checkSubtype(o,x.type)?null:new fl(o,d,x,g,_,T):null}evaluate(t){const r=this.input.evaluate(t);return(Ft(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Bn{constructor(t,r,o){this.type=t,this.branches=r,this.otherwise=o}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let o;r.expectedType&&r.expectedType.kind!=="value"&&(o=r.expectedType);const d=[];for(let _=1;_<t.length-1;_+=2){const x=r.parse(t[_],_,Dt);if(!x)return null;const T=r.parse(t[_+1],_+1,o);if(!T)return null;d.push([x,T]),o=o||T.type}const g=r.parse(t[t.length-1],t.length-1,o);if(!g)return null;if(!o)throw new Error("Can't infer output type");return new Bn(o,d,g)}evaluate(t){for(const[r,o]of this.branches)if(r.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,o]of this.branches)t(r),t(o);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class sc{constructor(t,r,o,d){this.type=t,this.input=r,this.beginIndex=o,this.endIndex=d}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,Zt),d=r.parse(t[2],2,ht);if(!o||!d)return null;if(!ll(o.type,[wr(Zt),qt,Zt]))return r.error(`Expected first argument to be of type array or string, but found ${rn(o.type)} instead`);if(t.length===4){const g=r.parse(t[3],3,ht);return g?new sc(o.type,o,d,g):null}return new sc(o.type,o,d)}evaluate(t){const r=this.input.evaluate(t),o=this.beginIndex.evaluate(t);let d;if(this.endIndex&&(d=this.endIndex.evaluate(t)),vo(r,["string"]))return[...r].slice(o,d).join("");if(vo(r,["array"]))return r.slice(o,d);throw new ki(`Expected first argument to be of type array or string, but found ${rn(Ft(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function pl(a,t){const r=a.length-1;let o,d,g=0,_=r,x=0;for(;g<=_;)if(x=Math.floor((g+_)/2),o=a[x],d=a[x+1],o<=t){if(x===r||t<d)return x;g=x+1}else{if(!(o>t))throw new ki("Input is not a number.");_=x-1}return 0}class ml{constructor(t,r,o){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[d,g]of o)this.labels.push(d),this.outputs.push(g)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const o=r.parse(t[1],1,ht);if(!o)return null;const d=[];let g=null;r.expectedType&&r.expectedType.kind!=="value"&&(g=r.expectedType);for(let _=1;_<t.length;_+=2){const x=_===1?-1/0:t[_],T=t[_+1],P=_,D=_+1;if(typeof x!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(d.length&&d[d.length-1][0]>=x)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const k=r.parse(T,D,g);if(!k)return null;g=g||k.type,d.push([x,k])}return new ml(g,o,d)}evaluate(t){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(t);const d=this.input.evaluate(t);if(d<=r[0])return o[0].evaluate(t);const g=r.length;return d>=r[g-1]?o[g-1].evaluate(t):o[pl(r,d)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Hh(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var js,oc,Gu=function(){if(oc)return js;function a(t,r,o,d){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(d-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=o,this.p2y=d}return oc=1,js=a,a.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,d=0;d<8;d++){var g=this.sampleCurveX(o)-t;if(Math.abs(g)<r)return o;var _=this.sampleCurveDerivativeX(o);if(Math.abs(_)<1e-6)break;o-=g/_}var x=0,T=1;for(o=t,d=0;d<20&&(g=this.sampleCurveX(o),!(Math.abs(g-t)<r));d++)t>g?x=o:T=o,o=.5*(T-x)+x;return o},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},js}(),$d=Hh(Gu);class or{constructor(t,r,o,d,g){this.type=t,this.operator=r,this.interpolation=o,this.input=d,this.labels=[],this.outputs=[];for(const[_,x]of g)this.labels.push(_),this.outputs.push(x)}static interpolationFactor(t,r,o,d){let g=0;if(t.name==="exponential")g=gl(r,t.base,o,d);else if(t.name==="linear")g=gl(r,1,o,d);else if(t.name==="cubic-bezier"){const _=t.controlPoints;g=new $d(_[0],_[1],_[2],_[3]).solve(gl(r,1,o,d))}return g}static parse(t,r){let[o,d,g,..._]=t;if(!Array.isArray(d)||d.length===0)return r.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const P=d[1];if(typeof P!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:P}}else{if(d[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const P=d.slice(1);if(P.length!==4||P.some(D=>typeof D!="number"||D<0||D>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:P}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(g=r.parse(g,2,ht),!g)return null;const x=[];let T=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||r.expectedType==Jl?r.expectedType&&r.expectedType.kind!=="value"&&(T=r.expectedType):T=Rr;for(let P=0;P<_.length;P+=2){const D=_[P],k=_[P+1],N=P+3,V=P+4;if(typeof D!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(x.length&&x[x.length-1][0]>=D)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const q=r.parse(k,V,T);if(!q)return null;T=T||q.type,x.push([D,q])}return ds(T,ht)||ds(T,Ql)||ds(T,Rr)||ds(T,yn)||ds(T,Bs)||ds(T,Jl)||ds(T,qr)||ds(T,wr(ht))?new or(T,o,d,g,x):r.error(`Type ${rn(T)} is not interpolatable.`)}evaluate(t){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(t);const d=this.input.evaluate(t);if(d<=r[0])return o[0].evaluate(t);const g=r.length;if(d>=r[g-1])return o[g-1].evaluate(t);const _=pl(r,d),x=or.interpolationFactor(this.interpolation,d,r[_],r[_+1]),T=o[_].evaluate(t),P=o[_+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Dr(T,P,x);case"color":return Kt.interpolate(T,P,x);case"padding":return on.interpolate(T,P,x);case"colorArray":return Ln.interpolate(T,P,x);case"numberArray":return ln.interpolate(T,P,x);case"variableAnchorOffsetCollection":return si.interpolate(T,P,x);case"array":return Ma(T,P,x);case"projectionDefinition":return $t.interpolate(T,P,x)}case"interpolate-hcl":switch(this.type.kind){case"color":return Kt.interpolate(T,P,x,"hcl");case"colorArray":return Ln.interpolate(T,P,x,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Kt.interpolate(T,P,x,"lab");case"colorArray":return Ln.interpolate(T,P,x,"lab")}}}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function gl(a,t,r,o){const d=o-r,g=a-r;return d===0?0:t===1?g/d:(Math.pow(t,g)-1)/(Math.pow(t,d)-1)}const $r={color:Kt.interpolate,number:Dr,padding:on.interpolate,numberArray:ln.interpolate,colorArray:Ln.interpolate,variableAnchorOffsetCollection:si.interpolate,array:Ma};class Ir{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let o=null;const d=r.expectedType;d&&d.kind!=="value"&&(o=d);const g=[];for(const x of t.slice(1)){const T=r.parse(x,1+g.length,o,void 0,{typeAnnotation:"omit"});if(!T)return null;o=o||T.type,g.push(T)}if(!o)throw new Error("No output type");const _=d&&g.some(x=>yo(d,x.type));return new Ir(_?Zt:o,g)}evaluate(t){let r,o=null,d=0;for(const g of this.args)if(d++,o=g.evaluate(t),o&&o instanceof sr&&!o.available&&(r||(r=o.name),o=null,d===this.args.length&&(o=r)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Hc(a,t){return a==="=="||a==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function lc(a,t,r,o){return o.compare(t,r)===0}function _l(a,t,r){const o=a!=="=="&&a!=="!=";return class q_{constructor(g,_,x){this.type=Dt,this.lhs=g,this.rhs=_,this.collator=x,this.hasUntypedArgument=g.type.kind==="value"||_.type.kind==="value"}static parse(g,_){if(g.length!==3&&g.length!==4)return _.error("Expected two or three arguments.");const x=g[0];let T=_.parse(g[1],1,Zt);if(!T)return null;if(!Hc(x,T.type))return _.concat(1).error(`"${x}" comparisons are not supported for type '${rn(T.type)}'.`);let P=_.parse(g[2],2,Zt);if(!P)return null;if(!Hc(x,P.type))return _.concat(2).error(`"${x}" comparisons are not supported for type '${rn(P.type)}'.`);if(T.type.kind!==P.type.kind&&T.type.kind!=="value"&&P.type.kind!=="value")return _.error(`Cannot compare types '${rn(T.type)}' and '${rn(P.type)}'.`);o&&(T.type.kind==="value"&&P.type.kind!=="value"?T=new Qn(P.type,[T]):T.type.kind!=="value"&&P.type.kind==="value"&&(P=new Qn(T.type,[P])));let D=null;if(g.length===4){if(T.type.kind!=="string"&&P.type.kind!=="string"&&T.type.kind!=="value"&&P.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(D=_.parse(g[3],3,hs),!D)return null}return new q_(T,P,D)}evaluate(g){const _=this.lhs.evaluate(g),x=this.rhs.evaluate(g);if(o&&this.hasUntypedArgument){const T=Ft(_),P=Ft(x);if(T.kind!==P.kind||T.kind!=="string"&&T.kind!=="number")throw new ki(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${T.kind}, ${P.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const T=Ft(_),P=Ft(x);if(T.kind!=="string"||P.kind!=="string")return t(g,_,x)}return this.collator?r(g,_,x,this.collator.evaluate(g)):t(g,_,x)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}const qu=_l("==",function(a,t,r){return t===r},lc),Hd=_l("!=",function(a,t,r){return t!==r},function(a,t,r,o){return!lc(0,t,r,o)}),Xd=_l("<",function(a,t,r){return t<r},function(a,t,r,o){return o.compare(t,r)<0}),Yd=_l(">",function(a,t,r){return t>r},function(a,t,r,o){return o.compare(t,r)>0}),Kd=_l("<=",function(a,t,r){return t<=r},function(a,t,r,o){return o.compare(t,r)<=0}),Xc=_l(">=",function(a,t,r){return t>=r},function(a,t,r,o){return o.compare(t,r)>=0});class Yc{constructor(t,r,o){this.type=hs,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return r.error("Collator options argument must be an object.");const d=r.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Dt);if(!d)return null;const g=r.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Dt);if(!g)return null;let _=null;return o.locale&&(_=r.parse(o.locale,1,qt),!_)?null:new Yc(d,g,_)}evaluate(t){return new qa(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class yl{constructor(t,r,o,d,g){this.type=qt,this.number=t,this.locale=r,this.currency=o,this.minFractionDigits=d,this.maxFractionDigits=g}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const o=r.parse(t[1],1,ht);if(!o)return null;const d=t[2];if(typeof d!="object"||Array.isArray(d))return r.error("NumberFormat options argument must be an object.");let g=null;if(d.locale&&(g=r.parse(d.locale,1,qt),!g))return null;let _=null;if(d.currency&&(_=r.parse(d.currency,1,qt),!_))return null;let x=null;if(d["min-fraction-digits"]&&(x=r.parse(d["min-fraction-digits"],1,ht),!x))return null;let T=null;return d["max-fraction-digits"]&&(T=r.parse(d["max-fraction-digits"],1,ht),!T)?null:new yl(o,g,_,x,T)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class gs{constructor(t){this.type=Os,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return r.error("First argument must be an image or text section.");const d=[];let g=!1;for(let _=1;_<=t.length-1;++_){const x=t[_];if(g&&typeof x=="object"&&!Array.isArray(x)){g=!1;let T=null;if(x["font-scale"]&&(T=r.parse(x["font-scale"],1,ht),!T))return null;let P=null;if(x["text-font"]&&(P=r.parse(x["text-font"],1,wr(qt)),!P))return null;let D=null;if(x["text-color"]&&(D=r.parse(x["text-color"],1,Rr),!D))return null;let k=null;if(x["vertical-align"]){if(typeof x["vertical-align"]=="string"&&!rc.includes(x["vertical-align"]))return r.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${x["vertical-align"]}' instead.`);if(k=r.parse(x["vertical-align"],1,qt),!k)return null}const N=d[d.length-1];N.scale=T,N.font=P,N.textColor=D,N.verticalAlign=k}else{const T=r.parse(t[_],1,Zt);if(!T)return null;const P=T.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,d.push({content:T,scale:null,font:null,textColor:null,verticalAlign:null})}}return new gs(d)}evaluate(t){return new ar(this.sections.map(r=>{const o=r.content.evaluate(t);return Ft(o)===oa?new ac("",o,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(t):null):new ac(On(o),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null,r.verticalAlign?r.verticalAlign.evaluate(t):null)}))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor),r.verticalAlign&&t(r.verticalAlign)}outputDefined(){return!1}}class Zu{constructor(t){this.type=oa,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");const o=r.parse(t[1],1,qt);return o?new Zu(o):r.error("No image name provided.")}evaluate(t){const r=this.input.evaluate(t),o=sr.fromString(r);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(r)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class cc{constructor(t){this.type=ht,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=r.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${rn(o.type)} instead.`):new cc(o):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new ki(`Expected value to be of type string or array, but found ${rn(Ft(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Aa=8192;function Xh(a,t){const r=(180+a[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,d=Math.pow(2,t.z);return[Math.round(r*d*Aa),Math.round(o*d*Aa)]}function Kc(a,t){const r=Math.pow(2,t.z);return[(d=(a[0]/Aa+t.x)/r,360*d-180),(o=(a[1]/Aa+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,d}function vl(a,t){a[0]=Math.min(a[0],t[0]),a[1]=Math.min(a[1],t[1]),a[2]=Math.max(a[2],t[0]),a[3]=Math.max(a[3],t[1])}function $a(a,t){return!(a[0]<=t[0]||a[2]>=t[2]||a[1]<=t[1]||a[3]>=t[3])}function Yh(a,t,r){const o=a[0]-t[0],d=a[1]-t[1],g=a[0]-r[0],_=a[1]-r[1];return o*_-g*d==0&&o*g<=0&&d*_<=0}function uc(a,t,r,o){return(d=[o[0]-r[0],o[1]-r[1]])[0]*(g=[t[0]-a[0],t[1]-a[1]])[1]-d[1]*g[0]!=0&&!(!Wc(a,t,r,o)||!Wc(r,o,a,t));var d,g}function Kh(a,t,r){for(const o of r)for(let d=0;d<o.length-1;++d)if(uc(a,t,o[d],o[d+1]))return!0;return!1}function So(a,t,r=!1){let o=!1;for(const x of t)for(let T=0;T<x.length-1;T++){if(Yh(a,x[T],x[T+1]))return r;(g=x[T])[1]>(d=a)[1]!=(_=x[T+1])[1]>d[1]&&d[0]<(_[0]-g[0])*(d[1]-g[1])/(_[1]-g[1])+g[0]&&(o=!o)}var d,g,_;return o}function Wh(a,t){for(const r of t)if(So(a,r))return!0;return!1}function xl(a,t){for(const r of a)if(!So(r,t))return!1;for(let r=0;r<a.length-1;++r)if(Kh(a[r],a[r+1],t))return!1;return!0}function hc(a,t){for(const r of t)if(xl(a,r))return!0;return!1}function Wc(a,t,r,o){const d=o[0]-r[0],g=o[1]-r[1],_=(a[0]-r[0])*g-d*(a[1]-r[1]),x=(t[0]-r[0])*g-d*(t[1]-r[1]);return _>0&&x<0||_<0&&x>0}function bl(a,t,r){const o=[];for(let d=0;d<a.length;d++){const g=[];for(let _=0;_<a[d].length;_++){const x=Xh(a[d][_],r);vl(t,x),g.push(x)}o.push(g)}return o}function $u(a,t,r){const o=[];for(let d=0;d<a.length;d++){const g=bl(a[d],t,r);o.push(g)}return o}function Hu(a,t,r,o){if(a[0]<r[0]||a[0]>r[2]){const d=.5*o;let g=a[0]-r[0]>d?-o:r[0]-a[0]>d?o:0;g===0&&(g=a[0]-r[2]>d?-o:r[2]-a[0]>d?o:0),a[0]+=g}vl(t,a)}function dc(a,t,r,o){const d=Math.pow(2,o.z)*Aa,g=[o.x*Aa,o.y*Aa],_=[];for(const x of a)for(const T of x){const P=[T.x+g[0],T.y+g[1]];Hu(P,t,r,d),_.push(P)}return _}function fc(a,t,r,o){const d=Math.pow(2,o.z)*Aa,g=[o.x*Aa,o.y*Aa],_=[];for(const T of a){const P=[];for(const D of T){const k=[D.x+g[0],D.y+g[1]];vl(t,k),P.push(k)}_.push(P)}if(t[2]-t[0]<=d/2){(x=t)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const T of _)for(const P of T)Hu(P,t,r,d)}var x;return _}class Us{constructor(t,r){this.type=Dt,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Za(t[1])){const o=t[1];if(o.type==="FeatureCollection"){const d=[];for(const g of o.features){const{type:_,coordinates:x}=g.geometry;_==="Polygon"&&d.push(x),_==="MultiPolygon"&&d.push(...x)}if(d.length)return new Us(o,{type:"MultiPolygon",coordinates:d})}else if(o.type==="Feature"){const d=o.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Us(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Us(o,o)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,o){const d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(o.type==="Polygon"){const x=bl(o.coordinates,g,_),T=dc(r.geometry(),d,g,_);if(!$a(d,g))return!1;for(const P of T)if(!So(P,x))return!1}if(o.type==="MultiPolygon"){const x=$u(o.coordinates,g,_),T=dc(r.geometry(),d,g,_);if(!$a(d,g))return!1;for(const P of T)if(!Wh(P,x))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,o){const d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(o.type==="Polygon"){const x=bl(o.coordinates,g,_),T=fc(r.geometry(),d,g,_);if(!$a(d,g))return!1;for(const P of T)if(!xl(P,x))return!1}if(o.type==="MultiPolygon"){const x=$u(o.coordinates,g,_),T=fc(r.geometry(),d,g,_);if(!$a(d,g))return!1;for(const P of T)if(!hc(P,x))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Xu=class{constructor(a=[],t=(r,o)=>r<o?-1:r>o?1:0){if(this.data=a,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(a){this.data.push(a),this._up(this.length++)}pop(){if(this.length===0)return;const a=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:t,compare:r}=this,o=t[a];for(;a>0;){const d=a-1>>1,g=t[d];if(r(o,g)>=0)break;t[a]=g,a=d}t[a]=o}_down(a){const{data:t,compare:r}=this,o=this.length>>1,d=t[a];for(;a<o;){let g=1+(a<<1);const _=g+1;if(_<this.length&&r(t[_],t[g])<0&&(g=_),r(t[g],d)>=0)break;t[a]=t[g],a=g}t[a]=d}};function Qc(a,t,r=0,o=a.length-1,d=Wd){for(;o>r;){if(o-r>600){const T=o-r+1,P=t-r+1,D=Math.log(T),k=.5*Math.exp(2*D/3),N=.5*Math.sqrt(D*k*(T-k)/T)*(P-T/2<0?-1:1);Qc(a,t,Math.max(r,Math.floor(t-P*k/T+N)),Math.min(o,Math.floor(t+(T-P)*k/T+N)),d)}const g=a[t];let _=r,x=o;for(wl(a,r,t),d(a[o],g)>0&&wl(a,r,o);_<x;){for(wl(a,_,x),_++,x--;d(a[_],g)<0;)_++;for(;d(a[x],g)>0;)x--}d(a[r],g)===0?wl(a,r,x):(x++,wl(a,x,o)),x<=t&&(r=x+1),t<=x&&(o=x-1)}}function wl(a,t,r){const o=a[t];a[t]=a[r],a[r]=o}function Wd(a,t){return a<t?-1:a>t?1:0}function Jc(a,t){if(a.length<=1)return[a];const r=[];let o,d;for(const g of a){const _=Qh(g);_!==0&&(g.area=Math.abs(_),d===void 0&&(d=_<0),d===_<0?(o&&r.push(o),o=[g]):o.push(g))}if(o&&r.push(o),t>1)for(let g=0;g<r.length;g++)r[g].length<=t||(Qc(r[g],t,1,r[g].length-1,Qd),r[g]=r[g].slice(0,t));return r}function Qd(a,t){return t.area-a.area}function Qh(a){let t=0;for(let r,o,d=0,g=a.length,_=g-1;d<g;_=d++)r=a[d],o=a[_],t+=(o.x-r.x)*(r.y+o.y);return t}const kr=1/298.257223563,Sl=kr*(2-kr),Yu=Math.PI/180;class eu{constructor(t){const r=6378.137*Yu*1e3,o=Math.cos(t*Yu),d=1/(1-Sl*(1-o*o)),g=Math.sqrt(d);this.kx=r*g*o,this.ky=r*g*d*(1-Sl)}distance(t,r){const o=this.wrap(t[0]-r[0])*this.kx,d=(t[1]-r[1])*this.ky;return Math.sqrt(o*o+d*d)}pointOnLine(t,r){let o,d,g,_,x=1/0;for(let T=0;T<t.length-1;T++){let P=t[T][0],D=t[T][1],k=this.wrap(t[T+1][0]-P)*this.kx,N=(t[T+1][1]-D)*this.ky,V=0;k===0&&N===0||(V=(this.wrap(r[0]-P)*this.kx*k+(r[1]-D)*this.ky*N)/(k*k+N*N),V>1?(P=t[T+1][0],D=t[T+1][1]):V>0&&(P+=k/this.kx*V,D+=N/this.ky*V)),k=this.wrap(r[0]-P)*this.kx,N=(r[1]-D)*this.ky;const q=k*k+N*N;q<x&&(x=q,o=P,d=D,g=T,_=V)}return{point:[o,d],index:g,t:Math.max(0,Math.min(1,_))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function vi(a,t){return t[0]-a[0]}function pc(a){return a[1]-a[0]+1}function za(a,t){return a[1]>=a[0]&&a[1]<t}function Ku(a,t){if(a[0]>a[1])return[null,null];const r=pc(a);if(t){if(r===2)return[a,null];const d=Math.floor(r/2);return[[a[0],a[0]+d],[a[0]+d,a[1]]]}if(r===1)return[a,null];const o=Math.floor(r/2)-1;return[[a[0],a[0]+o],[a[0]+o+1,a[1]]]}function Vs(a,t){if(!za(t,a.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let o=t[0];o<=t[1];++o)vl(r,a[o]);return r}function mc(a){const t=[1/0,1/0,-1/0,-1/0];for(const r of a)for(const o of r)vl(t,o);return t}function Tl(a){return a[0]!==-1/0&&a[1]!==-1/0&&a[2]!==1/0&&a[3]!==1/0}function gc(a,t,r){if(!Tl(a)||!Tl(t))return NaN;let o=0,d=0;return a[2]<t[0]&&(o=t[0]-a[2]),a[0]>t[2]&&(o=a[0]-t[2]),a[1]>t[3]&&(d=a[1]-t[3]),a[3]<t[1]&&(d=t[1]-a[3]),r.distance([0,0],[o,d])}function Gs(a,t,r){const o=r.pointOnLine(t,a);return r.distance(a,o.point)}function _s(a,t,r,o,d){const g=Math.min(Gs(a,[r,o],d),Gs(t,[r,o],d)),_=Math.min(Gs(r,[a,t],d),Gs(o,[a,t],d));return Math.min(g,_)}function Ml(a,t,r,o,d){if(!za(t,a.length)||!za(o,r.length))return 1/0;let g=1/0;for(let _=t[0];_<t[1];++_){const x=a[_],T=a[_+1];for(let P=o[0];P<o[1];++P){const D=r[P],k=r[P+1];if(uc(x,T,D,k))return 0;g=Math.min(g,_s(x,T,D,k,d))}}return g}function Wu(a,t,r,o,d){if(!za(t,a.length)||!za(o,r.length))return NaN;let g=1/0;for(let _=t[0];_<=t[1];++_)for(let x=o[0];x<=o[1];++x)if(g=Math.min(g,d.distance(a[_],r[x])),g===0)return g;return g}function Jh(a,t,r){if(So(a,t,!0))return 0;let o=1/0;for(const d of t){const g=d[0],_=d[d.length-1];if(g!==_&&(o=Math.min(o,Gs(a,[_,g],r)),o===0))return o;const x=r.pointOnLine(d,a);if(o=Math.min(o,r.distance(a,x.point)),o===0)return o}return o}function To(a,t,r,o){if(!za(t,a.length))return NaN;for(let g=t[0];g<=t[1];++g)if(So(a[g],r,!0))return 0;let d=1/0;for(let g=t[0];g<t[1];++g){const _=a[g],x=a[g+1];for(const T of r)for(let P=0,D=T.length,k=D-1;P<D;k=P++){const N=T[k],V=T[P];if(uc(_,x,N,V))return 0;d=Math.min(d,_s(_,x,N,V,o))}}return d}function Qu(a,t){for(const r of a)for(const o of r)if(So(o,t,!0))return!0;return!1}function ed(a,t,r,o=1/0){const d=mc(a),g=mc(t);if(o!==1/0&&gc(d,g,r)>=o)return o;if($a(d,g)){if(Qu(a,t))return 0}else if(Qu(t,a))return 0;let _=1/0;for(const x of a)for(let T=0,P=x.length,D=P-1;T<P;D=T++){const k=x[D],N=x[T];for(const V of t)for(let q=0,$=V.length,Q=$-1;q<$;Q=q++){const ae=V[Q],ve=V[q];if(uc(k,N,ae,ve))return 0;_=Math.min(_,_s(k,N,ae,ve,r))}}return _}function Ju(a,t,r,o,d,g){if(!g)return;const _=gc(Vs(o,g),d,r);_<t&&a.push([_,g,[0,0]])}function tu(a,t,r,o,d,g,_){if(!g||!_)return;const x=gc(Vs(o,g),Vs(d,_),r);x<t&&a.push([x,g,_])}function iu(a,t,r,o,d=1/0){let g=Math.min(o.distance(a[0],r[0][0]),d);if(g===0)return g;const _=new Xu([[0,[0,a.length-1],[0,0]]],vi),x=mc(r);for(;_.length>0;){const T=_.pop();if(T[0]>=g)continue;const P=T[1],D=t?50:100;if(pc(P)<=D){if(!za(P,a.length))return NaN;if(t){const k=To(a,P,r,o);if(isNaN(k)||k===0)return k;g=Math.min(g,k)}else for(let k=P[0];k<=P[1];++k){const N=Jh(a[k],r,o);if(g=Math.min(g,N),g===0)return 0}}else{const k=Ku(P,t);Ju(_,g,o,a,x,k[0]),Ju(_,g,o,a,x,k[1])}}return g}function nu(a,t,r,o,d,g=1/0){let _=Math.min(g,d.distance(a[0],r[0]));if(_===0)return _;const x=new Xu([[0,[0,a.length-1],[0,r.length-1]]],vi);for(;x.length>0;){const T=x.pop();if(T[0]>=_)continue;const P=T[1],D=T[2],k=t?50:100,N=o?50:100;if(pc(P)<=k&&pc(D)<=N){if(!za(P,a.length)&&za(D,r.length))return NaN;let V;if(t&&o)V=Ml(a,P,r,D,d),_=Math.min(_,V);else if(t&&!o){const q=a.slice(P[0],P[1]+1);for(let $=D[0];$<=D[1];++$)if(V=Gs(r[$],q,d),_=Math.min(_,V),_===0)return _}else if(!t&&o){const q=r.slice(D[0],D[1]+1);for(let $=P[0];$<=P[1];++$)if(V=Gs(a[$],q,d),_=Math.min(_,V),_===0)return _}else V=Wu(a,P,r,D,d),_=Math.min(_,V)}else{const V=Ku(P,t),q=Ku(D,o);tu(x,_,d,a,r,V[0],q[0]),tu(x,_,d,a,r,V[0],q[1]),tu(x,_,d,a,r,V[1],q[0]),tu(x,_,d,a,r,V[1],q[1])}}return _}function ru(a){return a.type==="MultiPolygon"?a.coordinates.map(t=>({type:"Polygon",coordinates:t})):a.type==="MultiLineString"?a.coordinates.map(t=>({type:"LineString",coordinates:t})):a.type==="MultiPoint"?a.coordinates.map(t=>({type:"Point",coordinates:t})):[a]}class qs{constructor(t,r){this.type=ht,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Za(t[1])){const o=t[1];if(o.type==="FeatureCollection")return new qs(o,o.features.map(d=>ru(d.geometry)).flat());if(o.type==="Feature")return new qs(o,ru(o.geometry));if("type"in o&&"coordinates"in o)return new qs(o,ru(o))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,o){const d=r.geometry(),g=d.flat().map(T=>Kc([T.x,T.y],r.canonical));if(d.length===0)return NaN;const _=new eu(g[0][1]);let x=1/0;for(const T of o){switch(T.type){case"Point":x=Math.min(x,nu(g,!1,[T.coordinates],!1,_,x));break;case"LineString":x=Math.min(x,nu(g,!1,T.coordinates,!0,_,x));break;case"Polygon":x=Math.min(x,iu(g,!1,T.coordinates,_,x))}if(x===0)return x}return x}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,o){const d=r.geometry(),g=d.flat().map(T=>Kc([T.x,T.y],r.canonical));if(d.length===0)return NaN;const _=new eu(g[0][1]);let x=1/0;for(const T of o){switch(T.type){case"Point":x=Math.min(x,nu(g,!0,[T.coordinates],!1,_,x));break;case"LineString":x=Math.min(x,nu(g,!0,T.coordinates,!0,_,x));break;case"Polygon":x=Math.min(x,iu(g,!0,T.coordinates,_,x))}if(x===0)return x}return x}(t,this.geometries);if(t.geometryType()==="Polygon")return function(r,o){const d=r.geometry();if(d.length===0||d[0].length===0)return NaN;const g=Jc(d,0).map(T=>T.map(P=>P.map(D=>Kc([D.x,D.y],r.canonical)))),_=new eu(g[0][0][0][1]);let x=1/0;for(const T of o)for(const P of g){switch(T.type){case"Point":x=Math.min(x,iu([T.coordinates],!1,P,_,x));break;case"LineString":x=Math.min(x,iu(T.coordinates,!0,P,_,x));break;case"Polygon":x=Math.min(x,ed(P,T.coordinates,_,x))}if(x===0)return x}return x}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Mo{constructor(t){this.type=Zt,this.key=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=t[1];return o==null?r.error("Global state property must be defined."):typeof o!="string"?r.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new Mo(o)}evaluate(t){var r;const o=(r=t.globals)===null||r===void 0?void 0:r.globalState;return o&&Object.keys(o).length!==0?ri(o,this.key):null}eachChild(){}outputDefined(){return!1}}const pr={"==":qu,"!=":Hd,">":Yd,"<":Xd,">=":Xc,"<=":Kd,array:Qn,at:Jn,boolean:Qn,case:Bn,coalesce:Ir,collator:Yc,format:gs,image:Zu,in:dl,"index-of":wo,interpolate:or,"interpolate-hcl":or,"interpolate-lab":or,length:cc,let:hl,literal:Sn,match:fl,number:Qn,"number-format":yl,object:Qn,slice:sc,step:ml,string:Qn,"to-boolean":ca,"to-color":ca,"to-number":ca,"to-string":ca,var:Ca,within:Us,distance:qs,"global-state":Mo};class Hr{constructor(t,r,o,d){this.name=t,this.type=r,this._evaluate=o,this.args=d}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){const o=t[0],d=Hr.definitions[o];if(!d)return r.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(d)?d[0]:d.type,_=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,x=_.filter(([P])=>!Array.isArray(P)||P.length===t.length-1);let T=null;for(const[P,D]of x){T=new Ns(r.registry,Eo,r.path,null,r.scope);const k=[];let N=!1;for(let V=1;V<t.length;V++){const q=t[V],$=Array.isArray(P)?P[V-1]:P.type,Q=T.parse(q,1+k.length,$);if(!Q){N=!0;break}k.push(Q)}if(!N)if(Array.isArray(P)&&P.length!==k.length)T.error(`Expected ${P.length} arguments, but found ${k.length} instead.`);else{for(let V=0;V<k.length;V++){const q=Array.isArray(P)?P[V]:P.type,$=k[V];T.concat(V+1).checkSubtype(q,$.type)}if(T.errors.length===0)return new Hr(o,g,D,k)}}if(x.length===1)r.errors.push(...T.errors);else{const P=(x.length?x:_).map(([k])=>{return N=k,Array.isArray(N)?`(${N.map(rn).join(", ")})`:`(${rn(N.type)}...)`;var N}).join(" | "),D=[];for(let k=1;k<t.length;k++){const N=r.parse(t[k],1+D.length);if(!N)return null;D.push(rn(N.type))}r.error(`Expected arguments of type ${P}, but found (${D.join(", ")}) instead.`)}return null}static register(t,r){Hr.definitions=r;for(const o in r)t[o]=Hr}}function Xr(a,[t,r,o,d]){t=t.evaluate(a),r=r.evaluate(a),o=o.evaluate(a);const g=d?d.evaluate(a):1,_=Xt(t,r,o,g);if(_)throw new ki(_);return new Kt(t/255,r/255,o/255,g,!1)}function Yr(a,t){return a in t}function Zs(a,t){const r=t[a];return r===void 0?null:r}function ys(a){return{type:a}}function Eo(a){if(a instanceof Ca)return Eo(a.boundExpression);if(a instanceof Hr&&a.name==="error"||a instanceof Yc||a instanceof Us||a instanceof qs||a instanceof Mo)return!1;const t=a instanceof ca||a instanceof Qn;let r=!0;return a.eachChild(o=>{r=t?r&&Eo(o):r&&o instanceof Sn}),!!r&&Co(a)&&Pa(a,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Co(a){if(a instanceof Hr&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Us||a instanceof qs)return!1;let t=!0;return a.eachChild(r=>{t&&!Co(r)&&(t=!1)}),t}function Ao(a){if(a instanceof Hr&&a.name==="feature-state")return!1;let t=!0;return a.eachChild(r=>{t&&!Ao(r)&&(t=!1)}),t}function Pa(a,t){if(a instanceof Hr&&t.indexOf(a.name)>=0)return!1;let r=!0;return a.eachChild(o=>{r&&!Pa(o,t)&&(r=!1)}),r}function eh(a){return{result:"success",value:a}}function vs(a){return{result:"error",value:a}}function Ra(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function th(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Sr(a){return!!a.expression&&a.expression.interpolated}function ti(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function Tr(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)&&Ft(a)===fr}function ih(a){return a}function _c(a,t){const r=a.stops&&typeof a.stops[0][0]=="object",o=r||!(r||a.property!==void 0),d=a.type||(Sr(t)?"exponential":"interval"),g=function(D){switch(D.type){case"color":return Kt.parse;case"padding":return on.parse;case"numberArray":return ln.parse;case"colorArray":return Ln.parse;default:return null}}(t);if(g&&((a=wn({},a)).stops&&(a.stops=a.stops.map(D=>[D[0],g(D[1])])),a.default=g(a.default?a.default:t.default)),a.colorSpace&&(_=a.colorSpace)!=="rgb"&&_!=="hcl"&&_!=="lab")throw new Error(`Unknown color space: "${a.colorSpace}"`);var _;const x=function(D){switch(D){case"exponential":return zo;case"interval":return rh;case"categorical":return nh;case"identity":return Po;default:throw new Error(`Unknown function type "${D}"`)}}(d);let T,P;if(d==="categorical"){T=Object.create(null);for(const D of a.stops)T[D[0]]=D[1];P=typeof a.stops[0][0]}if(r){const D={},k=[];for(let q=0;q<a.stops.length;q++){const $=a.stops[q],Q=$[0].zoom;D[Q]===void 0&&(D[Q]={zoom:Q,type:a.type,property:a.property,default:a.default,stops:[]},k.push(Q)),D[Q].stops.push([$[0].value,$[1]])}const N=[];for(const q of k)N.push([D[q].zoom,_c(D[q],t)]);const V={name:"linear"};return{kind:"composite",interpolationType:V,interpolationFactor:or.interpolationFactor.bind(void 0,V),zoomStops:N.map(q=>q[0]),evaluate:({zoom:q},$)=>zo({stops:N,base:a.base},t,q).evaluate(q,$)}}if(o){const D=d==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:or.interpolationFactor.bind(void 0,D),zoomStops:a.stops.map(k=>k[0]),evaluate:({zoom:k})=>x(a,t,k,T,P)}}return{kind:"source",evaluate(D,k){const N=k&&k.properties?k.properties[a.property]:void 0;return N===void 0?Da(a.default,t.default):x(a,t,N,T,P)}}}function Da(a,t,r){return a!==void 0?a:t!==void 0?t:r!==void 0?r:void 0}function nh(a,t,r,o,d){return Da(typeof r===d?o[r]:void 0,a.default,t.default)}function rh(a,t,r){if(ti(r)!=="number")return Da(a.default,t.default);const o=a.stops.length;if(o===1||r<=a.stops[0][0])return a.stops[0][1];if(r>=a.stops[o-1][0])return a.stops[o-1][1];const d=pl(a.stops.map(g=>g[0]),r);return a.stops[d][1]}function zo(a,t,r){const o=a.base!==void 0?a.base:1;if(ti(r)!=="number")return Da(a.default,t.default);const d=a.stops.length;if(d===1||r<=a.stops[0][0])return a.stops[0][1];if(r>=a.stops[d-1][0])return a.stops[d-1][1];const g=pl(a.stops.map(D=>D[0]),r),_=function(D,k,N,V){const q=V-N,$=D-N;return q===0?0:k===1?$/q:(Math.pow(k,$)-1)/(Math.pow(k,q)-1)}(r,o,a.stops[g][0],a.stops[g+1][0]),x=a.stops[g][1],T=a.stops[g+1][1],P=$r[t.type]||ih;return typeof x.evaluate=="function"?{evaluate(...D){const k=x.evaluate.apply(void 0,D),N=T.evaluate.apply(void 0,D);if(k!==void 0&&N!==void 0)return P(k,N,_,a.colorSpace)}}:P(x,T,_,a.colorSpace)}function Po(a,t,r){switch(t.type){case"color":r=Kt.parse(r);break;case"formatted":r=ar.fromString(r.toString());break;case"resolvedImage":r=sr.fromString(r.toString());break;case"padding":r=on.parse(r);break;case"colorArray":r=Ln.parse(r);break;case"numberArray":r=ln.parse(r);break;default:ti(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return Da(r,a.default,t.default)}Hr.register(pr,{error:[{kind:"error"},[qt],(a,[t])=>{throw new ki(t.evaluate(a))}],typeof:[qt,[Zt],(a,[t])=>rn(Ft(t.evaluate(a)))],"to-rgba":[wr(ht,4),[Rr],(a,[t])=>{const[r,o,d,g]=t.evaluate(a).rgb;return[255*r,255*o,255*d,g]}],rgb:[Rr,[ht,ht,ht],Xr],rgba:[Rr,[ht,ht,ht,ht],Xr],has:{type:Dt,overloads:[[[qt],(a,[t])=>Yr(t.evaluate(a),a.properties())],[[qt,fr],(a,[t,r])=>Yr(t.evaluate(a),r.evaluate(a))]]},get:{type:Zt,overloads:[[[qt],(a,[t])=>Zs(t.evaluate(a),a.properties())],[[qt,fr],(a,[t,r])=>Zs(t.evaluate(a),r.evaluate(a))]]},"feature-state":[Zt,[qt],(a,[t])=>Zs(t.evaluate(a),a.featureState||{})],properties:[fr,[],a=>a.properties()],"geometry-type":[qt,[],a=>a.geometryType()],id:[Zt,[],a=>a.id()],zoom:[ht,[],a=>a.globals.zoom],"heatmap-density":[ht,[],a=>a.globals.heatmapDensity||0],elevation:[ht,[],a=>a.globals.elevation||0],"line-progress":[ht,[],a=>a.globals.lineProgress||0],accumulated:[Zt,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[ht,ys(ht),(a,t)=>{let r=0;for(const o of t)r+=o.evaluate(a);return r}],"*":[ht,ys(ht),(a,t)=>{let r=1;for(const o of t)r*=o.evaluate(a);return r}],"-":{type:ht,overloads:[[[ht,ht],(a,[t,r])=>t.evaluate(a)-r.evaluate(a)],[[ht],(a,[t])=>-t.evaluate(a)]]},"/":[ht,[ht,ht],(a,[t,r])=>t.evaluate(a)/r.evaluate(a)],"%":[ht,[ht,ht],(a,[t,r])=>t.evaluate(a)%r.evaluate(a)],ln2:[ht,[],()=>Math.LN2],pi:[ht,[],()=>Math.PI],e:[ht,[],()=>Math.E],"^":[ht,[ht,ht],(a,[t,r])=>Math.pow(t.evaluate(a),r.evaluate(a))],sqrt:[ht,[ht],(a,[t])=>Math.sqrt(t.evaluate(a))],log10:[ht,[ht],(a,[t])=>Math.log(t.evaluate(a))/Math.LN10],ln:[ht,[ht],(a,[t])=>Math.log(t.evaluate(a))],log2:[ht,[ht],(a,[t])=>Math.log(t.evaluate(a))/Math.LN2],sin:[ht,[ht],(a,[t])=>Math.sin(t.evaluate(a))],cos:[ht,[ht],(a,[t])=>Math.cos(t.evaluate(a))],tan:[ht,[ht],(a,[t])=>Math.tan(t.evaluate(a))],asin:[ht,[ht],(a,[t])=>Math.asin(t.evaluate(a))],acos:[ht,[ht],(a,[t])=>Math.acos(t.evaluate(a))],atan:[ht,[ht],(a,[t])=>Math.atan(t.evaluate(a))],min:[ht,ys(ht),(a,t)=>Math.min(...t.map(r=>r.evaluate(a)))],max:[ht,ys(ht),(a,t)=>Math.max(...t.map(r=>r.evaluate(a)))],abs:[ht,[ht],(a,[t])=>Math.abs(t.evaluate(a))],round:[ht,[ht],(a,[t])=>{const r=t.evaluate(a);return r<0?-Math.round(-r):Math.round(r)}],floor:[ht,[ht],(a,[t])=>Math.floor(t.evaluate(a))],ceil:[ht,[ht],(a,[t])=>Math.ceil(t.evaluate(a))],"filter-==":[Dt,[qt,Zt],(a,[t,r])=>a.properties()[t.value]===r.value],"filter-id-==":[Dt,[Zt],(a,[t])=>a.id()===t.value],"filter-type-==":[Dt,[qt],(a,[t])=>a.geometryType()===t.value],"filter-<":[Dt,[qt,Zt],(a,[t,r])=>{const o=a.properties()[t.value],d=r.value;return typeof o==typeof d&&o<d}],"filter-id-<":[Dt,[Zt],(a,[t])=>{const r=a.id(),o=t.value;return typeof r==typeof o&&r<o}],"filter->":[Dt,[qt,Zt],(a,[t,r])=>{const o=a.properties()[t.value],d=r.value;return typeof o==typeof d&&o>d}],"filter-id->":[Dt,[Zt],(a,[t])=>{const r=a.id(),o=t.value;return typeof r==typeof o&&r>o}],"filter-<=":[Dt,[qt,Zt],(a,[t,r])=>{const o=a.properties()[t.value],d=r.value;return typeof o==typeof d&&o<=d}],"filter-id-<=":[Dt,[Zt],(a,[t])=>{const r=a.id(),o=t.value;return typeof r==typeof o&&r<=o}],"filter->=":[Dt,[qt,Zt],(a,[t,r])=>{const o=a.properties()[t.value],d=r.value;return typeof o==typeof d&&o>=d}],"filter-id->=":[Dt,[Zt],(a,[t])=>{const r=a.id(),o=t.value;return typeof r==typeof o&&r>=o}],"filter-has":[Dt,[Zt],(a,[t])=>t.value in a.properties()],"filter-has-id":[Dt,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Dt,[wr(qt)],(a,[t])=>t.value.indexOf(a.geometryType())>=0],"filter-id-in":[Dt,[wr(Zt)],(a,[t])=>t.value.indexOf(a.id())>=0],"filter-in-small":[Dt,[qt,wr(Zt)],(a,[t,r])=>r.value.indexOf(a.properties()[t.value])>=0],"filter-in-large":[Dt,[qt,wr(Zt)],(a,[t,r])=>function(o,d,g,_){for(;g<=_;){const x=g+_>>1;if(d[x]===o)return!0;d[x]>o?_=x-1:g=x+1}return!1}(a.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Dt,overloads:[[[Dt,Dt],(a,[t,r])=>t.evaluate(a)&&r.evaluate(a)],[ys(Dt),(a,t)=>{for(const r of t)if(!r.evaluate(a))return!1;return!0}]]},any:{type:Dt,overloads:[[[Dt,Dt],(a,[t,r])=>t.evaluate(a)||r.evaluate(a)],[ys(Dt),(a,t)=>{for(const r of t)if(r.evaluate(a))return!0;return!1}]]},"!":[Dt,[Dt],(a,[t])=>!t.evaluate(a)],"is-supported-script":[Dt,[qt],(a,[t])=>{const r=a.globals&&a.globals.isSupportedScript;return!r||r(t.evaluate(a))}],upcase:[qt,[qt],(a,[t])=>t.evaluate(a).toUpperCase()],downcase:[qt,[qt],(a,[t])=>t.evaluate(a).toLowerCase()],concat:[qt,ys(Zt),(a,t)=>t.map(r=>On(r.evaluate(a))).join("")],"resolved-locale":[qt,[hs],(a,[t])=>t.evaluate(a).resolvedLocale()]});class Ro{constructor(t,r){this.expression=t,this._warningHistory={},this._evaluator=new ul,this._defaultValue=r?function(o){if(o.type==="color"&&Tr(o.default))return new Kt(0,0,0,0);switch(o.type){case"color":return Kt.parse(o.default)||null;case"padding":return on.parse(o.default)||null;case"numberArray":return ln.parse(o.default)||null;case"colorArray":return Ln.parse(o.default)||null;case"variableAnchorOffsetCollection":return si.parse(o.default)||null;case"projectionDefinition":return $t.parse(o.default)||null;default:return o.default===void 0?null:o.default}}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,o,d,g,_){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=o,this._evaluator.canonical=d,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(t,r,o,d,g,_){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=o||null,this._evaluator.canonical=d,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_||null;try{const x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new ki(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function Do(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in pr}function Mr(a,t){const r=new Ns(pr,Eo,[],t?function(d){const g={color:Rr,string:qt,number:ht,enum:qt,boolean:Dt,formatted:Os,padding:yn,numberArray:Bs,colorArray:Jl,projectionDefinition:Ql,resolvedImage:oa,variableAnchorOffsetCollection:qr};return d.type==="array"?wr(g[d.value]||Zt,d.length):g[d.type]}(t):void 0),o=r.parse(a,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?eh(new Ro(o,t)):vs(r.errors)}class mr{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!Ao(r.expression),this.globalStateRefs=Io(r.expression)}evaluateWithoutErrorHandling(t,r,o,d,g,_){return this._styleExpression.evaluateWithoutErrorHandling(t,r,o,d,g,_)}evaluate(t,r,o,d,g,_){return this._styleExpression.evaluate(t,r,o,d,g,_)}}class Ha{constructor(t,r,o,d){this.kind=t,this.zoomStops=o,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!Ao(r.expression),this.globalStateRefs=Io(r.expression),this.interpolationType=d}evaluateWithoutErrorHandling(t,r,o,d,g,_){return this._styleExpression.evaluateWithoutErrorHandling(t,r,o,d,g,_)}evaluate(t,r,o,d,g,_){return this._styleExpression.evaluate(t,r,o,d,g,_)}interpolationFactor(t,r,o){return this.interpolationType?or.interpolationFactor(this.interpolationType,t,r,o):0}}function Ia(a,t){const r=Mr(a,t);if(r.result==="error")return r;const o=r.value.expression,d=Co(o);if(!d&&!Ra(t))return vs([new Yi("","data expressions not supported")]);const g=Pa(o,["zoom"]);if(!g&&!th(t))return vs([new Yi("","zoom expressions not supported")]);const _=ua(o);return _||g?_ instanceof Yi?vs([_]):_ instanceof or&&!Sr(t)?vs([new Yi("",'"interpolate" expressions cannot be used with this property')]):eh(_?new Ha(d?"camera":"composite",r.value,_.labels,_ instanceof or?_.interpolation:void 0):new mr(d?"constant":"source",r.value)):vs([new Yi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Kr{constructor(t,r){this._parameters=t,this._specification=r,wn(this,_c(this._parameters,this._specification))}static deserialize(t){return new Kr(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function ua(a){let t=null;if(a instanceof hl)t=ua(a.result);else if(a instanceof Ir){for(const r of a.args)if(t=ua(r),t)break}else(a instanceof ml||a instanceof or)&&a.input instanceof Hr&&a.input.name==="zoom"&&(t=a);return t instanceof Yi||a.eachChild(r=>{const o=ua(r);o instanceof Yi?t=o:!t&&o?t=new Yi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new Yi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Io(a,t=new Set){return a instanceof Mo&&t.add(a.key),a.eachChild(r=>{Io(r,t)}),t}function ko(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const t of a.slice(1))if(!ko(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const yc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function vn(a){if(a==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};ko(a)||(a=Xa(a));const t=Mr(a,yc);if(t.result==="error")throw new Error(t.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,o,d)=>t.value.evaluate(r,o,{},d),needGeometry:Si(a),getGlobalStateRefs:()=>Io(t.value.expression)}}function xn(a,t){return a<t?-1:a>t?1:0}function Si(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let t=1;t<a.length;t++)if(Si(a[t]))return!0;return!1}function Xa(a){if(!a)return!0;const t=a[0];return a.length<=1?t!=="any":t==="=="?ha(a[1],a[2],"=="):t==="!="?El(ha(a[1],a[2],"==")):t==="<"||t===">"||t==="<="||t===">="?ha(a[1],a[2],t):t==="any"?(r=a.slice(1),["any"].concat(r.map(Xa))):t==="all"?["all"].concat(a.slice(1).map(Xa)):t==="none"?["all"].concat(a.slice(1).map(Xa).map(El)):t==="in"?au(a[1],a.slice(2)):t==="!in"?El(au(a[1],a.slice(2))):t==="has"?$s(a[1]):t!=="!has"||El($s(a[1]));var r}function ha(a,t,r){switch(a){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,a,t]}}function au(a,t){if(t.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",a,["literal",t.sort(xn)]]:["filter-in-small",a,["literal",t]]}}function $s(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function El(a){return["!",a]}function vc(a){const t=typeof a;if(t==="number"||t==="boolean"||t==="string"||a==null)return JSON.stringify(a);if(Array.isArray(a)){let d="[";for(const g of a)d+=`${vc(g)},`;return`${d}]`}const r=Object.keys(a).sort();let o="{";for(let d=0;d<r.length;d++)o+=`${JSON.stringify(r[d])}:${vc(a[r[d]])},`;return`${o}}`}function Hs(a){let t="";for(const r of mt)t+=`/${vc(a[r])}`;return t}function Cl(a){const t=a.value;return t?[new ct(a.key,t,"constants have been deprecated as of v8")]:[]}function cn(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function da(a){if(Array.isArray(a))return a.map(da);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const t={};for(const r in a)t[r]=da(a[r]);return t}return cn(a)}function Lr(a){const t=a.key,r=a.value,o=a.valueSpec||{},d=a.objectElementValidators||{},g=a.style,_=a.styleSpec,x=a.validateSpec;let T=[];const P=ti(r);if(P!=="object")return[new ct(t,r,`object expected, ${P} found`)];for(const D in r){const k=D.split(".")[0],N=ri(o,k)||o["*"];let V;if(ri(d,k))V=d[k];else if(ri(o,k))V=x;else if(d["*"])V=d["*"];else{if(!o["*"]){T.push(new ct(t,r[D],`unknown property "${D}"`));continue}V=x}T=T.concat(V({key:(t&&`${t}.`)+D,value:r[D],valueSpec:N,style:g,styleSpec:_,object:r,objectKey:D,validateSpec:x},r))}for(const D in o)d[D]||o[D].required&&o[D].default===void 0&&r[D]===void 0&&T.push(new ct(t,r,`missing required property "${D}"`));return T}function Ya(a){const t=a.value,r=a.valueSpec,o=a.style,d=a.styleSpec,g=a.key,_=a.arrayElementValidator||a.validateSpec;if(ti(t)!=="array")return[new ct(g,t,`array expected, ${ti(t)} found`)];if(r.length&&t.length!==r.length)return[new ct(g,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new ct(g,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let x={type:r.value,values:r.values};d.$version<7&&(x.function=r.function),ti(r.value)==="object"&&(x=r.value);let T=[];for(let P=0;P<t.length;P++)T=T.concat(_({array:t,arrayIndex:P,value:t[P],valueSpec:x,validateSpec:a.validateSpec,style:o,styleSpec:d,key:`${g}[${P}]`}));return T}function Wr(a){const t=a.key,r=a.value,o=a.valueSpec;let d=ti(r);return d==="number"&&r!=r&&(d="NaN"),d!=="number"?[new ct(t,r,`number expected, ${d} found`)]:"minimum"in o&&r<o.minimum?[new ct(t,r,`${r} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&r>o.maximum?[new ct(t,r,`${r} is greater than the maximum value ${o.maximum}`)]:[]}function Qr(a){const t=a.valueSpec,r=cn(a.value.type);let o,d,g,_={};const x=r!=="categorical"&&a.value.property===void 0,T=!x,P=ti(a.value.stops)==="array"&&ti(a.value.stops[0])==="array"&&ti(a.value.stops[0][0])==="object",D=Lr({key:a.key,value:a.value,valueSpec:a.styleSpec.function,validateSpec:a.validateSpec,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(V){if(r==="identity")return[new ct(V.key,V.value,'identity function may not have a "stops" property')];let q=[];const $=V.value;return q=q.concat(Ya({key:V.key,value:$,valueSpec:V.valueSpec,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:k})),ti($)==="array"&&$.length===0&&q.push(new ct(V.key,$,"array must have at least one stop")),q},default:function(V){return V.validateSpec({key:V.key,value:V.value,valueSpec:t,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec})}}});return r==="identity"&&x&&D.push(new ct(a.key,a.value,'missing required property "property"')),r==="identity"||a.value.stops||D.push(new ct(a.key,a.value,'missing required property "stops"')),r==="exponential"&&a.valueSpec.expression&&!Sr(a.valueSpec)&&D.push(new ct(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(T&&!Ra(a.valueSpec)?D.push(new ct(a.key,a.value,"property functions not supported")):x&&!th(a.valueSpec)&&D.push(new ct(a.key,a.value,"zoom functions not supported"))),r!=="categorical"&&!P||a.value.property!==void 0||D.push(new ct(a.key,a.value,'"property" property is required')),D;function k(V){let q=[];const $=V.value,Q=V.key;if(ti($)!=="array")return[new ct(Q,$,`array expected, ${ti($)} found`)];if($.length!==2)return[new ct(Q,$,`array length 2 expected, length ${$.length} found`)];if(P){if(ti($[0])!=="object")return[new ct(Q,$,`object expected, ${ti($[0])} found`)];if($[0].zoom===void 0)return[new ct(Q,$,"object stop key must have zoom")];if($[0].value===void 0)return[new ct(Q,$,"object stop key must have value")];if(g&&g>cn($[0].zoom))return[new ct(Q,$[0].zoom,"stop zoom values must appear in ascending order")];cn($[0].zoom)!==g&&(g=cn($[0].zoom),d=void 0,_={}),q=q.concat(Lr({key:`${Q}[0]`,value:$[0],valueSpec:{zoom:{}},validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:Wr,value:N}}))}else q=q.concat(N({key:`${Q}[0]`,value:$[0],validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec},$));return Do(da($[1]))?q.concat([new ct(`${Q}[1]`,$[1],"expressions are not allowed in function stops.")]):q.concat(V.validateSpec({key:`${Q}[1]`,value:$[1],valueSpec:t,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec}))}function N(V,q){const $=ti(V.value),Q=cn(V.value),ae=V.value!==null?V.value:q;if(o){if($!==o)return[new ct(V.key,ae,`${$} stop domain type must match previous stop domain type ${o}`)]}else o=$;if($!=="number"&&$!=="string"&&$!=="boolean")return[new ct(V.key,ae,"stop domain value must be a number, string, or boolean")];if($!=="number"&&r!=="categorical"){let ve=`number expected, ${$} found`;return Ra(t)&&r===void 0&&(ve+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ct(V.key,ae,ve)]}return r!=="categorical"||$!=="number"||isFinite(Q)&&Math.floor(Q)===Q?r!=="categorical"&&$==="number"&&d!==void 0&&Q<d?[new ct(V.key,ae,"stop domain values must appear in ascending order")]:(d=Q,r==="categorical"&&Q in _?[new ct(V.key,ae,"stop domain values must be unique")]:(_[Q]=!0,[])):[new ct(V.key,ae,`integer expected, found ${Q}`)]}}function Or(a){const t=(a.expressionContext==="property"?Ia:Mr)(da(a.value),a.valueSpec);if(t.result==="error")return t.value.map(o=>new ct(`${a.key}${o.key}`,a.value,o.message));const r=t.value.expression||t.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!r.outputDefined())return[new ct(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!Ao(r))return[new ct(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!Ao(r))return[new ct(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!Pa(r,["zoom","feature-state"]))return[new ct(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!Co(r))return[new ct(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function xc(a){const t=a.key,r=a.value,o=ti(r);return o!=="string"?[new ct(t,r,`color expected, ${o} found`)]:Kt.parse(String(r))?[]:[new ct(t,r,`color expected, "${r}" found`)]}function Lo(a){const t=a.key,r=a.value,o=a.valueSpec,d=[];return Array.isArray(o.values)?o.values.indexOf(cn(r))===-1&&d.push(new ct(t,r,`expected one of [${o.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(o.values).indexOf(cn(r))===-1&&d.push(new ct(t,r,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(r)} found`)),d}function Oo(a){return ko(da(a.value))?Or(wn({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):bc(a)}function bc(a){const t=a.value,r=a.key;if(ti(t)!=="array")return[new ct(r,t,`array expected, ${ti(t)} found`)];const o=a.styleSpec;let d,g=[];if(t.length<1)return[new ct(r,t,"filter array must have at least 1 element")];switch(g=g.concat(Lo({key:`${r}[0]`,value:t[0],valueSpec:o.filter_operator,style:a.style,styleSpec:a.styleSpec})),cn(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&cn(t[1])==="$type"&&g.push(new ct(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&g.push(new ct(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(d=ti(t[1]),d!=="string"&&g.push(new ct(`${r}[1]`,t[1],`string expected, ${d} found`)));for(let _=2;_<t.length;_++)d=ti(t[_]),cn(t[1])==="$type"?g=g.concat(Lo({key:`${r}[${_}]`,value:t[_],valueSpec:o.geometry_type,style:a.style,styleSpec:a.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&g.push(new ct(`${r}[${_}]`,t[_],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let _=1;_<t.length;_++)g=g.concat(bc({key:`${r}[${_}]`,value:t[_],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":d=ti(t[1]),t.length!==2?g.push(new ct(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):d!=="string"&&g.push(new ct(`${r}[1]`,t[1],`string expected, ${d} found`))}return g}function Xs(a,t){const r=a.key,o=a.validateSpec,d=a.style,g=a.styleSpec,_=a.value,x=a.objectKey,T=g[`${t}_${a.layerType}`];if(!T)return[];const P=x.match(/^(.*)-transition$/);if(t==="paint"&&P&&T[P[1]]&&T[P[1]].transition)return o({key:r,value:_,valueSpec:g.transition,style:d,styleSpec:g});const D=a.valueSpec||T[x];if(!D)return[new ct(r,_,`unknown property "${x}"`)];let k;if(ti(_)==="string"&&Ra(D)&&!D.tokens&&(k=/^{([^}]+)}$/.exec(_)))return[new ct(r,_,`"${x}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(k[1])} }\`.`)];const N=[];return a.layerType==="symbol"&&(x==="text-field"&&d&&!d.glyphs&&N.push(new ct(r,_,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&Tr(da(_))&&cn(_.type)==="identity"&&N.push(new ct(r,_,'"text-font" does not support identity functions'))),N.concat(o({key:a.key,value:_,valueSpec:D,style:d,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:x}))}function Tn(a){return Xs(a,"paint")}function xs(a){return Xs(a,"layout")}function Er(a){let t=[];const r=a.value,o=a.key,d=a.style,g=a.styleSpec;if(ti(r)!=="object")return[new ct(o,r,`object expected, ${ti(r)} found`)];r.type||r.ref||t.push(new ct(o,r,'either "type" or "ref" is required'));let _=cn(r.type);const x=cn(r.ref);if(r.id){const T=cn(r.id);for(let P=0;P<a.arrayIndex;P++){const D=d.layers[P];cn(D.id)===T&&t.push(new ct(o,r.id,`duplicate layer id "${r.id}", previously used at line ${D.id.__line__}`))}}if("ref"in r){let T;["type","source","source-layer","filter","layout"].forEach(P=>{P in r&&t.push(new ct(o,r[P],`"${P}" is prohibited for ref layers`))}),d.layers.forEach(P=>{cn(P.id)===x&&(T=P)}),T?T.ref?t.push(new ct(o,r.ref,"ref cannot reference another ref layer")):_=cn(T.type):t.push(new ct(o,r.ref,`ref layer "${x}" not found`))}else if(_!=="background")if(r.source){const T=d.sources&&d.sources[r.source],P=T&&cn(T.type);T?P==="vector"&&_==="raster"?t.push(new ct(o,r.source,`layer "${r.id}" requires a raster source`)):P!=="raster-dem"&&_==="hillshade"||P!=="raster-dem"&&_==="color-relief"?t.push(new ct(o,r.source,`layer "${r.id}" requires a raster-dem source`)):P==="raster"&&_!=="raster"?t.push(new ct(o,r.source,`layer "${r.id}" requires a vector source`)):P!=="vector"||r["source-layer"]?P==="raster-dem"&&_!=="hillshade"&&_!=="color-relief"?t.push(new ct(o,r.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):_!=="line"||!r.paint||!r.paint["line-gradient"]||P==="geojson"&&T.lineMetrics||t.push(new ct(o,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ct(o,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new ct(o,r.source,`source "${r.source}" not found`))}else t.push(new ct(o,r,'missing required property "source"'));return t=t.concat(Lr({key:o,value:r,valueSpec:g.layer,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,objectElementValidators:{"*":()=>[],type:()=>a.validateSpec({key:`${o}.type`,value:r.type,valueSpec:g.layer.type,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,object:r,objectKey:"type"}),filter:Oo,layout:T=>Lr({layer:r,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":P=>xs(wn({layerType:_},P))}}),paint:T=>Lr({layer:r,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":P=>Tn(wn({layerType:_},P))}})}})),t}function ka(a){const t=a.value,r=a.key,o=ti(t);return o!=="string"?[new ct(r,t,`string expected, ${o} found`)]:[]}const ah={promoteId:function({key:a,value:t}){if(ti(t)==="string")return ka({key:a,value:t});{const r=[];for(const o in t)r.push(...ka({key:`${a}.${o}`,value:t[o]}));return r}}};function td(a){const t=a.value,r=a.key,o=a.styleSpec,d=a.style,g=a.validateSpec;if(!t.type)return[new ct(r,t,'"type" is required')];const _=cn(t.type);let x;switch(_){case"vector":case"raster":return x=Lr({key:r,value:t,valueSpec:o[`source_${_.replace("-","_")}`],style:a.style,styleSpec:o,objectElementValidators:ah,validateSpec:g}),x;case"raster-dem":return x=function(T){var P;const D=(P=T.sourceName)!==null&&P!==void 0?P:"",k=T.value,N=T.styleSpec,V=N.source_raster_dem,q=T.style;let $=[];const Q=ti(k);if(k===void 0)return $;if(Q!=="object")return $.push(new ct("source_raster_dem",k,`object expected, ${Q} found`)),$;const ae=cn(k.encoding)==="custom",ve=["redFactor","greenFactor","blueFactor","baseShift"],he=T.value.encoding?`"${T.value.encoding}"`:"Default";for(const U in k)!ae&&ve.includes(U)?$.push(new ct(U,k[U],`In "${D}": "${U}" is only valid when "encoding" is set to "custom". ${he} encoding found`)):V[U]?$=$.concat(T.validateSpec({key:U,value:k[U],valueSpec:V[U],validateSpec:T.validateSpec,style:q,styleSpec:N})):$.push(new ct(U,k[U],`unknown property "${U}"`));return $}({sourceName:r,value:t,style:a.style,styleSpec:o,validateSpec:g}),x;case"geojson":if(x=Lr({key:r,value:t,valueSpec:o.source_geojson,style:d,styleSpec:o,validateSpec:g,objectElementValidators:ah}),t.cluster)for(const T in t.clusterProperties){const[P,D]=t.clusterProperties[T],k=typeof P=="string"?[P,["accumulated"],["get",T]]:P;x.push(...Or({key:`${r}.${T}.map`,value:D,expressionContext:"cluster-map"})),x.push(...Or({key:`${r}.${T}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return x;case"video":return Lr({key:r,value:t,valueSpec:o.source_video,style:d,validateSpec:g,styleSpec:o});case"image":return Lr({key:r,value:t,valueSpec:o.source_image,style:d,validateSpec:g,styleSpec:o});case"canvas":return[new ct(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Lo({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Fn(a){const t=a.value,r=a.styleSpec,o=r.light,d=a.style;let g=[];const _=ti(t);if(t===void 0)return g;if(_!=="object")return g=g.concat([new ct("light",t,`object expected, ${_} found`)]),g;for(const x in t){const T=x.match(/^(.*)-transition$/);g=g.concat(T&&o[T[1]]&&o[T[1]].transition?a.validateSpec({key:x,value:t[x],valueSpec:r.transition,validateSpec:a.validateSpec,style:d,styleSpec:r}):o[x]?a.validateSpec({key:x,value:t[x],valueSpec:o[x],validateSpec:a.validateSpec,style:d,styleSpec:r}):[new ct(x,t[x],`unknown property "${x}"`)])}return g}function Ys(a){const t=a.value,r=a.styleSpec,o=r.sky,d=a.style,g=ti(t);if(t===void 0)return[];if(g!=="object")return[new ct("sky",t,`object expected, ${g} found`)];let _=[];for(const x in t)_=_.concat(o[x]?a.validateSpec({key:x,value:t[x],valueSpec:o[x],style:d,styleSpec:r}):[new ct(x,t[x],`unknown property "${x}"`)]);return _}function Bo(a){const t=a.value,r=a.styleSpec,o=r.terrain,d=a.style;let g=[];const _=ti(t);if(t===void 0)return g;if(_!=="object")return g=g.concat([new ct("terrain",t,`object expected, ${_} found`)]),g;for(const x in t)g=g.concat(o[x]?a.validateSpec({key:x,value:t[x],valueSpec:o[x],validateSpec:a.validateSpec,style:d,styleSpec:r}):[new ct(x,t[x],`unknown property "${x}"`)]);return g}function Ks(a){let t=[];const r=a.value,o=a.key;if(Array.isArray(r)){const d=[],g=[];for(const _ in r)r[_].id&&d.includes(r[_].id)&&t.push(new ct(o,r,`all the sprites' ids must be unique, but ${r[_].id} is duplicated`)),d.push(r[_].id),r[_].url&&g.includes(r[_].url)&&t.push(new ct(o,r,`all the sprites' URLs must be unique, but ${r[_].url} is duplicated`)),g.push(r[_].url),t=t.concat(Lr({key:`${o}[${_}]`,value:r[_],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:a.validateSpec}));return t}return ka({key:o,value:r})}function su(a){return t=a.value,t&&t.constructor===Object?[]:[new ct(a.key,a.value,`object expected, ${ti(a.value)} found`)];var t}const bs={"*":()=>[],array:Ya,boolean:function(a){const t=a.value,r=a.key,o=ti(t);return o!=="boolean"?[new ct(r,t,`boolean expected, ${o} found`)]:[]},number:Wr,color:xc,constants:Cl,enum:Lo,filter:Oo,function:Qr,layer:Er,object:Lr,source:td,light:Fn,sky:Ys,terrain:Bo,projection:function(a){const t=a.value,r=a.styleSpec,o=r.projection,d=a.style,g=ti(t);if(t===void 0)return[];if(g!=="object")return[new ct("projection",t,`object expected, ${g} found`)];let _=[];for(const x in t)_=_.concat(o[x]?a.validateSpec({key:x,value:t[x],valueSpec:o[x],style:d,styleSpec:r}):[new ct(x,t[x],`unknown property "${x}"`)]);return _},projectionDefinition:function(a){const t=a.key;let r=a.value;r=r instanceof String?r.valueOf():r;const o=ti(r);return o!=="array"||function(d){return Array.isArray(d)&&d.length===3&&typeof d[0]=="string"&&typeof d[1]=="string"&&typeof d[2]=="number"}(r)||function(d){return!!["interpolate","step","literal"].includes(d[0])}(r)?["array","string"].includes(o)?[]:[new ct(t,r,`projection expected, invalid type "${o}" found`)]:[new ct(t,r,`projection expected, invalid array ${JSON.stringify(r)} found`)]},string:ka,formatted:function(a){return ka(a).length===0?[]:Or(a)},resolvedImage:function(a){return ka(a).length===0?[]:Or(a)},padding:function(a){const t=a.key,r=a.value;if(ti(r)==="array"){if(r.length<1||r.length>4)return[new ct(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];const o={type:"number"};let d=[];for(let g=0;g<r.length;g++)d=d.concat(a.validateSpec({key:`${t}[${g}]`,value:r[g],validateSpec:a.validateSpec,valueSpec:o}));return d}return Wr({key:t,value:r,valueSpec:{}})},numberArray:function(a){const t=a.key,r=a.value;if(ti(r)==="array"){const o={type:"number"};if(r.length<1)return[new ct(t,r,"array length at least 1 expected, length 0 found")];let d=[];for(let g=0;g<r.length;g++)d=d.concat(a.validateSpec({key:`${t}[${g}]`,value:r[g],validateSpec:a.validateSpec,valueSpec:o}));return d}return Wr({key:t,value:r,valueSpec:{}})},colorArray:function(a){const t=a.key,r=a.value;if(ti(r)==="array"){if(r.length<1)return[new ct(t,r,"array length at least 1 expected, length 0 found")];let o=[];for(let d=0;d<r.length;d++)o=o.concat(xc({key:`${t}[${d}]`,value:r[d]}));return o}return xc({key:t,value:r})},variableAnchorOffsetCollection:function(a){const t=a.key,r=a.value,o=ti(r),d=a.styleSpec;if(o!=="array"||r.length<1||r.length%2!=0)return[new ct(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let g=[];for(let _=0;_<r.length;_+=2)g=g.concat(Lo({key:`${t}[${_}]`,value:r[_],valueSpec:d.layout_symbol["text-anchor"]})),g=g.concat(Ya({key:`${t}[${_+1}]`,value:r[_+1],valueSpec:{length:2,value:"number"},validateSpec:a.validateSpec,style:a.style,styleSpec:d}));return g},sprite:Ks,state:su};function ws(a){const t=a.value,r=a.valueSpec,o=a.styleSpec;return a.validateSpec=ws,r.expression&&Tr(cn(t))?Qr(a):r.expression&&Do(da(t))?Or(a):r.type&&bs[r.type]?bs[r.type](a):Lr(wn({},a,{valueSpec:r.type?o[r.type]:r}))}function Al(a){const t=a.value,r=a.key,o=ka(a);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new ct(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new ct(r,t,'"glyphs" url must include a "{range}" token'))),o}function Jr(a,t=_e){let r=[];return r=r.concat(ws({key:"",value:a,valueSpec:t.$root,styleSpec:t,style:a,validateSpec:ws,objectElementValidators:{glyphs:Al,"*":()=>[]}})),a.constants&&(r=r.concat(Cl({key:"constants",value:a.constants}))),sh(r)}function La(a){return function(t){return a({...t,validateSpec:ws})}}function sh(a){return[].concat(a).sort((t,r)=>t.line-r.line)}function Mn(a){return function(...t){return sh(a.apply(this,t))}}Jr.source=Mn(La(td)),Jr.sprite=Mn(La(Ks)),Jr.glyphs=Mn(La(Al)),Jr.light=Mn(La(Fn)),Jr.sky=Mn(La(Ys)),Jr.terrain=Mn(La(Bo)),Jr.state=Mn(La(su)),Jr.layer=Mn(La(Er)),Jr.filter=Mn(La(Oo)),Jr.paintProperty=Mn(La(Tn)),Jr.layoutProperty=Mn(La(xs));const Ws=Jr,ou=Ws.light,wc=Ws.sky,Sc=Ws.paintProperty,lu=Ws.layoutProperty;function Qs(a,t){let r=!1;if(t&&t.length)for(const o of t)a.fire(new ze(new Error(o.message))),r=!0;return r}class Js{constructor(t,r,o){const d=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const _=new Int32Array(this.arrayBuffer);t=_[0],this.d=(r=_[1])+2*(o=_[2]);for(let T=0;T<this.d*this.d;T++){const P=_[3+T],D=_[3+T+1];d.push(P===D?null:_.subarray(P,D))}const x=_[3+d.length+1];this.keys=_.subarray(_[3+d.length],x),this.bboxes=_.subarray(x),this.insert=this._insertReadonly}else{this.d=r+2*o;for(let _=0;_<this.d*this.d;_++)d.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=o,this.scale=r/t,this.uid=0;const g=o/r*t;this.min=-g,this.max=t+g}insert(t,r,o,d,g){this._forEachCell(r,o,d,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(d),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,o,d,g,_){this.cells[g].push(_)}query(t,r,o,d,g){const _=this.min,x=this.max;if(t<=_&&r<=_&&x<=o&&x<=d&&!g)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(t,r,o,d,this._queryCell,T,{},g),T}}_queryCell(t,r,o,d,g,_,x,T){const P=this.cells[g];if(P!==null){const D=this.keys,k=this.bboxes;for(let N=0;N<P.length;N++){const V=P[N];if(x[V]===void 0){const q=4*V;(T?T(k[q+0],k[q+1],k[q+2],k[q+3]):t<=k[q+2]&&r<=k[q+3]&&o>=k[q+0]&&d>=k[q+1])?(x[V]=!0,_.push(D[V])):x[V]=!1}}}}_forEachCell(t,r,o,d,g,_,x,T){const P=this._convertToCellCoord(t),D=this._convertToCellCoord(r),k=this._convertToCellCoord(o),N=this._convertToCellCoord(d);for(let V=P;V<=k;V++)for(let q=D;q<=N;q++){const $=this.d*q+V;if((!T||T(this._convertFromCellCoord(V),this._convertFromCellCoord(q),this._convertFromCellCoord(V+1),this._convertFromCellCoord(q+1)))&&g.call(this,t,r,o,d,$,_,x,T))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,r=3+this.cells.length+1+1;let o=0;for(let _=0;_<this.cells.length;_++)o+=this.cells[_].length;const d=new Int32Array(r+o+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;let g=r;for(let _=0;_<t.length;_++){const x=t[_];d[3+_]=g,d.set(x,g),g+=x.length}return d[3+t.length]=g,d.set(this.keys,g),g+=this.keys.length,d[3+t.length+1]=g,d.set(this.bboxes,g),g+=this.bboxes.length,d.buffer}static serialize(t,r){const o=t.toArrayBuffer();return r&&r.push(o),{buffer:o}}static deserialize(t){return new Js(t.buffer)}}const Oa={};function _t(a,t,r={}){if(Oa[a])throw new Error(`${a} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:a,writeable:!1}),Oa[a]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}_t("Object",Object),_t("Set",Set),_t("TransferableGridIndex",Js),_t("Color",Kt),_t("Error",Error),_t("AJAXError",ce),_t("ResolvedImage",sr),_t("StylePropertyFunction",Kr),_t("StyleExpression",Ro,{omit:["_evaluator"]}),_t("ZoomDependentExpression",Ha),_t("ZoomConstantExpression",mr),_t("CompoundExpression",Hr,{omit:["_evaluate"]});for(const a in pr)pr[a]._classRegistryKey||_t(`Expression_${a}`,pr[a]);function cu(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Ss(a){return a.$name||a.constructor._classRegistryKey}function uu(a){return!function(t){if(t===null||typeof t!="object")return!1;const r=Ss(t);return!(!r||r==="Object")}(a)&&(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||a instanceof Error||cu(a)||Sa(a)||ArrayBuffer.isView(a)||a instanceof ImageData)}function zl(a,t){if(uu(a))return(cu(a)||Sa(a))&&t&&t.push(a),ArrayBuffer.isView(a)&&t&&t.push(a.buffer),a instanceof ImageData&&t&&t.push(a.data.buffer),a;if(Array.isArray(a)){const g=[];for(const _ of a)g.push(zl(_,t));return g}if(typeof a!="object")throw new Error("can't serialize object of type "+typeof a);const r=Ss(a);if(!r)throw new Error(`can't serialize object of unregistered class ${a.constructor.name}`);if(!Oa[r])throw new Error(`${r} is not registered.`);const{klass:o}=Oa[r],d=o.serialize?o.serialize(a,t):{};if(o.serialize){if(t&&d===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const g in a){if(!a.hasOwnProperty(g)||Oa[r].omit.indexOf(g)>=0)continue;const _=a[g];d[g]=Oa[r].shallow.indexOf(g)>=0?_:zl(_,t)}a instanceof Error&&(d.message=a.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(d.$name=r),d}function ea(a){if(uu(a))return a;if(Array.isArray(a))return a.map(ea);if(typeof a!="object")throw new Error("can't deserialize object of type "+typeof a);const t=Ss(a)||"Object";if(!Oa[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:r}=Oa[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(a);const o=Object.create(r.prototype);for(const d of Object.keys(a)){if(d==="$name")continue;const g=a[d];o[d]=Oa[t].shallow.indexOf(d)>=0?g:ea(g)}return o}class Tc{constructor(){this.first=!0}update(t,r){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}const ii={"Latin-1 Supplement":a=>a>=128&&a<=255,"Hangul Jamo":a=>a>=4352&&a<=4607,Khmer:a=>a>=6016&&a<=6143,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Kanbun:a=>a>=12688&&a<=12703,"CJK Strokes":a=>a>=12736&&a<=12783,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Hangul Syllables":a=>a>=44032&&a<=55215,"Private Use Area":a=>a>=57344&&a<=63743,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function Ka(a){for(const t of a)if(to(t.charCodeAt(0)))return!0;return!1}function Ts(a){for(const t of a)if(!lh(t.charCodeAt(0)))return!1;return!0}function eo(a){const t=a.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(t.join("|"),"u")}const oh=eo(["Arab","Dupl","Mong","Ougr","Syrc"]);function lh(a){return!oh.test(String.fromCodePoint(a))}const Fo=eo(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function to(a){return!(a!==746&&a!==747&&(a<4352||!(ii["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||ii["CJK Compatibility"](a)||ii["CJK Strokes"](a)||!(!ii["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||ii["Enclosed CJK Letters and Months"](a)||ii["Ideographic Description Characters"](a)||ii.Kanbun(a)||ii.Katakana(a)&&a!==12540||!(!ii["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!ii["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||ii["Vertical Forms"](a)||ii["Yijing Hexagram Symbols"](a)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(a))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(a))||Fo.test(String.fromCodePoint(a)))))}function hu(a){return!(to(a)||function(t){return!!(ii["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||ii["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||ii["Letterlike Symbols"](t)||ii["Number Forms"](t)||ii["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||ii["Control Pictures"](t)&&t!==9251||ii["Optical Character Recognition"](t)||ii["Enclosed Alphanumerics"](t)||ii["Geometric Shapes"](t)||ii["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||ii["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||ii["CJK Symbols and Punctuation"](t)||ii.Katakana(t)||ii["Private Use Area"](t)||ii["CJK Compatibility Forms"](t)||ii["Small Form Variants"](t)||ii["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(a))}const ch=eo(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Wa(a){return ch.test(String.fromCodePoint(a))}function du(a,t){return!(!t&&Wa(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||ii.Khmer(a))}function fu(a){for(const t of a)if(Wa(t.charCodeAt(0)))return!0;return!1}const Qa=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(a){this.pluginStatus=a.pluginStatus,this.pluginURL=a.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(a){if(Qa.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=a.applyArabicShaping,this.processBidirectionalText=a.processBidirectionalText,this.processStyledBidirectionalText=a.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(a,t){return c(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(a.pluginStatus!=="loading")return this.setState(a),a;const r=a.pluginURL,o=new Promise(g=>{this.loadScriptResolve=g});t(r);const d=new Promise(g=>setTimeout(()=>g(),this.TIMEOUT));if(yield Promise.race([o,d]),this.isParsed()){const g={pluginStatus:"loaded",pluginURL:r};return this.setState(g),g}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${r}`)})}};class Ni{constructor(t,r){this.zoom=t,r?(this.now=r.now||0,this.fadeDuration=r.fadeDuration||0,this.zoomHistory=r.zoomHistory||new Tc,this.transition=r.transition||{},this.globalState=r.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Tc,this.transition={},this.globalState={})}isSupportedScript(t){return function(r,o){for(const d of r)if(!du(d.charCodeAt(0),o))return!1;return!0}(t,Qa.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,r=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*r}}}class fa{constructor(t,r){this.property=t,this.value=r,this.expression=function(o,d){if(Tr(o))return new Kr(o,d);if(Do(o)){const g=Ia(o,d);if(g.result==="error")throw new Error(g.value.map(_=>`${_.key}: ${_.message}`).join(", "));return g.value}{let g=o;return d.type==="color"&&typeof o=="string"?g=Kt.parse(o):d.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?d.type!=="numberArray"||typeof o!="number"&&!Array.isArray(o)?d.type!=="colorArray"||typeof o!="string"&&!Array.isArray(o)?d.type==="variableAnchorOffsetCollection"&&Array.isArray(o)?g=si.parse(o):d.type==="projectionDefinition"&&typeof o=="string"&&(g=$t.parse(o)):g=Ln.parse(o):g=ln.parse(o):g=on.parse(o),{globalStateRefs:new Set,kind:"constant",evaluate:()=>g}}}(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,r,o){return this.property.possiblyEvaluate(this,t,r,o)}}class ni{constructor(t){this.property=t,this.value=new fa(t,void 0)}transitioned(t,r){return new En(this.property,this.value,r,dr({},t.transition,this.transition),t.now)}untransitioned(){return new En(this.property,this.value,null,{},0)}}class Ci{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return aa(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new ni(this._values[t].property)),this._values[t].value=new fa(this._values[t].property,r===null?void 0:aa(r))}getTransition(t){return aa(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new ni(this._values[t].property)),this._values[t].transition=aa(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(t[r]=o);const d=this.getTransition(r);d!==void 0&&(t[`${r}-transition`]=d)}return t}transitioned(t,r){const o=new Mc(this._properties);for(const d of Object.keys(this._values))o._values[d]=this._values[d].transitioned(t,r._values[d]);return o}untransitioned(){const t=new Mc(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class En{constructor(t,r,o,d,g){this.property=t,this.value=r,this.begin=g+d.delay||0,this.end=this.begin+d.duration||0,t.specification.transition&&(d.delay||d.duration)&&(this.prior=o)}possiblyEvaluate(t,r,o){const d=t.now||0,g=this.value.possiblyEvaluate(t,r,o),_=this.prior;if(_){if(d>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(d<this.begin)return _.possiblyEvaluate(t,r,o);{const x=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(t,r,o),g,Vt(x))}}return g}}class Mc{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,o){const d=new No(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].possiblyEvaluate(t,r,o);return d}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Pl{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return aa(this._values[t].value)}setValue(t,r){this._values[t]=new fa(this._values[t].property,r===null?void 0:aa(r))}serialize(){const t={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(t[r]=o)}return t}possiblyEvaluate(t,r,o){const d=new No(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].possiblyEvaluate(t,r,o);return d}}class gr{constructor(t,r,o){this.property=t,this.value=r,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,o,d){return this.property.evaluate(this.value,this.parameters,t,r,o,d)}}class No{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class xt{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,o){const d=$r[this.specification.type];return d?d(t,r,o):t}}class zt{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,o,d){return new gr(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},o,d)}:t.expression,r)}interpolate(t,r,o){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new gr(this,{kind:"constant",value:void 0},t.parameters);const d=$r[this.specification.type];if(d){const g=d(t.value.value,r.value.value,o);return new gr(this,{kind:"constant",value:g},t.parameters)}return t}evaluate(t,r,o,d,g,_){return t.kind==="constant"?t.value:t.evaluate(r,o,d,g,_)}}class pu extends zt{possiblyEvaluate(t,r,o,d){if(t.value===void 0)return new gr(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){const g=t.expression.evaluate(r,null,{},o,d),_=t.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,x=this._calculate(_,_,_,r);return new gr(this,{kind:"constant",value:x},r)}if(t.expression.kind==="camera"){const g=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new gr(this,{kind:"constant",value:g},r)}return new gr(this,t.expression,r)}evaluate(t,r,o,d,g,_){if(t.kind==="source"){const x=t.evaluate(r,o,d,g,_);return this._calculate(x,x,x,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},o,d),t.evaluate({zoom:Math.floor(r.zoom)},o,d),t.evaluate({zoom:Math.floor(r.zoom)+1},o,d),r):t.value}_calculate(t,r,o,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:o,to:r}}interpolate(t){return t}}class dn{constructor(t){this.specification=t}possiblyEvaluate(t,r,o,d){if(t.value!==void 0){if(t.expression.kind==="constant"){const g=t.expression.evaluate(r,null,{},o,d);return this._calculate(g,g,g,r)}return this._calculate(t.expression.evaluate(new Ni(Math.floor(r.zoom-1),r)),t.expression.evaluate(new Ni(Math.floor(r.zoom),r)),t.expression.evaluate(new Ni(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,o,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:o,to:r}}interpolate(t){return t}}class jo{constructor(t){this.specification=t}possiblyEvaluate(t,r,o,d){return!!t.expression.evaluate(r,null,{},o,d)}interpolate(){return!1}}class lr{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in t){const o=t[r];o.specification.overridable&&this.overridableProperties.push(r);const d=this.defaultPropertyValues[r]=new fa(o,void 0),g=this.defaultTransitionablePropertyValues[r]=new ni(o);this.defaultTransitioningPropertyValues[r]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=d.possiblyEvaluate({})}}}_t("DataDrivenProperty",zt),_t("DataConstantProperty",xt),_t("CrossFadedDataDrivenProperty",pu),_t("CrossFadedProperty",dn),_t("ColorRampProperty",jo);const uh="-transition";class er extends Xe{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=vn(t.filter)),r.layout&&(this._unevaluatedLayout=new Pl(r.layout)),r.paint)){this._transitionablePaint=new Ci(r.paint);for(const o in t.paint)this.setPaintProperty(o,t.paint[o],{validate:!1});for(const o in t.layout)this.setLayoutProperty(o,t.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new No(r.paint)}}setFilter(t){this.filter=t,this._featureFilter=vn(t)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){const t=new Set;if(this._unevaluatedLayout)for(const r in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[r];for(const d of o.getGlobalStateRefs())t.add(d)}for(const r of this._featureFilter.getGlobalStateRefs())t.add(r);return t}setLayoutProperty(t,r,o={}){r!=null&&this._validate(lu,`layers.${this.id}.layout.${t}`,t,r,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(uh)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,o={}){if(r!=null&&this._validate(Sc,`layers.${this.id}.paint.${t}`,t,r,o))return!1;if(t.endsWith(uh))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{const d=this._transitionablePaint._values[t],g=d.property.specification["property-type"]==="cross-faded-data-driven",_=d.value.isDataDriven(),x=d.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);const T=this._transitionablePaint._values[t].value;return T.isDataDriven()||_||g||this._handleOverridablePaintPropertyUpdate(t,x,T)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,o){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),ra(t,(r,o)=>!(r===void 0||o==="layout"&&!Object.keys(r).length||o==="paint"&&!Object.keys(r).length))}_validate(t,r,o,d,g={}){return(!g||g.validate!==!1)&&Qs(this,t.call(Ws,{key:r,layerType:this.type,objectKey:o,value:d,styleSpec:_e,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof gr&&Ra(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const id={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ms{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ki{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function an(a,t=1){let r=0,o=0;return{members:a.map(d=>{const g=id[d.type].BYTES_PER_ELEMENT,_=r=Cr(r,Math.max(t,g)),x=d.components||1;return o=Math.max(o,g),r+=g*x,{name:d.name,type:d.type,components:x,offset:_}}),size:Cr(r,Math.max(o,t)),alignment:t}}function Cr(a,t){return Math.ceil(a/t)*t}class ji extends Ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,r)}emplace(t,r,o){const d=2*t;return this.int16[d+0]=r,this.int16[d+1]=o,t}}ji.prototype.bytesPerElement=4,_t("StructArrayLayout2i4",ji);class Ja extends Ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,o)}emplace(t,r,o,d){const g=3*t;return this.int16[g+0]=r,this.int16[g+1]=o,this.int16[g+2]=d,t}}Ja.prototype.bytesPerElement=6,_t("StructArrayLayout3i6",Ja);class Uo extends Ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,d){const g=this.length;return this.resize(g+1),this.emplace(g,t,r,o,d)}emplace(t,r,o,d,g){const _=4*t;return this.int16[_+0]=r,this.int16[_+1]=o,this.int16[_+2]=d,this.int16[_+3]=g,t}}Uo.prototype.bytesPerElement=8,_t("StructArrayLayout4i8",Uo);class Vo extends Ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,d,g,_){const x=this.length;return this.resize(x+1),this.emplace(x,t,r,o,d,g,_)}emplace(t,r,o,d,g,_,x){const T=6*t;return this.int16[T+0]=r,this.int16[T+1]=o,this.int16[T+2]=d,this.int16[T+3]=g,this.int16[T+4]=_,this.int16[T+5]=x,t}}Vo.prototype.bytesPerElement=12,_t("StructArrayLayout2i4i12",Vo);class Es extends Ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,d,g,_){const x=this.length;return this.resize(x+1),this.emplace(x,t,r,o,d,g,_)}emplace(t,r,o,d,g,_,x){const T=4*t,P=8*t;return this.int16[T+0]=r,this.int16[T+1]=o,this.uint8[P+4]=d,this.uint8[P+5]=g,this.uint8[P+6]=_,this.uint8[P+7]=x,t}}Es.prototype.bytesPerElement=8,_t("StructArrayLayout2i4ub8",Es);class ta extends Ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,r)}emplace(t,r,o){const d=2*t;return this.float32[d+0]=r,this.float32[d+1]=o,t}}ta.prototype.bytesPerElement=8,_t("StructArrayLayout2f8",ta);class Rl extends Ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o,d,g,_,x,T,P,D){const k=this.length;return this.resize(k+1),this.emplace(k,t,r,o,d,g,_,x,T,P,D)}emplace(t,r,o,d,g,_,x,T,P,D,k){const N=10*t;return this.uint16[N+0]=r,this.uint16[N+1]=o,this.uint16[N+2]=d,this.uint16[N+3]=g,this.uint16[N+4]=_,this.uint16[N+5]=x,this.uint16[N+6]=T,this.uint16[N+7]=P,this.uint16[N+8]=D,this.uint16[N+9]=k,t}}Rl.prototype.bytesPerElement=20,_t("StructArrayLayout10ui20",Rl);class Dl extends Ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o,d,g,_,x,T,P,D,k,N){const V=this.length;return this.resize(V+1),this.emplace(V,t,r,o,d,g,_,x,T,P,D,k,N)}emplace(t,r,o,d,g,_,x,T,P,D,k,N,V){const q=12*t;return this.int16[q+0]=r,this.int16[q+1]=o,this.int16[q+2]=d,this.int16[q+3]=g,this.uint16[q+4]=_,this.uint16[q+5]=x,this.uint16[q+6]=T,this.uint16[q+7]=P,this.int16[q+8]=D,this.int16[q+9]=k,this.int16[q+10]=N,this.int16[q+11]=V,t}}Dl.prototype.bytesPerElement=24,_t("StructArrayLayout4i4ui4i24",Dl);class Ec extends Ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,o)}emplace(t,r,o,d){const g=3*t;return this.float32[g+0]=r,this.float32[g+1]=o,this.float32[g+2]=d,t}}Ec.prototype.bytesPerElement=12,_t("StructArrayLayout3f12",Ec);class f extends Ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}f.prototype.bytesPerElement=4,_t("StructArrayLayout1ul4",f);class e extends Ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o,d,g,_,x,T,P){const D=this.length;return this.resize(D+1),this.emplace(D,t,r,o,d,g,_,x,T,P)}emplace(t,r,o,d,g,_,x,T,P,D){const k=10*t,N=5*t;return this.int16[k+0]=r,this.int16[k+1]=o,this.int16[k+2]=d,this.int16[k+3]=g,this.int16[k+4]=_,this.int16[k+5]=x,this.uint32[N+3]=T,this.uint16[k+8]=P,this.uint16[k+9]=D,t}}e.prototype.bytesPerElement=20,_t("StructArrayLayout6i1ul2ui20",e);class n extends Ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,d,g,_){const x=this.length;return this.resize(x+1),this.emplace(x,t,r,o,d,g,_)}emplace(t,r,o,d,g,_,x){const T=6*t;return this.int16[T+0]=r,this.int16[T+1]=o,this.int16[T+2]=d,this.int16[T+3]=g,this.int16[T+4]=_,this.int16[T+5]=x,t}}n.prototype.bytesPerElement=12,_t("StructArrayLayout2i2i2i12",n);class l extends Ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,d,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,o,d,g)}emplace(t,r,o,d,g,_){const x=4*t,T=8*t;return this.float32[x+0]=r,this.float32[x+1]=o,this.float32[x+2]=d,this.int16[T+6]=g,this.int16[T+7]=_,t}}l.prototype.bytesPerElement=16,_t("StructArrayLayout2f1f2i16",l);class h extends Ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,d,g,_){const x=this.length;return this.resize(x+1),this.emplace(x,t,r,o,d,g,_)}emplace(t,r,o,d,g,_,x){const T=16*t,P=4*t,D=8*t;return this.uint8[T+0]=r,this.uint8[T+1]=o,this.float32[P+1]=d,this.float32[P+2]=g,this.int16[D+6]=_,this.int16[D+7]=x,t}}h.prototype.bytesPerElement=16,_t("StructArrayLayout2ub2f2i16",h);class m extends Ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,o)}emplace(t,r,o,d){const g=3*t;return this.uint16[g+0]=r,this.uint16[g+1]=o,this.uint16[g+2]=d,t}}m.prototype.bytesPerElement=6,_t("StructArrayLayout3ui6",m);class y extends Ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o,d,g,_,x,T,P,D,k,N,V,q,$,Q,ae){const ve=this.length;return this.resize(ve+1),this.emplace(ve,t,r,o,d,g,_,x,T,P,D,k,N,V,q,$,Q,ae)}emplace(t,r,o,d,g,_,x,T,P,D,k,N,V,q,$,Q,ae,ve){const he=24*t,U=12*t,W=48*t;return this.int16[he+0]=r,this.int16[he+1]=o,this.uint16[he+2]=d,this.uint16[he+3]=g,this.uint32[U+2]=_,this.uint32[U+3]=x,this.uint32[U+4]=T,this.uint16[he+10]=P,this.uint16[he+11]=D,this.uint16[he+12]=k,this.float32[U+7]=N,this.float32[U+8]=V,this.uint8[W+36]=q,this.uint8[W+37]=$,this.uint8[W+38]=Q,this.uint32[U+10]=ae,this.int16[he+22]=ve,t}}y.prototype.bytesPerElement=48,_t("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",y);class S extends Ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o,d,g,_,x,T,P,D,k,N,V,q,$,Q,ae,ve,he,U,W,fe,Ie,Je,Ne,qe,st,nt){const ot=this.length;return this.resize(ot+1),this.emplace(ot,t,r,o,d,g,_,x,T,P,D,k,N,V,q,$,Q,ae,ve,he,U,W,fe,Ie,Je,Ne,qe,st,nt)}emplace(t,r,o,d,g,_,x,T,P,D,k,N,V,q,$,Q,ae,ve,he,U,W,fe,Ie,Je,Ne,qe,st,nt,ot){const $e=32*t,St=16*t;return this.int16[$e+0]=r,this.int16[$e+1]=o,this.int16[$e+2]=d,this.int16[$e+3]=g,this.int16[$e+4]=_,this.int16[$e+5]=x,this.int16[$e+6]=T,this.int16[$e+7]=P,this.uint16[$e+8]=D,this.uint16[$e+9]=k,this.uint16[$e+10]=N,this.uint16[$e+11]=V,this.uint16[$e+12]=q,this.uint16[$e+13]=$,this.uint16[$e+14]=Q,this.uint16[$e+15]=ae,this.uint16[$e+16]=ve,this.uint16[$e+17]=he,this.uint16[$e+18]=U,this.uint16[$e+19]=W,this.uint16[$e+20]=fe,this.uint16[$e+21]=Ie,this.uint16[$e+22]=Je,this.uint32[St+12]=Ne,this.float32[St+13]=qe,this.float32[St+14]=st,this.uint16[$e+30]=nt,this.uint16[$e+31]=ot,t}}S.prototype.bytesPerElement=64,_t("StructArrayLayout8i15ui1ul2f2ui64",S);class M extends Ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}M.prototype.bytesPerElement=4,_t("StructArrayLayout1f4",M);class R extends Ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,o)}emplace(t,r,o,d){const g=3*t;return this.uint16[6*t+0]=r,this.float32[g+1]=o,this.float32[g+2]=d,t}}R.prototype.bytesPerElement=12,_t("StructArrayLayout1ui2f12",R);class I extends Ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,o)}emplace(t,r,o,d){const g=4*t;return this.uint32[2*t+0]=r,this.uint16[g+2]=o,this.uint16[g+3]=d,t}}I.prototype.bytesPerElement=8,_t("StructArrayLayout1ul2ui8",I);class B extends Ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,r)}emplace(t,r,o){const d=2*t;return this.uint16[d+0]=r,this.uint16[d+1]=o,t}}B.prototype.bytesPerElement=4,_t("StructArrayLayout2ui4",B);class O extends Ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}O.prototype.bytesPerElement=2,_t("StructArrayLayout1ui2",O);class j extends Ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o,d){const g=this.length;return this.resize(g+1),this.emplace(g,t,r,o,d)}emplace(t,r,o,d,g){const _=4*t;return this.float32[_+0]=r,this.float32[_+1]=o,this.float32[_+2]=d,this.float32[_+3]=g,t}}j.prototype.bytesPerElement=16,_t("StructArrayLayout4f16",j);class Z extends Ms{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Ee(this.anchorPointX,this.anchorPointY)}}Z.prototype.size=20;class ie extends e{get(t){return new Z(this,t)}}_t("CollisionBoxArray",ie);class te extends Ms{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}te.prototype.size=48;class ne extends y{get(t){return new te(this,t)}}_t("PlacedSymbolArray",ne);class se extends Ms{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}se.prototype.size=64;class ue extends S{get(t){return new se(this,t)}}_t("SymbolInstanceArray",ue);class oe extends M{getoffsetX(t){return this.float32[1*t+0]}}_t("GlyphOffsetArray",oe);class pe extends Ja{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}_t("SymbolLineVertexArray",pe);class ge extends Ms{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ge.prototype.size=12;class le extends R{get(t){return new ge(this,t)}}_t("TextAnchorOffsetArray",le);class we extends Ms{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}we.prototype.size=8;class Oe extends I{get(t){return new we(this,t)}}_t("FeatureIndexArray",Oe);class Re extends ji{}class De extends ji{}class Be extends ji{}class dt extends Vo{}class ut extends Es{}class it extends ta{}class wt extends Rl{}class Wt extends Dl{}class gi extends Ec{}class sn extends f{}class Ai extends n{}class un extends h{}class zi extends m{}class Pi extends B{}const Ii=an([{name:"a_pos",components:2,type:"Int16"}],4),{members:Gn}=Ii;class hi{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,r,o,d){const g=this.segments[this.segments.length-1];return t>hi.MAX_VERTEX_ARRAY_LENGTH&&Xi(`Max vertices per segment is ${hi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${hi.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!g||g.vertexLength+t>hi.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==d?this.createNewSegment(r,o,d):g}createNewSegment(t,r,o){const d={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(d.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(d),d}getOrCreateLatestSegment(t,r,o){return this.prepareSegment(0,t,r,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,o,d){return new hi([{vertexOffset:t,primitiveOffset:r,vertexLength:o,primitiveLength:d,vaos:{},sortKey:0}])}}function qn(a,t){return 256*(a=Hi(Math.floor(a),0,255))+Hi(Math.floor(t),0,255)}hi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,_t("SegmentVector",hi);const cr=an([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var io,Cs,pa,ma={exports:{}},no={exports:{}},Il={exports:{}},Go=function(){if(pa)return ma.exports;pa=1;var a=(io||(io=1,no.exports=function(r,o){var d,g,_,x,T,P,D,k;for(g=r.length-(d=3&r.length),_=o,T=3432918353,P=461845907,k=0;k<g;)D=255&r.charCodeAt(k)|(255&r.charCodeAt(++k))<<8|(255&r.charCodeAt(++k))<<16|(255&r.charCodeAt(++k))<<24,++k,_=27492+(65535&(x=5*(65535&(_=(_^=D=(65535&(D=(D=(65535&D)*T+(((D>>>16)*T&65535)<<16)&4294967295)<<15|D>>>17))*P+(((D>>>16)*P&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(D=0,d){case 3:D^=(255&r.charCodeAt(k+2))<<16;case 2:D^=(255&r.charCodeAt(k+1))<<8;case 1:_^=D=(65535&(D=(D=(65535&(D^=255&r.charCodeAt(k)))*T+(((D>>>16)*T&65535)<<16)&4294967295)<<15|D>>>17))*P+(((D>>>16)*P&65535)<<16)&4294967295}return _^=r.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),no.exports),t=(Cs||(Cs=1,Il.exports=function(r,o){for(var d,g=r.length,_=o^g,x=0;g>=4;)d=1540483477*(65535&(d=255&r.charCodeAt(x)|(255&r.charCodeAt(++x))<<8|(255&r.charCodeAt(++x))<<16|(255&r.charCodeAt(++x))<<24))+((1540483477*(d>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),g-=4,++x;switch(g){case 3:_^=(255&r.charCodeAt(x+2))<<16;case 2:_^=(255&r.charCodeAt(x+1))<<8;case 1:_=1540483477*(65535&(_^=255&r.charCodeAt(x)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),Il.exports);return ma.exports=a,ma.exports.murmur3=a,ma.exports.murmur2=t,ma.exports}(),ur=J(Go);class ga{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,o,d){this.ids.push(As(t)),this.positions.push(r,o,d)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=As(t);let o=0,d=this.ids.length-1;for(;o<d;){const _=o+d>>1;this.ids[_]>=r?d=_:o=_+1}const g=[];for(;this.ids[o]===r;)g.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return g}static serialize(t,r){const o=new Float64Array(t.ids),d=new Uint32Array(t.positions);return qo(o,d,0,o.length-1),r&&r.push(o.buffer,d.buffer),{ids:o,positions:d}}static deserialize(t){const r=new ga;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function As(a){const t=+a;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:ur(String(a))}function qo(a,t,r,o){for(;r<o;){const d=a[r+o>>1];let g=r-1,_=o+1;for(;;){do g++;while(a[g]<d);do _--;while(a[_]>d);if(g>=_)break;Ui(a,g,_),Ui(t,3*g,3*_),Ui(t,3*g+1,3*_+1),Ui(t,3*g+2,3*_+2)}_-r<o-_?(qo(a,t,r,_),r=_+1):(qo(a,t,_+1,o),o=_)}}function Ui(a,t,r){const o=a[t];a[t]=a[r],a[r]=o}_t("FeaturePositionMap",ga);class Ri{constructor(t,r){this.gl=t.gl,this.location=r}}class tr extends Ri{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class fn extends Ri{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Cc extends Ri{constructor(t,r){super(t,r),this.current=Kt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const nd=new Float32Array(16);function mu(a){return[qn(255*a.r,255*a.g),qn(255*a.b,255*a.a)]}class es{constructor(t,r,o){this.value=t,this.uniformNames=r.map(d=>`u_${d}`),this.type=o}setUniform(t,r,o){t.set(o.constantOr(this.value))}getBinding(t,r,o){return this.type==="color"?new Cc(t,r):new tr(t,r)}}class Zo{constructor(t,r){this.uniformNames=r.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,o,d){const g=d==="u_pattern_to"?this.patternTo:d==="u_pattern_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&t.set(g)}getBinding(t,r,o){return o.substr(0,9)==="u_pattern"?new fn(t,r):new tr(t,r)}}class Nn{constructor(t,r,o,d){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=r.map(g=>({name:`a_${g}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(t,r,o,d,g){const _=this.paintVertexArray.length,x=this.expression.evaluate(new Ni(0),r,{},d,[],g);this.paintVertexArray.resize(t),this._setPaintValue(_,t,x)}updatePaintArray(t,r,o,d){const g=this.expression.evaluate({zoom:0},o,d);this._setPaintValue(t,r,g)}_setPaintValue(t,r,o){if(this.type==="color"){const d=mu(o);for(let g=t;g<r;g++)this.paintVertexArray.emplace(g,d[0],d[1])}else{for(let d=t;d<r;d++)this.paintVertexArray.emplace(d,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Wi{constructor(t,r,o,d,g,_){this.expression=t,this.uniformNames=r.map(x=>`u_${x}_t`),this.type=o,this.useIntegerZoom=d,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=r.map(x=>({name:`a_${x}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(t,r,o,d,g){const _=this.expression.evaluate(new Ni(this.zoom),r,{},d,[],g),x=this.expression.evaluate(new Ni(this.zoom+1),r,{},d,[],g),T=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(T,t,_,x)}updatePaintArray(t,r,o,d){const g=this.expression.evaluate({zoom:this.zoom},o,d),_=this.expression.evaluate({zoom:this.zoom+1},o,d);this._setPaintValue(t,r,g,_)}_setPaintValue(t,r,o,d){if(this.type==="color"){const g=mu(o),_=mu(d);for(let x=t;x<r;x++)this.paintVertexArray.emplace(x,g[0],g[1],_[0],_[1])}else{for(let g=t;g<r;g++)this.paintVertexArray.emplace(g,o,d);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(d))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){const o=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,d=Hi(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(d)}getBinding(t,r,o){return new tr(t,r)}}class _r{constructor(t,r,o,d,g,_){this.expression=t,this.type=r,this.useIntegerZoom=o,this.zoom=d,this.layerId=_,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(t,r,o){const d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(d,t,r.patterns&&r.patterns[this.layerId],o)}updatePaintArray(t,r,o,d,g){this._setPaintValues(t,r,o.patterns&&o.patterns[this.layerId],g)}_setPaintValues(t,r,o,d){if(!d||!o)return;const{min:g,mid:_,max:x}=o,T=d[g],P=d[_],D=d[x];if(T&&P&&D)for(let k=t;k<r;k++)this.zoomInPaintVertexArray.emplace(k,P.tl[0],P.tl[1],P.br[0],P.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],P.pixelRatio,T.pixelRatio),this.zoomOutPaintVertexArray.emplace(k,P.tl[0],P.tl[1],P.br[0],P.br[1],D.tl[0],D.tl[1],D.br[0],D.br[1],P.pixelRatio,D.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,cr.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,cr.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class gu{constructor(t,r,o){this.binders={},this._buffers=[];const d=[];for(const g in t.paint._values){if(!o(g))continue;const _=t.paint.get(g);if(!(_ instanceof gr&&Ra(_.property.specification)))continue;const x=Ba(g,t.type),T=_.value,P=_.property.specification.type,D=_.property.useIntegerZoom,k=_.property.specification["property-type"],N=k==="cross-faded"||k==="cross-faded-data-driven";if(T.kind==="constant")this.binders[g]=N?new Zo(T.value,x):new es(T.value,x,P),d.push(`/u_${g}`);else if(T.kind==="source"||N){const V=Cn(g,P,"source");this.binders[g]=N?new _r(T,P,D,r,V,t.id):new Nn(T,x,P,V),d.push(`/a_${g}`)}else{const V=Cn(g,P,"composite");this.binders[g]=new Wi(T,x,P,D,r,V),d.push(`/z_${g}`)}}this.cacheKey=d.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof Nn||r instanceof Wi?r.maxValue:0}populatePaintArrays(t,r,o,d,g){for(const _ in this.binders){const x=this.binders[_];(x instanceof Nn||x instanceof Wi||x instanceof _r)&&x.populatePaintArray(t,r,o,d,g)}}setConstantPatternPositions(t,r){for(const o in this.binders){const d=this.binders[o];d instanceof Zo&&d.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,o,d,g){let _=!1;for(const x in t){const T=r.getPositions(x);for(const P of T){const D=o.feature(P.index);for(const k in this.binders){const N=this.binders[k];if((N instanceof Nn||N instanceof Wi||N instanceof _r)&&N.expression.isStateDependent===!0){const V=d.paint.get(k);N.expression=V.value,N.updatePaintArray(P.start,P.end,D,t[x],g),_=!0}}}}return _}defines(){const t=[];for(const r in this.binders){const o=this.binders[r];(o instanceof es||o instanceof Zo)&&t.push(...o.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof Nn||o instanceof Wi)for(let d=0;d<o.paintVertexAttributes.length;d++)t.push(o.paintVertexAttributes[d].name);else if(o instanceof _r)for(let d=0;d<cr.members.length;d++)t.push(cr.members[d].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof es||o instanceof Zo||o instanceof Wi)for(const d of o.uniformNames)t.push(d)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){const o=[];for(const d in this.binders){const g=this.binders[d];if(g instanceof es||g instanceof Zo||g instanceof Wi){for(const _ of g.uniformNames)if(r[_]){const x=g.getBinding(t,r[_],_);o.push({name:_,property:d,binding:x})}}}return o}setUniforms(t,r,o,d){for(const{name:g,property:_,binding:x}of r)this.binders[_].setUniform(x,d,o.get(_),g)}updatePaintBuffers(t){this._buffers=[];for(const r in this.binders){const o=this.binders[r];if(t&&o instanceof _r){const d=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(o instanceof Nn||o instanceof Wi)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const r in this.binders){const o=this.binders[r];(o instanceof Nn||o instanceof Wi||o instanceof _r)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof Nn||r instanceof Wi||r instanceof _r)&&r.destroy()}}}class Ar{constructor(t,r,o=()=>!0){this.programConfigurations={};for(const d of t)this.programConfigurations[d.id]=new gu(d,r,o);this.needsUpload=!1,this._featureMap=new ga,this._bufferOffset=0}populatePaintArrays(t,r,o,d,g,_){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(t,r,d,g,_);r.id!==void 0&&this._featureMap.add(r.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,o,d){for(const g of o)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,r,g,d)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Ba(a,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(`${t}-`,"").replace(/-/g,"_")]}function Cn(a,t,r){const o={color:{source:ta,composite:j},number:{source:M,composite:ta}},d=function(g){return{"line-pattern":{source:wt,composite:wt},"fill-pattern":{source:wt,composite:wt},"fill-extrusion-pattern":{source:wt,composite:wt}}[g]}(a);return d&&d[r]||o[t][r]}_t("ConstantBinder",es),_t("CrossFadedConstantBinder",Zo),_t("SourceExpressionBinder",Nn),_t("CrossFadedCompositeBinder",_r),_t("CompositeExpressionBinder",Wi),_t("ProgramConfiguration",gu,{omit:["_buffers"]}),_t("ProgramConfigurationSet",Ar);const ro=Math.pow(2,14)-1,rd=-ro-1;function $o(a){const t=lt/a.extent,r=a.loadGeometry();for(let o=0;o<r.length;o++){const d=r[o];for(let g=0;g<d.length;g++){const _=d[g],x=Math.round(_.x*t),T=Math.round(_.y*t);_.x=Hi(x,rd,ro),_.y=Hi(T,rd,ro),(x<_.x||x>_.x+1||T<_.y||T>_.y+1)&&Xi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function kl(a,t){return{type:a.type,id:a.id,properties:a.properties,geometry:t?$o(a):[]}}const Jd=-32768;function Ac(a,t,r,o,d){a.emplaceBack(Jd+8*t+o,Jd+8*r+d)}class _u{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new De,this.indexArray=new zi,this.segments=new hi,this.programConfigurations=new Ar(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,o){const d=this.layers[0],g=[];let _=null,x=!1,T=d.type==="heatmap";if(d.type==="circle"){const D=d;_=D.layout.get("circle-sort-key"),x=!_.isConstant(),T=T||D.paint.get("circle-pitch-alignment")==="map"}const P=T?r.subdivisionGranularity.circle:1;for(const{feature:D,id:k,index:N,sourceLayerIndex:V}of t){const q=this.layers[0]._featureFilter.needGeometry,$=kl(D,q);if(!this.layers[0]._featureFilter.filter(new Ni(this.zoom,{globalState:this.globalState}),$,o))continue;const Q=x?_.evaluate($,{},o):void 0,ae={id:k,properties:D.properties,type:D.type,sourceLayerIndex:V,index:N,geometry:q?$.geometry:$o(D),patterns:{},sortKey:Q};g.push(ae)}x&&g.sort((D,k)=>D.sortKey-k.sortKey);for(const D of g){const{geometry:k,index:N,sourceLayerIndex:V}=D,q=t[N].feature;this.addFeature(D,k,N,o,P),r.featureIndex.insert(q,k,N,V,this.index)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Gn),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,o,d,g=1){let _;switch(g){case 1:_=[0,7];break;case 3:_=[0,2,5,7];break;case 5:_=[0,1,3,4,6,7];break;case 7:_=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${g}; valid values are 1, 3, 5, 7.`)}const x=_.length;for(const T of r)for(const P of T){const D=P.x,k=P.y;if(D<0||D>=lt||k<0||k>=lt)continue;const N=this.segments.prepareSegment(x*x,this.layoutVertexArray,this.indexArray,t.sortKey),V=N.vertexLength;for(let q=0;q<x;q++)for(let $=0;$<x;$++)Ac(this.layoutVertexArray,D,k,_[$],_[q]);for(let q=0;q<x-1;q++)for(let $=0;$<x-1;$++){const Q=V+q*x+$,ae=V+(q+1)*x+$;this.indexArray.emplaceBack(Q,ae+1,Q+1),this.indexArray.emplaceBack(Q,ae,ae+1)}N.vertexLength+=x*x,N.primitiveLength+=(x-1)*(x-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{},d)}}function ef(a,t){for(let r=0;r<a.length;r++)if(zc(t,a[r]))return!0;for(let r=0;r<t.length;r++)if(zc(a,t[r]))return!0;return!!sd(a,t)}function Ep(a,t,r){return!!zc(a,t)||!!od(t,a,r)}function tf(a,t){if(a.length===1)return Cp(t,a[0]);for(let r=0;r<t.length;r++){const o=t[r];for(let d=0;d<o.length;d++)if(zc(a,o[d]))return!0}for(let r=0;r<a.length;r++)if(Cp(t,a[r]))return!0;for(let r=0;r<t.length;r++)if(sd(a,t[r]))return!0;return!1}function ad(a,t,r){if(a.length>1){if(sd(a,t))return!0;for(let o=0;o<t.length;o++)if(od(t[o],a,r))return!0}for(let o=0;o<a.length;o++)if(od(a[o],t,r))return!0;return!1}function sd(a,t){if(a.length===0||t.length===0)return!1;for(let r=0;r<a.length-1;r++){const o=a[r],d=a[r+1];for(let g=0;g<t.length-1;g++)if(nf(o,d,t[g],t[g+1]))return!0}return!1}function nf(a,t,r,o){return Ur(a,r,o)!==Ur(t,r,o)&&Ur(a,t,r)!==Ur(a,t,o)}function od(a,t,r){const o=r*r;if(t.length===1)return a.distSqr(t[0])<o;for(let d=1;d<t.length;d++)if(rf(a,t[d-1],t[d])<o)return!0;return!1}function rf(a,t,r){const o=t.distSqr(r);if(o===0)return a.distSqr(t);const d=((a.x-t.x)*(r.x-t.x)+(a.y-t.y)*(r.y-t.y))/o;return a.distSqr(d<0?t:d>1?r:r.sub(t)._mult(d)._add(t))}function Cp(a,t){let r,o,d,g=!1;for(let _=0;_<a.length;_++){r=a[_];for(let x=0,T=r.length-1;x<r.length;T=x++)o=r[x],d=r[T],o.y>t.y!=d.y>t.y&&t.x<(d.x-o.x)*(t.y-o.y)/(d.y-o.y)+o.x&&(g=!g)}return g}function zc(a,t){let r=!1;for(let o=0,d=a.length-1;o<a.length;d=o++){const g=a[o],_=a[d];g.y>t.y!=_.y>t.y&&t.x<(_.x-g.x)*(t.y-g.y)/(_.y-g.y)+g.x&&(r=!r)}return r}function yr(a,t,r){const o=r[0],d=r[2];if(a.x<o.x&&t.x<o.x||a.x>d.x&&t.x>d.x||a.y<o.y&&t.y<o.y||a.y>d.y&&t.y>d.y)return!1;const g=Ur(a,t,r[0]);return g!==Ur(a,t,r[1])||g!==Ur(a,t,r[2])||g!==Ur(a,t,r[3])}function Zn(a,t,r){const o=t.paint.get(a).value;return o.kind==="constant"?o.value:r.programConfigurations.get(t.id).getMaxValue(a)}function hh(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function dh(a,t,r,o,d){if(!t[0]&&!t[1])return a;const g=Ee.convert(t)._mult(d);r==="viewport"&&g._rotate(-o);const _=[];for(let x=0;x<a.length;x++)_.push(a[x].sub(g));return _}let af,sf;_t("CircleBucket",_u,{omit:["layers"]});var Ap={get paint(){return sf=sf||new lr({"circle-radius":new zt(_e.paint_circle["circle-radius"]),"circle-color":new zt(_e.paint_circle["circle-color"]),"circle-blur":new zt(_e.paint_circle["circle-blur"]),"circle-opacity":new zt(_e.paint_circle["circle-opacity"]),"circle-translate":new xt(_e.paint_circle["circle-translate"]),"circle-translate-anchor":new xt(_e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new xt(_e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new xt(_e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new zt(_e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new zt(_e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new zt(_e.paint_circle["circle-stroke-opacity"])})},get layout(){return af=af||new lr({"circle-sort-key":new zt(_e.layout_circle["circle-sort-key"])})}};class ld extends er{constructor(t){super(t,Ap)}createBucket(t){return new _u(t)}queryRadius(t){const r=t;return Zn("circle-radius",this,r)+Zn("circle-stroke-width",this,r)+hh(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:o,geometry:d,transform:g,pixelsToTileUnits:_,unwrappedTileID:x,getElevation:T}){const P=dh(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-g.bearingInRadians,_),D=this.paint.get("circle-radius").evaluate(r,o)+this.paint.get("circle-stroke-width").evaluate(r,o),k=this.paint.get("circle-pitch-alignment")==="map",N=k?P:function(q,$,Q,ae){return q.map(ve=>cd(ve,$,Q,ae))}(P,g,x,T),V=k?D*_:D;for(const q of d)for(const $ of q){const Q=k?$:cd($,g,x,T);let ae=V;const ve=g.projectTileCoordinates($.x,$.y,x,T).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ae*=ve/g.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ae*=g.cameraToCenterDistance/ve),Ep(N,Q,ae))return!0}return!1}}function cd(a,t,r,o){const d=t.projectTileCoordinates(a.x,a.y,r,o).point;return new Ee((.5*d.x+.5)*t.width,(.5*-d.y+.5)*t.height)}class of extends _u{}let lf;_t("HeatmapBucket",of,{omit:["layers"]});var zp={get paint(){return lf=lf||new lr({"heatmap-radius":new zt(_e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new zt(_e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new xt(_e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new jo(_e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new xt(_e.paint_heatmap["heatmap-opacity"])})}};function fh(a,{width:t,height:r},o,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==t*r*o)throw new RangeError(`mismatched image size. expected: ${d.length} but got: ${t*r*o}`)}else d=new Uint8Array(t*r*o);return a.width=t,a.height=r,a.data=d,a}function ud(a,{width:t,height:r},o){if(t===a.width&&r===a.height)return;const d=fh({},{width:t,height:r},o);ph(a,d,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,t),height:Math.min(a.height,r)},o),a.width=t,a.height=r,a.data=d.data}function ph(a,t,r,o,d,g){if(d.width===0||d.height===0)return t;if(d.width>a.width||d.height>a.height||r.x>a.width-d.width||r.y>a.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>t.width||d.height>t.height||o.x>t.width-d.width||o.y>t.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const _=a.data,x=t.data;if(_===x)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<d.height;T++){const P=((r.y+T)*a.width+r.x)*g,D=((o.y+T)*t.width+o.x)*g;for(let k=0;k<d.width*g;k++)x[D+k]=_[P+k]}return t}class yu{constructor(t,r){fh(this,t,1,r)}resize(t){ud(this,t,1)}clone(){return new yu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,o,d,g){ph(t,r,o,d,g,1)}}class zr{constructor(t,r){fh(this,t,4,r)}resize(t){ud(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new zr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,o,d,g){ph(t,r,o,d,g,4)}setPixel(t,r,o){const d=4*(t*this.width+r);this.data[d+0]=Math.round(255*o.r/o.a),this.data[d+1]=Math.round(255*o.g/o.a),this.data[d+2]=Math.round(255*o.b/o.a),this.data[d+3]=Math.round(255*o.a)}}function mh(a){const t={},r=a.resolution||256,o=a.clips?a.clips.length:1,d=a.image||new zr({width:r,height:o});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const g=(_,x,T)=>{t[a.evaluationKey]=T;const P=a.expression.evaluate(t);d.setPixel(_/4/r,x/4,P)};if(a.clips)for(let _=0,x=0;_<o;++_,x+=4*r)for(let T=0,P=0;T<r;T++,P+=4){const D=T/(r-1),{start:k,end:N}=a.clips[_];g(x,P,k*(1-D)+N*D)}else for(let _=0,x=0;_<r;_++,x+=4)g(0,x,_/(r-1));return d}_t("AlphaImage",yu),_t("RGBAImage",zr);const gh="big-fb";class Pp extends er{createBucket(t){return new of(t)}constructor(t){super(t,zp),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=mh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(gh)&&this.heatmapFbos.delete(gh)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let hd;var Rp={get paint(){return hd=hd||new lr({"hillshade-illumination-direction":new xt(_e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new xt(_e.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new xt(_e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new xt(_e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new xt(_e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new xt(_e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new xt(_e.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new xt(_e.paint_hillshade["hillshade-method"])})}};class Ho extends er{constructor(t){super(t,Rp),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,r=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,d=this.paint.get("hillshade-shadow-color").values;const g=Math.max(t.length,r.length,o.length,d.length);t=t.concat(Array(g-t.length).fill(t.at(-1))),r=r.concat(Array(g-r.length).fill(r.at(-1))),o=o.concat(Array(g-o.length).fill(o.at(-1))),d=d.concat(Array(g-d.length).fill(d.at(-1)));const _=r.map(nn);return{directionRadians:t.map(nn),altitudeRadians:_,shadowColor:d,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let dd;var Pm={get paint(){return dd=dd||new lr({"color-relief-opacity":new xt(_e["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new jo(_e["paint_color-relief"]["color-relief-color"])})}};class fd{constructor(t,r,o,d){this.context=t,this.format=o,this.texture=t.gl.createTexture(),this.update(r,d)}update(t,r,o){const{width:d,height:g}=t,_=!(this.size&&this.size[0]===d&&this.size[1]===g||o),{context:x}=this,{gl:T}=x;if(this.useMipmap=!!(r&&r.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!r||r.premultiply!==!1)),_)this.size=[d,g],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||Sa(t)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,t):T.texImage2D(T.TEXTURE_2D,0,this.format,d,g,0,this.format,T.UNSIGNED_BYTE,t.data);else{const{x:P,y:D}=o||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||Sa(t)?T.texSubImage2D(T.TEXTURE_2D,0,P,D,T.RGBA,T.UNSIGNED_BYTE,t):T.texSubImage2D(T.TEXTURE_2D,0,P,D,d,g,T.RGBA,T.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D),x.pixelStoreUnpackFlipY.setDefault(),x.pixelStoreUnpack.setDefault(),x.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,r,o){const{context:d}=this,{gl:g}=d;g.bindTexture(g.TEXTURE_2D,this.texture),o!==g.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=g.LINEAR),t!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,t),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,o||t),this.filter=t),r!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,r),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class ao{constructor(t,r,o,d=1,g=1,_=1,x=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void Xi(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const T=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=d,this.greenFactor=g,this.blueFactor=_,this.baseShift=x;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let P=0;P<T;P++)this.data[this._idx(-1,P)]=this.data[this._idx(0,P)],this.data[this._idx(T,P)]=this.data[this._idx(T-1,P)],this.data[this._idx(P,-1)]=this.data[this._idx(P,0)],this.data[this._idx(P,T)]=this.data[this._idx(P,T-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(T,-1)]=this.data[this._idx(T-1,0)],this.data[this._idx(-1,T)]=this.data[this._idx(0,T-1)],this.data[this._idx(T,T)]=this.data[this._idx(T-1,T-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let P=0;P<T;P++)for(let D=0;D<T;D++){const k=this.get(P,D);k>this.max&&(this.max=k),k<this.min&&(this.min=k)}}get(t,r){const o=new Uint8Array(this.data.buffer),d=4*this._idx(t,r);return this.unpack(o[d],o[d+1],o[d+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,o){return t*this.redFactor+r*this.greenFactor+o*this.blueFactor-this.baseShift}pack(t){return cf(t,this.getUnpackVector())}getPixels(){return new zr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let d=r*this.dim,g=r*this.dim+this.dim,_=o*this.dim,x=o*this.dim+this.dim;switch(r){case-1:d=g-1;break;case 1:g=d+1}switch(o){case-1:_=x-1;break;case 1:x=_+1}const T=-r*this.dim,P=-o*this.dim;for(let D=_;D<x;D++)for(let k=d;k<g;k++)this.data[this._idx(k,D)]=t.data[this._idx(k+T,D+P)]}}function cf(a,t){const r=t[0],o=t[1],d=t[2],g=t[3],_=Math.min(r,o,d),x=Math.round((a+g)/_);return{r:Math.floor(x*_/r)%256,g:Math.floor(x*_/o)%256,b:Math.floor(x*_/d)%256}}_t("DEMData",ao);class pd extends er{constructor(t){super(t,Pm)}_createColorRamp(t){const r={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof mr&&o._styleExpression.expression instanceof or){this.colorRampExpression=o;const _=o._styleExpression.expression;r.elevationStops=_.labels,r.colorStops=[];for(const x of r.elevationStops)r.colorStops.push(_.evaluate({globals:{elevation:x}}))}if(r.elevationStops.length<1&&(r.elevationStops=[0],r.colorStops=[Kt.transparent]),r.elevationStops.length<2&&(r.elevationStops.push(r.elevationStops[0]+1),r.colorStops.push(r.colorStops[0])),r.elevationStops.length<=t)return r;const d={elevationStops:[],colorStops:[]},g=(r.elevationStops.length-1)/(t-1);for(let _=0;_<r.elevationStops.length-.5;_+=g)d.elevationStops.push(r.elevationStops[Math.round(_)]),d.colorStops.push(r.colorStops[Math.round(_)]);return Xi(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),d}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,r,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const d=this._createColorRamp(r),g=new zr({width:d.colorStops.length,height:1}),_=new zr({width:d.colorStops.length,height:1});for(let x=0;x<d.elevationStops.length;x++){const T=cf(d.elevationStops[x],o);_.setPixel(0,x,new Kt(T.r/255,T.g/255,T.b/255,1)),g.setPixel(0,x,d.colorStops[x])}return this.colorRampTextures={elevationTexture:new fd(t,_,t.gl.RGBA),colorTexture:new fd(t,g,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const _h=an([{name:"a_pos",components:2,type:"Int16"}],4),{members:An}=_h;function uf(a,t,r){const o=r.patternDependencies;let d=!1;for(const g of t){const _=g.paint.get(`${a}-pattern`);_.isConstant()||(d=!0);const x=_.constantOr(null);x&&(d=!0,o[x.to]=!0,o[x.from]=!0)}return d}function hf(a,t,r,o,d){const g=d.patternDependencies;for(const _ of t){const x=_.paint.get(`${a}-pattern`).value;if(x.kind!=="constant"){let T=x.evaluate({zoom:o-1},r,{},d.availableImages),P=x.evaluate({zoom:o},r,{},d.availableImages),D=x.evaluate({zoom:o+1},r,{},d.availableImages);T=T&&T.name?T.name:T,P=P&&P.name?P.name:P,D=D&&D.name?D.name:D,g[T]=!0,g[P]=!0,g[D]=!0,r.patterns[_.id]={min:T,mid:P,max:D}}}return r}function df(a,t,r,o,d){let g;if(d===function(_,x,T,P){let D=0;for(let k=x,N=T-P;k<T;k+=P)D+=(_[N]-_[k])*(_[k+1]+_[N+1]),N=k;return D}(a,t,r,o)>0)for(let _=t;_<r;_+=o)g=pn(_/o|0,a[_],a[_+1],g);else for(let _=r-o;_>=t;_-=o)g=pn(_/o|0,a[_],a[_+1],g);return g&&Ll(g,g.next)&&(vr(g),g=g.next),g}function zs(a,t){if(!a)return a;t||(t=a);let r,o=a;do if(r=!1,o.steiner||!Ll(o,o.next)&&ai(o.prev,o,o.next)!==0)o=o.next;else{if(vr(o),o=t=o.prev,o===o.next)break;r=!0}while(r||o!==t);return t}function ts(a,t,r,o,d,g,_){if(!a)return;!_&&g&&function(T,P,D,k){let N=T;do N.z===0&&(N.z=vh(N.x,N.y,P,D,k)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next;while(N!==T);N.prevZ.nextZ=null,N.prevZ=null,function(V){let q,$=1;do{let Q,ae=V;V=null;let ve=null;for(q=0;ae;){q++;let he=ae,U=0;for(let fe=0;fe<$&&(U++,he=he.nextZ,he);fe++);let W=$;for(;U>0||W>0&&he;)U!==0&&(W===0||!he||ae.z<=he.z)?(Q=ae,ae=ae.nextZ,U--):(Q=he,he=he.nextZ,W--),ve?ve.nextZ=Q:V=Q,Q.prevZ=ve,ve=Q;ae=he}ve.nextZ=null,$*=2}while(q>1)}(N)}(a,o,d,g);let x=a;for(;a.prev!==a.next;){const T=a.prev,P=a.next;if(g?Ip(a,o,d,g):Dp(a))t.push(T.i,a.i,P.i),vr(a),a=P.next,x=P.next;else if((a=P)===x){_?_===1?ts(a=yh(zs(a),t),t,r,o,d,g,2):_===2&&so(a,t,r,o,d,g):ts(zs(a),t,r,o,d,g,1);break}}}function Dp(a){const t=a.prev,r=a,o=a.next;if(ai(t,r,o)>=0)return!1;const d=t.x,g=r.x,_=o.x,x=t.y,T=r.y,P=o.y,D=Math.min(d,g,_),k=Math.min(x,T,P),N=Math.max(d,g,_),V=Math.max(x,T,P);let q=o.next;for(;q!==t;){if(q.x>=D&&q.x<=N&&q.y>=k&&q.y<=V&&vu(d,x,g,T,_,P,q.x,q.y)&&ai(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function Ip(a,t,r,o){const d=a.prev,g=a,_=a.next;if(ai(d,g,_)>=0)return!1;const x=d.x,T=g.x,P=_.x,D=d.y,k=g.y,N=_.y,V=Math.min(x,T,P),q=Math.min(D,k,N),$=Math.max(x,T,P),Q=Math.max(D,k,N),ae=vh(V,q,t,r,o),ve=vh($,Q,t,r,o);let he=a.prevZ,U=a.nextZ;for(;he&&he.z>=ae&&U&&U.z<=ve;){if(he.x>=V&&he.x<=$&&he.y>=q&&he.y<=Q&&he!==d&&he!==_&&vu(x,D,T,k,P,N,he.x,he.y)&&ai(he.prev,he,he.next)>=0||(he=he.prevZ,U.x>=V&&U.x<=$&&U.y>=q&&U.y<=Q&&U!==d&&U!==_&&vu(x,D,T,k,P,N,U.x,U.y)&&ai(U.prev,U,U.next)>=0))return!1;U=U.nextZ}for(;he&&he.z>=ae;){if(he.x>=V&&he.x<=$&&he.y>=q&&he.y<=Q&&he!==d&&he!==_&&vu(x,D,T,k,P,N,he.x,he.y)&&ai(he.prev,he,he.next)>=0)return!1;he=he.prevZ}for(;U&&U.z<=ve;){if(U.x>=V&&U.x<=$&&U.y>=q&&U.y<=Q&&U!==d&&U!==_&&vu(x,D,T,k,P,N,U.x,U.y)&&ai(U.prev,U,U.next)>=0)return!1;U=U.nextZ}return!0}function yh(a,t){let r=a;do{const o=r.prev,d=r.next.next;!Ll(o,d)&&mf(o,r,r.next,d)&&xu(o,d)&&xu(d,o)&&(t.push(o.i,r.i,d.i),vr(r),vr(r.next),r=a=d),r=r.next}while(r!==a);return zs(r)}function so(a,t,r,o,d,g){let _=a;do{let x=_.next.next;for(;x!==_.prev;){if(_.i!==x.i&&Xo(_,x)){let T=gf(_,x);return _=zs(_,_.next),T=zs(T,T.next),ts(_,t,r,o,d,g,0),void ts(T,t,r,o,d,g,0)}x=x.next}_=_.next}while(_!==a)}function kp(a,t){let r=a.x-t.x;return r===0&&(r=a.y-t.y,r===0)&&(r=(a.next.y-a.y)/(a.next.x-a.x)-(t.next.y-t.y)/(t.next.x-t.x)),r}function ff(a,t){const r=function(d,g){let _=g;const x=d.x,T=d.y;let P,D=-1/0;if(Ll(d,_))return _;do{if(Ll(d,_.next))return _.next;if(T<=_.y&&T>=_.next.y&&_.next.y!==_.y){const $=_.x+(T-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if($<=x&&$>D&&(D=$,P=_.x<_.next.x?_:_.next,$===x))return P}_=_.next}while(_!==g);if(!P)return null;const k=P,N=P.x,V=P.y;let q=1/0;_=P;do{if(x>=_.x&&_.x>=N&&x!==_.x&&xh(T<V?x:D,T,N,V,T<V?D:x,T,_.x,_.y)){const $=Math.abs(T-_.y)/(x-_.x);xu(_,d)&&($<q||$===q&&(_.x>P.x||_.x===P.x&&Lp(P,_)))&&(P=_,q=$)}_=_.next}while(_!==k);return P}(a,t);if(!r)return t;const o=gf(r,a);return zs(o,o.next),zs(r,r.next)}function Lp(a,t){return ai(a.prev,a,t.prev)<0&&ai(t.next,a,a.next)<0}function vh(a,t,r,o,d){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-r)*d|0)|a<<8))|a<<4))|a<<2))|a<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*d|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function pf(a){let t=a,r=a;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==a);return r}function xh(a,t,r,o,d,g,_,x){return(d-_)*(t-x)>=(a-_)*(g-x)&&(a-_)*(o-x)>=(r-_)*(t-x)&&(r-_)*(g-x)>=(d-_)*(o-x)}function vu(a,t,r,o,d,g,_,x){return!(a===_&&t===x)&&xh(a,t,r,o,d,g,_,x)}function Xo(a,t){return a.next.i!==t.i&&a.prev.i!==t.i&&!function(r,o){let d=r;do{if(d.i!==r.i&&d.next.i!==r.i&&d.i!==o.i&&d.next.i!==o.i&&mf(d,d.next,r,o))return!0;d=d.next}while(d!==r);return!1}(a,t)&&(xu(a,t)&&xu(t,a)&&function(r,o){let d=r,g=!1;const _=(r.x+o.x)/2,x=(r.y+o.y)/2;do d.y>x!=d.next.y>x&&d.next.y!==d.y&&_<(d.next.x-d.x)*(x-d.y)/(d.next.y-d.y)+d.x&&(g=!g),d=d.next;while(d!==r);return g}(a,t)&&(ai(a.prev,a,t.prev)||ai(a,t.prev,t))||Ll(a,t)&&ai(a.prev,a,a.next)>0&&ai(t.prev,t,t.next)>0)}function ai(a,t,r){return(t.y-a.y)*(r.x-t.x)-(t.x-a.x)*(r.y-t.y)}function Ll(a,t){return a.x===t.x&&a.y===t.y}function mf(a,t,r,o){const d=md(ai(a,t,r)),g=md(ai(a,t,o)),_=md(ai(r,o,a)),x=md(ai(r,o,t));return d!==g&&_!==x||!(d!==0||!$n(a,r,t))||!(g!==0||!$n(a,o,t))||!(_!==0||!$n(r,a,o))||!(x!==0||!$n(r,t,o))}function $n(a,t,r){return t.x<=Math.max(a.x,r.x)&&t.x>=Math.min(a.x,r.x)&&t.y<=Math.max(a.y,r.y)&&t.y>=Math.min(a.y,r.y)}function md(a){return a>0?1:a<0?-1:0}function xu(a,t){return ai(a.prev,a,a.next)<0?ai(a,t,a.next)>=0&&ai(a,a.prev,t)>=0:ai(a,t,a.prev)<0||ai(a,a.next,t)<0}function gf(a,t){const r=Ps(a.i,a.x,a.y),o=Ps(t.i,t.x,t.y),d=a.next,g=t.prev;return a.next=t,t.prev=a,r.next=d,d.prev=r,o.next=r,r.prev=o,g.next=o,o.prev=g,o}function pn(a,t,r,o){const d=Ps(a,t,r);return o?(d.next=o.next,d.prev=o,o.next.prev=d,o.next=d):(d.prev=d,d.next=d),d}function vr(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Ps(a,t,r){return{i:a,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Pc{constructor(t,r){if(r>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=r}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class bh{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}bh.noSubdivision=new bh({fill:new Pc(0,0),line:new Pc(0,0),tile:new Pc(0,0),stencil:new Pc(0,0),circle:1}),_t("SubdivisionGranularityExpression",Pc),_t("SubdivisionGranularitySetting",bh);const bu=-32768,Rc=32767;class Fa{constructor(t,r){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=lt/t,this._canonical=r}_getKey(t,r){return(t+=32768)<<16|r+32768}_vertexToIndex(t,r){if(t<-32768||r<-32768||t>32767||r>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(t),d=0|Math.round(r),g=this._getKey(o,d);if(this._vertexDictionary.has(g))return this._vertexDictionary.get(g);const _=this._vertexBuffer.length/2;return this._vertexDictionary.set(g,_),this._vertexBuffer.push(o,d),_}_subdivideTrianglesScanline(t){if(this._granularity<2)return function(d,g){const _=[];for(let x=0;x<g.length;x+=3){const T=g[x],P=g[x+1],D=g[x+2],k=d[2*T],N=d[2*T+1];(d[2*P]-k)*(d[2*D+1]-N)-(d[2*P+1]-N)*(d[2*D]-k)>0?(_.push(T),_.push(D),_.push(P)):(_.push(T),_.push(P),_.push(D))}return _}(this._vertexBuffer,t);const r=[],o=t.length;for(let d=0;d<o;d+=3){const g=[t[d+0],t[d+1],t[d+2]],_=[this._vertexBuffer[2*t[d+0]+0],this._vertexBuffer[2*t[d+0]+1],this._vertexBuffer[2*t[d+1]+0],this._vertexBuffer[2*t[d+1]+1],this._vertexBuffer[2*t[d+2]+0],this._vertexBuffer[2*t[d+2]+1]];let x=1/0,T=1/0,P=-1/0,D=-1/0;for(let $=0;$<3;$++){const Q=_[2*$],ae=_[2*$+1];x=Math.min(x,Q),P=Math.max(P,Q),T=Math.min(T,ae),D=Math.max(D,ae)}if(x===P||T===D)continue;const k=Math.floor(x/this._granularityCellSize),N=Math.ceil(P/this._granularityCellSize),V=Math.floor(T/this._granularityCellSize),q=Math.ceil(D/this._granularityCellSize);if(k!==N||V!==q)for(let $=V;$<q;$++){const Q=this._scanlineGenerateVertexRingForCellRow($,_,g);Na(this._vertexBuffer,Q,r)}else r.push(...g)}return r}_scanlineGenerateVertexRingForCellRow(t,r,o){const d=t*this._granularityCellSize,g=d+this._granularityCellSize,_=[];for(let x=0;x<3;x++){const T=r[2*x],P=r[2*x+1],D=r[2*(x+1)%6],k=r[(2*(x+1)+1)%6],N=r[2*(x+2)%6],V=r[(2*(x+2)+1)%6],q=D-T,$=k-P,Q=q===0,ae=$===0,ve=(d-P)/$,he=(g-P)/$,U=Math.min(ve,he),W=Math.max(ve,he);if(!ae&&(U>=1||W<=0)||ae&&(P<d||P>g)){k>=d&&k<=g&&_.push(o[(x+1)%3]);continue}!ae&&U>0&&_.push(this._vertexToIndex(T+q*U,P+$*U));const fe=T+q*Math.max(U,0),Ie=T+q*Math.min(W,1);Q||this._generateIntraEdgeVertices(_,T,P,D,k,fe,Ie),!ae&&W<1&&_.push(this._vertexToIndex(T+q*W,P+$*W)),(ae||k>=d&&k<=g)&&_.push(o[(x+1)%3]),!ae&&(k<=d||k>=g)&&this._generateInterEdgeVertices(_,T,P,D,k,N,V,Ie,d,g)}return _}_generateIntraEdgeVertices(t,r,o,d,g,_,x){const T=d-r,P=g-o,D=P===0,k=D?Math.min(r,d):Math.min(_,x),N=D?Math.max(r,d):Math.max(_,x),V=Math.floor(k/this._granularityCellSize)+1,q=Math.ceil(N/this._granularityCellSize)-1;if(D?r<d:_<x)for(let $=V;$<=q;$++){const Q=$*this._granularityCellSize;t.push(this._vertexToIndex(Q,o+P*(Q-r)/T))}else for(let $=q;$>=V;$--){const Q=$*this._granularityCellSize;t.push(this._vertexToIndex(Q,o+P*(Q-r)/T))}}_generateInterEdgeVertices(t,r,o,d,g,_,x,T,P,D){const k=g-o,N=_-d,V=x-g,q=(P-g)/V,$=(D-g)/V,Q=Math.min(q,$),ae=Math.max(q,$),ve=d+N*Q;let he=Math.floor(Math.min(ve,T)/this._granularityCellSize)+1,U=Math.ceil(Math.max(ve,T)/this._granularityCellSize)-1,W=T<ve;const fe=V===0;if(fe&&(x===P||x===D))return;if(fe||Q>=1||ae<=0){const Je=o-x,Ne=_+(r-_)*Math.min((P-x)/Je,(D-x)/Je);he=Math.floor(Math.min(Ne,T)/this._granularityCellSize)+1,U=Math.ceil(Math.max(Ne,T)/this._granularityCellSize)-1,W=T<Ne}const Ie=k>0?D:P;if(W)for(let Je=he;Je<=U;Je++)t.push(this._vertexToIndex(Je*this._granularityCellSize,Ie));else for(let Je=U;Je>=he;Je--)t.push(this._vertexToIndex(Je*this._granularityCellSize,Ie))}_generateOutline(t){const r=[];for(const o of t){const d=Ol(o,this._granularity,!0),g=this._pointArrayToIndices(d),_=[];for(let x=1;x<g.length;x++)_.push(g[x-1]),_.push(g[x]);r.push(_)}return r}_handlePoles(t){let r=!1,o=!1;this._canonical&&(this._canonical.y===0&&(r=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(r||o)&&this._fillPoles(t,r,o)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let r=0;r<t.length;r+=2){const o=t[r+1];o===bu&&(t[r+1]=-32767),o===Rc&&(t[r+1]=32766)}}_generatePoleQuad(t,r,o,d,g,_){d>g!=(_===bu)?(t.push(r),t.push(o),t.push(this._vertexToIndex(d,_)),t.push(o),t.push(this._vertexToIndex(g,_)),t.push(this._vertexToIndex(d,_))):(t.push(o),t.push(r),t.push(this._vertexToIndex(d,_)),t.push(this._vertexToIndex(g,_)),t.push(o),t.push(this._vertexToIndex(d,_)))}_fillPoles(t,r,o){const d=this._vertexBuffer,g=lt,_=t.length;for(let x=2;x<_;x+=3){const T=t[x-2],P=t[x-1],D=t[x],k=d[2*T],N=d[2*T+1],V=d[2*P],q=d[2*P+1],$=d[2*D],Q=d[2*D+1];r&&(N===0&&q===0&&this._generatePoleQuad(t,T,P,k,V,bu),q===0&&Q===0&&this._generatePoleQuad(t,P,D,V,$,bu),Q===0&&N===0&&this._generatePoleQuad(t,D,T,$,k,bu)),o&&(N===g&&q===g&&this._generatePoleQuad(t,T,P,k,V,Rc),q===g&&Q===g&&this._generatePoleQuad(t,P,D,V,$,Rc),Q===g&&N===g&&this._generatePoleQuad(t,D,T,$,k,Rc))}}_initializeVertices(t){for(let r=0;r<t.length;r+=2)this._vertexToIndex(t[r],t[r+1])}subdividePolygonInternal(t,r){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:d}=function(x){const T=[],P=[];for(const D of x)if(D.length!==0){D!==x[0]&&T.push(P.length/2);for(let k=0;k<D.length;k++)P.push(D[k].x),P.push(D[k].y)}return{flattened:P,holeIndices:T}}(t);let g;this._initializeVertices(o);try{const x=function(P,D,k=2){const N=D&&D.length,V=N?D[0]*k:P.length;let q=df(P,0,V,k,!0);const $=[];if(!q||q.next===q.prev)return $;let Q,ae,ve;if(N&&(q=function(he,U,W,fe){const Ie=[];for(let Je=0,Ne=U.length;Je<Ne;Je++){const qe=df(he,U[Je]*fe,Je<Ne-1?U[Je+1]*fe:he.length,fe,!1);qe===qe.next&&(qe.steiner=!0),Ie.push(pf(qe))}Ie.sort(kp);for(let Je=0;Je<Ie.length;Je++)W=ff(Ie[Je],W);return W}(P,D,q,k)),P.length>80*k){Q=1/0,ae=1/0;let he=-1/0,U=-1/0;for(let W=k;W<V;W+=k){const fe=P[W],Ie=P[W+1];fe<Q&&(Q=fe),Ie<ae&&(ae=Ie),fe>he&&(he=fe),Ie>U&&(U=Ie)}ve=Math.max(he-Q,U-ae),ve=ve!==0?32767/ve:0}return ts(q,$,k,Q,ae,ve,0),$}(o,d),T=this._convertIndices(o,x);g=this._subdivideTrianglesScanline(T)}catch(x){console.error(x)}let _=[];return r&&(_=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(g),{verticesFlattened:this._vertexBuffer,indicesTriangles:g,indicesLineList:_}}_convertIndices(t,r){const o=[];for(let d=0;d<r.length;d++)o.push(this._vertexToIndex(t[2*r[d]],t[2*r[d]+1]));return o}_pointArrayToIndices(t){const r=[];for(let o=0;o<t.length;o++){const d=t[o];r.push(this._vertexToIndex(d.x,d.y))}return r}}function is(a,t,r,o=!0){return new Fa(r,t).subdividePolygonInternal(a,o)}function Ol(a,t,r=!1){if(!a||a.length<1)return[];if(a.length<2)return[];const o=a[0],d=a[a.length-1],g=r&&(o.x!==d.x||o.y!==d.y);if(t<2)return g?[...a,a[0]]:[...a];const _=Math.floor(lt/t),x=[];x.push(new Ee(a[0].x,a[0].y));const T=a.length,P=g?T:T-1;for(let D=0;D<P;D++){const k=a[D],N=D<T-1?a[D+1]:a[0],V=k.x,q=k.y,$=N.x,Q=N.y,ae=V!==$,ve=q!==Q;if(!ae&&!ve)continue;const he=$-V,U=Q-q,W=Math.abs(he),fe=Math.abs(U);let Ie=V,Je=q;for(;;){const qe=he>0?(Math.floor(Ie/_)+1)*_:(Math.ceil(Ie/_)-1)*_,st=U>0?(Math.floor(Je/_)+1)*_:(Math.ceil(Je/_)-1)*_,nt=Math.abs(Ie-qe),ot=Math.abs(Je-st),$e=Math.abs(Ie-$),St=Math.abs(Je-Q),Rt=ae?nt/W:Number.POSITIVE_INFINITY,Mt=ve?ot/fe:Number.POSITIVE_INFINITY;if(($e<=nt||!ae)&&(St<=ot||!ve))break;if(Rt<Mt&&ae||!ve){Ie=qe,Je+=U*Rt;const bt=new Ee(Ie,Math.round(Je));x[x.length-1].x===bt.x&&x[x.length-1].y===bt.y||x.push(bt)}else{Ie+=he*Mt,Je=st;const bt=new Ee(Math.round(Ie),Je);x[x.length-1].x===bt.x&&x[x.length-1].y===bt.y||x.push(bt)}}const Ne=new Ee($,Q);x[x.length-1].x===Ne.x&&x[x.length-1].y===Ne.y||x.push(Ne)}return x}function Na(a,t,r){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,d=a[2*t[0]];for(let T=1;T<t.length;T++){const P=a[2*t[T]];P<d&&(d=P,o=T)}const g=t.length;let _=o,x=(_+1)%g;for(;;){const T=_-1>=0?_-1:g-1,P=(x+1)%g,D=a[2*t[T]],k=a[2*t[P]],N=a[2*t[_]],V=a[2*t[_]+1],q=a[2*t[x]+1];let $=!1;if(D<k)$=!0;else if(D>k)$=!1;else{const Q=q-V,ae=-(a[2*t[x]]-N),ve=V<q?1:-1;((D-N)*Q+(a[2*t[T]+1]-V)*ae)*ve>((k-N)*Q+(a[2*t[P]+1]-V)*ae)*ve&&($=!0)}if($){const Q=t[T],ae=t[_],ve=t[x];Q!==ae&&Q!==ve&&ae!==ve&&r.push(ve,ae,Q),_--,_<0&&(_=g-1)}else{const Q=t[P],ae=t[_],ve=t[x];Q!==ae&&Q!==ve&&ae!==ve&&r.push(ve,ae,Q),x++,x>=g&&(x=0)}if(T===P)break}}function _f(a,t,r,o,d,g,_,x,T){const P=d.length/2,D=_&&x&&T;if(P<hi.MAX_VERTEX_ARRAY_LENGTH){const k=t.prepareSegment(P,r,o),N=k.vertexLength;for(let $=0;$<g.length;$+=3)o.emplaceBack(N+g[$],N+g[$+1],N+g[$+2]);let V,q;k.vertexLength+=P,k.primitiveLength+=g.length/3,D&&(q=_.prepareSegment(P,r,x),V=q.vertexLength,q.vertexLength+=P);for(let $=0;$<d.length;$+=2)a(d[$],d[$+1]);if(D)for(let $=0;$<T.length;$++){const Q=T[$];for(let ae=1;ae<Q.length;ae+=2)x.emplaceBack(V+Q[ae-1],V+Q[ae]);q.primitiveLength+=Q.length/2}}else(function(k,N,V,q,$,Q){const ae=[];for(let fe=0;fe<q.length/2;fe++)ae.push(-1);const ve={count:0};let he=0,U=k.getOrCreateLatestSegment(N,V),W=U.vertexLength;for(let fe=2;fe<$.length;fe+=3){const Ie=$[fe-2],Je=$[fe-1],Ne=$[fe];let qe=ae[Ie]<he,st=ae[Je]<he,nt=ae[Ne]<he;U.vertexLength+((qe?1:0)+(st?1:0)+(nt?1:0))>hi.MAX_VERTEX_ARRAY_LENGTH&&(U=k.createNewSegment(N,V),he=ve.count,qe=!0,st=!0,nt=!0,W=0);const ot=ns(ae,q,Q,ve,Ie,qe,U),$e=ns(ae,q,Q,ve,Je,st,U),St=ns(ae,q,Q,ve,Ne,nt,U);V.emplaceBack(W+ot-he,W+$e-he,W+St-he),U.primitiveLength++}})(t,r,o,d,g,a),D&&function(k,N,V,q,$,Q){const ae=[];for(let fe=0;fe<q.length/2;fe++)ae.push(-1);const ve={count:0};let he=0,U=k.getOrCreateLatestSegment(N,V),W=U.vertexLength;for(let fe=0;fe<$.length;fe++){const Ie=$[fe];for(let Je=1;Je<$[fe].length;Je+=2){const Ne=Ie[Je-1],qe=Ie[Je];let st=ae[Ne]<he,nt=ae[qe]<he;U.vertexLength+((st?1:0)+(nt?1:0))>hi.MAX_VERTEX_ARRAY_LENGTH&&(U=k.createNewSegment(N,V),he=ve.count,st=!0,nt=!0,W=0);const ot=ns(ae,q,Q,ve,Ne,st,U),$e=ns(ae,q,Q,ve,qe,nt,U);V.emplaceBack(W+ot-he,W+$e-he),U.primitiveLength++}}}(_,r,x,d,T,a),t.forceNewSegmentOnNextPrepare(),_==null||_.forceNewSegmentOnNextPrepare()}function ns(a,t,r,o,d,g,_){if(g){const x=o.count;return r(t[2*d],t[2*d+1]),a[d]=o.count,o.count++,_.vertexLength++,x}return a[d]}class Yo{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Be,this.indexArray=new zi,this.indexArray2=new Pi,this.programConfigurations=new Ar(t.layers,t.zoom),this.segments=new hi,this.segments2=new hi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,o){this.hasPattern=uf("fill",this.layers,r);const d=this.layers[0].layout.get("fill-sort-key"),g=!d.isConstant(),_=[];for(const{feature:x,id:T,index:P,sourceLayerIndex:D}of t){const k=this.layers[0]._featureFilter.needGeometry,N=kl(x,k);if(!this.layers[0]._featureFilter.filter(new Ni(this.zoom,{globalState:this.globalState}),N,o))continue;const V=g?d.evaluate(N,{},o,r.availableImages):void 0,q={id:T,properties:x.properties,type:x.type,sourceLayerIndex:D,index:P,geometry:k?N.geometry:$o(x),patterns:{},sortKey:V};_.push(q)}g&&_.sort((x,T)=>x.sortKey-T.sortKey);for(const x of _){const{geometry:T,index:P,sourceLayerIndex:D}=x;if(this.hasPattern){const k=hf("fill",this.layers,x,this.zoom,r);this.patternFeatures.push(k)}else this.addFeature(x,T,P,o,{},r.subdivisionGranularity);r.featureIndex.insert(t[P].feature,T,P,D,this.index)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,o)}addFeatures(t,r,o){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,r,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,An),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,o,d,g,_){for(const x of Jc(r,500)){const T=is(x,d,_.fill.getGranularityForZoomLevel(d.z)),P=this.layoutVertexArray;_f((D,k)=>{P.emplaceBack(D,k)},this.segments,this.layoutVertexArray,this.indexArray,T.verticesFlattened,T.indicesTriangles,this.segments2,this.indexArray2,T.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,g,d)}}let Ko,gd;_t("FillBucket",Yo,{omit:["layers","patternFeatures"]});var yf={get paint(){return gd=gd||new lr({"fill-antialias":new xt(_e.paint_fill["fill-antialias"]),"fill-opacity":new zt(_e.paint_fill["fill-opacity"]),"fill-color":new zt(_e.paint_fill["fill-color"]),"fill-outline-color":new zt(_e.paint_fill["fill-outline-color"]),"fill-translate":new xt(_e.paint_fill["fill-translate"]),"fill-translate-anchor":new xt(_e.paint_fill["fill-translate-anchor"]),"fill-pattern":new pu(_e.paint_fill["fill-pattern"])})},get layout(){return Ko=Ko||new lr({"fill-sort-key":new zt(_e.layout_fill["fill-sort-key"])})}};class oo extends er{constructor(t){super(t,yf)}recalculate(t,r){super.recalculate(t,r);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Yo(t)}queryRadius(){return hh(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:r,transform:o,pixelsToTileUnits:d}){return tf(dh(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,d),r)}isTileClipped(){return!0}}const Op=an([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),wu=an([{name:"a_centroid",components:2,type:"Int16"}],4),{members:wh}=Op;var Dc,Ic,_d,vf,kc,xf,Sh,Th={};function Bp(){if(Ic)return Dc;Ic=1;var a=Te();function t(d,g,_,x,T){this.properties={},this.extent=_,this.type=0,this._pbf=d,this._geometry=-1,this._keys=x,this._values=T,d.readFields(r,this,g)}function r(d,g,_){d==1?g.id=_.readVarint():d==2?function(x,T){for(var P=x.readVarint()+x.pos;x.pos<P;){var D=T._keys[x.readVarint()],k=T._values[x.readVarint()];T.properties[D]=k}}(_,g):d==3?g.type=_.readVarint():d==4&&(g._geometry=_.pos)}function o(d){for(var g,_,x=0,T=0,P=d.length,D=P-1;T<P;D=T++)x+=((_=d[D]).x-(g=d[T]).x)*(g.y+_.y);return x}return Dc=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var d=this._pbf;d.pos=this._geometry;for(var g,_=d.readVarint()+d.pos,x=1,T=0,P=0,D=0,k=[];d.pos<_;){if(T<=0){var N=d.readVarint();x=7&N,T=N>>3}if(T--,x===1||x===2)P+=d.readSVarint(),D+=d.readSVarint(),x===1&&(g&&k.push(g),g=[]),g.push(new a(P,D));else{if(x!==7)throw new Error("unknown command "+x);g&&g.push(g[0].clone())}}return g&&k.push(g),k},t.prototype.bbox=function(){var d=this._pbf;d.pos=this._geometry;for(var g=d.readVarint()+d.pos,_=1,x=0,T=0,P=0,D=1/0,k=-1/0,N=1/0,V=-1/0;d.pos<g;){if(x<=0){var q=d.readVarint();_=7&q,x=q>>3}if(x--,_===1||_===2)(T+=d.readSVarint())<D&&(D=T),T>k&&(k=T),(P+=d.readSVarint())<N&&(N=P),P>V&&(V=P);else if(_!==7)throw new Error("unknown command "+_)}return[D,N,k,V]},t.prototype.toGeoJSON=function(d,g,_){var x,T,P=this.extent*Math.pow(2,_),D=this.extent*d,k=this.extent*g,N=this.loadGeometry(),V=t.types[this.type];function q(ae){for(var ve=0;ve<ae.length;ve++){var he=ae[ve];ae[ve]=[360*(he.x+D)/P-180,360/Math.PI*Math.atan(Math.exp((180-360*(he.y+k)/P)*Math.PI/180))-90]}}switch(this.type){case 1:var $=[];for(x=0;x<N.length;x++)$[x]=N[x][0];q(N=$);break;case 2:for(x=0;x<N.length;x++)q(N[x]);break;case 3:for(N=function(ae){var ve=ae.length;if(ve<=1)return[ae];for(var he,U,W=[],fe=0;fe<ve;fe++){var Ie=o(ae[fe]);Ie!==0&&(U===void 0&&(U=Ie<0),U===Ie<0?(he&&W.push(he),he=[ae[fe]]):he.push(ae[fe]))}return he&&W.push(he),W}(N),x=0;x<N.length;x++)for(T=0;T<N[x].length;T++)q(N[x][T])}N.length===1?N=N[0]:V="Multi"+V;var Q={type:"Feature",geometry:{type:V,coordinates:N},properties:this.properties};return"id"in this&&(Q.id=this.id),Q},Dc}function Fp(){if(vf)return _d;vf=1;var a=Bp();function t(o,d){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(r,this,d),this.length=this._features.length}function r(o,d,g){o===15?d.version=g.readVarint():o===1?d.name=g.readString():o===5?d.extent=g.readVarint():o===2?d._features.push(g.pos):o===3?d._keys.push(g.readString()):o===4&&d._values.push(function(_){for(var x=null,T=_.readVarint()+_.pos;_.pos<T;){var P=_.readVarint()>>3;x=P===1?_.readString():P===2?_.readFloat():P===3?_.readDouble():P===4?_.readVarint64():P===5?_.readVarint():P===6?_.readSVarint():P===7?_.readBoolean():null}return x}(g))}return _d=t,t.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var d=this._pbf.readVarint()+this._pbf.pos;return new a(this._pbf,d,this.extent,this._keys,this._values)},_d}function Li(){return Sh||(Sh=1,Th.VectorTile=function(){if(xf)return kc;xf=1;var a=Fp();function t(r,o,d){if(r===3){var g=new a(d,d.readVarint()+d.pos);g.length&&(o[g.name]=g)}}return kc=function(r,o){this.layers=r.readFields(t,{},o)},kc}(),Th.VectorTileFeature=Bp(),Th.VectorTileLayer=Fp()),Th}var Oi=J(Li());const _i=Oi.VectorTileFeature.types,xi=Math.pow(2,13);function Ti(a,t,r,o,d,g,_,x){a.emplaceBack(t,r,2*Math.floor(o*xi)+_,d*xi*2,g*xi*2,Math.round(x))}class ia{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new dt,this.centroidVertexArray=new Re,this.indexArray=new zi,this.programConfigurations=new Ar(t.layers,t.zoom),this.segments=new hi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,o){this.features=[],this.hasPattern=uf("fill-extrusion",this.layers,r);for(const{feature:d,id:g,index:_,sourceLayerIndex:x}of t){const T=this.layers[0]._featureFilter.needGeometry,P=kl(d,T);if(!this.layers[0]._featureFilter.filter(new Ni(this.zoom,{globalState:this.globalState}),P,o))continue;const D={id:g,sourceLayerIndex:x,index:_,geometry:T?P.geometry:$o(d),properties:d.properties,type:d.type,patterns:{}};this.hasPattern?this.features.push(hf("fill-extrusion",this.layers,D,this.zoom,r)):this.addFeature(D,D.geometry,_,o,{},r.subdivisionGranularity),r.featureIndex.insert(d,D.geometry,_,x,this.index,!0)}}addFeatures(t,r,o){for(const d of this.features){const{geometry:g}=d;this.addFeature(d,g,d.index,r,o,t.subdivisionGranularity)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,wh),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,wu.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,o,d,g,_){for(const x of Jc(r,500)){const T={x:0,y:0,sampleCount:0},P=this.layoutVertexArray.length;this.processPolygon(T,d,t,x,_);const D=this.layoutVertexArray.length-P,k=Math.floor(T.x/T.sampleCount),N=Math.floor(T.y/T.sampleCount);for(let V=0;V<D;V++)this.centroidVertexArray.emplaceBack(k,N)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,g,d)}processPolygon(t,r,o,d,g){if(d.length<1||yd(d[0]))return;for(const k of d)k.length!==0&&Bl(t,k);const _={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},x=g.fill.getGranularityForZoomLevel(r.z),T=_i[o.type]==="Polygon";for(const k of d){if(k.length===0||yd(k))continue;const N=Ol(k,x,T);this._generateSideFaces(N,_)}if(!T)return;const P=is(d,r,x,!1),D=this.layoutVertexArray;_f((k,N)=>{Ti(D,k,N,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,P.verticesFlattened,P.indicesTriangles)}_generateSideFaces(t,r){let o=0;for(let d=1;d<t.length;d++){const g=t[d],_=t[d-1];if(Su(g,_))continue;r.segment.vertexLength+4>hi.MAX_VERTEX_ARRAY_LENGTH&&(r.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const x=g.sub(_)._perp()._unit(),T=_.dist(g);o+T>32768&&(o=0),Ti(this.layoutVertexArray,g.x,g.y,x.x,x.y,0,0,o),Ti(this.layoutVertexArray,g.x,g.y,x.x,x.y,0,1,o),o+=T,Ti(this.layoutVertexArray,_.x,_.y,x.x,x.y,0,0,o),Ti(this.layoutVertexArray,_.x,_.y,x.x,x.y,0,1,o);const P=r.segment.vertexLength;this.indexArray.emplaceBack(P,P+2,P+1),this.indexArray.emplaceBack(P+1,P+2,P+3),r.segment.vertexLength+=4,r.segment.primitiveLength+=2}}}function Bl(a,t){for(let r=0;r<t.length;r++){const o=t[r];r===t.length-1&&t[0].x===o.x&&t[0].y===o.y||(a.x+=o.x,a.y+=o.y,a.sampleCount++)}}function Su(a,t){return a.x===t.x&&(a.x<0||a.x>lt)||a.y===t.y&&(a.y<0||a.y>lt)}function yd(a){return a.every(t=>t.x<0)||a.every(t=>t.x>lt)||a.every(t=>t.y<0)||a.every(t=>t.y>lt)}let lo;_t("FillExtrusionBucket",ia,{omit:["layers","features"]});var jn={get paint(){return lo=lo||new lr({"fill-extrusion-opacity":new xt(_e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new zt(_e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new xt(_e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new xt(_e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new pu(_e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new zt(_e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new zt(_e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new xt(_e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Fl extends er{constructor(t){super(t,jn)}createBucket(t){return new ia(t)}queryRadius(){return hh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:o,geometry:d,transform:g,pixelsToTileUnits:_,pixelPosMatrix:x}){const T=dh(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-g.bearingInRadians,_),P=this.paint.get("fill-extrusion-height").evaluate(r,o),D=this.paint.get("fill-extrusion-base").evaluate(r,o),k=function(V,q){const $=[];for(const Q of V){const ae=[Q.x,Q.y,0,1];yt(ae,ae,q),$.push(new Ee(ae[0]/ae[3],ae[1]/ae[3]))}return $}(T,x),N=function(V,q,$,Q){const ae=[],ve=[],he=Q[8]*q,U=Q[9]*q,W=Q[10]*q,fe=Q[11]*q,Ie=Q[8]*$,Je=Q[9]*$,Ne=Q[10]*$,qe=Q[11]*$;for(const st of V){const nt=[],ot=[];for(const $e of st){const St=$e.x,Rt=$e.y,Mt=Q[0]*St+Q[4]*Rt+Q[12],bt=Q[1]*St+Q[5]*Rt+Q[13],Yt=Q[2]*St+Q[6]*Rt+Q[14],Zi=Q[3]*St+Q[7]*Rt+Q[15],mn=Yt+W,gn=Zi+fe,Ua=Mt+Ie,Br=bt+Je,Pn=Yt+Ne,hn=Zi+qe,Hn=new Ee((Mt+he)/gn,(bt+U)/gn);Hn.z=mn/gn,nt.push(Hn);const Un=new Ee(Ua/hn,Br/hn);Un.z=Pn/hn,ot.push(Un)}ae.push(nt),ve.push(ot)}return[ae,ve]}(d,D,P,x);return function(V,q,$){let Q=1/0;tf($,q)&&(Q=vd($,q[0]));for(let ae=0;ae<q.length;ae++){const ve=q[ae],he=V[ae];for(let U=0;U<ve.length-1;U++){const W=ve[U],fe=[W,ve[U+1],he[U+1],he[U],W];ef($,fe)&&(Q=Math.min(Q,vd($,fe)))}}return Q!==1/0&&Q}(N[0],N[1],k)}}function Rs(a,t){return a.x*t.x+a.y*t.y}function vd(a,t){if(a.length===1){let r=0;const o=t[r++];let d;for(;!d||o.equals(d);)if(d=t[r++],!d)return 1/0;for(;r<t.length;r++){const g=t[r],_=a[0],x=d.sub(o),T=g.sub(o),P=_.sub(o),D=Rs(x,x),k=Rs(x,T),N=Rs(T,T),V=Rs(P,x),q=Rs(P,T),$=D*N-k*k,Q=(N*V-k*q)/$,ae=(D*q-k*V)/$,ve=o.z*(1-Q-ae)+d.z*Q+g.z*ae;if(isFinite(ve))return ve}return 1/0}{let r=1/0;for(const o of t)r=Math.min(r,o.z);return r}}const rs=an([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Tu}=rs,Mh=an([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:_a}=Mh,bf=Oi.VectorTileFeature.types,wf=Math.cos(Math.PI/180*37.5),Eh=Math.pow(2,14)/.5;class Mu{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new ut,this.layoutVertexArray2=new it,this.indexArray=new zi,this.programConfigurations=new Ar(t.layers,t.zoom),this.segments=new hi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,o){this.hasPattern=uf("line",this.layers,r);const d=this.layers[0].layout.get("line-sort-key"),g=!d.isConstant(),_=[];for(const{feature:x,id:T,index:P,sourceLayerIndex:D}of t){const k=this.layers[0]._featureFilter.needGeometry,N=kl(x,k);if(!this.layers[0]._featureFilter.filter(new Ni(this.zoom,{globalState:this.globalState}),N,o))continue;const V=g?d.evaluate(N,{},o):void 0,q={id:T,properties:x.properties,type:x.type,sourceLayerIndex:D,index:P,geometry:k?N.geometry:$o(x),patterns:{},sortKey:V};_.push(q)}g&&_.sort((x,T)=>x.sortKey-T.sortKey);for(const x of _){const{geometry:T,index:P,sourceLayerIndex:D}=x;if(this.hasPattern){const k=hf("line",this.layers,x,this.zoom,r);this.patternFeatures.push(k)}else this.addFeature(x,T,P,o,{},r.subdivisionGranularity);r.featureIndex.insert(t[P].feature,T,P,D,this.index)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,o)}addFeatures(t,r,o){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,r,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,_a)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Tu),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,o,d,g,_){const x=this.layers[0].layout,T=x.get("line-join").evaluate(t,{}),P=x.get("line-cap"),D=x.get("line-miter-limit"),k=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const N of r)this.addLine(N,t,T,P,D,k,d,_);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,g,d)}addLine(t,r,o,d,g,_,x,T){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=Ol(t,x?T.line.getGranularityForZoomLevel(x.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let he=0;he<t.length-1;he++)this.totalDistance+=t[he].dist(t[he+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const P=bf[r.type]==="Polygon";let D=t.length;for(;D>=2&&t[D-1].equals(t[D-2]);)D--;let k=0;for(;k<D-1&&t[k].equals(t[k+1]);)k++;if(D<(P?3:2))return;o==="bevel"&&(g=1.05);const N=this.overscaling<=16?122880/(512*this.overscaling):0,V=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray);let q,$,Q,ae,ve;this.e1=this.e2=-1,P&&(q=t[D-2],ve=t[k].sub(q)._unit()._perp());for(let he=k;he<D;he++){if(Q=he===D-1?P?t[k+1]:void 0:t[he+1],Q&&t[he].equals(Q))continue;ve&&(ae=ve),q&&($=q),q=t[he],ve=Q?Q.sub(q)._unit()._perp():ae,ae=ae||ve;let U=ae.add(ve);U.x===0&&U.y===0||U._unit();const W=ae.x*ve.x+ae.y*ve.y,fe=U.x*ve.x+U.y*ve.y,Ie=fe!==0?1/fe:1/0,Je=2*Math.sqrt(2-2*fe),Ne=fe<wf&&$&&Q,qe=ae.x*ve.y-ae.y*ve.x>0;if(Ne&&he>k){const ot=q.dist($);if(ot>2*N){const $e=q.sub(q.sub($)._mult(N/ot)._round());this.updateDistance($,$e),this.addCurrentVertex($e,ae,0,0,V),$=$e}}const st=$&&Q;let nt=st?o:P?"butt":d;if(st&&nt==="round"&&(Ie<_?nt="miter":Ie<=2&&(nt="fakeround")),nt==="miter"&&Ie>g&&(nt="bevel"),nt==="bevel"&&(Ie>2&&(nt="flipbevel"),Ie<g&&(nt="miter")),$&&this.updateDistance($,q),nt==="miter")U._mult(Ie),this.addCurrentVertex(q,U,0,0,V);else if(nt==="flipbevel"){if(Ie>100)U=ve.mult(-1);else{const ot=Ie*ae.add(ve).mag()/ae.sub(ve).mag();U._perp()._mult(ot*(qe?-1:1))}this.addCurrentVertex(q,U,0,0,V),this.addCurrentVertex(q,U.mult(-1),0,0,V)}else if(nt==="bevel"||nt==="fakeround"){const ot=-Math.sqrt(Ie*Ie-1),$e=qe?ot:0,St=qe?0:ot;if($&&this.addCurrentVertex(q,ae,$e,St,V),nt==="fakeround"){const Rt=Math.round(180*Je/Math.PI/20);for(let Mt=1;Mt<Rt;Mt++){let bt=Mt/Rt;if(bt!==.5){const Zi=bt-.5;bt+=bt*Zi*(bt-1)*((1.0904+W*(W*(3.55645-1.43519*W)-3.2452))*Zi*Zi+(.848013+W*(.215638*W-1.06021)))}const Yt=ve.sub(ae)._mult(bt)._add(ae)._unit()._mult(qe?-1:1);this.addHalfVertex(q,Yt.x,Yt.y,!1,qe,0,V)}}Q&&this.addCurrentVertex(q,ve,-$e,-St,V)}else if(nt==="butt")this.addCurrentVertex(q,U,0,0,V);else if(nt==="square"){const ot=$?1:-1;this.addCurrentVertex(q,U,ot,ot,V)}else nt==="round"&&($&&(this.addCurrentVertex(q,ae,0,0,V),this.addCurrentVertex(q,ae,1,1,V,!0)),Q&&(this.addCurrentVertex(q,ve,-1,-1,V,!0),this.addCurrentVertex(q,ve,0,0,V)));if(Ne&&he<D-1){const ot=q.dist(Q);if(ot>2*N){const $e=q.add(Q.sub(q)._mult(N/ot)._round());this.updateDistance(q,$e),this.addCurrentVertex($e,ve,0,0,V),q=$e}}}}addCurrentVertex(t,r,o,d,g,_=!1){const x=r.y*d-r.x,T=-r.y-r.x*d;this.addHalfVertex(t,r.x+r.y*o,r.y-r.x*o,_,!1,o,g),this.addHalfVertex(t,x,T,_,!0,-d,g),this.distance>Eh/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,o,d,g,_))}addHalfVertex({x:t,y:r},o,d,g,_,x,T){const P=.5*(this.lineClips?this.scaledDistance*(Eh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(g?1:0),(r<<1)+(_?1:0),Math.round(63*o)+128,Math.round(63*d)+128,1+(x===0?0:x<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const D=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,D,this.e2),T.primitiveLength++),_?this.e2=D:this.e1=D}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let Wo,xr;_t("LineBucket",Mu,{omit:["layers","patternFeatures"]});var Qo={get paint(){return xr=xr||new lr({"line-opacity":new zt(_e.paint_line["line-opacity"]),"line-color":new zt(_e.paint_line["line-color"]),"line-translate":new xt(_e.paint_line["line-translate"]),"line-translate-anchor":new xt(_e.paint_line["line-translate-anchor"]),"line-width":new zt(_e.paint_line["line-width"]),"line-gap-width":new zt(_e.paint_line["line-gap-width"]),"line-offset":new zt(_e.paint_line["line-offset"]),"line-blur":new zt(_e.paint_line["line-blur"]),"line-dasharray":new dn(_e.paint_line["line-dasharray"]),"line-pattern":new pu(_e.paint_line["line-pattern"]),"line-gradient":new jo(_e.paint_line["line-gradient"])})},get layout(){return Wo=Wo||new lr({"line-cap":new xt(_e.layout_line["line-cap"]),"line-join":new zt(_e.layout_line["line-join"]),"line-miter-limit":new xt(_e.layout_line["line-miter-limit"]),"line-round-limit":new xt(_e.layout_line["line-round-limit"]),"line-sort-key":new zt(_e.layout_line["line-sort-key"])})}};class Eu extends zt{possiblyEvaluate(t,r){return r=new Ni(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,o,d){return r=dr({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,o,d)}}let Jo;class Sf extends er{constructor(t){super(t,Qo),this.gradientVersion=0,Jo||(Jo=new Eu(Qo.paint.properties["line-width"].specification),Jo.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof ml,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=Jo.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Mu(t)}queryRadius(t){const r=t,o=xd(Zn("line-width",this,r),Zn("line-gap-width",this,r)),d=Zn("line-offset",this,r);return o/2+Math.abs(d)+hh(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:o,geometry:d,transform:g,pixelsToTileUnits:_}){const x=dh(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-g.bearingInRadians,_),T=_/2*xd(this.paint.get("line-width").evaluate(r,o),this.paint.get("line-gap-width").evaluate(r,o)),P=this.paint.get("line-offset").evaluate(r,o);return P&&(d=function(D,k){const N=[];for(let V=0;V<D.length;V++){const q=D[V],$=[];for(let Q=0;Q<q.length;Q++){const ae=q[Q-1],ve=q[Q],he=q[Q+1],U=Q===0?new Ee(0,0):ve.sub(ae)._unit()._perp(),W=Q===q.length-1?new Ee(0,0):he.sub(ve)._unit()._perp(),fe=U._add(W)._unit(),Ie=fe.x*W.x+fe.y*W.y;Ie!==0&&fe._mult(1/Ie),$.push(fe._mult(k)._add(ve))}N.push($)}return N}(d,P*_)),function(D,k,N){for(let V=0;V<k.length;V++){const q=k[V];if(D.length>=3){for(let $=0;$<q.length;$++)if(zc(D,q[$]))return!0}if(ad(D,q,N))return!0}return!1}(x,d,T)}isTileClipped(){return!0}}function xd(a,t){return t>0?t+2*a:a}const Np=an([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ch=an([{name:"a_projected_pos",components:3,type:"Float32"}],4);an([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Tf=an([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);an([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ya=an([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),jp=an([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function ja(a,t,r){return a.sections.forEach(o=>{o.text=function(d,g,_){const x=g.layout.get("text-transform").evaluate(_,{});return x==="uppercase"?d=d.toLocaleUpperCase():x==="lowercase"&&(d=d.toLocaleLowerCase()),Qa.applyArabicShaping&&(d=Qa.applyArabicShaping(d)),d}(o.text,t,r)}),a}an([{name:"triangle",components:3,type:"Uint16"}]),an([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),an([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),an([{type:"Float32",name:"offsetX"}]),an([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),an([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Cu={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Mf,Ef,el,zn=24,Ah={};function Au(){return Mf||(Mf=1,Ah.read=function(a,t,r,o,d){var g,_,x=8*d-o-1,T=(1<<x)-1,P=T>>1,D=-7,k=r?d-1:0,N=r?-1:1,V=a[t+k];for(k+=N,g=V&(1<<-D)-1,V>>=-D,D+=x;D>0;g=256*g+a[t+k],k+=N,D-=8);for(_=g&(1<<-D)-1,g>>=-D,D+=o;D>0;_=256*_+a[t+k],k+=N,D-=8);if(g===0)g=1-P;else{if(g===T)return _?NaN:1/0*(V?-1:1);_+=Math.pow(2,o),g-=P}return(V?-1:1)*_*Math.pow(2,g-o)},Ah.write=function(a,t,r,o,d,g){var _,x,T,P=8*g-d-1,D=(1<<P)-1,k=D>>1,N=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,V=o?0:g-1,q=o?1:-1,$=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(x=isNaN(t)?1:0,_=D):(_=Math.floor(Math.log(t)/Math.LN2),t*(T=Math.pow(2,-_))<1&&(_--,T*=2),(t+=_+k>=1?N/T:N*Math.pow(2,1-k))*T>=2&&(_++,T/=2),_+k>=D?(x=0,_=D):_+k>=1?(x=(t*T-1)*Math.pow(2,d),_+=k):(x=t*Math.pow(2,k-1)*Math.pow(2,d),_=0));d>=8;a[r+V]=255&x,V+=q,x/=256,d-=8);for(_=_<<d|x,P+=d;P>0;a[r+V]=255&_,V+=q,_/=256,P-=8);a[r+V-q]|=128*$}),Ah}function Cf(){if(el)return Ef;el=1,Ef=t;var a=Au();function t(U){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(U)?U:new Uint8Array(U||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var r=4294967296,o=1/r,d=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function g(U){return U.type===t.Bytes?U.readVarint()+U.pos:U.pos+1}function _(U,W,fe){return fe?4294967296*W+(U>>>0):4294967296*(W>>>0)+(U>>>0)}function x(U,W,fe){var Ie=W<=16383?1:W<=2097151?2:W<=268435455?3:Math.floor(Math.log(W)/(7*Math.LN2));fe.realloc(Ie);for(var Je=fe.pos-1;Je>=U;Je--)fe.buf[Je+Ie]=fe.buf[Je]}function T(U,W){for(var fe=0;fe<U.length;fe++)W.writeVarint(U[fe])}function P(U,W){for(var fe=0;fe<U.length;fe++)W.writeSVarint(U[fe])}function D(U,W){for(var fe=0;fe<U.length;fe++)W.writeFloat(U[fe])}function k(U,W){for(var fe=0;fe<U.length;fe++)W.writeDouble(U[fe])}function N(U,W){for(var fe=0;fe<U.length;fe++)W.writeBoolean(U[fe])}function V(U,W){for(var fe=0;fe<U.length;fe++)W.writeFixed32(U[fe])}function q(U,W){for(var fe=0;fe<U.length;fe++)W.writeSFixed32(U[fe])}function $(U,W){for(var fe=0;fe<U.length;fe++)W.writeFixed64(U[fe])}function Q(U,W){for(var fe=0;fe<U.length;fe++)W.writeSFixed64(U[fe])}function ae(U,W){return(U[W]|U[W+1]<<8|U[W+2]<<16)+16777216*U[W+3]}function ve(U,W,fe){U[fe]=W,U[fe+1]=W>>>8,U[fe+2]=W>>>16,U[fe+3]=W>>>24}function he(U,W){return(U[W]|U[W+1]<<8|U[W+2]<<16)+(U[W+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function(U,W,fe){for(fe=fe||this.length;this.pos<fe;){var Ie=this.readVarint(),Je=Ie>>3,Ne=this.pos;this.type=7&Ie,U(Je,W,this),this.pos===Ne&&this.skip(Ie)}return W},readMessage:function(U,W){return this.readFields(U,W,this.readVarint()+this.pos)},readFixed32:function(){var U=ae(this.buf,this.pos);return this.pos+=4,U},readSFixed32:function(){var U=he(this.buf,this.pos);return this.pos+=4,U},readFixed64:function(){var U=ae(this.buf,this.pos)+ae(this.buf,this.pos+4)*r;return this.pos+=8,U},readSFixed64:function(){var U=ae(this.buf,this.pos)+he(this.buf,this.pos+4)*r;return this.pos+=8,U},readFloat:function(){var U=a.read(this.buf,this.pos,!0,23,4);return this.pos+=4,U},readDouble:function(){var U=a.read(this.buf,this.pos,!0,52,8);return this.pos+=8,U},readVarint:function(U){var W,fe,Ie=this.buf;return W=127&(fe=Ie[this.pos++]),fe<128?W:(W|=(127&(fe=Ie[this.pos++]))<<7,fe<128?W:(W|=(127&(fe=Ie[this.pos++]))<<14,fe<128?W:(W|=(127&(fe=Ie[this.pos++]))<<21,fe<128?W:function(Je,Ne,qe){var st,nt,ot=qe.buf;if(st=(112&(nt=ot[qe.pos++]))>>4,nt<128||(st|=(127&(nt=ot[qe.pos++]))<<3,nt<128)||(st|=(127&(nt=ot[qe.pos++]))<<10,nt<128)||(st|=(127&(nt=ot[qe.pos++]))<<17,nt<128)||(st|=(127&(nt=ot[qe.pos++]))<<24,nt<128)||(st|=(1&(nt=ot[qe.pos++]))<<31,nt<128))return _(Je,st,Ne);throw new Error("Expected varint not more than 10 bytes")}(W|=(15&(fe=Ie[this.pos]))<<28,U,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var U=this.readVarint();return U%2==1?(U+1)/-2:U/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var U=this.readVarint()+this.pos,W=this.pos;return this.pos=U,U-W>=12&&d?function(fe,Ie,Je){return d.decode(fe.subarray(Ie,Je))}(this.buf,W,U):function(fe,Ie,Je){for(var Ne="",qe=Ie;qe<Je;){var st,nt,ot,$e=fe[qe],St=null,Rt=$e>239?4:$e>223?3:$e>191?2:1;if(qe+Rt>Je)break;Rt===1?$e<128&&(St=$e):Rt===2?(192&(st=fe[qe+1]))==128&&(St=(31&$e)<<6|63&st)<=127&&(St=null):Rt===3?(nt=fe[qe+2],(192&(st=fe[qe+1]))==128&&(192&nt)==128&&((St=(15&$e)<<12|(63&st)<<6|63&nt)<=2047||St>=55296&&St<=57343)&&(St=null)):Rt===4&&(nt=fe[qe+2],ot=fe[qe+3],(192&(st=fe[qe+1]))==128&&(192&nt)==128&&(192&ot)==128&&((St=(15&$e)<<18|(63&st)<<12|(63&nt)<<6|63&ot)<=65535||St>=1114112)&&(St=null)),St===null?(St=65533,Rt=1):St>65535&&(St-=65536,Ne+=String.fromCharCode(St>>>10&1023|55296),St=56320|1023&St),Ne+=String.fromCharCode(St),qe+=Rt}return Ne}(this.buf,W,U)},readBytes:function(){var U=this.readVarint()+this.pos,W=this.buf.subarray(this.pos,U);return this.pos=U,W},readPackedVarint:function(U,W){if(this.type!==t.Bytes)return U.push(this.readVarint(W));var fe=g(this);for(U=U||[];this.pos<fe;)U.push(this.readVarint(W));return U},readPackedSVarint:function(U){if(this.type!==t.Bytes)return U.push(this.readSVarint());var W=g(this);for(U=U||[];this.pos<W;)U.push(this.readSVarint());return U},readPackedBoolean:function(U){if(this.type!==t.Bytes)return U.push(this.readBoolean());var W=g(this);for(U=U||[];this.pos<W;)U.push(this.readBoolean());return U},readPackedFloat:function(U){if(this.type!==t.Bytes)return U.push(this.readFloat());var W=g(this);for(U=U||[];this.pos<W;)U.push(this.readFloat());return U},readPackedDouble:function(U){if(this.type!==t.Bytes)return U.push(this.readDouble());var W=g(this);for(U=U||[];this.pos<W;)U.push(this.readDouble());return U},readPackedFixed32:function(U){if(this.type!==t.Bytes)return U.push(this.readFixed32());var W=g(this);for(U=U||[];this.pos<W;)U.push(this.readFixed32());return U},readPackedSFixed32:function(U){if(this.type!==t.Bytes)return U.push(this.readSFixed32());var W=g(this);for(U=U||[];this.pos<W;)U.push(this.readSFixed32());return U},readPackedFixed64:function(U){if(this.type!==t.Bytes)return U.push(this.readFixed64());var W=g(this);for(U=U||[];this.pos<W;)U.push(this.readFixed64());return U},readPackedSFixed64:function(U){if(this.type!==t.Bytes)return U.push(this.readSFixed64());var W=g(this);for(U=U||[];this.pos<W;)U.push(this.readSFixed64());return U},skip:function(U){var W=7&U;if(W===t.Varint)for(;this.buf[this.pos++]>127;);else if(W===t.Bytes)this.pos=this.readVarint()+this.pos;else if(W===t.Fixed32)this.pos+=4;else{if(W!==t.Fixed64)throw new Error("Unimplemented type: "+W);this.pos+=8}},writeTag:function(U,W){this.writeVarint(U<<3|W)},realloc:function(U){for(var W=this.length||16;W<this.pos+U;)W*=2;if(W!==this.length){var fe=new Uint8Array(W);fe.set(this.buf),this.buf=fe,this.length=W}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(U){this.realloc(4),ve(this.buf,U,this.pos),this.pos+=4},writeSFixed32:function(U){this.realloc(4),ve(this.buf,U,this.pos),this.pos+=4},writeFixed64:function(U){this.realloc(8),ve(this.buf,-1&U,this.pos),ve(this.buf,Math.floor(U*o),this.pos+4),this.pos+=8},writeSFixed64:function(U){this.realloc(8),ve(this.buf,-1&U,this.pos),ve(this.buf,Math.floor(U*o),this.pos+4),this.pos+=8},writeVarint:function(U){(U=+U||0)>268435455||U<0?function(W,fe){var Ie,Je;if(W>=0?(Ie=W%4294967296|0,Je=W/4294967296|0):(Je=~(-W/4294967296),4294967295^(Ie=~(-W%4294967296))?Ie=Ie+1|0:(Ie=0,Je=Je+1|0)),W>=18446744073709552e3||W<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");fe.realloc(10),function(Ne,qe,st){st.buf[st.pos++]=127&Ne|128,Ne>>>=7,st.buf[st.pos++]=127&Ne|128,Ne>>>=7,st.buf[st.pos++]=127&Ne|128,Ne>>>=7,st.buf[st.pos++]=127&Ne|128,st.buf[st.pos]=127&(Ne>>>=7)}(Ie,0,fe),function(Ne,qe){var st=(7&Ne)<<4;qe.buf[qe.pos++]|=st|((Ne>>>=3)?128:0),Ne&&(qe.buf[qe.pos++]=127&Ne|((Ne>>>=7)?128:0),Ne&&(qe.buf[qe.pos++]=127&Ne|((Ne>>>=7)?128:0),Ne&&(qe.buf[qe.pos++]=127&Ne|((Ne>>>=7)?128:0),Ne&&(qe.buf[qe.pos++]=127&Ne|((Ne>>>=7)?128:0),Ne&&(qe.buf[qe.pos++]=127&Ne)))))}(Je,fe)}(U,this):(this.realloc(4),this.buf[this.pos++]=127&U|(U>127?128:0),U<=127||(this.buf[this.pos++]=127&(U>>>=7)|(U>127?128:0),U<=127||(this.buf[this.pos++]=127&(U>>>=7)|(U>127?128:0),U<=127||(this.buf[this.pos++]=U>>>7&127))))},writeSVarint:function(U){this.writeVarint(U<0?2*-U-1:2*U)},writeBoolean:function(U){this.writeVarint(!!U)},writeString:function(U){U=String(U),this.realloc(4*U.length),this.pos++;var W=this.pos;this.pos=function(Ie,Je,Ne){for(var qe,st,nt=0;nt<Je.length;nt++){if((qe=Je.charCodeAt(nt))>55295&&qe<57344){if(!st){qe>56319||nt+1===Je.length?(Ie[Ne++]=239,Ie[Ne++]=191,Ie[Ne++]=189):st=qe;continue}if(qe<56320){Ie[Ne++]=239,Ie[Ne++]=191,Ie[Ne++]=189,st=qe;continue}qe=st-55296<<10|qe-56320|65536,st=null}else st&&(Ie[Ne++]=239,Ie[Ne++]=191,Ie[Ne++]=189,st=null);qe<128?Ie[Ne++]=qe:(qe<2048?Ie[Ne++]=qe>>6|192:(qe<65536?Ie[Ne++]=qe>>12|224:(Ie[Ne++]=qe>>18|240,Ie[Ne++]=qe>>12&63|128),Ie[Ne++]=qe>>6&63|128),Ie[Ne++]=63&qe|128)}return Ne}(this.buf,U,this.pos);var fe=this.pos-W;fe>=128&&x(W,fe,this),this.pos=W-1,this.writeVarint(fe),this.pos+=fe},writeFloat:function(U){this.realloc(4),a.write(this.buf,U,this.pos,!0,23,4),this.pos+=4},writeDouble:function(U){this.realloc(8),a.write(this.buf,U,this.pos,!0,52,8),this.pos+=8},writeBytes:function(U){var W=U.length;this.writeVarint(W),this.realloc(W);for(var fe=0;fe<W;fe++)this.buf[this.pos++]=U[fe]},writeRawMessage:function(U,W){this.pos++;var fe=this.pos;U(W,this);var Ie=this.pos-fe;Ie>=128&&x(fe,Ie,this),this.pos=fe-1,this.writeVarint(Ie),this.pos+=Ie},writeMessage:function(U,W,fe){this.writeTag(U,t.Bytes),this.writeRawMessage(W,fe)},writePackedVarint:function(U,W){W.length&&this.writeMessage(U,T,W)},writePackedSVarint:function(U,W){W.length&&this.writeMessage(U,P,W)},writePackedBoolean:function(U,W){W.length&&this.writeMessage(U,N,W)},writePackedFloat:function(U,W){W.length&&this.writeMessage(U,D,W)},writePackedDouble:function(U,W){W.length&&this.writeMessage(U,k,W)},writePackedFixed32:function(U,W){W.length&&this.writeMessage(U,V,W)},writePackedSFixed32:function(U,W){W.length&&this.writeMessage(U,q,W)},writePackedFixed64:function(U,W){W.length&&this.writeMessage(U,$,W)},writePackedSFixed64:function(U,W){W.length&&this.writeMessage(U,Q,W)},writeBytesField:function(U,W){this.writeTag(U,t.Bytes),this.writeBytes(W)},writeFixed32Field:function(U,W){this.writeTag(U,t.Fixed32),this.writeFixed32(W)},writeSFixed32Field:function(U,W){this.writeTag(U,t.Fixed32),this.writeSFixed32(W)},writeFixed64Field:function(U,W){this.writeTag(U,t.Fixed64),this.writeFixed64(W)},writeSFixed64Field:function(U,W){this.writeTag(U,t.Fixed64),this.writeSFixed64(W)},writeVarintField:function(U,W){this.writeTag(U,t.Varint),this.writeVarint(W)},writeSVarintField:function(U,W){this.writeTag(U,t.Varint),this.writeSVarint(W)},writeStringField:function(U,W){this.writeTag(U,t.Bytes),this.writeString(W)},writeFloatField:function(U,W){this.writeTag(U,t.Fixed32),this.writeFloat(W)},writeDoubleField:function(U,W){this.writeTag(U,t.Fixed64),this.writeDouble(W)},writeBooleanField:function(U,W){this.writeVarintField(U,!!W)}},Ef}var tl,bd=J(Cf());function Af(a,t,r){a===1&&r.readMessage(zf,t)}function zf(a,t,r){if(a===3){const{id:o,bitmap:d,width:g,height:_,left:x,top:T,advance:P}=r.readMessage(Rm,{});t.push({id:o,bitmap:new yu({width:g+6,height:_+6},d),metrics:{width:g,height:_,left:x,top:T,advance:P}})}}function Rm(a,t,r){a===1?t.id=r.readVarint():a===2?t.bitmap=r.readBytes():a===3?t.width=r.readVarint():a===4?t.height=r.readVarint():a===5?t.left=r.readSVarint():a===6?t.top=r.readSVarint():a===7&&(t.advance=r.readVarint())}function Up(a){let t=0,r=0;for(const _ of a)t+=_.w*_.h,r=Math.max(r,_.w);a.sort((_,x)=>x.h-_.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let d=0,g=0;for(const _ of a)for(let x=o.length-1;x>=0;x--){const T=o[x];if(!(_.w>T.w||_.h>T.h)){if(_.x=T.x,_.y=T.y,g=Math.max(g,_.y+_.h),d=Math.max(d,_.x+_.w),_.w===T.w&&_.h===T.h){const P=o.pop();x<o.length&&(o[x]=P)}else _.h===T.h?(T.x+=_.w,T.w-=_.w):_.w===T.w?(T.y+=_.h,T.h-=_.h):(o.push({x:T.x+_.w,y:T.y,w:T.w-_.w,h:_.h}),T.y+=_.h,T.h-=_.h);break}}return{w:d,h:g,fill:t/(d*g)||0}}class Pf{constructor(t,{pixelRatio:r,version:o,stretchX:d,stretchY:g,content:_,textFitWidth:x,textFitHeight:T}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=d,this.stretchY=g,this.content=_,this.version=o,this.textFitWidth=x,this.textFitHeight=T}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Rf{constructor(t,r){const o={},d={};this.haveRenderCallbacks=[];const g=[];this.addImages(t,o,g),this.addImages(r,d,g);const{w:_,h:x}=Up(g),T=new zr({width:_||1,height:x||1});for(const P in t){const D=t[P],k=o[P].paddedRect;zr.copy(D.data,T,{x:0,y:0},{x:k.x+1,y:k.y+1},D.data)}for(const P in r){const D=r[P],k=d[P].paddedRect,N=k.x+1,V=k.y+1,q=D.data.width,$=D.data.height;zr.copy(D.data,T,{x:0,y:0},{x:N,y:V},D.data),zr.copy(D.data,T,{x:0,y:$-1},{x:N,y:V-1},{width:q,height:1}),zr.copy(D.data,T,{x:0,y:0},{x:N,y:V+$},{width:q,height:1}),zr.copy(D.data,T,{x:q-1,y:0},{x:N-1,y:V},{width:1,height:$}),zr.copy(D.data,T,{x:0,y:0},{x:N+q,y:V},{width:1,height:$})}this.image=T,this.iconPositions=o,this.patternPositions=d}addImages(t,r,o){for(const d in t){const g=t[d],_={x:0,y:0,w:g.data.width+2,h:g.data.height+2};o.push(_),r[d]=new Pf(_,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),r),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),r)}patchUpdatedImage(t,r,o){if(!t||!r||t.version===r.version)return;t.version=r.version;const[d,g]=t.tl;o.update(r.data,void 0,{x:d,y:g})}}_t("ImagePosition",Pf),_t("ImageAtlas",Rf),A.an=void 0,(tl=A.an||(A.an={}))[tl.none=0]="none",tl[tl.horizontal=1]="horizontal",tl[tl.vertical=2]="vertical",tl[tl.horizontalOnly=3]="horizontalOnly";class zu{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,r,o){const d=new zu;return d.scale=t||1,d.fontStack=r,d.verticalAlign=o||"bottom",d}static forImage(t,r){const o=new zu;return o.imageName=t,o.verticalAlign=r||"bottom",o}}class Ds{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const o=new Ds;for(let d=0;d<t.sections.length;d++){const g=t.sections[d];g.image?o.addImageSection(g):o.addTextSection(g,r)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let r="";for(let o=0;o<t.length;o++){const d=t.charCodeAt(o+1)||null,g=t.charCodeAt(o-1)||null;r+=d&&hu(d)&&!Cu[t[o+1]]||g&&hu(g)&&!Cu[t[o-1]]||!Cu[t[o]]?t[o]:Cu[t[o]]}return r}(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&zh[this.text.charCodeAt(o)];o++)t++;let r=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&zh[this.text.charCodeAt(o)];o--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const o=new Ds;return o.text=this.text.substring(t,r),o.sectionIndex=this.sectionIndex.slice(t,r),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}getMaxImageSize(t){let r=0,o=0;for(let d=0;d<this.length();d++){const g=this.getSection(d);if(g.imageName){const _=t[g.imageName];if(!_)continue;const x=_.displaySize;r=Math.max(r,x[0]),o=Math.max(o,x[1])}}return{maxImageWidth:r,maxImageHeight:o}}addTextSection(t,r){this.text+=t.text,this.sections.push(zu.forText(t.scale,t.fontStack||r,t.verticalAlign));const o=this.sections.length-1;for(let d=0;d<t.text.length;++d)this.sectionIndex.push(o)}addImageSection(t){const r=t.image?t.image.name:"";if(r.length===0)return void Xi("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(zu.forImage(r,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Xi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Lc(a,t,r,o,d,g,_,x,T,P,D,k,N,V,q){const $=Ds.fromFeature(a,d);let Q;k===A.an.vertical&&$.verticalizePunctuation();const{processBidirectionalText:ae,processStyledBidirectionalText:ve}=Qa;if(ae&&$.sections.length===1){Q=[];const W=ae($.toString(),wd($,P,g,t,o,V));for(const fe of W){const Ie=new Ds;Ie.text=fe,Ie.sections=$.sections;for(let Je=0;Je<fe.length;Je++)Ie.sectionIndex.push(0);Q.push(Ie)}}else if(ve){Q=[];const W=ve($.text,$.sectionIndex,wd($,P,g,t,o,V));for(const fe of W){const Ie=new Ds;Ie.text=fe[0],Ie.sectionIndex=fe[1],Ie.sections=$.sections,Q.push(Ie)}}else Q=function(W,fe){const Ie=[],Je=W.text;let Ne=0;for(const qe of fe)Ie.push(W.substring(Ne,qe)),Ne=qe;return Ne<Je.length&&Ie.push(W.substring(Ne,Je.length)),Ie}($,wd($,P,g,t,o,V));const he=[],U={positionedLines:he,text:$.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:k,iconsInText:!1,verticalizable:!1};return function(W,fe,Ie,Je,Ne,qe,st,nt,ot,$e,St,Rt){let Mt=0,bt=0,Yt=0,Zi=0;const mn=nt==="right"?1:nt==="left"?0:.5,gn=zn/Rt;let Ua=0;for(const hn of Ne){hn.trim();const Hn=hn.getMaxScale(),Un={positionedGlyphs:[],lineOffset:0};W.positionedLines[Ua]=Un;const ir=Un.positionedGlyphs;let Fr=0;if(!hn.length()){bt+=qe,++Ua;continue}const Nr=Lf(Je,hn,gn);for(let jr=0;jr<hn.length();jr++){const _n=hn.getSection(jr),Vn=hn.getSectionIndex(jr),Dn=hn.getCharCode(jr),In=$p(ot,St,Dn);let Qi;if(_n.imageName){if(W.iconsInText=!0,_n.scale=_n.scale*gn,Qi=Im(_n,In,Hn,Nr,Je),!Qi)continue;Fr=Math.max(Fr,Qi.imageOffset)}else if(Qi=Dm(_n,Dn,In,Nr,fe,Ie),!Qi)continue;const{rect:xa,metrics:i,baselineOffset:s}=Qi;ir.push({glyph:Dn,imageName:_n.imageName,x:Mt,y:bt+s+-17,vertical:In,scale:_n.scale,fontStack:_n.fontStack,sectionIndex:Vn,metrics:i,rect:xa}),In?(W.verticalizable=!0,Mt+=(_n.imageName?i.advance:zn)*_n.scale+$e):Mt+=i.advance*_n.scale+$e}ir.length!==0&&(Yt=Math.max(Mt-$e,Yt),km(ir,0,ir.length-1,mn)),Mt=0,Un.lineOffset=Math.max(Fr,(Hn-1)*zn);const Rn=qe*Hn+Fr;bt+=Rn,Zi=Math.max(Rn,Zi),++Ua}const{horizontalAlign:Br,verticalAlign:Pn}=Vi(st);(function(hn,Hn,Un,ir,Fr,Nr,Rn,jr,_n){const Vn=(Hn-Un)*Fr;let Dn=0;Dn=Nr!==Rn?-jr*ir- -17:-ir*_n*Rn+.5*Rn;for(const In of hn)for(const Qi of In.positionedGlyphs)Qi.x+=Vn,Qi.y+=Dn})(W.positionedLines,mn,Br,Pn,Yt,Zi,qe,bt,Ne.length),W.top+=-Pn*bt,W.bottom=W.top+bt,W.left+=-Br*Yt,W.right=W.left+Yt}(U,t,r,o,Q,_,x,T,k,P,N,q),!function(W){for(const fe of W)if(fe.positionedGlyphs.length!==0)return!1;return!0}(he)&&U}const zh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Vp={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Gp={40:!0};function Df(a,t,r,o,d,g){if(t.imageName){const _=o[t.imageName];return _?_.displaySize[0]*t.scale*zn/g+d:0}{const _=r[t.fontStack],x=_&&_[a];return x?x.metrics.advance*t.scale+d:0}}function If(a,t,r,o){const d=Math.pow(a-t,2);return o?a<t?d/2:2*d:d+Math.abs(r)*r}function qp(a,t,r){let o=0;return a===10&&(o-=1e4),r&&(o+=150),a!==40&&a!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function Ph(a,t,r,o,d,g){let _=null,x=If(t,r,d,g);for(const T of o){const P=If(t-T.x,r,d,g)+T.badness;P<=x&&(_=T,x=P)}return{index:a,x:t,priorBreak:_,badness:x}}function kf(a){return a?kf(a.priorBreak).concat(a.index):[]}function wd(a,t,r,o,d,g){if(!a)return[];const _=[],x=function(k,N,V,q,$,Q){let ae=0;for(let ve=0;ve<k.length();ve++){const he=k.getSection(ve);ae+=Df(k.getCharCode(ve),he,q,$,N,Q)}return ae/Math.max(1,Math.ceil(ae/V))}(a,t,r,o,d,g),T=a.text.indexOf("​")>=0;let P=0;for(let k=0;k<a.length();k++){const N=a.getSection(k),V=a.getCharCode(k);if(zh[V]||(P+=Df(V,N,o,d,t,g)),k<a.length()-1){const q=!((D=V)<11904)&&(!!ii["CJK Compatibility Forms"](D)||!!ii["CJK Compatibility"](D)||!!ii["CJK Strokes"](D)||!!ii["CJK Symbols and Punctuation"](D)||!!ii["Enclosed CJK Letters and Months"](D)||!!ii["Halfwidth and Fullwidth Forms"](D)||!!ii["Ideographic Description Characters"](D)||!!ii["Vertical Forms"](D)||Fo.test(String.fromCodePoint(D)));(Vp[V]||q||N.imageName||k!==a.length()-2&&Gp[a.getCharCode(k+1)])&&_.push(Ph(k+1,P,x,_,qp(V,a.getCharCode(k+1),q&&T),!1))}}var D;return kf(Ph(a.length(),P,x,_,0,!0))}function Vi(a){let t=.5,r=.5;switch(a){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function Lf(a,t,r){const o=t.getMaxScale()*zn,{maxImageWidth:d,maxImageHeight:g}=t.getMaxImageSize(a),_=Math.max(o,g*r);return{verticalLineContentWidth:Math.max(o,d*r),horizontalLineContentHeight:_}}function Zp(a){switch(a){case"top":return 0;case"center":return .5;default:return 1}}function $p(a,t,r){return!(a===A.an.horizontal||!t&&!to(r)||t&&(zh[r]||(o=r,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function Dm(a,t,r,o,d,g){const _=g[a.fontStack],x=function(P,D,k,N){if(P&&P.rect)return P;const V=D[k.fontStack],q=V&&V[N];return q?{rect:null,metrics:q.metrics}:null}(_&&_[t],d,a,t);if(x===null)return null;let T;if(r)T=o.verticalLineContentWidth-a.scale*zn;else{const P=Zp(a.verticalAlign);T=(o.horizontalLineContentHeight-a.scale*zn)*P}return{rect:x.rect,metrics:x.metrics,baselineOffset:T}}function Im(a,t,r,o,d){const g=d[a.imageName];if(!g)return null;const _=g.paddedRect,x=g.displaySize,T={width:x[0],height:x[1],left:1,top:-3,advance:t?x[1]:x[0]};let P;if(t)P=o.verticalLineContentWidth-x[1]*a.scale;else{const D=Zp(a.verticalAlign);P=(o.horizontalLineContentHeight-x[1]*a.scale)*D}return{rect:_,metrics:T,baselineOffset:P,imageOffset:(t?x[0]:x[1])*a.scale-zn*r}}function km(a,t,r,o){if(o===0)return;const d=a[r],g=(a[r].x+d.metrics.advance*d.scale)*o;for(let _=t;_<=r;_++)a[_].x-=g}function Sd(a,t,r){const{horizontalAlign:o,verticalAlign:d}=Vi(r),g=t[0]-a.displaySize[0]*o,_=t[1]-a.displaySize[1]*d;return{image:a,top:_,bottom:_+a.displaySize[1],left:g,right:g+a.displaySize[0]}}function Oc(a){var t,r;let o=a.left,d=a.top,g=a.right-o,_=a.bottom-d;const x=(t=a.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",T=(r=a.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",P=(a.image.content[2]-a.image.content[0])/(a.image.content[3]-a.image.content[1]);if(T==="proportional"){if(x==="stretchOnly"&&g/_<P||x==="proportional"){const D=Math.ceil(_*P);o*=D/g,g=D}}else if(x==="proportional"&&T==="stretchOnly"&&P!==0&&g/_>P){const D=Math.ceil(g/P);d*=D/_,_=D}return{x1:o,y1:d,x2:o+g,y2:d+_}}function Td(a,t,r,o,d,g){const _=a.image;let x;if(_.content){const Q=_.content,ae=_.pixelRatio||1;x=[Q[0]/ae,Q[1]/ae,_.displaySize[0]-Q[2]/ae,_.displaySize[1]-Q[3]/ae]}const T=t.left*g,P=t.right*g;let D,k,N,V;r==="width"||r==="both"?(V=d[0]+T-o[3],k=d[0]+P+o[1]):(V=d[0]+(T+P-_.displaySize[0])/2,k=V+_.displaySize[0]);const q=t.top*g,$=t.bottom*g;return r==="height"||r==="both"?(D=d[1]+q-o[0],N=d[1]+$+o[2]):(D=d[1]+(q+$-_.displaySize[1])/2,N=D+_.displaySize[1]),{image:_,top:D,right:k,bottom:N,left:V,collisionPadding:x}}const as=128,co=32640;function Nl(a,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Ni(a+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:d}=r;let g=0;for(;g<o.length&&o[g]<=a;)g++;g=Math.max(0,g-1);let _=g;for(;_<o.length&&o[_]<a+1;)_++;_=Math.min(o.length-1,_);const x=o[g],T=o[_];return r.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:T,interpolationType:d}:{kind:"camera",minZoom:x,maxZoom:T,minSize:r.evaluate(new Ni(x)),maxSize:r.evaluate(new Ni(T)),interpolationType:d}}}function ss(a,t,r){let o="never";const d=a.get(t);return d?o=d:a.get(r)&&(o="always"),o}const Rh=Oi.VectorTileFeature.types,Lm=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Dh(a,t,r,o,d,g,_,x,T,P,D,k,N){const V=x?Math.min(co,Math.round(x[0])):0,q=x?Math.min(co,Math.round(x[1])):0;a.emplaceBack(t,r,Math.round(32*o),Math.round(32*d),g,_,(V<<1)+(T?1:0),q,16*P,16*D,256*k,256*N)}function Md(a,t,r){a.emplaceBack(t.x,t.y,r),a.emplaceBack(t.x,t.y,r),a.emplaceBack(t.x,t.y,r),a.emplaceBack(t.x,t.y,r)}function Hp(a){for(const t of a.sections)if(fu(t.text))return!0;return!1}class Ed{constructor(t){this.layoutVertexArray=new Wt,this.indexArray=new zi,this.programConfigurations=t,this.segments=new hi,this.dynamicLayoutVertexArray=new gi,this.opacityVertexArray=new sn,this.hasVisibleVertices=!1,this.placedSymbolArray=new ne}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,o,d){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Np.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Ch.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Lm,!0),this.opacityVertexBuffer.itemSize=1),(o||d)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}_t("SymbolBuffers",Ed);class Of{constructor(t,r,o){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new o,this.segments=new hi,this.collisionVertexArray=new un}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Tf.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}_t("CollisionBuffers",Of);class jl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(_=>_.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Nl(this.zoom,r["text-size"]),this.iconSizeData=Nl(this.zoom,r["icon-size"]);const o=this.layers[0].layout,d=o.get("symbol-sort-key"),g=o.get("symbol-z-order");this.canOverlap=ss(o,"text-overlap","text-allow-overlap")!=="never"||ss(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&!d.isConstant(),this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(_=>A.an[_])),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=t.sourceID}createArrays(){this.text=new Ed(new Ar(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Ed(new Ar(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new oe,this.lineVertexArray=new pe,this.symbolInstances=new ue,this.textAnchorOffsets=new le}calculateGlyphDependencies(t,r,o,d,g){for(let _=0;_<t.length;_++)if(r[t.charCodeAt(_)]=!0,(o||d)&&g){const x=Cu[t.charAt(_)];x&&(r[x.charCodeAt(0)]=!0)}}populate(t,r,o){const d=this.layers[0],g=d.layout,_=g.get("text-font"),x=g.get("text-field"),T=g.get("icon-image"),P=(x.value.kind!=="constant"||x.value.value instanceof ar&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(_.value.kind!=="constant"||_.value.value.length>0),D=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,k=g.get("symbol-sort-key");if(this.features=[],!P&&!D)return;const N=r.iconDependencies,V=r.glyphDependencies,q=r.availableImages,$=new Ni(this.zoom,{globalState:this.globalState});for(const{feature:Q,id:ae,index:ve,sourceLayerIndex:he}of t){const U=d._featureFilter.needGeometry,W=kl(Q,U);if(!d._featureFilter.filter($,W,o))continue;let fe,Ie;if(U||(W.geometry=$o(Q)),P){const Ne=d.getValueAndResolveTokens("text-field",W,o,q),qe=ar.factory(Ne),st=this.hasRTLText=this.hasRTLText||Hp(qe);(!st||Qa.getRTLTextPluginStatus()==="unavailable"||st&&Qa.isParsed())&&(fe=ja(qe,d,W))}if(D){const Ne=d.getValueAndResolveTokens("icon-image",W,o,q);Ie=Ne instanceof sr?Ne:sr.fromString(Ne)}if(!fe&&!Ie)continue;const Je=this.sortFeaturesByKey?k.evaluate(W,{},o):void 0;if(this.features.push({id:ae,text:fe,icon:Ie,index:ve,sourceLayerIndex:he,geometry:W.geometry,properties:Q.properties,type:Rh[Q.type],sortKey:Je}),Ie&&(N[Ie.name]=!0),fe){const Ne=_.evaluate(W,{},o).join(","),qe=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(A.an.vertical)>=0;for(const st of fe.sections)if(st.image)N[st.image.name]=!0;else{const nt=Ka(fe.toString()),ot=st.fontStack||Ne,$e=V[ot]=V[ot]||{};this.calculateGlyphDependencies(st.text,$e,qe,this.allowVerticalPlacement,nt)}}}g.get("symbol-placement")==="line"&&(this.features=function(Q){const ae={},ve={},he=[];let U=0;function W(Ne){he.push(Q[Ne]),U++}function fe(Ne,qe,st){const nt=ve[Ne];return delete ve[Ne],ve[qe]=nt,he[nt].geometry[0].pop(),he[nt].geometry[0]=he[nt].geometry[0].concat(st[0]),nt}function Ie(Ne,qe,st){const nt=ae[qe];return delete ae[qe],ae[Ne]=nt,he[nt].geometry[0].shift(),he[nt].geometry[0]=st[0].concat(he[nt].geometry[0]),nt}function Je(Ne,qe,st){const nt=st?qe[0][qe[0].length-1]:qe[0][0];return`${Ne}:${nt.x}:${nt.y}`}for(let Ne=0;Ne<Q.length;Ne++){const qe=Q[Ne],st=qe.geometry,nt=qe.text?qe.text.toString():null;if(!nt){W(Ne);continue}const ot=Je(nt,st),$e=Je(nt,st,!0);if(ot in ve&&$e in ae&&ve[ot]!==ae[$e]){const St=Ie(ot,$e,st),Rt=fe(ot,$e,he[St].geometry);delete ae[ot],delete ve[$e],ve[Je(nt,he[Rt].geometry,!0)]=Rt,he[St].geometry=null}else ot in ve?fe(ot,$e,st):$e in ae?Ie(ot,$e,st):(W(Ne),ae[ot]=U-1,ve[$e]=U-1)}return he.filter(Ne=>Ne.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Q,ae)=>Q.sortKey-ae.sortKey)}update(t,r,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,o),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const o=this.lineVertexArray.length;if(t.segment!==void 0){let d=t.dist(r[t.segment+1]),g=t.dist(r[t.segment]);const _={};for(let x=t.segment+1;x<r.length;x++)_[x]={x:r[x].x,y:r[x].y,tileUnitDistanceFromAnchor:d},x<r.length-1&&(d+=r[x+1].dist(r[x]));for(let x=t.segment||0;x>=0;x--)_[x]={x:r[x].x,y:r[x].y,tileUnitDistanceFromAnchor:g},x>0&&(g+=r[x-1].dist(r[x]));for(let x=0;x<r.length;x++){const T=_[x];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,r,o,d,g,_,x,T,P,D,k,N){const V=t.indexArray,q=t.layoutVertexArray,$=t.segments.prepareSegment(4*r.length,q,V,this.canOverlap?_.sortKey:void 0),Q=this.glyphOffsetArray.length,ae=$.vertexLength,ve=this.allowVerticalPlacement&&x===A.an.vertical?Math.PI/2:0,he=_.text&&_.text.sections;for(let U=0;U<r.length;U++){const{tl:W,tr:fe,bl:Ie,br:Je,tex:Ne,pixelOffsetTL:qe,pixelOffsetBR:st,minFontScaleX:nt,minFontScaleY:ot,glyphOffset:$e,isSDF:St,sectionIndex:Rt}=r[U],Mt=$.vertexLength,bt=$e[1];Dh(q,T.x,T.y,W.x,bt+W.y,Ne.x,Ne.y,o,St,qe.x,qe.y,nt,ot),Dh(q,T.x,T.y,fe.x,bt+fe.y,Ne.x+Ne.w,Ne.y,o,St,st.x,qe.y,nt,ot),Dh(q,T.x,T.y,Ie.x,bt+Ie.y,Ne.x,Ne.y+Ne.h,o,St,qe.x,st.y,nt,ot),Dh(q,T.x,T.y,Je.x,bt+Je.y,Ne.x+Ne.w,Ne.y+Ne.h,o,St,st.x,st.y,nt,ot),Md(t.dynamicLayoutVertexArray,T,ve),V.emplaceBack(Mt,Mt+2,Mt+1),V.emplaceBack(Mt+1,Mt+2,Mt+3),$.vertexLength+=4,$.primitiveLength+=2,this.glyphOffsetArray.emplaceBack($e[0]),U!==r.length-1&&Rt===r[U+1].sectionIndex||t.programConfigurations.populatePaintArrays(q.length,_,_.index,{},N,he&&he[Rt])}t.placedSymbolArray.emplaceBack(T.x,T.y,Q,this.glyphOffsetArray.length-Q,ae,P,D,T.segment,o?o[0]:0,o?o[1]:0,d[0],d[1],x,0,!1,0,k)}_addCollisionDebugVertex(t,r,o,d,g,_){return r.emplaceBack(0,0),t.emplaceBack(o.x,o.y,d,g,Math.round(_.x),Math.round(_.y))}addCollisionDebugVertices(t,r,o,d,g,_,x){const T=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),P=T.vertexLength,D=g.layoutVertexArray,k=g.collisionVertexArray,N=x.anchorX,V=x.anchorY;this._addCollisionDebugVertex(D,k,_,N,V,new Ee(t,r)),this._addCollisionDebugVertex(D,k,_,N,V,new Ee(o,r)),this._addCollisionDebugVertex(D,k,_,N,V,new Ee(o,d)),this._addCollisionDebugVertex(D,k,_,N,V,new Ee(t,d)),T.vertexLength+=4;const q=g.indexArray;q.emplaceBack(P,P+1),q.emplaceBack(P+1,P+2),q.emplaceBack(P+2,P+3),q.emplaceBack(P+3,P),T.primitiveLength+=4}addDebugCollisionBoxes(t,r,o,d){for(let g=t;g<r;g++){const _=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(_.x1,_.y1,_.x2,_.y2,d?this.textCollisionBox:this.iconCollisionBox,_.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Of(Ai,ya.members,Pi),this.iconCollisionBox=new Of(Ai,ya.members,Pi);for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,o,d,g,_,x,T,P){const D={};for(let k=r;k<o;k++){const N=t.get(k);D.textBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},D.textFeatureIndex=N.featureIndex;break}for(let k=d;k<g;k++){const N=t.get(k);D.verticalTextBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},D.verticalTextFeatureIndex=N.featureIndex;break}for(let k=_;k<x;k++){const N=t.get(k);D.iconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},D.iconFeatureIndex=N.featureIndex;break}for(let k=T;k<P;k++){const N=t.get(k);D.verticalIconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},D.verticalIconFeatureIndex=N.featureIndex;break}return D}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){const o=t.placedSymbolArray.get(r),d=o.vertexStartIndex+4*o.numGlyphs;for(let g=o.vertexStartIndex;g<d;g+=4)t.indexArray.emplaceBack(g,g+2,g+1),t.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),o=Math.cos(t),d=[],g=[],_=[];for(let x=0;x<this.symbolInstances.length;++x){_.push(x);const T=this.symbolInstances.get(x);d.push(0|Math.round(r*T.anchorX+o*T.anchorY)),g.push(T.featureIndex)}return _.sort((x,T)=>d[x]-d[T]||g[T]-g[x]),_}addToSortKeyRanges(t,r){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===r?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const o=this.symbolInstances.get(r);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((d,g,_)=>{d>=0&&_.indexOf(d)===g&&this.addIndicesForPlacedSymbol(this.text,d)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Bf,Ff;_t("SymbolBucket",jl,{omit:["layers","collisionBoxArray","features","compareText"]}),jl.MAX_GLYPHS=65535,jl.addDynamicAttributes=Md;var Nf={get paint(){return Ff=Ff||new lr({"icon-opacity":new zt(_e.paint_symbol["icon-opacity"]),"icon-color":new zt(_e.paint_symbol["icon-color"]),"icon-halo-color":new zt(_e.paint_symbol["icon-halo-color"]),"icon-halo-width":new zt(_e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new zt(_e.paint_symbol["icon-halo-blur"]),"icon-translate":new xt(_e.paint_symbol["icon-translate"]),"icon-translate-anchor":new xt(_e.paint_symbol["icon-translate-anchor"]),"text-opacity":new zt(_e.paint_symbol["text-opacity"]),"text-color":new zt(_e.paint_symbol["text-color"],{runtimeType:Rr,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new zt(_e.paint_symbol["text-halo-color"]),"text-halo-width":new zt(_e.paint_symbol["text-halo-width"]),"text-halo-blur":new zt(_e.paint_symbol["text-halo-blur"]),"text-translate":new xt(_e.paint_symbol["text-translate"]),"text-translate-anchor":new xt(_e.paint_symbol["text-translate-anchor"])})},get layout(){return Bf=Bf||new lr({"symbol-placement":new xt(_e.layout_symbol["symbol-placement"]),"symbol-spacing":new xt(_e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new xt(_e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new zt(_e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new xt(_e.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new xt(_e.layout_symbol["icon-allow-overlap"]),"icon-overlap":new xt(_e.layout_symbol["icon-overlap"]),"icon-ignore-placement":new xt(_e.layout_symbol["icon-ignore-placement"]),"icon-optional":new xt(_e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new xt(_e.layout_symbol["icon-rotation-alignment"]),"icon-size":new zt(_e.layout_symbol["icon-size"]),"icon-text-fit":new xt(_e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new xt(_e.layout_symbol["icon-text-fit-padding"]),"icon-image":new zt(_e.layout_symbol["icon-image"]),"icon-rotate":new zt(_e.layout_symbol["icon-rotate"]),"icon-padding":new zt(_e.layout_symbol["icon-padding"]),"icon-keep-upright":new xt(_e.layout_symbol["icon-keep-upright"]),"icon-offset":new zt(_e.layout_symbol["icon-offset"]),"icon-anchor":new zt(_e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new xt(_e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new xt(_e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new xt(_e.layout_symbol["text-rotation-alignment"]),"text-field":new zt(_e.layout_symbol["text-field"]),"text-font":new zt(_e.layout_symbol["text-font"]),"text-size":new zt(_e.layout_symbol["text-size"]),"text-max-width":new zt(_e.layout_symbol["text-max-width"]),"text-line-height":new xt(_e.layout_symbol["text-line-height"]),"text-letter-spacing":new zt(_e.layout_symbol["text-letter-spacing"]),"text-justify":new zt(_e.layout_symbol["text-justify"]),"text-radial-offset":new zt(_e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new xt(_e.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new zt(_e.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new zt(_e.layout_symbol["text-anchor"]),"text-max-angle":new xt(_e.layout_symbol["text-max-angle"]),"text-writing-mode":new xt(_e.layout_symbol["text-writing-mode"]),"text-rotate":new zt(_e.layout_symbol["text-rotate"]),"text-padding":new xt(_e.layout_symbol["text-padding"]),"text-keep-upright":new xt(_e.layout_symbol["text-keep-upright"]),"text-transform":new zt(_e.layout_symbol["text-transform"]),"text-offset":new zt(_e.layout_symbol["text-offset"]),"text-allow-overlap":new xt(_e.layout_symbol["text-allow-overlap"]),"text-overlap":new xt(_e.layout_symbol["text-overlap"]),"text-ignore-placement":new xt(_e.layout_symbol["text-ignore-placement"]),"text-optional":new xt(_e.layout_symbol["text-optional"])})}};class Cd{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:sa,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}_t("FormatSectionOverride",Cd,{omit:["defaultValue"]});class Pu extends er{constructor(t){super(t,Nf)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const d=[];for(const g of o)d.indexOf(g)<0&&d.push(g);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,o,d){const g=this.layout.get(t).evaluate(r,{},o,d),_=this._unevaluatedLayout._values[t];return _.isDataDriven()||Do(_.value)||!g?g:function(x,T){return T.replace(/{([^{}]+)}/g,(P,D)=>x&&D in x?String(x[D]):"")}(r.properties,g)}createBucket(t){return new jl(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Nf.paint.overridableProperties){if(!Pu.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),o=new Cd(r),d=new Ro(o,r.property.specification);let g=null;g=r.value.kind==="constant"||r.value.kind==="source"?new mr("source",d):new Ha("composite",d,r.value.zoomStops),this.paint._values[t]=new gr(r.property,g,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,o){return!(!this.layout||r.isDataDriven()||o.isDataDriven())&&Pu.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const o=t.get("text-field"),d=Nf.paint.properties[r];let g=!1;const _=x=>{for(const T of x)if(d.overrides&&d.overrides.hasOverride(T))return void(g=!0)};if(o.value.kind==="constant"&&o.value.value instanceof ar)_(o.value.value.sections);else if(o.value.kind==="source"){const x=P=>{g||(P instanceof Sn&&Ft(P.value)===Os?_(P.value.sections):P instanceof gs?_(P.sections):P.eachChild(x))},T=o.value;T._styleExpression&&x(T._styleExpression.expression)}return g}}let Xp;var Om={get paint(){return Xp=Xp||new lr({"background-color":new xt(_e.paint_background["background-color"]),"background-pattern":new dn(_e.paint_background["background-pattern"]),"background-opacity":new xt(_e.paint_background["background-opacity"])})}};class Ih extends er{constructor(t){super(t,Om)}}let Yp;var Kp={get paint(){return Yp=Yp||new lr({"raster-opacity":new xt(_e.paint_raster["raster-opacity"]),"raster-hue-rotate":new xt(_e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new xt(_e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new xt(_e.paint_raster["raster-brightness-max"]),"raster-saturation":new xt(_e.paint_raster["raster-saturation"]),"raster-contrast":new xt(_e.paint_raster["raster-contrast"]),"raster-resampling":new xt(_e.paint_raster["raster-resampling"]),"raster-fade-duration":new xt(_e.paint_raster["raster-fade-duration"])})}};class yi extends er{constructor(t){super(t,Kp)}}class jf extends er{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Ad{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Uf={once:!0},zd=63710088e-1;class uo{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new uo(po(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,o=this.lat*r,d=t.lat*r,g=Math.sin(o)*Math.sin(d)+Math.cos(o)*Math.cos(d)*Math.cos((t.lng-this.lng)*r);return zd*Math.acos(Math.min(g,1))}static convert(t){if(t instanceof uo)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new uo(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new uo(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Ru=2*Math.PI*zd;function kh(a){return Ru*Math.cos(a*Math.PI/180)}function Bc(a){return(180+a)/360}function Vf(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Wp(a,t){return a/kh(t)}function Gf(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function qf(a,t){return a*kh(Gf(t))}class Du{constructor(t,r,o=0){this.x=+t,this.y=+r,this.z=+o}static fromLngLat(t,r=0){const o=uo.convert(t);return new Du(Bc(o.lng),Vf(o.lat),Wp(r,o.lat))}toLngLat(){return new uo(360*this.x-180,Gf(this.y))}toAltitude(){return qf(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ru*(t=Gf(this.y),1/Math.cos(t*Math.PI/180));var t}}function Lh(a,t,r){var o=2*Math.PI*6378137/256/Math.pow(2,r);return[a*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class Bi{constructor(t,r,o){if(!function(d,g,_){return!(d<0||d>25||_<0||_>=Math.pow(2,d)||g<0||g>=Math.pow(2,d))}(t,r,o))throw new Error(`x=${r}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=o,this.key=Iu(0,t,t,r,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,o){const d=(_=this.y,x=this.z,T=Lh(256*(g=this.x),256*(_=Math.pow(2,x)-_-1),x),P=Lh(256*(g+1),256*(_+1),x),T[0]+","+T[1]+","+P[0]+","+P[1]);var g,_,x,T,P;const D=function(k,N,V){let q,$="";for(let Q=k;Q>0;Q--)q=1<<Q-1,$+=(N&q?1:0)+(V&q?2:0);return $}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,D).replace(/{bbox-epsg-3857}/g,d)}isChildOf(t){const r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){const r=Math.pow(2,this.z);return new Ee((t.x*r-this.x)*lt,(t.y*r-this.y)*lt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Pd{constructor(t,r){this.wrap=t,this.canonical=r,this.key=Iu(t,r.z,r.z,r.x,r.y)}}class Gi{constructor(t,r,o,d,g){if(this.terrainRttPosMatrix32f=null,t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=r,this.canonical=new Bi(o,+d,+g),this.key=Iu(r,t,o,d,g)}clone(){return new Gi(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-t;return t>this.canonical.z?new Gi(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Gi(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?Iu(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):Iu(this.wrap*+r,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new Gi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,o=2*this.canonical.x,d=2*this.canonical.y;return[new Gi(r,this.wrap,r,o,d),new Gi(r,this.wrap,r,o+1,d),new Gi(r,this.wrap,r,o,d+1),new Gi(r,this.wrap,r,o+1,d+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Gi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Gi(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Pd(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Du(t.x-this.wrap,t.y))}}function Iu(a,t,r,o,d){(a*=2)<0&&(a=-1*a-1);const g=1<<r;return(g*g*a+g*d+o).toString(36)+r.toString(36)+t.toString(36)}_t("CanonicalTileID",Bi),_t("OverscaledTileID",Gi,{omit:["terrainRttPosMatrix32f"]});class il{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){const r=new il;return r.extend(t(new Ee(this.minX,this.minY))),r.extend(t(new Ee(this.maxX,this.minY))),r.extend(t(new Ee(this.minX,this.maxY))),r.extend(t(new Ee(this.maxX,this.maxY))),r}static fromPoints(t){const r=new il;for(const o of t)r.extend(o);return r}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}class Rd{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const o=t[r];this._stringToNumber[o]=r,this._numberToString[r]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Oh{constructor(t,r,o,d,g){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=o,t._y=d,this.properties=t.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class Zf{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Js(lt,16,0),this.grid3D=new Js(lt,16,0),this.featureIndexArray=new Oe,this.promoteId=r}insert(t,r,o,d,g,_){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,d,g);const T=_?this.grid3D:this.grid;for(let P=0;P<r.length;P++){const D=r[P],k=[1/0,1/0,-1/0,-1/0];for(let N=0;N<D.length;N++){const V=D[N];k[0]=Math.min(k[0],V.x),k[1]=Math.min(k[1],V.y),k[2]=Math.max(k[2],V.x),k[3]=Math.max(k[3],V.y)}k[0]<lt&&k[1]<lt&&k[2]>=0&&k[3]>=0&&T.insert(x,k[0],k[1],k[2],k[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Oi.VectorTile(new bd(this.rawTileData)).layers,this.sourceLayerCoder=new Rd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,o,d){this.loadVTLayers();const g=t.params,_=lt/t.tileSize/t.scale,x=vn(g.filter),T=t.queryGeometry,P=t.queryPadding*_,D=il.fromPoints(T),k=this.grid.query(D.minX-P,D.minY-P,D.maxX+P,D.maxY+P),N=il.fromPoints(t.cameraQueryGeometry).expandBy(P),V=this.grid3D.query(N.minX,N.minY,N.maxX,N.maxY,(Q,ae,ve,he)=>function(U,W,fe,Ie,Je){for(const qe of U)if(W<=qe.x&&fe<=qe.y&&Ie>=qe.x&&Je>=qe.y)return!0;const Ne=[new Ee(W,fe),new Ee(W,Je),new Ee(Ie,Je),new Ee(Ie,fe)];if(U.length>2){for(const qe of Ne)if(zc(U,qe))return!0}for(let qe=0;qe<U.length-1;qe++)if(yr(U[qe],U[qe+1],Ne))return!0;return!1}(t.cameraQueryGeometry,Q-P,ae-P,ve+P,he+P));for(const Q of V)k.push(Q);k.sort(Hf);const q={};let $;for(let Q=0;Q<k.length;Q++){const ae=k[Q];if(ae===$)continue;$=ae;const ve=this.featureIndexArray.get(ae);let he=null;this.loadMatchingFeature(q,ve.bucketIndex,ve.sourceLayerIndex,ve.featureIndex,x,g.layers,g.availableImages,r,o,d,(U,W,fe)=>(he||(he=$o(U)),W.queryIntersectsFeature({queryGeometry:T,feature:U,featureState:fe,geometry:he,zoom:this.z,transform:t.transform,pixelsToTileUnits:_,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation})))}return q}loadMatchingFeature(t,r,o,d,g,_,x,T,P,D,k){const N=this.bucketLayerIDs[r];if(_&&!N.some(Q=>_.has(Q)))return;const V=this.sourceLayerCoder.decode(o),q=this.vtLayers[V].feature(d);if(g.needGeometry){const Q=kl(q,!0);if(!g.filter(new Ni(this.tileID.overscaledZ),Q,this.tileID.canonical))return}else if(!g.filter(new Ni(this.tileID.overscaledZ),q))return;const $=this.getId(q,V);for(let Q=0;Q<N.length;Q++){const ae=N[Q];if(_&&!_.has(ae))continue;const ve=T[ae];if(!ve)continue;let he={};$&&D&&(he=D.getState(ve.sourceLayer||"_geojsonTileLayer",$));const U=dr({},P[ae]);U.paint=$f(U.paint,ve.paint,q,he,x),U.layout=$f(U.layout,ve.layout,q,he,x);const W=!k||k(q,ve,he);if(!W)continue;const fe=new Oh(q,this.z,this.x,this.y,$);fe.layer=U;let Ie=t[ae];Ie===void 0&&(Ie=t[ae]=[]),Ie.push({featureIndex:d,feature:fe,intersectionZ:W})}}lookupSymbolFeatures(t,r,o,d,g,_,x,T){const P={};this.loadVTLayers();const D=vn(g);for(const k of t)this.loadMatchingFeature(P,o,d,k,D,_,x,T,r);return P}hasLayer(t){for(const r of this.bucketLayerIDs)for(const o of r)if(t===o)return!0;return!1}getId(t,r){var o;let d=t.id;return this.promoteId&&(d=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof d=="boolean"&&(d=Number(d)),d===void 0&&(!((o=t.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(d=Number(t.properties.cluster_id))),d}}function $f(a,t,r,o,d){return tn(a,(g,_)=>{const x=t instanceof No?t.get(_):null;return x&&x.evaluate?x.evaluate(r,o,d):x})}function Hf(a,t){return t-a}function Dd(a,t,r,o,d){const g=[];for(let _=0;_<a.length;_++){const x=a[_];let T;for(let P=0;P<x.length-1;P++){let D=x[P],k=x[P+1];D.x<t&&k.x<t||(D.x<t?D=new Ee(t,D.y+(t-D.x)/(k.x-D.x)*(k.y-D.y))._round():k.x<t&&(k=new Ee(t,D.y+(t-D.x)/(k.x-D.x)*(k.y-D.y))._round()),D.y<r&&k.y<r||(D.y<r?D=new Ee(D.x+(r-D.y)/(k.y-D.y)*(k.x-D.x),r)._round():k.y<r&&(k=new Ee(D.x+(r-D.y)/(k.y-D.y)*(k.x-D.x),r)._round()),D.x>=o&&k.x>=o||(D.x>=o?D=new Ee(o,D.y+(o-D.x)/(k.x-D.x)*(k.y-D.y))._round():k.x>=o&&(k=new Ee(o,D.y+(o-D.x)/(k.x-D.x)*(k.y-D.y))._round()),D.y>=d&&k.y>=d||(D.y>=d?D=new Ee(D.x+(d-D.y)/(k.y-D.y)*(k.x-D.x),d)._round():k.y>=d&&(k=new Ee(D.x+(d-D.y)/(k.y-D.y)*(k.x-D.x),d)._round()),T&&D.equals(T[T.length-1])||(T=[D],g.push(T)),T.push(k)))))}}return g}_t("FeatureIndex",Zf,{omit:["rawTileData","sourceLayerCoder"]});class Ul extends Ee{constructor(t,r,o,d){super(t,r),this.angle=o,d!==void 0&&(this.segment=d)}clone(){return new Ul(this.x,this.y,this.angle,this.segment)}}function Xf(a,t,r,o,d){if(t.segment===void 0||r===0)return!0;let g=t,_=t.segment+1,x=0;for(;x>-r/2;){if(_--,_<0)return!1;x-=a[_].dist(g),g=a[_]}x+=a[_].dist(a[_+1]),_++;const T=[];let P=0;for(;x<r/2;){const D=a[_],k=a[_+1];if(!k)return!1;let N=a[_-1].angleTo(D)-D.angleTo(k);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:x,angleDelta:N}),P+=N;x-T[0].distance>o;)P-=T.shift().angleDelta;if(P>d)return!1;_++,x+=D.dist(k)}return!0}function Qp(a){let t=0;for(let r=0;r<a.length-1;r++)t+=a[r].dist(a[r+1]);return t}function Yf(a,t,r){return a?.6*t*r:0}function Jp(a,t){return Math.max(a?a.right-a.left:0,t?t.right-t.left:0)}function Bm(a,t,r,o,d,g){const _=Yf(r,d,g),x=Jp(r,o)*g;let T=0;const P=Qp(a)/2;for(let D=0;D<a.length-1;D++){const k=a[D],N=a[D+1],V=k.dist(N);if(T+V>P){const q=(P-T)/V,$=$r.number(k.x,N.x,q),Q=$r.number(k.y,N.y,q),ae=new Ul($,Q,N.angleTo(k),D);return ae._round(),!_||Xf(a,ae,x,_,t)?ae:void 0}T+=V}}function Vl(a,t,r,o,d,g,_,x,T){const P=Yf(o,g,_),D=Jp(o,d),k=D*_,N=a[0].x===0||a[0].x===T||a[0].y===0||a[0].y===T;return t-k<t/4&&(t=k+t/4),Kf(a,N?t/2*x%t:(D/2+2*g)*_*x%t,t,P,r,k,N,!1,T)}function Kf(a,t,r,o,d,g,_,x,T){const P=g/2,D=Qp(a);let k=0,N=t-r,V=[];for(let q=0;q<a.length-1;q++){const $=a[q],Q=a[q+1],ae=$.dist(Q),ve=Q.angleTo($);for(;N+r<k+ae;){N+=r;const he=(N-k)/ae,U=$r.number($.x,Q.x,he),W=$r.number($.y,Q.y,he);if(U>=0&&U<T&&W>=0&&W<T&&N-P>=0&&N+P<=D){const fe=new Ul(U,W,ve,q);fe._round(),o&&!Xf(a,fe,g,o,d)||V.push(fe)}}k+=ae}return x||V.length||_||(V=Kf(a,k/2,r,o,d,g,_,!0,T)),V}function Id(a,t,r,o){const d=[],g=a.image,_=g.pixelRatio,x=g.paddedRect.w-2,T=g.paddedRect.h-2;let P={x1:a.left,y1:a.top,x2:a.right,y2:a.bottom};const D=g.stretchX||[[0,x]],k=g.stretchY||[[0,T]],N=($e,St)=>$e+St[1]-St[0],V=D.reduce(N,0),q=k.reduce(N,0),$=x-V,Q=T-q;let ae=0,ve=V,he=0,U=q,W=0,fe=$,Ie=0,Je=Q;if(g.content&&o){const $e=g.content,St=$e[2]-$e[0],Rt=$e[3]-$e[1];(g.textFitWidth||g.textFitHeight)&&(P=Oc(a)),ae=kd(D,0,$e[0]),he=kd(k,0,$e[1]),ve=kd(D,$e[0],$e[2]),U=kd(k,$e[1],$e[3]),W=$e[0]-ae,Ie=$e[1]-he,fe=St-ve,Je=Rt-U}const Ne=P.x1,qe=P.y1,st=P.x2-Ne,nt=P.y2-qe,ot=($e,St,Rt,Mt)=>{const bt=ku($e.stretch-ae,ve,st,Ne),Yt=Ld($e.fixed-W,fe,$e.stretch,V),Zi=ku(St.stretch-he,U,nt,qe),mn=Ld(St.fixed-Ie,Je,St.stretch,q),gn=ku(Rt.stretch-ae,ve,st,Ne),Ua=Ld(Rt.fixed-W,fe,Rt.stretch,V),Br=ku(Mt.stretch-he,U,nt,qe),Pn=Ld(Mt.fixed-Ie,Je,Mt.stretch,q),hn=new Ee(bt,Zi),Hn=new Ee(gn,Zi),Un=new Ee(gn,Br),ir=new Ee(bt,Br),Fr=new Ee(Yt/_,mn/_),Nr=new Ee(Ua/_,Pn/_),Rn=t*Math.PI/180;if(Rn){const Vn=Math.sin(Rn),Dn=Math.cos(Rn),In=[Dn,-Vn,Vn,Dn];hn._matMult(In),Hn._matMult(In),ir._matMult(In),Un._matMult(In)}const jr=$e.stretch+$e.fixed,_n=St.stretch+St.fixed;return{tl:hn,tr:Hn,bl:ir,br:Un,tex:{x:g.paddedRect.x+1+jr,y:g.paddedRect.y+1+_n,w:Rt.stretch+Rt.fixed-jr,h:Mt.stretch+Mt.fixed-_n},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Fr,pixelOffsetBR:Nr,minFontScaleX:fe/_/st,minFontScaleY:Je/_/nt,isSDF:r}};if(o&&(g.stretchX||g.stretchY)){const $e=em(D,$,V),St=em(k,Q,q);for(let Rt=0;Rt<$e.length-1;Rt++){const Mt=$e[Rt],bt=$e[Rt+1];for(let Yt=0;Yt<St.length-1;Yt++)d.push(ot(Mt,St[Yt],bt,St[Yt+1]))}}else d.push(ot({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:T+1}));return d}function kd(a,t,r){let o=0;for(const d of a)o+=Math.max(t,Math.min(r,d[1]))-Math.max(t,Math.min(r,d[0]));return o}function em(a,t,r){const o=[{fixed:-1,stretch:0}];for(const[d,g]of a){const _=o[o.length-1];o.push({fixed:d-_.stretch,stretch:_.stretch}),o.push({fixed:d-_.stretch,stretch:_.stretch+(g-d)})}return o.push({fixed:t+1,stretch:r}),o}function ku(a,t,r,o){return a/t*r+o}function Ld(a,t,r,o){return a-t*r/o}_t("Anchor",Ul);class va{constructor(t,r,o,d,g,_,x,T,P,D){var k;if(this.boxStartIndex=t.length,P){let N=_.top,V=_.bottom;const q=_.collisionPadding;q&&(N-=q[1],V+=q[3]);let $=V-N;$>0&&($=Math.max(10,$),this.circleDiameter=$)}else{const N=!((k=_.image)===null||k===void 0)&&k.content&&(_.image.textFitWidth||_.image.textFitHeight)?Oc(_):{x1:_.left,y1:_.top,x2:_.right,y2:_.bottom};N.y1=N.y1*x-T[0],N.y2=N.y2*x+T[2],N.x1=N.x1*x-T[3],N.x2=N.x2*x+T[1];const V=_.collisionPadding;if(V&&(N.x1-=V[0]*x,N.y1-=V[1]*x,N.x2+=V[2]*x,N.y2+=V[3]*x),D){const q=new Ee(N.x1,N.y1),$=new Ee(N.x2,N.y1),Q=new Ee(N.x1,N.y2),ae=new Ee(N.x2,N.y2),ve=D*Math.PI/180;q._rotate(ve),$._rotate(ve),Q._rotate(ve),ae._rotate(ve),N.x1=Math.min(q.x,$.x,Q.x,ae.x),N.x2=Math.max(q.x,$.x,Q.x,ae.x),N.y1=Math.min(q.y,$.y,Q.y,ae.y),N.y2=Math.max(q.y,$.y,Q.y,ae.y)}t.emplaceBack(r.x,r.y,N.x1,N.y1,N.x2,N.y2,o,d,g)}this.boxEndIndex=t.length}}class Wf{constructor(t=[],r=(o,d)=>o<d?-1:o>d?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:o}=this,d=r[t];for(;t>0;){const g=t-1>>1,_=r[g];if(o(d,_)>=0)break;r[t]=_,t=g}r[t]=d}_down(t){const{data:r,compare:o}=this,d=this.length>>1,g=r[t];for(;t<d;){let _=1+(t<<1);const x=_+1;if(x<this.length&&o(r[x],r[_])<0&&(_=x),o(r[_],g)>=0)break;r[t]=r[_],t=_}r[t]=g}}function tm(a,t=1,r=!1){const o=il.fromPoints(a[0]),d=Math.min(o.width(),o.height());let g=d/2;const _=new Wf([],im),{minX:x,minY:T,maxX:P,maxY:D}=o;if(d===0)return new Ee(x,T);for(let V=x;V<P;V+=d)for(let q=T;q<D;q+=d)_.push(new ho(V+g,q+g,g,a));let k=function(V){let q=0,$=0,Q=0;const ae=V[0];for(let ve=0,he=ae.length,U=he-1;ve<he;U=ve++){const W=ae[ve],fe=ae[U],Ie=W.x*fe.y-fe.x*W.y;$+=(W.x+fe.x)*Ie,Q+=(W.y+fe.y)*Ie,q+=3*Ie}return new ho($/q,Q/q,0,V)}(a),N=_.length;for(;_.length;){const V=_.pop();(V.d>k.d||!k.d)&&(k=V,r&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,N)),V.max-k.d<=t||(g=V.h/2,_.push(new ho(V.p.x-g,V.p.y-g,g,a)),_.push(new ho(V.p.x+g,V.p.y-g,g,a)),_.push(new ho(V.p.x-g,V.p.y+g,g,a)),_.push(new ho(V.p.x+g,V.p.y+g,g,a)),N+=4)}return r&&(console.log(`num probes: ${N}`),console.log(`best distance: ${k.d}`)),k.p}function im(a,t){return t.max-a.max}function ho(a,t,r,o){this.p=new Ee(a,t),this.h=r,this.d=function(d,g){let _=!1,x=1/0;for(let T=0;T<g.length;T++){const P=g[T];for(let D=0,k=P.length,N=k-1;D<k;N=D++){const V=P[D],q=P[N];V.y>d.y!=q.y>d.y&&d.x<(q.x-V.x)*(d.y-V.y)/(q.y-V.y)+V.x&&(_=!_),x=Math.min(x,rf(d,V,q))}}return(_?1:-1)*Math.sqrt(x)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var qi;A.aD=void 0,(qi=A.aD||(A.aD={}))[qi.center=1]="center",qi[qi.left=2]="left",qi[qi.right=3]="right",qi[qi.top=4]="top",qi[qi.bottom=5]="bottom",qi[qi["top-left"]=6]="top-left",qi[qi["top-right"]=7]="top-right",qi[qi["bottom-left"]=8]="bottom-left",qi[qi["bottom-right"]=9]="bottom-right";const Od=Number.POSITIVE_INFINITY;function Bh(a,t){return t[1]!==Od?function(r,o,d){let g=0,_=0;switch(o=Math.abs(o),d=Math.abs(d),r){case"top-right":case"top-left":case"top":_=d-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-d}switch(r){case"top-right":case"bottom-right":case"right":g=-o;break;case"top-left":case"bottom-left":case"left":g=o}return[g,_]}(a,t[0],t[1]):function(r,o){let d=0,g=0;o<0&&(o=0);const _=o/Math.SQRT2;switch(r){case"top-right":case"top-left":g=_-7;break;case"bottom-right":case"bottom-left":g=7-_;break;case"bottom":g=7-o;break;case"top":g=o-7}switch(r){case"top-right":case"bottom-right":d=-_;break;case"top-left":case"bottom-left":d=_;break;case"left":d=o;break;case"right":d=-o}return[d,g]}(a,t[0])}function fo(a,t,r){var o;const d=a.layout,g=(o=d.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(t,{},r);if(g){const x=g.values,T=[];for(let P=0;P<x.length;P+=2){const D=T[P]=x[P],k=x[P+1].map(N=>N*zn);D.startsWith("top")?k[1]-=7:D.startsWith("bottom")&&(k[1]+=7),T[P+1]=k}return new si(T)}const _=d.get("text-variable-anchor");if(_){let x;x=a._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[d.get("text-radial-offset").evaluate(t,{},r)*zn,Od]:d.get("text-offset").evaluate(t,{},r).map(P=>P*zn);const T=[];for(const P of _)T.push(P,Bh(P,x));return new si(T)}return null}function Qf(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Fm(a,t,r,o,d,g,_,x,T,P,D,k){let N=g.textMaxSize.evaluate(t,{});N===void 0&&(N=_);const V=a.layers[0].layout,q=V.get("icon-offset").evaluate(t,{},D),$=Jf(r.horizontal),Q=_/24,ae=a.tilePixelRatio*Q,ve=a.tilePixelRatio*N/24,he=a.tilePixelRatio*x,U=a.tilePixelRatio*V.get("symbol-spacing"),W=V.get("text-padding")*a.tilePixelRatio,fe=function(Rt,Mt,bt,Yt=1){const Zi=Rt.get("icon-padding").evaluate(Mt,{},bt),mn=Zi&&Zi.values;return[mn[0]*Yt,mn[1]*Yt,mn[2]*Yt,mn[3]*Yt]}(V,t,D,a.tilePixelRatio),Ie=V.get("text-max-angle")/180*Math.PI,Je=V.get("text-rotation-alignment")!=="viewport"&&V.get("symbol-placement")!=="point",Ne=V.get("icon-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",qe=V.get("symbol-placement"),st=U/2,nt=V.get("icon-text-fit");let ot;o&&nt!=="none"&&(a.allowVerticalPlacement&&r.vertical&&(ot=Td(o,r.vertical,nt,V.get("icon-text-fit-padding"),q,Q)),$&&(o=Td(o,$,nt,V.get("icon-text-fit-padding"),q,Q)));const $e=D?k.line.getGranularityForZoomLevel(D.z):1,St=(Rt,Mt)=>{Mt.x<0||Mt.x>=lt||Mt.y<0||Mt.y>=lt||function(bt,Yt,Zi,mn,gn,Ua,Br,Pn,hn,Hn,Un,ir,Fr,Nr,Rn,jr,_n,Vn,Dn,In,Qi,xa,i,s,u){const p=bt.addToLineVertexArray(Yt,Zi);let b,C,G,K,me=0,Fe=0,tt=0,at=0,Ue=-1,Ge=-1;const jt={};let Gt=ur("");if(bt.allowVerticalPlacement&&mn.vertical){const na=Pn.layout.get("text-rotate").evaluate(Qi,{},s)+90;G=new va(hn,Yt,Hn,Un,ir,mn.vertical,Fr,Nr,Rn,na),Br&&(K=new va(hn,Yt,Hn,Un,ir,Br,_n,Vn,Rn,na))}if(gn){const na=Pn.layout.get("icon-rotate").evaluate(Qi,{}),Is=Pn.layout.get("icon-text-fit")!=="none",Nh=Id(gn,na,i,Is),rl=Br?Id(Br,na,i,Is):void 0;C=new va(hn,Yt,Hn,Un,ir,gn,_n,Vn,!1,na),me=4*Nh.length;const jh=bt.iconSizeData;let $l=null;jh.kind==="source"?($l=[as*Pn.layout.get("icon-size").evaluate(Qi,{})],$l[0]>co&&Xi(`${bt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):jh.kind==="composite"&&($l=[as*xa.compositeIconSizes[0].evaluate(Qi,{},s),as*xa.compositeIconSizes[1].evaluate(Qi,{},s)],($l[0]>co||$l[1]>co)&&Xi(`${bt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),bt.addSymbols(bt.icon,Nh,$l,In,Dn,Qi,A.an.none,Yt,p.lineStartIndex,p.lineLength,-1,s),Ue=bt.icon.placedSymbolArray.length-1,rl&&(Fe=4*rl.length,bt.addSymbols(bt.icon,rl,$l,In,Dn,Qi,A.an.vertical,Yt,p.lineStartIndex,p.lineLength,-1,s),Ge=bt.icon.placedSymbolArray.length-1)}const $i=Object.keys(mn.horizontal);for(const na of $i){const Is=mn.horizontal[na];if(!b){Gt=ur(Is.text);const rl=Pn.layout.get("text-rotate").evaluate(Qi,{},s);b=new va(hn,Yt,Hn,Un,ir,Is,Fr,Nr,Rn,rl)}const Nh=Is.positionedLines.length===1;if(tt+=Fc(bt,Yt,Is,Ua,Pn,Rn,Qi,jr,p,mn.vertical?A.an.horizontal:A.an.horizontalOnly,Nh?$i:[na],jt,Ue,xa,s),Nh)break}mn.vertical&&(at+=Fc(bt,Yt,mn.vertical,Ua,Pn,Rn,Qi,jr,p,A.an.vertical,["vertical"],jt,Ge,xa,s));const Pe=b?b.boxStartIndex:bt.collisionBoxArray.length,Me=b?b.boxEndIndex:bt.collisionBoxArray.length,Le=G?G.boxStartIndex:bt.collisionBoxArray.length,rt=G?G.boxEndIndex:bt.collisionBoxArray.length,Pt=C?C.boxStartIndex:bt.collisionBoxArray.length,pi=C?C.boxEndIndex:bt.collisionBoxArray.length,Nt=K?K.boxStartIndex:bt.collisionBoxArray.length,Ht=K?K.boxEndIndex:bt.collisionBoxArray.length;let Ji=-1;const bi=(na,Is)=>na&&na.circleDiameter?Math.max(na.circleDiameter,Is):Is;Ji=bi(b,Ji),Ji=bi(G,Ji),Ji=bi(C,Ji),Ji=bi(K,Ji);const nl=Ji>-1?1:0;nl&&(Ji*=u/zn),bt.glyphOffsetArray.length>=jl.MAX_GLYPHS&&Xi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Qi.sortKey!==void 0&&bt.addToSortKeyRanges(bt.symbolInstances.length,Qi.sortKey);const jm=fo(Pn,Qi,s),[By,Fy]=function(na,Is){const Nh=na.length,rl=Is==null?void 0:Is.values;if((rl==null?void 0:rl.length)>0)for(let jh=0;jh<rl.length;jh+=2){const $l=rl[jh+1];na.emplaceBack(A.aD[rl[jh]],$l[0],$l[1])}return[Nh,na.length]}(bt.textAnchorOffsets,jm);bt.symbolInstances.emplaceBack(Yt.x,Yt.y,jt.right>=0?jt.right:-1,jt.center>=0?jt.center:-1,jt.left>=0?jt.left:-1,jt.vertical||-1,Ue,Ge,Gt,Pe,Me,Le,rt,Pt,pi,Nt,Ht,Hn,tt,at,me,Fe,nl,0,Fr,Ji,By,Fy)}(a,Mt,Rt,r,o,d,ot,a.layers[0],a.collisionBoxArray,t.index,t.sourceLayerIndex,a.index,ae,[W,W,W,W],Je,T,he,fe,Ne,q,t,g,P,D,_)};if(qe==="line")for(const Rt of Dd(t.geometry,0,0,lt,lt)){const Mt=Ol(Rt,$e),bt=Vl(Mt,U,Ie,r.vertical||$,o,24,ve,a.overscaling,lt);for(const Yt of bt)$&&Nm(a,$.text,st,Yt)||St(Mt,Yt)}else if(qe==="line-center"){for(const Rt of t.geometry)if(Rt.length>1){const Mt=Ol(Rt,$e),bt=Bm(Mt,Ie,r.vertical||$,o,24,ve);bt&&St(Mt,bt)}}else if(t.type==="Polygon")for(const Rt of Jc(t.geometry,0)){const Mt=tm(Rt,16);St(Ol(Rt[0],$e,!0),new Ul(Mt.x,Mt.y,0))}else if(t.type==="LineString")for(const Rt of t.geometry){const Mt=Ol(Rt,$e);St(Mt,new Ul(Mt[0].x,Mt[0].y,0))}else if(t.type==="Point")for(const Rt of t.geometry)for(const Mt of Rt)St([Mt],new Ul(Mt.x,Mt.y,0))}function Fc(a,t,r,o,d,g,_,x,T,P,D,k,N,V,q){const $=function(ve,he,U,W,fe,Ie,Je,Ne){const qe=W.layout.get("text-rotate").evaluate(Ie,{})*Math.PI/180,st=[];for(const nt of he.positionedLines)for(const ot of nt.positionedGlyphs){if(!ot.rect)continue;const $e=ot.rect||{};let St=4,Rt=!0,Mt=1,bt=0;const Yt=(fe||Ne)&&ot.vertical,Zi=ot.metrics.advance*ot.scale/2;if(Ne&&he.verticalizable&&(bt=nt.lineOffset/2-(ot.imageName?-(zn-ot.metrics.width*ot.scale)/2:(ot.scale-1)*zn)),ot.imageName){const Vn=Je[ot.imageName];Rt=Vn.sdf,Mt=Vn.pixelRatio,St=1/Mt}const mn=fe?[ot.x+Zi,ot.y]:[0,0];let gn=fe?[0,0]:[ot.x+Zi+U[0],ot.y+U[1]-bt],Ua=[0,0];Yt&&(Ua=gn,gn=[0,0]);const Br=ot.metrics.isDoubleResolution?2:1,Pn=(ot.metrics.left-St)*ot.scale-Zi+gn[0],hn=(-ot.metrics.top-St)*ot.scale+gn[1],Hn=Pn+$e.w/Br*ot.scale/Mt,Un=hn+$e.h/Br*ot.scale/Mt,ir=new Ee(Pn,hn),Fr=new Ee(Hn,hn),Nr=new Ee(Pn,Un),Rn=new Ee(Hn,Un);if(Yt){const Vn=new Ee(-Zi,Zi- -17),Dn=-Math.PI/2,In=12-Zi,Qi=new Ee(22-In,-(ot.imageName?In:0)),xa=new Ee(...Ua);ir._rotateAround(Dn,Vn)._add(Qi)._add(xa),Fr._rotateAround(Dn,Vn)._add(Qi)._add(xa),Nr._rotateAround(Dn,Vn)._add(Qi)._add(xa),Rn._rotateAround(Dn,Vn)._add(Qi)._add(xa)}if(qe){const Vn=Math.sin(qe),Dn=Math.cos(qe),In=[Dn,-Vn,Vn,Dn];ir._matMult(In),Fr._matMult(In),Nr._matMult(In),Rn._matMult(In)}const jr=new Ee(0,0),_n=new Ee(0,0);st.push({tl:ir,tr:Fr,bl:Nr,br:Rn,tex:$e,writingMode:he.writingMode,glyphOffset:mn,sectionIndex:ot.sectionIndex,isSDF:Rt,pixelOffsetTL:jr,pixelOffsetBR:_n,minFontScaleX:0,minFontScaleY:0})}return st}(0,r,x,d,g,_,o,a.allowVerticalPlacement),Q=a.textSizeData;let ae=null;Q.kind==="source"?(ae=[as*d.layout.get("text-size").evaluate(_,{})],ae[0]>co&&Xi(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Q.kind==="composite"&&(ae=[as*V.compositeTextSizes[0].evaluate(_,{},q),as*V.compositeTextSizes[1].evaluate(_,{},q)],(ae[0]>co||ae[1]>co)&&Xi(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,$,ae,x,g,_,P,t,T.lineStartIndex,T.lineLength,N,q);for(const ve of D)k[ve]=a.text.placedSymbolArray.length-1;return 4*$.length}function Jf(a){for(const t in a)return a[t];return null}function Nm(a,t,r,o){const d=a.compareText;if(t in d){const g=d[t];for(let _=g.length-1;_>=0;_--)if(o.dist(g[_])<r)return!0}else d[t]=[];return d[t].push(o),!1}const nm=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class ep{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,o]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=o>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const g=nm[15&o];if(!g)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(t,2,1),[x]=new Uint32Array(t,4,1);return new ep(x,_,g,t)}constructor(t,r=64,o=Float64Array,d){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const g=nm.indexOf(this.ArrayType),_=2*t*this.ArrayType.BYTES_PER_ELEMENT,x=t*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-x%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${o}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+x+T,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+_+x+T),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+x+T,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=r,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return tp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,o,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:_,nodeSize:x}=this,T=[0,g.length-1,0],P=[];for(;T.length;){const D=T.pop()||0,k=T.pop()||0,N=T.pop()||0;if(k-N<=x){for(let Q=N;Q<=k;Q++){const ae=_[2*Q],ve=_[2*Q+1];ae>=t&&ae<=o&&ve>=r&&ve<=d&&P.push(g[Q])}continue}const V=N+k>>1,q=_[2*V],$=_[2*V+1];q>=t&&q<=o&&$>=r&&$<=d&&P.push(g[V]),(D===0?t<=q:r<=$)&&(T.push(N),T.push(V-1),T.push(1-D)),(D===0?o>=q:d>=$)&&(T.push(V+1),T.push(k),T.push(1-D))}return P}within(t,r,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:g,nodeSize:_}=this,x=[0,d.length-1,0],T=[],P=o*o;for(;x.length;){const D=x.pop()||0,k=x.pop()||0,N=x.pop()||0;if(k-N<=_){for(let Q=N;Q<=k;Q++)np(g[2*Q],g[2*Q+1],t,r)<=P&&T.push(d[Q]);continue}const V=N+k>>1,q=g[2*V],$=g[2*V+1];np(q,$,t,r)<=P&&T.push(d[V]),(D===0?t-o<=q:r-o<=$)&&(x.push(N),x.push(V-1),x.push(1-D)),(D===0?t+o>=q:r+o>=$)&&(x.push(V+1),x.push(k),x.push(1-D))}return T}}function tp(a,t,r,o,d,g){if(d-o<=r)return;const _=o+d>>1;rm(a,t,_,o,d,g),tp(a,t,r,o,_-1,1-g),tp(a,t,r,_+1,d,1-g)}function rm(a,t,r,o,d,g){for(;d>o;){if(d-o>600){const P=d-o+1,D=r-o+1,k=Math.log(P),N=.5*Math.exp(2*k/3),V=.5*Math.sqrt(k*N*(P-N)/P)*(D-P/2<0?-1:1);rm(a,t,r,Math.max(o,Math.floor(r-D*N/P+V)),Math.min(d,Math.floor(r+(P-D)*N/P+V)),g)}const _=t[2*r+g];let x=o,T=d;for(Fh(a,t,o,r),t[2*d+g]>_&&Fh(a,t,o,d);x<T;){for(Fh(a,t,x,T),x++,T--;t[2*x+g]<_;)x++;for(;t[2*T+g]>_;)T--}t[2*o+g]===_?Fh(a,t,o,T):(T++,Fh(a,t,T,d)),T<=r&&(o=T+1),r<=T&&(d=T-1)}}function Fh(a,t,r,o){ip(a,r,o),ip(t,2*r,2*o),ip(t,2*r+1,2*o+1)}function ip(a,t,r){const o=a[t];a[t]=a[r],a[r]=o}function np(a,t,r,o){const d=a-r,g=t-o;return d*d+g*g}var Gl;A.cw=void 0,(Gl=A.cw||(A.cw={})).create="create",Gl.load="load",Gl.fullLoad="fullLoad";let ql=null,Lu=[];const rp=1e3/60,Zl="loadTime",Nc="fullLoadTime",am={mark(a){performance.mark(a)},frame(a){const t=a;ql!=null&&Lu.push(t-ql),ql=t},clearMetrics(){ql=null,Lu=[],performance.clearMeasures(Zl),performance.clearMeasures(Nc);for(const a in A.cw)performance.clearMarks(A.cw[a])},getPerformanceMetrics(){performance.measure(Zl,A.cw.create,A.cw.load),performance.measure(Nc,A.cw.create,A.cw.fullLoad);const a=performance.getEntriesByName(Zl)[0].duration,t=performance.getEntriesByName(Nc)[0].duration,r=Lu.length,o=1/(Lu.reduce((g,_)=>g+_,0)/r/1e3),d=Lu.filter(g=>g>rp).reduce((g,_)=>g+(_-rp)/rp,0);return{loadTime:a,fullLoadTime:t,fps:o,percentDroppedFrames:d/(r+d)*100,totalFrames:r}}};A.$=lt,A.A=Ut,A.B=function([a,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:a*Math.cos(t)*Math.sin(r),y:a*Math.sin(t)*Math.sin(r),z:a*Math.cos(r)}},A.C=$r,A.D=xt,A.E=Xe,A.F=Ni,A.G=wc,A.H=function(a){if(ks==null){const t=a.navigator?a.navigator.userAgent:null;ks=!!a.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return ks},A.I=Pf,A.J=class{constructor(a,t){this.target=a,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Ad(()=>this.process()),this.subscription=Vr(this.target,"message",r=>this.receive(r),!1),this.globalScope=br(self)?a:window}registerMessageHandler(a,t){this.messageHandlers[a]=t}sendAsync(a,t){return new Promise((r,o)=>{const d=Math.round(1e18*Math.random()).toString(36).substring(0,10),g=t?Vr(t.signal,"abort",()=>{g==null||g.unsubscribe(),delete this.resolveRejects[d];const T={id:d,type:"<cancel>",origin:location.origin,targetMapId:a.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)},Uf):null;this.resolveRejects[d]={resolve:T=>{g==null||g.unsubscribe(),r(T)},reject:T=>{g==null||g.unsubscribe(),o(T)}};const _=[],x=Object.assign(Object.assign({},a),{id:d,sourceMapId:this.mapId,origin:location.origin,data:zl(a.data,_)});this.target.postMessage(x,{transfer:_})})}receive(a){const t=a.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];const o=this.abortControllers[r];return delete this.abortControllers[r],void(o&&o.abort())}if(br(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;const a=this.taskQueue.shift(),t=this.tasks[a];delete this.tasks[a],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(a,t)}processTask(a,t){return c(this,void 0,void 0,function*(){if(t.type==="<response>"){const d=this.resolveRejects[a];return delete this.resolveRejects[a],d?void(t.error?d.reject(ea(t.error)):d.resolve(ea(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(a,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=ea(t.data),o=new AbortController;this.abortControllers[a]=o;try{const d=yield this.messageHandlers[t.type](t.sourceMapId,r,o);this.completeTask(a,null,d)}catch(d){this.completeTask(a,d)}})}completeTask(a,t,r){const o=[];delete this.abortControllers[a];const d={id:a,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?zl(t):null,data:zl(r,o)};this.target.postMessage(d,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},A.K=ee,A.L=function(){var a=new Ut(16);return Ut!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},A.M=function(a,t,r){var o,d,g,_,x,T,P,D,k,N,V,q,$=r[0],Q=r[1],ae=r[2];return t===a?(a[12]=t[0]*$+t[4]*Q+t[8]*ae+t[12],a[13]=t[1]*$+t[5]*Q+t[9]*ae+t[13],a[14]=t[2]*$+t[6]*Q+t[10]*ae+t[14],a[15]=t[3]*$+t[7]*Q+t[11]*ae+t[15]):(d=t[1],g=t[2],_=t[3],x=t[4],T=t[5],P=t[6],D=t[7],k=t[8],N=t[9],V=t[10],q=t[11],a[0]=o=t[0],a[1]=d,a[2]=g,a[3]=_,a[4]=x,a[5]=T,a[6]=P,a[7]=D,a[8]=k,a[9]=N,a[10]=V,a[11]=q,a[12]=o*$+x*Q+k*ae+t[12],a[13]=d*$+T*Q+N*ae+t[13],a[14]=g*$+P*Q+V*ae+t[14],a[15]=_*$+D*Q+q*ae+t[15]),a},A.N=function(a,t,r){var o=r[0],d=r[1],g=r[2];return a[0]=t[0]*o,a[1]=t[1]*o,a[2]=t[2]*o,a[3]=t[3]*o,a[4]=t[4]*d,a[5]=t[5]*d,a[6]=t[6]*d,a[7]=t[7]*d,a[8]=t[8]*g,a[9]=t[9]*g,a[10]=t[10]*g,a[11]=t[11]*g,a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},A.O=function(a,t,r){var o=t[0],d=t[1],g=t[2],_=t[3],x=t[4],T=t[5],P=t[6],D=t[7],k=t[8],N=t[9],V=t[10],q=t[11],$=t[12],Q=t[13],ae=t[14],ve=t[15],he=r[0],U=r[1],W=r[2],fe=r[3];return a[0]=he*o+U*x+W*k+fe*$,a[1]=he*d+U*T+W*N+fe*Q,a[2]=he*g+U*P+W*V+fe*ae,a[3]=he*_+U*D+W*q+fe*ve,a[4]=(he=r[4])*o+(U=r[5])*x+(W=r[6])*k+(fe=r[7])*$,a[5]=he*d+U*T+W*N+fe*Q,a[6]=he*g+U*P+W*V+fe*ae,a[7]=he*_+U*D+W*q+fe*ve,a[8]=(he=r[8])*o+(U=r[9])*x+(W=r[10])*k+(fe=r[11])*$,a[9]=he*d+U*T+W*N+fe*Q,a[10]=he*g+U*P+W*V+fe*ae,a[11]=he*_+U*D+W*q+fe*ve,a[12]=(he=r[12])*o+(U=r[13])*x+(W=r[14])*k+(fe=r[15])*$,a[13]=he*d+U*T+W*N+fe*Q,a[14]=he*g+U*P+W*V+fe*ae,a[15]=he*_+U*D+W*q+fe*ve,a},A.P=Ee,A.Q=function(a,t){const r={};for(let o=0;o<t.length;o++){const d=t[o];d in a&&(r[d]=a[d])}return r},A.R=zr,A.S=uo,A.T=fd,A.U=Vf,A.V=Bc,A.W=Tt,A.X=Ot,A.Y=Ls,A.Z=Gi,A._=c,A.a=H,A.a$=function(a,t,r){return a[0]=t[0]*r,a[1]=t[1]*r,a[2]=t[2]*r,a[3]=t[3]*r,a},A.a0=Du,A.a1=il,A.a2=25,A.a3=Bi,A.a4=a=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(r=>{t.onloadstart=()=>{r(t)};for(const o of a){const d=window.document.createElement("source");ke(o)||(t.crossOrigin="Anonymous"),d.src=o,t.appendChild(d)}})},A.a5=ct,A.a6=function(){return mo++},A.a7=ie,A.a8=jl,A.a9=vn,A.aA=zn,A.aB=gt,A.aC=function(a,t,r,o,d=!1){if(!r[0]&&!r[1])return[0,0];const g=d?o==="map"?-a.bearingInRadians:0:o==="viewport"?a.bearingInRadians:0;if(g){const _=Math.sin(g),x=Math.cos(g);r=[r[0]*x-r[1]*_,r[0]*_+r[1]*x]}return[d?r[0]:gt(t,r[0],a.zoom),d?r[1]:gt(t,r[1],a.zoom)]},A.aE=ss,A.aF=Qf,A.aG=Vi,A.aH=ep,A.aI=an,A.aJ=bh,A.aK=Re,A.aL=hi,A.aM=zi,A.aN=po,A.aO=nr,A.aP=qf,A.aQ=bn,A.aR=en,A.aS=function(a){var t=new Ut(3);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t},A.aT=function(a,t,r){return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2],a},A.aU=function(a,t){var r=t[0],o=t[1],d=t[2],g=r*r+o*o+d*d;return g>0&&(g=1/Math.sqrt(g)),a[0]=t[0]*g,a[1]=t[1]*g,a[2]=t[2]*g,a},A.aV=Yn,A.aW=function(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]},A.aX=function(a,t,r){return a[0]=t[0]*r[0],a[1]=t[1]*r[1],a[2]=t[2]*r[2],a[3]=t[3]*r[3],a},A.aY=Jt,A.aZ=function(a,t,r){const o=t[0]*r[0]+t[1]*r[1]+t[2]*r[2];return o===0?null:(-(a[0]*r[0]+a[1]*r[1]+a[2]*r[2])-r[3])/o},A.a_=Ke,A.aa=kl,A.ab=Oh,A.ac=function(a){const t={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,o,d,g)=>{const _=d||g;return t[o]=!_||_.toLowerCase(),""}),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},A.ad=nn,A.ae=function(a){return Math.pow(2,a)},A.af=Di,A.ag=Hi,A.ah=85.051129,A.ai=Wp,A.aj=function(a){return Math.log(a)/Math.LN2},A.ak=function(a){var t=a[0],r=a[1];return t*t+r*r},A.al=function(a,t){const r=[];for(const o in a)o in t||r.push(o);return r},A.am=function(a,t){let r=0,o=0;if(a.kind==="constant")o=a.layoutSize;else if(a.kind!=="source"){const{interpolationType:d,minZoom:g,maxZoom:_}=a,x=d?Hi(or.interpolationFactor(d,t,g,_),0,1):0;a.kind==="camera"?o=$r.number(a.minSize,a.maxSize,x):r=x}return{uSizeT:r,uSize:o}},A.ao=function(a,{uSize:t,uSizeT:r},{lowerSize:o,upperSize:d}){return a.kind==="source"?o/as:a.kind==="composite"?$r.number(o/as,d/as,r):t},A.ap=function(a,t){var r=t[0],o=t[1],d=t[2],g=t[3],_=t[4],x=t[5],T=t[6],P=t[7],D=t[8],k=t[9],N=t[10],V=t[11],q=t[12],$=t[13],Q=t[14],ae=t[15],ve=r*x-o*_,he=r*T-d*_,U=r*P-g*_,W=o*T-d*x,fe=o*P-g*x,Ie=d*P-g*T,Je=D*$-k*q,Ne=D*Q-N*q,qe=D*ae-V*q,st=k*Q-N*$,nt=k*ae-V*$,ot=N*ae-V*Q,$e=ve*ot-he*nt+U*st+W*qe-fe*Ne+Ie*Je;return $e?(a[0]=(x*ot-T*nt+P*st)*($e=1/$e),a[1]=(d*nt-o*ot-g*st)*$e,a[2]=($*Ie-Q*fe+ae*W)*$e,a[3]=(N*fe-k*Ie-V*W)*$e,a[4]=(T*qe-_*ot-P*Ne)*$e,a[5]=(r*ot-d*qe+g*Ne)*$e,a[6]=(Q*U-q*Ie-ae*he)*$e,a[7]=(D*Ie-N*U+V*he)*$e,a[8]=(_*nt-x*qe+P*Je)*$e,a[9]=(o*qe-r*nt-g*Je)*$e,a[10]=(q*fe-$*U+ae*ve)*$e,a[11]=(k*U-D*fe-V*ve)*$e,a[12]=(x*Ne-_*st-T*Je)*$e,a[13]=(r*st-o*Ne+d*Je)*$e,a[14]=($*he-q*W-Q*ve)*$e,a[15]=(D*W-k*he+N*ve)*$e,a):null},A.aq=be,A.ar=function(a){return Math.hypot(a[0],a[1])},A.as=function(a){return a[0]=0,a[1]=0,a},A.at=function(a,t,r){return a[0]=t[0]*r,a[1]=t[1]*r,a},A.au=Md,A.av=yt,A.aw=function(a,t,r,o){const d=t.y-a.y,g=t.x-a.x,_=o.y-r.y,x=o.x-r.x,T=_*g-x*d;if(T===0)return null;const P=(x*(a.y-r.y)-_*(a.x-r.x))/T;return new Ee(a.x+P*g,a.y+P*d)},A.ax=Dd,A.ay=ef,A.az=function(a){let t=1/0,r=1/0,o=-1/0,d=-1/0;for(const g of a)t=Math.min(t,g.x),r=Math.min(r,g.y),o=Math.max(o,g.x),d=Math.max(d,g.y);return[t,r,o,d]},A.b=Sa,A.b$=jp,A.b0=function(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]+a[3]},A.b1=Pd,A.b2=Iu,A.b3=function(a,t,r,o,d){var g,_=1/Math.tan(t/2);return a[0]=_/r,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=_,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,d!=null&&d!==1/0?(a[10]=(d+o)*(g=1/(o-d)),a[14]=2*d*o*g):(a[10]=-1,a[14]=-2*o),a},A.b4=function(a){var t=new Ut(16);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},A.b5=function(a,t,r){var o=Math.sin(r),d=Math.cos(r),g=t[0],_=t[1],x=t[2],T=t[3],P=t[4],D=t[5],k=t[6],N=t[7];return t!==a&&(a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=g*d+P*o,a[1]=_*d+D*o,a[2]=x*d+k*o,a[3]=T*d+N*o,a[4]=P*d-g*o,a[5]=D*d-_*o,a[6]=k*d-x*o,a[7]=N*d-T*o,a},A.b6=function(a,t,r){var o=Math.sin(r),d=Math.cos(r),g=t[4],_=t[5],x=t[6],T=t[7],P=t[8],D=t[9],k=t[10],N=t[11];return t!==a&&(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[4]=g*d+P*o,a[5]=_*d+D*o,a[6]=x*d+k*o,a[7]=T*d+N*o,a[8]=P*d-g*o,a[9]=D*d-_*o,a[10]=k*d-x*o,a[11]=N*d-T*o,a},A.b7=function(){const a=new Float32Array(16);return Di(a),a},A.b8=function(){const a=new Float64Array(16);return Di(a),a},A.b9=function(){return new Float64Array(16)},A.bA=function(a){return a[0]=0,a[1]=0,a[2]=0,a},A.bB=function(a,t,r,o){const d=Math.sqrt(a*a+t*t),g=Math.sqrt(r*r+o*o);a/=d,t/=d,r/=g,o/=g;const _=Math.acos(a*r+t*o);return-t*r+a*o>0?_:-_},A.bC=function(a,t){const r=Ct(a,2*Math.PI),o=Ct(t,2*Math.PI);return Math.min(Math.abs(r-o),Math.abs(r-o+2*Math.PI),Math.abs(r-o-2*Math.PI))},A.bD=function(){const a={},t=_e.$version;for(const r in _e.$root){const o=_e.$root[r];if(o.required){let d=null;d=r==="version"?t:o.type==="array"?[]:{},d!=null&&(a[r]=d)}}return a},A.bE=Tc,A.bF=ye,A.bG=function a(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let o=0;o<t.length;o++)if(!a(t[o],r[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(const o in t)if(!a(t[o],r[o]))return!1;return!0}return t===r},A.bH=function(a){a=a.slice();const t=Object.create(null);for(let r=0;r<a.length;r++)t[a[r].id]=a[r];for(let r=0;r<a.length;r++)"ref"in a[r]&&(a[r]=Lt(a[r],t[a[r].ref]));return a},A.bI=function(a){if(a.type==="custom")return new jf(a);switch(a.type){case"background":return new Ih(a);case"circle":return new ld(a);case"color-relief":return new pd(a);case"fill":return new oo(a);case"fill-extrusion":return new Fl(a);case"heatmap":return new Pp(a);case"hillshade":return new Ho(a);case"line":return new Sf(a);case"raster":return new yi(a);case"symbol":return new Pu(a)}},A.bJ=aa,A.bK=function(a,t){if(!a)return[{command:"setStyle",args:[t]}];let r=[];try{if(!vt(a.version,t.version))return[{command:"setStyle",args:[t]}];vt(a.center,t.center)||r.push({command:"setCenter",args:[t.center]}),vt(a.state,t.state)||r.push({command:"setGlobalState",args:[t.state]}),vt(a.centerAltitude,t.centerAltitude)||r.push({command:"setCenterAltitude",args:[t.centerAltitude]}),vt(a.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),vt(a.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),vt(a.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),vt(a.roll,t.roll)||r.push({command:"setRoll",args:[t.roll]}),vt(a.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),vt(a.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),vt(a.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),vt(a.light,t.light)||r.push({command:"setLight",args:[t.light]}),vt(a.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),vt(a.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),vt(a.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});const o={},d=[];(function(_,x,T,P){let D;for(D in x=x||{},_=_||{})Object.prototype.hasOwnProperty.call(_,D)&&(Object.prototype.hasOwnProperty.call(x,D)||ei(D,T,P));for(D in x)Object.prototype.hasOwnProperty.call(x,D)&&(Object.prototype.hasOwnProperty.call(_,D)?vt(_[D],x[D])||(_[D].type==="geojson"&&x[D].type==="geojson"&&ci(_,x,D)?At(T,{command:"setGeoJSONSourceData",args:[D,x[D].data]}):Qt(D,x,T,P)):kt(D,x,T))})(a.sources,t.sources,d,o);const g=[];a.layers&&a.layers.forEach(_=>{"source"in _&&o[_.source]?r.push({command:"removeLayer",args:[_.id]}):g.push(_)}),r=r.concat(d),function(_,x,T){x=x||[];const P=(_=_||[]).map(ui),D=x.map(ui),k=_.reduce(Wn,{}),N=x.reduce(Wn,{}),V=P.slice(),q=Object.create(null);let $,Q,ae,ve,he;for(let U=0,W=0;U<P.length;U++)$=P[U],Object.prototype.hasOwnProperty.call(N,$)?W++:(At(T,{command:"removeLayer",args:[$]}),V.splice(V.indexOf($,W),1));for(let U=0,W=0;U<D.length;U++)$=D[D.length-1-U],V[V.length-1-U]!==$&&(Object.prototype.hasOwnProperty.call(k,$)?(At(T,{command:"removeLayer",args:[$]}),V.splice(V.lastIndexOf($,V.length-W),1)):W++,ve=V[V.length-U],At(T,{command:"addLayer",args:[N[$],ve]}),V.splice(V.length-U,0,$),q[$]=!0);for(let U=0;U<D.length;U++)if($=D[U],Q=k[$],ae=N[$],!q[$]&&!vt(Q,ae))if(vt(Q.source,ae.source)&&vt(Q["source-layer"],ae["source-layer"])&&vt(Q.type,ae.type)){for(he in Bt(Q.layout,ae.layout,T,$,null,"setLayoutProperty"),Bt(Q.paint,ae.paint,T,$,null,"setPaintProperty"),vt(Q.filter,ae.filter)||At(T,{command:"setFilter",args:[$,ae.filter]}),vt(Q.minzoom,ae.minzoom)&&vt(Q.maxzoom,ae.maxzoom)||At(T,{command:"setLayerZoomRange",args:[$,ae.minzoom,ae.maxzoom]}),Q)Object.prototype.hasOwnProperty.call(Q,he)&&he!=="layout"&&he!=="paint"&&he!=="filter"&&he!=="metadata"&&he!=="minzoom"&&he!=="maxzoom"&&(he.indexOf("paint.")===0?Bt(Q[he],ae[he],T,$,he.slice(6),"setPaintProperty"):vt(Q[he],ae[he])||At(T,{command:"setLayerProperty",args:[$,he,ae[he]]}));for(he in ae)Object.prototype.hasOwnProperty.call(ae,he)&&!Object.prototype.hasOwnProperty.call(Q,he)&&he!=="layout"&&he!=="paint"&&he!=="filter"&&he!=="metadata"&&he!=="minzoom"&&he!=="maxzoom"&&(he.indexOf("paint.")===0?Bt(Q[he],ae[he],T,$,he.slice(6),"setPaintProperty"):vt(Q[he],ae[he])||At(T,{command:"setLayerProperty",args:[$,he,ae[he]]}))}else At(T,{command:"removeLayer",args:[$]}),ve=V[V.lastIndexOf($)+1],At(T,{command:"addLayer",args:[ae,ve]})}(g,t.layers,r)}catch(o){console.warn("Unable to compute style diff:",o),r=[{command:"setStyle",args:[t]}]}return r},A.bL=function(a){const t=[],r=a.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),a.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},A.bM=tn,A.bN=ra,A.bO=class extends Ri{constructor(a,t){super(a,t),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},A.bP=Cc,A.bQ=class extends Ri{constructor(a,t){super(a,t),this.current=nd}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let t=1;t<16;t++)if(a[t]!==this.current[t]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},A.bR=fn,A.bS=class extends Ri{constructor(a,t){super(a,t),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},A.bT=class extends Ri{constructor(a,t){super(a,t),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},A.bU=oi,A.bV=function(a,t){var r=Math.sin(t),o=Math.cos(t);return a[0]=o,a[1]=r,a[2]=0,a[3]=-r,a[4]=o,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},A.bW=function(a,t,r){var o=t[0],d=t[1],g=t[2];return a[0]=o*r[0]+d*r[3]+g*r[6],a[1]=o*r[1]+d*r[4]+g*r[7],a[2]=o*r[2]+d*r[5]+g*r[8],a},A.bX=function(a,t,r,o,d,g,_){var x=1/(t-r),T=1/(o-d),P=1/(g-_);return a[0]=-2*x,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*T,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*P,a[11]=0,a[12]=(t+r)*x,a[13]=(d+o)*T,a[14]=(_+g)*P,a[15]=1,a},A.bY=class extends Ri{constructor(a,t){super(a,t),this.current=new Array}set(a){if(a!=this.current){this.current=a;const t=new Float32Array(4*a.length);for(let r=0;r<a.length;r++)t[4*r]=a[r].r,t[4*r+1]=a[r].g,t[4*r+2]=a[r].b,t[4*r+3]=a[r].a;this.gl.uniform4fv(this.location,t)}}},A.bZ=class extends Ri{constructor(a,t){super(a,t),this.current=new Array}set(a){if(a!=this.current){this.current=a;const t=new Float32Array(a);this.gl.uniform1fv(this.location,t)}}},A.b_=class extends l{},A.ba=function(a,t,r){const o=new Float64Array(4);return mi(o,a,t-90,r),o},A.bb=function(a,t,r,o){var d,g,_,x,T,P=t[0],D=t[1],k=t[2],N=t[3],V=r[0],q=r[1],$=r[2],Q=r[3];return(g=P*V+D*q+k*$+N*Q)<0&&(g=-g,V=-V,q=-q,$=-$,Q=-Q),1-g>pt?(d=Math.acos(g),_=Math.sin(d),x=Math.sin((1-o)*d)/_,T=Math.sin(o*d)/_):(x=1-o,T=o),a[0]=x*P+T*V,a[1]=x*D+T*q,a[2]=x*k+T*$,a[3]=x*N+T*Q,a},A.bc=function(a){const t=new Float64Array(9);var r,o,d,g,_,x,T,P,D,k,N,V,q,$,Q,ae,ve,he;k=(d=(o=a)[0])*(T=d+d),N=(g=o[1])*T,q=(_=o[2])*T,$=_*(P=g+g),ae=(x=o[3])*T,ve=x*P,he=x*(D=_+_),(r=t)[0]=1-(V=g*P)-(Q=_*D),r[3]=N-he,r[6]=q+ve,r[1]=N+he,r[4]=1-k-Q,r[7]=$-ae,r[2]=q-ve,r[5]=$+ae,r[8]=1-k-V;const U=nr(-Math.asin(Hi(t[2],-1,1)));let W,fe;return Math.hypot(t[5],t[8])<.001?(W=0,fe=-nr(Math.atan2(t[3],t[4]))):(W=nr(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),fe=nr(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:W,pitch:U+90,bearing:fe}},A.bd=function(a,t){return a.roll==t.roll&&a.pitch==t.pitch&&a.bearing==t.bearing},A.be=Kt,A.bf=tr,A.bg=bu,A.bh=Rc,A.bi=Pc,A.bj=li,A.bk=Vt,A.bl=$t,A.bm=function(a,t,r,o,d){return li(o,d,Hi((a-t)/(r-t),0,1))},A.bn=Ct,A.bo=function(){return new Float64Array(3)},A.bp=function(a,t,r,o){return a[0]=t[0]+r[0]*o,a[1]=t[1]+r[1]*o,a[2]=t[2]+r[2]*o,a},A.bq=mi,A.br=function(a,t,r){var o=r[0],d=r[1],g=r[2],_=t[0],x=t[1],T=t[2],P=d*T-g*x,D=g*_-o*T,k=o*x-d*_,N=d*k-g*D,V=g*P-o*k,q=o*D-d*P,$=2*r[3];return D*=$,k*=$,V*=2,q*=2,a[0]=_+(P*=$)+(N*=2),a[1]=x+D+V,a[2]=T+k+q,a},A.bs=function(a,t,r){const o=(d=[a[0],a[1],a[2],t[0],t[1],t[2],r[0],r[1],r[2]])[0]*((D=d[8])*(_=d[4])-(x=d[5])*(P=d[7]))+d[1]*(-D*(g=d[3])+x*(T=d[6]))+d[2]*(P*g-_*T);var d,g,_,x,T,P,D;if(o===0)return null;const k=Yn([],[t[0],t[1],t[2]],[r[0],r[1],r[2]]),N=Yn([],[r[0],r[1],r[2]],[a[0],a[1],a[2]]),V=Yn([],[a[0],a[1],a[2]],[t[0],t[1],t[2]]),q=bn([],k,-a[3]);return en(q,q,bn([],N,-t[3])),en(q,q,bn([],V,-r[3])),bn(q,q,1/o),q},A.bt=zd,A.bu=function(){return new Float64Array(4)},A.bv=function(a,t,r,o){var d=[],g=[];return d[0]=t[0]-r[0],d[1]=t[1]-r[1],d[2]=t[2]-r[2],g[0]=d[0]*Math.cos(o)-d[1]*Math.sin(o),g[1]=d[0]*Math.sin(o)+d[1]*Math.cos(o),g[2]=d[2],a[0]=g[0]+r[0],a[1]=g[1]+r[1],a[2]=g[2]+r[2],a},A.bw=function(a,t,r,o){var d=[],g=[];return d[0]=t[0]-r[0],d[1]=t[1]-r[1],d[2]=t[2]-r[2],g[0]=d[0],g[1]=d[1]*Math.cos(o)-d[2]*Math.sin(o),g[2]=d[1]*Math.sin(o)+d[2]*Math.cos(o),a[0]=g[0]+r[0],a[1]=g[1]+r[1],a[2]=g[2]+r[2],a},A.bx=function(a,t,r,o){var d=[],g=[];return d[0]=t[0]-r[0],d[1]=t[1]-r[1],d[2]=t[2]-r[2],g[0]=d[2]*Math.sin(o)+d[0]*Math.cos(o),g[1]=d[1],g[2]=d[2]*Math.cos(o)-d[0]*Math.sin(o),a[0]=g[0]+r[0],a[1]=g[1]+r[1],a[2]=g[2]+r[2],a},A.by=function(a,t,r){var o=Math.sin(r),d=Math.cos(r),g=t[0],_=t[1],x=t[2],T=t[3],P=t[8],D=t[9],k=t[10],N=t[11];return t!==a&&(a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=g*d-P*o,a[1]=_*d-D*o,a[2]=x*d-k*o,a[3]=T*d-N*o,a[8]=g*o+P*d,a[9]=_*o+D*d,a[10]=x*o+k*d,a[11]=T*o+N*d,a},A.bz=function(a,t){const r=Ct(a,360),o=Ct(t,360),d=o-r,g=o>r?d-360:d+360;return Math.abs(d)<Math.abs(g)?d:g},A.c=Ae,A.c0=class extends m{},A.c1=gh,A.c2=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},A.c3=mh,A.c4=function(a,t,r){var o=t[0],d=t[1],g=t[2],_=r[3]*o+r[7]*d+r[11]*g+r[15];return a[0]=(r[0]*o+r[4]*d+r[8]*g+r[12])/(_=_||1),a[1]=(r[1]*o+r[5]*d+r[9]*g+r[13])/_,a[2]=(r[2]*o+r[6]*d+r[10]*g+r[14])/_,a},A.c5=class extends Uo{},A.c6=class extends O{},A.c7=function(a,t){return a[0]===t[0]&&a[1]===t[1]&&a[2]===t[2]&&a[3]===t[3]&&a[4]===t[4]&&a[5]===t[5]&&a[6]===t[6]&&a[7]===t[7]&&a[8]===t[8]&&a[9]===t[9]&&a[10]===t[10]&&a[11]===t[11]&&a[12]===t[12]&&a[13]===t[13]&&a[14]===t[14]&&a[15]===t[15]},A.c8=function(a,t){var r=a[0],o=a[1],d=a[2],g=a[3],_=a[4],x=a[5],T=a[6],P=a[7],D=a[8],k=a[9],N=a[10],V=a[11],q=a[12],$=a[13],Q=a[14],ae=a[15],ve=t[0],he=t[1],U=t[2],W=t[3],fe=t[4],Ie=t[5],Je=t[6],Ne=t[7],qe=t[8],st=t[9],nt=t[10],ot=t[11],$e=t[12],St=t[13],Rt=t[14],Mt=t[15];return Math.abs(r-ve)<=pt*Math.max(1,Math.abs(r),Math.abs(ve))&&Math.abs(o-he)<=pt*Math.max(1,Math.abs(o),Math.abs(he))&&Math.abs(d-U)<=pt*Math.max(1,Math.abs(d),Math.abs(U))&&Math.abs(g-W)<=pt*Math.max(1,Math.abs(g),Math.abs(W))&&Math.abs(_-fe)<=pt*Math.max(1,Math.abs(_),Math.abs(fe))&&Math.abs(x-Ie)<=pt*Math.max(1,Math.abs(x),Math.abs(Ie))&&Math.abs(T-Je)<=pt*Math.max(1,Math.abs(T),Math.abs(Je))&&Math.abs(P-Ne)<=pt*Math.max(1,Math.abs(P),Math.abs(Ne))&&Math.abs(D-qe)<=pt*Math.max(1,Math.abs(D),Math.abs(qe))&&Math.abs(k-st)<=pt*Math.max(1,Math.abs(k),Math.abs(st))&&Math.abs(N-nt)<=pt*Math.max(1,Math.abs(N),Math.abs(nt))&&Math.abs(V-ot)<=pt*Math.max(1,Math.abs(V),Math.abs(ot))&&Math.abs(q-$e)<=pt*Math.max(1,Math.abs(q),Math.abs($e))&&Math.abs($-St)<=pt*Math.max(1,Math.abs($),Math.abs(St))&&Math.abs(Q-Rt)<=pt*Math.max(1,Math.abs(Q),Math.abs(Rt))&&Math.abs(ae-Mt)<=pt*Math.max(1,Math.abs(ae),Math.abs(Mt))},A.c9=function(a,t){return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},A.cA=function(a){delete H.REGISTERED_PROTOCOLS[a]},A.cB=function(a,t){const r={};for(let d=0;d<a.length;d++){const g=t&&t[a[d].id]||Hs(a[d]);t&&(t[a[d].id]=g);let _=r[g];_||(_=r[g]=[]),_.push(a[d])}const o=[];for(const d in r)o.push(r[d]);return o},A.cC=_t,A.cD=Rd,A.cE=Zf,A.cF=Rf,A.cG=function(a){a.bucket.createArrays(),a.bucket.tilePixelRatio=lt/(512*a.bucket.overscaling),a.bucket.compareText={},a.bucket.iconsNeedLinear=!1;const t=a.bucket.layers[0],r=t.layout,o=t._unevaluatedLayout._values,d={layoutIconSize:o["icon-size"].possiblyEvaluate(new Ni(a.bucket.zoom+1),a.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Ni(a.bucket.zoom+1),a.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Ni(18))};if(a.bucket.textSizeData.kind==="composite"){const{minZoom:P,maxZoom:D}=a.bucket.textSizeData;d.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Ni(P),a.canonical),o["text-size"].possiblyEvaluate(new Ni(D),a.canonical)]}if(a.bucket.iconSizeData.kind==="composite"){const{minZoom:P,maxZoom:D}=a.bucket.iconSizeData;d.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Ni(P),a.canonical),o["icon-size"].possiblyEvaluate(new Ni(D),a.canonical)]}const g=r.get("text-line-height")*zn,_=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",x=r.get("text-keep-upright"),T=r.get("text-size");for(const P of a.bucket.features){const D=r.get("text-font").evaluate(P,{},a.canonical).join(","),k=T.evaluate(P,{},a.canonical),N=d.layoutTextSize.evaluate(P,{},a.canonical),V=d.layoutIconSize.evaluate(P,{},a.canonical),q={horizontal:{},vertical:void 0},$=P.text;let Q,ae=[0,0];if($){const U=$.toString(),W=r.get("text-letter-spacing").evaluate(P,{},a.canonical)*zn,fe=Ts(U)?W:0,Ie=r.get("text-anchor").evaluate(P,{},a.canonical),Je=fo(t,P,a.canonical);if(!Je){const nt=r.get("text-radial-offset").evaluate(P,{},a.canonical);ae=nt?Bh(Ie,[nt*zn,Od]):r.get("text-offset").evaluate(P,{},a.canonical).map(ot=>ot*zn)}let Ne=_?"center":r.get("text-justify").evaluate(P,{},a.canonical);const qe=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(P,{},a.canonical)*zn:1/0,st=()=>{a.bucket.allowVerticalPlacement&&Ka(U)&&(q.vertical=Lc($,a.glyphMap,a.glyphPositions,a.imagePositions,D,qe,g,Ie,"left",fe,ae,A.an.vertical,!0,N,k))};if(!_&&Je){const nt=new Set;if(Ne==="auto")for(let $e=0;$e<Je.values.length;$e+=2)nt.add(Qf(Je.values[$e]));else nt.add(Ne);let ot=!1;for(const $e of nt)if(!q.horizontal[$e])if(ot)q.horizontal[$e]=q.horizontal[0];else{const St=Lc($,a.glyphMap,a.glyphPositions,a.imagePositions,D,qe,g,"center",$e,fe,ae,A.an.horizontal,!1,N,k);St&&(q.horizontal[$e]=St,ot=St.positionedLines.length===1)}st()}else{Ne==="auto"&&(Ne=Qf(Ie));const nt=Lc($,a.glyphMap,a.glyphPositions,a.imagePositions,D,qe,g,Ie,Ne,fe,ae,A.an.horizontal,!1,N,k);nt&&(q.horizontal[Ne]=nt),st(),Ka(U)&&_&&x&&(q.vertical=Lc($,a.glyphMap,a.glyphPositions,a.imagePositions,D,qe,g,Ie,Ne,fe,ae,A.an.vertical,!1,N,k))}}let ve=!1;if(P.icon&&P.icon.name){const U=a.imageMap[P.icon.name];U&&(Q=Sd(a.imagePositions[P.icon.name],r.get("icon-offset").evaluate(P,{},a.canonical),r.get("icon-anchor").evaluate(P,{},a.canonical)),ve=!!U.sdf,a.bucket.sdfIcons===void 0?a.bucket.sdfIcons=ve:a.bucket.sdfIcons!==ve&&Xi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(U.pixelRatio!==a.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(a.bucket.iconsNeedLinear=!0))}const he=Jf(q.horizontal)||q.vertical;a.bucket.iconsInText=!!he&&he.iconsInText,(he||Q)&&Fm(a.bucket,P,q,Q,a.imageMap,d,N,V,ae,ve,a.canonical,a.subdivisionGranularity)}a.showCollisionBoxes&&a.bucket.generateCollisionDebugBuffers()},A.cH=Mu,A.cI=Yo,A.cJ=ia,A.cK=Oi,A.cL=bd,A.cM=class{constructor(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let a=performance.getEntriesByName(this._marks.measure);return a.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),a=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),a}},A.cN=function(a,t,r,o,d){return c(this,void 0,void 0,function*(){if(Ot())try{return yield Ls(a,t,r,o,d)}catch{}return function(g,_,x,T,P){const D=g.width,k=g.height;cs&&go||(cs=new OffscreenCanvas(D,k),go=cs.getContext("2d",{willReadFrequently:!0})),cs.width=D,cs.height=k,go.drawImage(g,0,0,D,k);const N=go.getImageData(_,x,T,P);return go.clearRect(0,0,D,k),N.data}(a,t,r,o,d)})},A.cO=ao,A.cP=J,A.cQ=Te,A.cR=Li,A.cS=Cf,A.cT=Mr,A.cU=Qa,A.ca=a=>a.type==="symbol",A.cb=a=>a.type==="circle",A.cc=a=>a.type==="heatmap",A.cd=a=>a.type==="line",A.ce=a=>a.type==="fill",A.cf=a=>a.type==="fill-extrusion",A.cg=a=>a.type==="hillshade",A.ch=a=>a.type==="color-relief",A.ci=a=>a.type==="raster",A.cj=a=>a.type==="background",A.ck=a=>a.type==="custom",A.cl=Kn,A.cm=function(a,t,r){const o=Qe(t.x-r.x,t.y-r.y),d=Qe(a.x-r.x,a.y-r.y);var g,_;return nr(Math.atan2(o[0]*d[1]-o[1]*d[0],(g=o)[0]*(_=d)[0]+g[1]*_[1]))},A.cn=Fi,A.co=function(a,t){return qc[t]&&(a instanceof MouseEvent||a instanceof WheelEvent)},A.cp=function(a,t){return rr[t]&&"touches"in a},A.cq=function(a){return rr[a]||qc[a]},A.cr=function(a,t,r){var o=t[0],d=t[1];return a[0]=r[0]*o+r[4]*d+r[12],a[1]=r[1]*o+r[5]*d+r[13],a},A.cs=function(a,t){const{x:r,y:o}=Du.fromLngLat(t);return!(a<0||a>25||o<0||o>=1||r<0||r>=1)},A.ct=function(a,t){return a[0]=t[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=t[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=t[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},A.cu=class extends Ja{},A.cv=am,A.cx=function(a){return a.message===us},A.cy=ce,A.cz=function(a,t){H.REGISTERED_PROTOCOLS[a]=t},A.d=ke,A.e=dr,A.f=a=>c(void 0,void 0,void 0,function*(){if(a.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(a)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),A.g=Y,A.h=a=>new Promise((t,r)=>{const o=new Image;o.onload=()=>{t(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=Wl})},o.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const d=new Blob([new Uint8Array(a)],{type:"image/png"});o.src=a.byteLength?URL.createObjectURL(d):Wl}),A.i=br,A.j=(a,t)=>Ce(dr(a,{type:"json"}),t),A.k=ze,A.l=je,A.m=Ce,A.n=(a,t)=>Ce(dr(a,{type:"arrayBuffer"}),t),A.o=function(a){return new bd(a).readFields(Af,[])},A.p=Up,A.q=yu,A.r=lr,A.s=Vr,A.t=Ci,A.u=ii,A.v=_e,A.w=Xi,A.x=ou,A.y=Qs,A.z=Ws}),L("worker",["./shared"],function(A){class c{constructor(H){this.keyCache={},H&&this.replace(H)}replace(H){this._layerConfigs={},this._layers={},this.update(H,[])}update(H,Y){for(const ce of H){this._layerConfigs[ce.id]=ce;const ye=this._layers[ce.id]=A.bI(ce);ye._featureFilter=A.a9(ye.filter),this.keyCache[ce.id]&&delete this.keyCache[ce.id]}for(const ce of Y)delete this.keyCache[ce],delete this._layerConfigs[ce],delete this._layers[ce];this.familiesBySource={};const ee=A.cB(Object.values(this._layerConfigs),this.keyCache);for(const ce of ee){const ye=ce.map(ze=>this._layers[ze.id]),Ce=ye[0];if(Ce.visibility==="none")continue;const ke=Ce.source||"";let Se=this.familiesBySource[ke];Se||(Se=this.familiesBySource[ke]={});const Ze=Ce.sourceLayer||"_geojsonTileLayer";let je=Se[Ze];je||(je=Se[Ze]=[]),je.push(ye)}}}class J{constructor(H){const Y={},ee=[];for(const ke in H){const Se=H[ke],Ze=Y[ke]={};for(const je in Se){const ze=Se[+je];if(!ze||ze.bitmap.width===0||ze.bitmap.height===0)continue;const Xe={x:0,y:0,w:ze.bitmap.width+2,h:ze.bitmap.height+2};ee.push(Xe),Ze[je]={rect:Xe,metrics:ze.metrics}}}const{w:ce,h:ye}=A.p(ee),Ce=new A.q({width:ce||1,height:ye||1});for(const ke in H){const Se=H[ke];for(const Ze in Se){const je=Se[+Ze];if(!je||je.bitmap.width===0||je.bitmap.height===0)continue;const ze=Y[ke][Ze].rect;A.q.copy(je.bitmap,Ce,{x:0,y:0},{x:ze.x+1,y:ze.y+1},je.bitmap)}}this.image=Ce,this.positions=Y}}A.cC("GlyphAtlas",J);class X{constructor(H){this.tileID=new A.Z(H.tileID.overscaledZ,H.tileID.wrap,H.tileID.canonical.z,H.tileID.canonical.x,H.tileID.canonical.y),this.uid=H.uid,this.zoom=H.zoom,this.pixelRatio=H.pixelRatio,this.tileSize=H.tileSize,this.source=H.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=H.showCollisionBoxes,this.collectResourceTiming=!!H.collectResourceTiming,this.returnDependencies=!!H.returnDependencies,this.promoteId=H.promoteId,this.inFlightDependencies=[],this.globalState=H.globalState}parse(H,Y,ee,ce,ye){return A._(this,void 0,void 0,function*(){this.status="parsing",this.data=H,this.collisionBoxArray=new A.a7;const Ce=new A.cD(Object.keys(H.layers).sort()),ke=new A.cE(this.tileID,this.promoteId);ke.bucketLayerIDs=[];const Se={},Ze={featureIndex:ke,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ee,subdivisionGranularity:ye},je=Y.familiesBySource[this.source];for(const Bt in je){const ui=H.layers[Bt];if(!ui)continue;ui.version===1&&A.w(`Vector tile source "${this.source}" layer "${Bt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Wn=Ce.encode(Bt),ct=[];for(let wn=0;wn<ui.length;wn++){const Yi=ui.feature(wn),Gr=ke.getId(Yi,Bt);ct.push({feature:Yi,id:Gr,index:wn,sourceLayerIndex:Wn})}for(const wn of je[Bt]){const Yi=wn[0];Yi.source!==this.source&&A.w(`layer.source = ${Yi.source} does not equal this.source = ${this.source}`),Yi.minzoom&&this.zoom<Math.floor(Yi.minzoom)||Yi.maxzoom&&this.zoom>=Yi.maxzoom||Yi.visibility!=="none"&&(re(wn,this.zoom,ee),(Se[Yi.id]=Yi.createBucket({index:ke.bucketLayerIDs.length,layers:wn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Wn,sourceID:this.source,globalState:this.globalState})).populate(ct,Ze,this.tileID.canonical),ke.bucketLayerIDs.push(wn.map(Gr=>Gr.id)))}}const ze=A.bM(Ze.glyphDependencies,Bt=>Object.keys(Bt).map(Number));this.inFlightDependencies.forEach(Bt=>Bt==null?void 0:Bt.abort()),this.inFlightDependencies=[];let Xe=Promise.resolve({});if(Object.keys(ze).length){const Bt=new AbortController;this.inFlightDependencies.push(Bt),Xe=ce.sendAsync({type:"GG",data:{stacks:ze,source:this.source,tileID:this.tileID,type:"glyphs"}},Bt)}const _e=Object.keys(Ze.iconDependencies);let mt=Promise.resolve({});if(_e.length){const Bt=new AbortController;this.inFlightDependencies.push(Bt),mt=ce.sendAsync({type:"GI",data:{icons:_e,source:this.source,tileID:this.tileID,type:"icons"}},Bt)}const Lt=Object.keys(Ze.patternDependencies);let vt=Promise.resolve({});if(Lt.length){const Bt=new AbortController;this.inFlightDependencies.push(Bt),vt=ce.sendAsync({type:"GI",data:{icons:Lt,source:this.source,tileID:this.tileID,type:"patterns"}},Bt)}const[At,kt,ei]=yield Promise.all([Xe,mt,vt]),Qt=new J(At),ci=new A.cF(kt,ei);for(const Bt in Se){const ui=Se[Bt];ui instanceof A.a8?(re(ui.layers,this.zoom,ee),A.cG({bucket:ui,glyphMap:At,glyphPositions:Qt.positions,imageMap:kt,imagePositions:ci.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Ze.subdivisionGranularity})):ui.hasPattern&&(ui instanceof A.cH||ui instanceof A.cI||ui instanceof A.cJ)&&(re(ui.layers,this.zoom,ee),ui.addFeatures(Ze,this.tileID.canonical,ci.patternPositions))}return this.status="done",{buckets:Object.values(Se).filter(Bt=>!Bt.isEmpty()),featureIndex:ke,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Qt.image,imageAtlas:ci,glyphMap:this.returnDependencies?At:null,iconMap:this.returnDependencies?kt:null,glyphPositions:this.returnDependencies?Qt.positions:null}})}}function re(Ae,H,Y){const ee=new A.F(H);for(const ce of Ae)ce.recalculate(ee,Y)}class Te{constructor(H,Y,ee){this.actor=H,this.layerIndex=Y,this.availableImages=ee,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(H,Y){return A._(this,void 0,void 0,function*(){const ee=yield A.n(H.request,Y);try{return{vectorTile:new A.cK.VectorTile(new A.cL(ee.data)),rawData:ee.data,cacheControl:ee.cacheControl,expires:ee.expires}}catch(ce){const ye=new Uint8Array(ee.data);let Ce=`Unable to parse the tile at ${H.request.url}, `;throw Ce+=ye[0]===31&&ye[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ce.message}`,new Error(Ce)}})}loadTile(H){return A._(this,void 0,void 0,function*(){const Y=H.uid,ee=!!(H&&H.request&&H.request.collectResourceTiming)&&new A.cM(H.request),ce=new X(H);this.loading[Y]=ce;const ye=new AbortController;ce.abort=ye;try{const Ce=yield this.loadVectorTile(H,ye);if(delete this.loading[Y],!Ce)return null;const ke=Ce.rawData,Se={};Ce.expires&&(Se.expires=Ce.expires),Ce.cacheControl&&(Se.cacheControl=Ce.cacheControl);const Ze={};if(ee){const ze=ee.finish();ze&&(Ze.resourceTiming=JSON.parse(JSON.stringify(ze)))}ce.vectorTile=Ce.vectorTile;const je=ce.parse(Ce.vectorTile,this.layerIndex,this.availableImages,this.actor,H.subdivisionGranularity);this.loaded[Y]=ce,this.fetching[Y]={rawTileData:ke,cacheControl:Se,resourceTiming:Ze};try{const ze=yield je;return A.e({rawTileData:ke.slice(0)},ze,Se,Ze)}finally{delete this.fetching[Y]}}catch(Ce){throw delete this.loading[Y],ce.status="done",this.loaded[Y]=ce,Ce}})}reloadTile(H){return A._(this,void 0,void 0,function*(){const Y=H.uid;if(!this.loaded||!this.loaded[Y])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ee=this.loaded[Y];if(ee.showCollisionBoxes=H.showCollisionBoxes,ee.globalState=H.globalState,ee.status==="parsing"){const ce=yield ee.parse(ee.vectorTile,this.layerIndex,this.availableImages,this.actor,H.subdivisionGranularity);let ye;if(this.fetching[Y]){const{rawTileData:Ce,cacheControl:ke,resourceTiming:Se}=this.fetching[Y];delete this.fetching[Y],ye=A.e({rawTileData:Ce.slice(0)},ce,ke,Se)}else ye=ce;return ye}if(ee.status==="done"&&ee.vectorTile)return ee.parse(ee.vectorTile,this.layerIndex,this.availableImages,this.actor,H.subdivisionGranularity)})}abortTile(H){return A._(this,void 0,void 0,function*(){const Y=this.loading,ee=H.uid;Y&&Y[ee]&&Y[ee].abort&&(Y[ee].abort.abort(),delete Y[ee])})}removeTile(H){return A._(this,void 0,void 0,function*(){this.loaded&&this.loaded[H.uid]&&delete this.loaded[H.uid]})}}class xe{constructor(){this.loaded={}}loadTile(H){return A._(this,void 0,void 0,function*(){const{uid:Y,encoding:ee,rawImageData:ce,redFactor:ye,greenFactor:Ce,blueFactor:ke,baseShift:Se}=H,Ze=ce.width+2,je=ce.height+2,ze=A.b(ce)?new A.R({width:Ze,height:je},yield A.cN(ce,-1,-1,Ze,je)):ce,Xe=new A.cO(Y,ze,ee,ye,Ce,ke,Se);return this.loaded=this.loaded||{},this.loaded[Y]=Xe,Xe})}removeTile(H){const Y=this.loaded,ee=H.uid;Y&&Y[ee]&&delete Y[ee]}}var de,Ee,We=function(){if(Ee)return de;function Ae(Y,ee){if(Y.length!==0){H(Y[0],ee);for(var ce=1;ce<Y.length;ce++)H(Y[ce],!ee)}}function H(Y,ee){for(var ce=0,ye=0,Ce=0,ke=Y.length,Se=ke-1;Ce<ke;Se=Ce++){var Ze=(Y[Ce][0]-Y[Se][0])*(Y[Se][1]+Y[Ce][1]),je=ce+Ze;ye+=Math.abs(ce)>=Math.abs(Ze)?ce-je+Ze:Ze-je+ce,ce=je}ce+ye>=0!=!!ee&&Y.reverse()}return Ee=1,de=function Y(ee,ce){var ye,Ce=ee&&ee.type;if(Ce==="FeatureCollection")for(ye=0;ye<ee.features.length;ye++)Y(ee.features[ye],ce);else if(Ce==="GeometryCollection")for(ye=0;ye<ee.geometries.length;ye++)Y(ee.geometries[ye],ce);else if(Ce==="Feature")Y(ee.geometry,ce);else if(Ce==="Polygon")Ae(ee.coordinates,ce);else if(Ce==="MultiPolygon")for(ye=0;ye<ee.coordinates.length;ye++)Ae(ee.coordinates[ye],ce);return ee}}(),Ve=A.cP(We);const et=A.cK.VectorTileFeature.prototype.toGeoJSON;class ft{constructor(H){this._feature=H,this.extent=A.$,this.type=H.type,this.properties=H.tags,"id"in H&&!isNaN(H.id)&&(this.id=parseInt(H.id,10))}loadGeometry(){if(this._feature.type===1){const H=[];for(const Y of this._feature.geometry)H.push([new A.P(Y[0],Y[1])]);return H}{const H=[];for(const Y of this._feature.geometry){const ee=[];for(const ce of Y)ee.push(new A.P(ce[0],ce[1]));H.push(ee)}return H}}toGeoJSON(H,Y,ee){return et.call(this,H,Y,ee)}}class Tt{constructor(H){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=A.$,this.length=H.length,this._features=H}feature(H){return new ft(this._features[H])}}var Ot,pt,Ut,oi={exports:{}},Di=function(){if(Ut)return oi.exports;Ut=1;var Ae=A.cS(),H=function(){if(pt)return Ot;pt=1;var je=A.cQ(),ze=A.cR().VectorTileFeature;function Xe(mt,Lt){this.options=Lt||{},this.features=mt,this.length=mt.length}function _e(mt,Lt){this.id=typeof mt.id=="number"?mt.id:void 0,this.type=mt.type,this.rawGeometry=mt.type===1?[mt.geometry]:mt.geometry,this.properties=mt.tags,this.extent=Lt||4096}return Ot=Xe,Xe.prototype.feature=function(mt){return new _e(this.features[mt],this.options.extent)},_e.prototype.loadGeometry=function(){var mt=this.rawGeometry;this.geometry=[];for(var Lt=0;Lt<mt.length;Lt++){for(var vt=mt[Lt],At=[],kt=0;kt<vt.length;kt++)At.push(new je(vt[kt][0],vt[kt][1]));this.geometry.push(At)}return this.geometry},_e.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var mt=this.geometry,Lt=1/0,vt=-1/0,At=1/0,kt=-1/0,ei=0;ei<mt.length;ei++)for(var Qt=mt[ei],ci=0;ci<Qt.length;ci++){var Bt=Qt[ci];Lt=Math.min(Lt,Bt.x),vt=Math.max(vt,Bt.x),At=Math.min(At,Bt.y),kt=Math.max(kt,Bt.y)}return[Lt,At,vt,kt]},_e.prototype.toGeoJSON=ze.prototype.toGeoJSON,Ot}();function Y(je){var ze=new Ae;return function(Xe,_e){for(var mt in Xe.layers)_e.writeMessage(3,ee,Xe.layers[mt])}(je,ze),ze.finish()}function ee(je,ze){var Xe;ze.writeVarintField(15,je.version||1),ze.writeStringField(1,je.name||""),ze.writeVarintField(5,je.extent||4096);var _e={keys:[],values:[],keycache:{},valuecache:{}};for(Xe=0;Xe<je.length;Xe++)_e.feature=je.feature(Xe),ze.writeMessage(2,ce,_e);var mt=_e.keys;for(Xe=0;Xe<mt.length;Xe++)ze.writeStringField(3,mt[Xe]);var Lt=_e.values;for(Xe=0;Xe<Lt.length;Xe++)ze.writeMessage(4,Ze,Lt[Xe])}function ce(je,ze){var Xe=je.feature;Xe.id!==void 0&&ze.writeVarintField(1,Xe.id),ze.writeMessage(2,ye,je),ze.writeVarintField(3,Xe.type),ze.writeMessage(4,Se,Xe)}function ye(je,ze){var Xe=je.feature,_e=je.keys,mt=je.values,Lt=je.keycache,vt=je.valuecache;for(var At in Xe.properties){var kt=Xe.properties[At],ei=Lt[At];if(kt!==null){ei===void 0&&(_e.push(At),Lt[At]=ei=_e.length-1),ze.writeVarint(ei);var Qt=typeof kt;Qt!=="string"&&Qt!=="boolean"&&Qt!=="number"&&(kt=JSON.stringify(kt));var ci=Qt+":"+kt,Bt=vt[ci];Bt===void 0&&(mt.push(kt),vt[ci]=Bt=mt.length-1),ze.writeVarint(Bt)}}}function Ce(je,ze){return(ze<<3)+(7&je)}function ke(je){return je<<1^je>>31}function Se(je,ze){for(var Xe=je.loadGeometry(),_e=je.type,mt=0,Lt=0,vt=Xe.length,At=0;At<vt;At++){var kt=Xe[At],ei=1;_e===1&&(ei=kt.length),ze.writeVarint(Ce(1,ei));for(var Qt=_e===3?kt.length-1:kt.length,ci=0;ci<Qt;ci++){ci===1&&_e!==1&&ze.writeVarint(Ce(2,Qt-1));var Bt=kt[ci].x-mt,ui=kt[ci].y-Lt;ze.writeVarint(ke(Bt)),ze.writeVarint(ke(ui)),mt+=Bt,Lt+=ui}_e===3&&ze.writeVarint(Ce(7,1))}}function Ze(je,ze){var Xe=typeof je;Xe==="string"?ze.writeStringField(1,je):Xe==="boolean"?ze.writeBooleanField(7,je):Xe==="number"&&(je%1!=0?ze.writeDoubleField(3,je):je<0?ze.writeSVarintField(6,je):ze.writeVarintField(5,je))}return oi.exports=Y,oi.exports.fromVectorTileJs=Y,oi.exports.fromGeojsonVt=function(je,ze){ze=ze||{};var Xe={};for(var _e in je)Xe[_e]=new H(je[_e].features,ze),Xe[_e].name=_e,Xe[_e].version=ze.version,Xe[_e].extent=ze.extent;return Y({layers:Xe})},oi.exports.GeoJSONWrapper=H,oi.exports}(),Mi=A.cP(Di);const Jt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ae=>Ae},wi=Math.fround||(en=new Float32Array(1),Ae=>(en[0]=+Ae,en[0]));var en;class bn{constructor(H){this.options=Object.assign(Object.create(Jt),H),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(H){const{log:Y,minZoom:ee,maxZoom:ce}=this.options;Y&&console.time("total time");const ye=`prepare ${H.length} points`;Y&&console.time(ye),this.points=H;const Ce=[];for(let Se=0;Se<H.length;Se++){const Ze=H[Se];if(!Ze.geometry)continue;const[je,ze]=Ze.geometry.coordinates,Xe=wi(Ke(je)),_e=wi(yt(ze));Ce.push(Xe,_e,1/0,Se,-1,1),this.options.reduce&&Ce.push(0)}let ke=this.trees[ce+1]=this._createTree(Ce);Y&&console.timeEnd(ye);for(let Se=ce;Se>=ee;Se--){const Ze=+Date.now();ke=this.trees[Se]=this._createTree(this._cluster(ke,Se)),Y&&console.log("z%d: %d clusters in %dms",Se,ke.numItems,+Date.now()-Ze)}return Y&&console.timeEnd("total time"),this}getClusters(H,Y){let ee=((H[0]+180)%360+360)%360-180;const ce=Math.max(-90,Math.min(90,H[1]));let ye=H[2]===180?180:((H[2]+180)%360+360)%360-180;const Ce=Math.max(-90,Math.min(90,H[3]));if(H[2]-H[0]>=360)ee=-180,ye=180;else if(ee>ye){const ze=this.getClusters([ee,ce,180,Ce],Y),Xe=this.getClusters([-180,ce,ye,Ce],Y);return ze.concat(Xe)}const ke=this.trees[this._limitZoom(Y)],Se=ke.range(Ke(ee),yt(Ce),Ke(ye),yt(ce)),Ze=ke.data,je=[];for(const ze of Se){const Xe=this.stride*ze;je.push(Ze[Xe+5]>1?Yn(Ze,Xe,this.clusterProps):this.points[Ze[Xe+3]])}return je}getChildren(H){const Y=this._getOriginId(H),ee=this._getOriginZoom(H),ce="No cluster with the specified id.",ye=this.trees[ee];if(!ye)throw new Error(ce);const Ce=ye.data;if(Y*this.stride>=Ce.length)throw new Error(ce);const ke=this.options.radius/(this.options.extent*Math.pow(2,ee-1)),Se=ye.within(Ce[Y*this.stride],Ce[Y*this.stride+1],ke),Ze=[];for(const je of Se){const ze=je*this.stride;Ce[ze+4]===H&&Ze.push(Ce[ze+5]>1?Yn(Ce,ze,this.clusterProps):this.points[Ce[ze+3]])}if(Ze.length===0)throw new Error(ce);return Ze}getLeaves(H,Y,ee){const ce=[];return this._appendLeaves(ce,H,Y=Y||10,ee=ee||0,0),ce}getTile(H,Y,ee){const ce=this.trees[this._limitZoom(H)],ye=Math.pow(2,H),{extent:Ce,radius:ke}=this.options,Se=ke/Ce,Ze=(ee-Se)/ye,je=(ee+1+Se)/ye,ze={features:[]};return this._addTileFeatures(ce.range((Y-Se)/ye,Ze,(Y+1+Se)/ye,je),ce.data,Y,ee,ye,ze),Y===0&&this._addTileFeatures(ce.range(1-Se/ye,Ze,1,je),ce.data,ye,ee,ye,ze),Y===ye-1&&this._addTileFeatures(ce.range(0,Ze,Se/ye,je),ce.data,-1,ee,ye,ze),ze.features.length?ze:null}getClusterExpansionZoom(H){let Y=this._getOriginZoom(H)-1;for(;Y<=this.options.maxZoom;){const ee=this.getChildren(H);if(Y++,ee.length!==1)break;H=ee[0].properties.cluster_id}return Y}_appendLeaves(H,Y,ee,ce,ye){const Ce=this.getChildren(Y);for(const ke of Ce){const Se=ke.properties;if(Se&&Se.cluster?ye+Se.point_count<=ce?ye+=Se.point_count:ye=this._appendLeaves(H,Se.cluster_id,ee,ce,ye):ye<ce?ye++:H.push(ke),H.length===ee)break}return ye}_createTree(H){const Y=new A.aH(H.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ee=0;ee<H.length;ee+=this.stride)Y.add(H[ee],H[ee+1]);return Y.finish(),Y.data=H,Y}_addTileFeatures(H,Y,ee,ce,ye,Ce){for(const ke of H){const Se=ke*this.stride,Ze=Y[Se+5]>1;let je,ze,Xe;if(Ze)je=Ei(Y,Se,this.clusterProps),ze=Y[Se],Xe=Y[Se+1];else{const Lt=this.points[Y[Se+3]];je=Lt.properties;const[vt,At]=Lt.geometry.coordinates;ze=Ke(vt),Xe=yt(At)}const _e={type:1,geometry:[[Math.round(this.options.extent*(ze*ye-ee)),Math.round(this.options.extent*(Xe*ye-ce))]],tags:je};let mt;mt=Ze||this.options.generateId?Y[Se+3]:this.points[Y[Se+3]].id,mt!==void 0&&(_e.id=mt),Ce.features.push(_e)}}_limitZoom(H){return Math.max(this.options.minZoom,Math.min(Math.floor(+H),this.options.maxZoom+1))}_cluster(H,Y){const{radius:ee,extent:ce,reduce:ye,minPoints:Ce}=this.options,ke=ee/(ce*Math.pow(2,Y)),Se=H.data,Ze=[],je=this.stride;for(let ze=0;ze<Se.length;ze+=je){if(Se[ze+2]<=Y)continue;Se[ze+2]=Y;const Xe=Se[ze],_e=Se[ze+1],mt=H.within(Se[ze],Se[ze+1],ke),Lt=Se[ze+5];let vt=Lt;for(const At of mt){const kt=At*je;Se[kt+2]>Y&&(vt+=Se[kt+5])}if(vt>Lt&&vt>=Ce){let At,kt=Xe*Lt,ei=_e*Lt,Qt=-1;const ci=(ze/je<<5)+(Y+1)+this.points.length;for(const Bt of mt){const ui=Bt*je;if(Se[ui+2]<=Y)continue;Se[ui+2]=Y;const Wn=Se[ui+5];kt+=Se[ui]*Wn,ei+=Se[ui+1]*Wn,Se[ui+4]=ci,ye&&(At||(At=this._map(Se,ze,!0),Qt=this.clusterProps.length,this.clusterProps.push(At)),ye(At,this._map(Se,ui)))}Se[ze+4]=ci,Ze.push(kt/vt,ei/vt,1/0,ci,-1,vt),ye&&Ze.push(Qt)}else{for(let At=0;At<je;At++)Ze.push(Se[ze+At]);if(vt>1)for(const At of mt){const kt=At*je;if(!(Se[kt+2]<=Y)){Se[kt+2]=Y;for(let ei=0;ei<je;ei++)Ze.push(Se[kt+ei])}}}}return Ze}_getOriginId(H){return H-this.points.length>>5}_getOriginZoom(H){return(H-this.points.length)%32}_map(H,Y,ee){if(H[Y+5]>1){const Ce=this.clusterProps[H[Y+6]];return ee?Object.assign({},Ce):Ce}const ce=this.points[H[Y+3]].properties,ye=this.options.map(ce);return ee&&ye===ce?Object.assign({},ye):ye}}function Yn(Ae,H,Y){return{type:"Feature",id:Ae[H+3],properties:Ei(Ae,H,Y),geometry:{type:"Point",coordinates:[(ee=Ae[H],360*(ee-.5)),It(Ae[H+1])]}};var ee}function Ei(Ae,H,Y){const ee=Ae[H+5],ce=ee>=1e4?`${Math.round(ee/1e3)}k`:ee>=1e3?Math.round(ee/100)/10+"k":ee,ye=Ae[H+6],Ce=ye===-1?{}:Object.assign({},Y[ye]);return Object.assign(Ce,{cluster:!0,cluster_id:Ae[H+3],point_count:ee,point_count_abbreviated:ce})}function Ke(Ae){return Ae/360+.5}function yt(Ae){const H=Math.sin(Ae*Math.PI/180),Y=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return Y<0?0:Y>1?1:Y}function It(Ae){const H=(180-360*Ae)*Math.PI/180;return 360*Math.atan(Math.exp(H))/Math.PI-90}function mi(Ae,H,Y,ee){let ce=ee;const ye=H+(Y-H>>1);let Ce,ke=Y-H;const Se=Ae[H],Ze=Ae[H+1],je=Ae[Y],ze=Ae[Y+1];for(let Xe=H+3;Xe<Y;Xe+=3){const _e=be(Ae[Xe],Ae[Xe+1],Se,Ze,je,ze);if(_e>ce)Ce=Xe,ce=_e;else if(_e===ce){const mt=Math.abs(Xe-ye);mt<ke&&(Ce=Xe,ke=mt)}}ce>ee&&(Ce-H>3&&mi(Ae,H,Ce,ee),Ae[Ce+2]=ce,Y-Ce>3&&mi(Ae,Ce,Y,ee))}function be(Ae,H,Y,ee,ce,ye){let Ce=ce-Y,ke=ye-ee;if(Ce!==0||ke!==0){const Se=((Ae-Y)*Ce+(H-ee)*ke)/(Ce*Ce+ke*ke);Se>1?(Y=ce,ee=ye):Se>0&&(Y+=Ce*Se,ee+=ke*Se)}return Ce=Ae-Y,ke=H-ee,Ce*Ce+ke*ke}function Qe(Ae,H,Y,ee){const ce={id:Ae??null,type:H,geometry:Y,tags:ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(H==="Point"||H==="MultiPoint"||H==="LineString")lt(ce,Y);else if(H==="Polygon")lt(ce,Y[0]);else if(H==="MultiLineString")for(const ye of Y)lt(ce,ye);else if(H==="MultiPolygon")for(const ye of Y)lt(ce,ye[0]);return ce}function lt(Ae,H){for(let Y=0;Y<H.length;Y+=3)Ae.minX=Math.min(Ae.minX,H[Y]),Ae.minY=Math.min(Ae.minY,H[Y+1]),Ae.maxX=Math.max(Ae.maxX,H[Y]),Ae.maxY=Math.max(Ae.maxY,H[Y+1])}function gt(Ae,H,Y,ee){if(!H.geometry)return;const ce=H.geometry.coordinates;if(ce&&ce.length===0)return;const ye=H.geometry.type,Ce=Math.pow(Y.tolerance/((1<<Y.maxZoom)*Y.extent),2);let ke=[],Se=H.id;if(Y.promoteId?Se=H.properties[Y.promoteId]:Y.generateId&&(Se=ee||0),ye==="Point")Ct(ce,ke);else if(ye==="MultiPoint")for(const Ze of ce)Ct(Ze,ke);else if(ye==="LineString")li(ce,ke,Ce,!1);else if(ye==="MultiLineString"){if(Y.lineMetrics){for(const Ze of ce)ke=[],li(Ze,ke,Ce,!1),Ae.push(Qe(Se,"LineString",ke,H.properties));return}Vt(ce,ke,Ce,!1)}else if(ye==="Polygon")Vt(ce,ke,Ce,!0);else{if(ye!=="MultiPolygon"){if(ye==="GeometryCollection"){for(const Ze of H.geometry.geometries)gt(Ae,{id:Se,geometry:Ze,properties:H.properties},Y,ee);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ze of ce){const je=[];Vt(Ze,je,Ce,!0),ke.push(je)}}Ae.push(Qe(Se,ye,ke,H.properties))}function Ct(Ae,H){H.push(Kn(Ae[0]),Fi(Ae[1]),0)}function li(Ae,H,Y,ee){let ce,ye,Ce=0;for(let Se=0;Se<Ae.length;Se++){const Ze=Kn(Ae[Se][0]),je=Fi(Ae[Se][1]);H.push(Ze,je,0),Se>0&&(Ce+=ee?(ce*je-Ze*ye)/2:Math.sqrt(Math.pow(Ze-ce,2)+Math.pow(je-ye,2))),ce=Ze,ye=je}const ke=H.length-3;H[2]=1,mi(H,0,ke,Y),H[ke+2]=1,H.size=Math.abs(Ce),H.start=0,H.end=H.size}function Vt(Ae,H,Y,ee){for(let ce=0;ce<Ae.length;ce++){const ye=[];li(Ae[ce],ye,Y,ee),H.push(ye)}}function Kn(Ae){return Ae/360+.5}function Fi(Ae){const H=Math.sin(Ae*Math.PI/180),Y=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return Y<0?0:Y>1?1:Y}function Hi(Ae,H,Y,ee,ce,ye,Ce,ke){if(ee/=H,ye>=(Y/=H)&&Ce<ee)return Ae;if(Ce<Y||ye>=ee)return null;const Se=[];for(const Ze of Ae){const je=Ze.geometry;let ze=Ze.type;const Xe=ce===0?Ze.minX:Ze.minY,_e=ce===0?Ze.maxX:Ze.maxY;if(Xe>=Y&&_e<ee){Se.push(Ze);continue}if(_e<Y||Xe>=ee)continue;let mt=[];if(ze==="Point"||ze==="MultiPoint")po(je,mt,Y,ee,ce);else if(ze==="LineString")dr(je,mt,Y,ee,ce,!1,ke.lineMetrics);else if(ze==="MultiLineString")tn(je,mt,Y,ee,ce,!1);else if(ze==="Polygon")tn(je,mt,Y,ee,ce,!0);else if(ze==="MultiPolygon")for(const Lt of je){const vt=[];tn(Lt,vt,Y,ee,ce,!0),vt.length&&mt.push(vt)}if(mt.length){if(ke.lineMetrics&&ze==="LineString"){for(const Lt of mt)Se.push(Qe(Ze.id,ze,Lt,Ze.tags));continue}ze!=="LineString"&&ze!=="MultiLineString"||(mt.length===1?(ze="LineString",mt=mt[0]):ze="MultiLineString"),ze!=="Point"&&ze!=="MultiPoint"||(ze=mt.length===3?"Point":"MultiPoint"),Se.push(Qe(Ze.id,ze,mt,Ze.tags))}}return Se.length?Se:null}function po(Ae,H,Y,ee,ce){for(let ye=0;ye<Ae.length;ye+=3){const Ce=Ae[ye+ce];Ce>=Y&&Ce<=ee&&ra(H,Ae[ye],Ae[ye+1],Ae[ye+2])}}function dr(Ae,H,Y,ee,ce,ye,Ce){let ke=mo(Ae);const Se=ce===0?aa:ol;let Ze,je,ze=Ae.start;for(let vt=0;vt<Ae.length-3;vt+=3){const At=Ae[vt],kt=Ae[vt+1],ei=Ae[vt+2],Qt=Ae[vt+3],ci=Ae[vt+4],Bt=ce===0?At:kt,ui=ce===0?Qt:ci;let Wn=!1;Ce&&(Ze=Math.sqrt(Math.pow(At-Qt,2)+Math.pow(kt-ci,2))),Bt<Y?ui>Y&&(je=Se(ke,At,kt,Qt,ci,Y),Ce&&(ke.start=ze+Ze*je)):Bt>ee?ui<ee&&(je=Se(ke,At,kt,Qt,ci,ee),Ce&&(ke.start=ze+Ze*je)):ra(ke,At,kt,ei),ui<Y&&Bt>=Y&&(je=Se(ke,At,kt,Qt,ci,Y),Wn=!0),ui>ee&&Bt<=ee&&(je=Se(ke,At,kt,Qt,ci,ee),Wn=!0),!ye&&Wn&&(Ce&&(ke.end=ze+Ze*je),H.push(ke),ke=mo(Ae)),Ce&&(ze+=Ze)}let Xe=Ae.length-3;const _e=Ae[Xe],mt=Ae[Xe+1],Lt=ce===0?_e:mt;Lt>=Y&&Lt<=ee&&ra(ke,_e,mt,Ae[Xe+2]),Xe=ke.length-3,ye&&Xe>=3&&(ke[Xe]!==ke[0]||ke[Xe+1]!==ke[1])&&ra(ke,ke[0],ke[1],ke[2]),ke.length&&H.push(ke)}function mo(Ae){const H=[];return H.size=Ae.size,H.start=Ae.start,H.end=Ae.end,H}function tn(Ae,H,Y,ee,ce,ye){for(const Ce of Ae)dr(Ce,H,Y,ee,ce,ye,!1)}function ra(Ae,H,Y,ee){Ae.push(H,Y,ee)}function aa(Ae,H,Y,ee,ce,ye){const Ce=(ye-H)/(ee-H);return ra(Ae,ye,Y+(ce-Y)*Ce,1),Ce}function ol(Ae,H,Y,ee,ce,ye){const Ce=(ye-Y)/(ce-Y);return ra(Ae,H+(ee-H)*Ce,ye,1),Ce}function Xi(Ae,H){const Y=[];for(let ee=0;ee<Ae.length;ee++){const ce=Ae[ee],ye=ce.type;let Ce;if(ye==="Point"||ye==="MultiPoint"||ye==="LineString")Ce=Ur(ce.geometry,H);else if(ye==="MultiLineString"||ye==="Polygon"){Ce=[];for(const ke of ce.geometry)Ce.push(Ur(ke,H))}else if(ye==="MultiPolygon"){Ce=[];for(const ke of ce.geometry){const Se=[];for(const Ze of ke)Se.push(Ur(Ze,H));Ce.push(Se)}}Y.push(Qe(ce.id,ye,Ce,ce.tags))}return Y}function Ur(Ae,H){const Y=[];Y.size=Ae.size,Ae.start!==void 0&&(Y.start=Ae.start,Y.end=Ae.end);for(let ee=0;ee<Ae.length;ee+=3)Y.push(Ae[ee]+H,Ae[ee+1],Ae[ee+2]);return Y}function br(Ae,H){if(Ae.transformed)return Ae;const Y=1<<Ae.z,ee=Ae.x,ce=Ae.y;for(const ye of Ae.features){const Ce=ye.geometry,ke=ye.type;if(ye.geometry=[],ke===1)for(let Se=0;Se<Ce.length;Se+=2)ye.geometry.push(ks(Ce[Se],Ce[Se+1],H,Y,ee,ce));else for(let Se=0;Se<Ce.length;Se++){const Ze=[];for(let je=0;je<Ce[Se].length;je+=2)Ze.push(ks(Ce[Se][je],Ce[Se][je+1],H,Y,ee,ce));ye.geometry.push(Ze)}}return Ae.transformed=!0,Ae}function ks(Ae,H,Y,ee,ce,ye){return[Math.round(Y*(Ae*ee-ce)),Math.round(Y*(H*ee-ye))]}function Sa(Ae,H,Y,ee,ce){const ye=H===ce.maxZoom?0:ce.tolerance/((1<<H)*ce.extent),Ce={features:[],numPoints:0,numSimplified:0,numFeatures:Ae.length,source:null,x:Y,y:ee,z:H,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ke of Ae)Wl(Ce,ke,ye,ce);return Ce}function Wl(Ae,H,Y,ee){const ce=H.geometry,ye=H.type,Ce=[];if(Ae.minX=Math.min(Ae.minX,H.minX),Ae.minY=Math.min(Ae.minY,H.minY),Ae.maxX=Math.max(Ae.maxX,H.maxX),Ae.maxY=Math.max(Ae.maxY,H.maxY),ye==="Point"||ye==="MultiPoint")for(let ke=0;ke<ce.length;ke+=3)Ce.push(ce[ke],ce[ke+1]),Ae.numPoints++,Ae.numSimplified++;else if(ye==="LineString")Ls(Ce,ce,Ae,Y,!1,!1);else if(ye==="MultiLineString"||ye==="Polygon")for(let ke=0;ke<ce.length;ke++)Ls(Ce,ce[ke],Ae,Y,ye==="Polygon",ke===0);else if(ye==="MultiPolygon")for(let ke=0;ke<ce.length;ke++){const Se=ce[ke];for(let Ze=0;Ze<Se.length;Ze++)Ls(Ce,Se[Ze],Ae,Y,!0,Ze===0)}if(Ce.length){let ke=H.tags||null;if(ye==="LineString"&&ee.lineMetrics){ke={};for(const Ze in H.tags)ke[Ze]=H.tags[Ze];ke.mapbox_clip_start=ce.start/ce.size,ke.mapbox_clip_end=ce.end/ce.size}const Se={geometry:Ce,type:ye==="Polygon"||ye==="MultiPolygon"?3:ye==="LineString"||ye==="MultiLineString"?2:1,tags:ke};H.id!==null&&(Se.id=H.id),Ae.features.push(Se)}}function Ls(Ae,H,Y,ee,ce,ye){const Ce=ee*ee;if(ee>0&&H.size<(ce?Ce:ee))return void(Y.numPoints+=H.length/3);const ke=[];for(let Se=0;Se<H.length;Se+=3)(ee===0||H[Se+2]>Ce)&&(Y.numSimplified++,ke.push(H[Se],H[Se+1])),Y.numPoints++;ce&&function(Se,Ze){let je=0;for(let ze=0,Xe=Se.length,_e=Xe-2;ze<Xe;_e=ze,ze+=2)je+=(Se[ze]-Se[_e])*(Se[ze+1]+Se[_e+1]);if(je>0===Ze)for(let ze=0,Xe=Se.length;ze<Xe/2;ze+=2){const _e=Se[ze],mt=Se[ze+1];Se[ze]=Se[Xe-2-ze],Se[ze+1]=Se[Xe-1-ze],Se[Xe-2-ze]=_e,Se[Xe-1-ze]=mt}}(ke,ye),Ae.push(ke)}const cs={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class go{constructor(H,Y){const ee=(Y=this.options=function(ye,Ce){for(const ke in Ce)ye[ke]=Ce[ke];return ye}(Object.create(cs),Y)).debug;if(ee&&console.time("preprocess data"),Y.maxZoom<0||Y.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Y.promoteId&&Y.generateId)throw new Error("promoteId and generateId cannot be used together.");let ce=function(ye,Ce){const ke=[];if(ye.type==="FeatureCollection")for(let Se=0;Se<ye.features.length;Se++)gt(ke,ye.features[Se],Ce,Se);else gt(ke,ye.type==="Feature"?ye:{geometry:ye},Ce);return ke}(H,Y);this.tiles={},this.tileCoords=[],ee&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Y.indexMaxZoom,Y.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ce=function(ye,Ce){const ke=Ce.buffer/Ce.extent;let Se=ye;const Ze=Hi(ye,1,-1-ke,ke,0,-1,2,Ce),je=Hi(ye,1,1-ke,2+ke,0,-1,2,Ce);return(Ze||je)&&(Se=Hi(ye,1,-ke,1+ke,0,-1,2,Ce)||[],Ze&&(Se=Xi(Ze,1).concat(Se)),je&&(Se=Se.concat(Xi(je,-1)))),Se}(ce,Y),ce.length&&this.splitTile(ce,0,0,0),ee&&(ce.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(H,Y,ee,ce,ye,Ce,ke){const Se=[H,Y,ee,ce],Ze=this.options,je=Ze.debug;for(;Se.length;){ce=Se.pop(),ee=Se.pop(),Y=Se.pop(),H=Se.pop();const ze=1<<Y,Xe=Vr(Y,ee,ce);let _e=this.tiles[Xe];if(!_e&&(je>1&&console.time("creation"),_e=this.tiles[Xe]=Sa(H,Y,ee,ce,Ze),this.tileCoords.push({z:Y,x:ee,y:ce}),je)){je>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Y,ee,ce,_e.numFeatures,_e.numPoints,_e.numSimplified),console.timeEnd("creation"));const Wn=`z${Y}`;this.stats[Wn]=(this.stats[Wn]||0)+1,this.total++}if(_e.source=H,ye==null){if(Y===Ze.indexMaxZoom||_e.numPoints<=Ze.indexMaxPoints)continue}else{if(Y===Ze.maxZoom||Y===ye)continue;if(ye!=null){const Wn=ye-Y;if(ee!==Ce>>Wn||ce!==ke>>Wn)continue}}if(_e.source=null,H.length===0)continue;je>1&&console.time("clipping");const mt=.5*Ze.buffer/Ze.extent,Lt=.5-mt,vt=.5+mt,At=1+mt;let kt=null,ei=null,Qt=null,ci=null,Bt=Hi(H,ze,ee-mt,ee+vt,0,_e.minX,_e.maxX,Ze),ui=Hi(H,ze,ee+Lt,ee+At,0,_e.minX,_e.maxX,Ze);H=null,Bt&&(kt=Hi(Bt,ze,ce-mt,ce+vt,1,_e.minY,_e.maxY,Ze),ei=Hi(Bt,ze,ce+Lt,ce+At,1,_e.minY,_e.maxY,Ze),Bt=null),ui&&(Qt=Hi(ui,ze,ce-mt,ce+vt,1,_e.minY,_e.maxY,Ze),ci=Hi(ui,ze,ce+Lt,ce+At,1,_e.minY,_e.maxY,Ze),ui=null),je>1&&console.timeEnd("clipping"),Se.push(kt||[],Y+1,2*ee,2*ce),Se.push(ei||[],Y+1,2*ee,2*ce+1),Se.push(Qt||[],Y+1,2*ee+1,2*ce),Se.push(ci||[],Y+1,2*ee+1,2*ce+1)}}getTile(H,Y,ee){H=+H,Y=+Y,ee=+ee;const ce=this.options,{extent:ye,debug:Ce}=ce;if(H<0||H>24)return null;const ke=1<<H,Se=Vr(H,Y=Y+ke&ke-1,ee);if(this.tiles[Se])return br(this.tiles[Se],ye);Ce>1&&console.log("drilling down to z%d-%d-%d",H,Y,ee);let Ze,je=H,ze=Y,Xe=ee;for(;!Ze&&je>0;)je--,ze>>=1,Xe>>=1,Ze=this.tiles[Vr(je,ze,Xe)];return Ze&&Ze.source?(Ce>1&&(console.log("found parent tile z%d-%d-%d",je,ze,Xe),console.time("drilling down")),this.splitTile(Ze.source,je,ze,Xe,H,Y,ee),Ce>1&&console.timeEnd("drilling down"),this.tiles[Se]?br(this.tiles[Se],ye):null):null}}function Vr(Ae,H,Y){return 32*((1<<Ae)*Y+H)+Ae}function nn(Ae,H){return H?Ae.properties[H]:Ae.id}function nr(Ae,H){if(Ae==null)return!0;if(Ae.type==="Feature")return nn(Ae,H)!=null;if(Ae.type==="FeatureCollection"){const Y=new Set;for(const ee of Ae.features){const ce=nn(ee,H);if(ce==null||Y.has(ce))return!1;Y.add(ce)}return!0}return!1}function rr(Ae,H){const Y=new Map;if(Ae!=null)if(Ae.type==="Feature")Y.set(nn(Ae,H),Ae);else for(const ee of Ae.features)Y.set(nn(ee,H),ee);return Y}class qc extends Te{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(H,Y){return A._(this,void 0,void 0,function*(){const ee=H.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ce=this._geoJSONIndex.getTile(ee.z,ee.x,ee.y);if(!ce)return null;const ye=new Tt(ce.features);let Ce=Mi(ye);return Ce.byteOffset===0&&Ce.byteLength===Ce.buffer.byteLength||(Ce=new Uint8Array(Ce)),{vectorTile:ye,rawData:Ce.buffer}})}loadData(H){return A._(this,void 0,void 0,function*(){var Y;(Y=this._pendingRequest)===null||Y===void 0||Y.abort();const ee=!!(H&&H.request&&H.request.collectResourceTiming)&&new A.cM(H.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(H,this._pendingRequest),this._geoJSONIndex=H.cluster?new bn(function({superclusterOptions:Ce,clusterProperties:ke}){if(!ke||!Ce)return Ce;const Se={},Ze={},je={accumulated:null,zoom:0},ze={properties:null},Xe=Object.keys(ke);for(const _e of Xe){const[mt,Lt]=ke[_e],vt=A.cT(Lt),At=A.cT(typeof mt=="string"?[mt,["accumulated"],["get",_e]]:mt);Se[_e]=vt.value,Ze[_e]=At.value}return Ce.map=_e=>{ze.properties=_e;const mt={};for(const Lt of Xe)mt[Lt]=Se[Lt].evaluate(je,ze);return mt},Ce.reduce=(_e,mt)=>{ze.properties=mt;for(const Lt of Xe)je.accumulated=_e[Lt],_e[Lt]=Ze[Lt].evaluate(je,ze)},Ce}(H)).load((yield this._pendingData).features):(ce=yield this._pendingData,new go(ce,H.geojsonVtOptions)),this.loaded={};const ye={};if(ee){const Ce=ee.finish();Ce&&(ye.resourceTiming={},ye.resourceTiming[H.source]=JSON.parse(JSON.stringify(Ce)))}return ye}catch(ye){if(delete this._pendingRequest,A.cx(ye))return{abandoned:!0};throw ye}var ce})}getData(){return A._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(H){const Y=this.loaded;return Y&&Y[H.uid]?super.reloadTile(H):this.loadTile(H)}loadAndProcessGeoJSON(H,Y){return A._(this,void 0,void 0,function*(){let ee=yield this.loadGeoJSON(H,Y);if(delete this._pendingRequest,typeof ee!="object")throw new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`);if(Ve(ee,!0),H.filter){const ce=A.cT(H.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ce.result==="error")throw new Error(ce.value.map(Ce=>`${Ce.key}: ${Ce.message}`).join(", "));ee={type:"FeatureCollection",features:ee.features.filter(Ce=>ce.value.evaluate({zoom:0},Ce))}}return ee})}loadGeoJSON(H,Y){return A._(this,void 0,void 0,function*(){const{promoteId:ee}=H;if(H.request){const ce=yield A.j(H.request,Y);return this._dataUpdateable=nr(ce.data,ee)?rr(ce.data,ee):void 0,ce.data}if(typeof H.data=="string")try{const ce=JSON.parse(H.data);return this._dataUpdateable=nr(ce,ee)?rr(ce,ee):void 0,ce}catch{throw new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`)}if(!H.dataDiff)throw new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${H.source}`);return function(ce,ye,Ce){var ke,Se,Ze,je;if(ye.removeAll&&ce.clear(),ye.remove)for(const ze of ye.remove)ce.delete(ze);if(ye.add)for(const ze of ye.add){const Xe=nn(ze,Ce);Xe!=null&&ce.set(Xe,ze)}if(ye.update)for(const ze of ye.update){let Xe=ce.get(ze.id);if(Xe==null)continue;const _e=!ze.removeAllProperties&&(((ke=ze.removeProperties)===null||ke===void 0?void 0:ke.length)>0||((Se=ze.addOrUpdateProperties)===null||Se===void 0?void 0:Se.length)>0);if((ze.newGeometry||ze.removeAllProperties||_e)&&(Xe=Object.assign({},Xe),ce.set(ze.id,Xe),_e&&(Xe.properties=Object.assign({},Xe.properties))),ze.newGeometry&&(Xe.geometry=ze.newGeometry),ze.removeAllProperties)Xe.properties={};else if(((Ze=ze.removeProperties)===null||Ze===void 0?void 0:Ze.length)>0)for(const mt of ze.removeProperties)Object.prototype.hasOwnProperty.call(Xe.properties,mt)&&delete Xe.properties[mt];if(((je=ze.addOrUpdateProperties)===null||je===void 0?void 0:je.length)>0)for(const{key:mt,value:Lt}of ze.addOrUpdateProperties)Xe.properties[mt]=Lt}}(this._dataUpdateable,H.dataDiff,ee),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(H){return A._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(H){return this._geoJSONIndex.getClusterExpansionZoom(H.clusterId)}getClusterChildren(H){return this._geoJSONIndex.getChildren(H.clusterId)}getClusterLeaves(H){return this._geoJSONIndex.getLeaves(H.clusterId,H.limit,H.offset)}}class us{constructor(H){this.self=H,this.actor=new A.J(H),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(Y,ee)=>{if(this.externalWorkerSourceTypes[Y])throw new Error(`Worker source with name "${Y}" already registered.`);this.externalWorkerSourceTypes[Y]=ee},this.self.addProtocol=A.cz,this.self.removeProtocol=A.cA,this.self.registerRTLTextPlugin=Y=>{A.cU.setMethods(Y)},this.actor.registerMessageHandler("LDT",(Y,ee)=>this._getDEMWorkerSource(Y,ee.source).loadTile(ee)),this.actor.registerMessageHandler("RDT",(Y,ee)=>A._(this,void 0,void 0,function*(){this._getDEMWorkerSource(Y,ee.source).removeTile(ee)})),this.actor.registerMessageHandler("GCEZ",(Y,ee)=>A._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,ee.type,ee.source).getClusterExpansionZoom(ee)})),this.actor.registerMessageHandler("GCC",(Y,ee)=>A._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,ee.type,ee.source).getClusterChildren(ee)})),this.actor.registerMessageHandler("GCL",(Y,ee)=>A._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,ee.type,ee.source).getClusterLeaves(ee)})),this.actor.registerMessageHandler("LD",(Y,ee)=>this._getWorkerSource(Y,ee.type,ee.source).loadData(ee)),this.actor.registerMessageHandler("GD",(Y,ee)=>this._getWorkerSource(Y,ee.type,ee.source).getData()),this.actor.registerMessageHandler("LT",(Y,ee)=>this._getWorkerSource(Y,ee.type,ee.source).loadTile(ee)),this.actor.registerMessageHandler("RT",(Y,ee)=>this._getWorkerSource(Y,ee.type,ee.source).reloadTile(ee)),this.actor.registerMessageHandler("AT",(Y,ee)=>this._getWorkerSource(Y,ee.type,ee.source).abortTile(ee)),this.actor.registerMessageHandler("RMT",(Y,ee)=>this._getWorkerSource(Y,ee.type,ee.source).removeTile(ee)),this.actor.registerMessageHandler("RS",(Y,ee)=>A._(this,void 0,void 0,function*(){if(!this.workerSources[Y]||!this.workerSources[Y][ee.type]||!this.workerSources[Y][ee.type][ee.source])return;const ce=this.workerSources[Y][ee.type][ee.source];delete this.workerSources[Y][ee.type][ee.source],ce.removeSource!==void 0&&ce.removeSource(ee)})),this.actor.registerMessageHandler("RM",Y=>A._(this,void 0,void 0,function*(){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.workerSources[Y],delete this.demWorkerSources[Y]})),this.actor.registerMessageHandler("SR",(Y,ee)=>A._(this,void 0,void 0,function*(){this.referrer=ee})),this.actor.registerMessageHandler("SRPS",(Y,ee)=>this._syncRTLPluginState(Y,ee)),this.actor.registerMessageHandler("IS",(Y,ee)=>A._(this,void 0,void 0,function*(){this.self.importScripts(ee)})),this.actor.registerMessageHandler("SI",(Y,ee)=>this._setImages(Y,ee)),this.actor.registerMessageHandler("UL",(Y,ee)=>A._(this,void 0,void 0,function*(){this._getLayerIndex(Y).update(ee.layers,ee.removedIds)})),this.actor.registerMessageHandler("SL",(Y,ee)=>A._(this,void 0,void 0,function*(){this._getLayerIndex(Y).replace(ee)}))}_setImages(H,Y){return A._(this,void 0,void 0,function*(){this.availableImages[H]=Y;for(const ee in this.workerSources[H]){const ce=this.workerSources[H][ee];for(const ye in ce)ce[ye].availableImages=Y}})}_syncRTLPluginState(H,Y){return A._(this,void 0,void 0,function*(){return yield A.cU.syncState(Y,this.self.importScripts)})}_getAvailableImages(H){let Y=this.availableImages[H];return Y||(Y=[]),Y}_getLayerIndex(H){let Y=this.layerIndexes[H];return Y||(Y=this.layerIndexes[H]=new c),Y}_getWorkerSource(H,Y,ee){if(this.workerSources[H]||(this.workerSources[H]={}),this.workerSources[H][Y]||(this.workerSources[H][Y]={}),!this.workerSources[H][Y][ee]){const ce={sendAsync:(ye,Ce)=>(ye.targetMapId=H,this.actor.sendAsync(ye,Ce))};switch(Y){case"vector":this.workerSources[H][Y][ee]=new Te(ce,this._getLayerIndex(H),this._getAvailableImages(H));break;case"geojson":this.workerSources[H][Y][ee]=new qc(ce,this._getLayerIndex(H),this._getAvailableImages(H));break;default:this.workerSources[H][Y][ee]=new this.externalWorkerSourceTypes[Y](ce,this._getLayerIndex(H),this._getAvailableImages(H))}}return this.workerSources[H][Y][ee]}_getDEMWorkerSource(H,Y){return this.demWorkerSources[H]||(this.demWorkerSources[H]={}),this.demWorkerSources[H][Y]||(this.demWorkerSources[H][Y]=new xe),this.demWorkerSources[H][Y]}}return A.i(self)&&(self.worker=new us(self)),us}),L("index",["exports","./shared"],function(A,c){var J="5.6.1";function X(){var f=new c.A(4);return c.A!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f}let re,Te;const xe={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(f,e,n){const l=requestAnimationFrame(m=>{h(),e(m)}),{unsubscribe:h}=c.s(f.signal,"abort",()=>{h(),cancelAnimationFrame(l),n(c.c())},!1)},frameAsync(f){return new Promise((e,n)=>{this.frame(f,e,n)})},getImageData(f,e=0){return this.getImageCanvasContext(f).getImageData(-e,-e,f.width+2*e,f.height+2*e)},getImageCanvasContext(f){const e=window.document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return e.width=f.width,e.height=f.height,n.drawImage(f,0,0,f.width,f.height),n},resolveURL:f=>(re||(re=document.createElement("a")),re.href=f,re.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Te==null&&(Te=matchMedia("(prefers-reduced-motion: reduce)")),Te.matches)}};class de{static testProp(e){if(!de.docStyle)return e[0];for(let n=0;n<e.length;n++)if(e[n]in de.docStyle)return e[n];return e[0]}static create(e,n,l){const h=window.document.createElement(e);return n!==void 0&&(h.className=n),l&&l.appendChild(h),h}static createNS(e,n){return window.document.createElementNS(e,n)}static disableDrag(){de.docStyle&&de.selectProp&&(de.userSelect=de.docStyle[de.selectProp],de.docStyle[de.selectProp]="none")}static enableDrag(){de.docStyle&&de.selectProp&&(de.docStyle[de.selectProp]=de.userSelect)}static setTransform(e,n){e.style[de.transformProp]=n}static addEventListener(e,n,l,h={}){e.addEventListener(n,l,"passive"in h?h:h.capture)}static removeEventListener(e,n,l,h={}){e.removeEventListener(n,l,"passive"in h?h:h.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",de.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",de.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",de.suppressClickInternal,!0)},0)}static getScale(e){const n=e.getBoundingClientRect();return{x:n.width/e.offsetWidth||1,y:n.height/e.offsetHeight||1,boundingClientRect:n}}static getPoint(e,n,l){const h=n.boundingClientRect;return new c.P((l.clientX-h.left)/n.x-e.clientLeft,(l.clientY-h.top)/n.y-e.clientTop)}static mousePos(e,n){const l=de.getScale(e);return de.getPoint(e,l,n)}static touchPos(e,n){const l=[],h=de.getScale(e);for(let m=0;m<n.length;m++)l.push(de.getPoint(e,h,n[m]));return l}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const n=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),l=n.querySelectorAll("script");for(const h of l)h.remove();return de.clean(n),n.innerHTML}static isPossiblyDangerous(e,n){const l=n.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!l.includes("javascript:")&&!l.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const n=e.children;for(const l of n)de.removeAttributes(l),de.clean(l)}static removeAttributes(e){for(const{name:n,value:l}of e.attributes)de.isPossiblyDangerous(n,l)&&e.removeAttribute(n)}}de.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,de.selectProp=de.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),de.transformProp=de.testProp(["transform","WebkitTransform"]);const Ee={supported:!1,testSupport:function(f){!et&&Ve&&(ft?Tt(f):We=f)}};let We,Ve,et=!1,ft=!1;function Tt(f){const e=f.createTexture();f.bindTexture(f.TEXTURE_2D,e);try{if(f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,Ve),f.isContextLost())return;Ee.supported=!0}catch{}f.deleteTexture(e),et=!0}var Ot;typeof document<"u"&&(Ve=document.createElement("img"),Ve.onload=()=>{We&&Tt(We),We=null,ft=!0},Ve.onerror=()=>{et=!0,We=null},Ve.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(f){let e,n,l,h;f.resetRequestQueue=()=>{e=[],n=0,l=0,h={}},f.addThrottleControl=M=>{const R=l++;return h[R]=M,R},f.removeThrottleControl=M=>{delete h[M],y()},f.getImage=(M,R,I=!0)=>new Promise((B,O)=>{Ee.supported&&(M.headers||(M.headers={}),M.headers.accept="image/webp,*/*"),c.e(M,{type:"image"}),e.push({abortController:R,requestParameters:M,supportImageRefresh:I,state:"queued",onError:j=>{O(j)},onSuccess:j=>{B(j)}}),y()});const m=M=>c._(this,void 0,void 0,function*(){M.state="running";const{requestParameters:R,supportImageRefresh:I,onError:B,onSuccess:O,abortController:j}=M,Z=I===!1&&!c.i(self)&&!c.g(R.url)&&(!R.headers||Object.keys(R.headers).reduce((ne,se)=>ne&&se==="accept",!0));n++;const ie=Z?S(R,j):c.m(R,j);try{const ne=yield ie;delete M.abortController,M.state="completed",ne.data instanceof HTMLImageElement||c.b(ne.data)?O(ne):ne.data&&O({data:yield(te=ne.data,typeof createImageBitmap=="function"?c.f(te):c.h(te)),cacheControl:ne.cacheControl,expires:ne.expires})}catch(ne){delete M.abortController,B(ne)}finally{n--,y()}var te}),y=()=>{const M=(()=>{for(const R of Object.keys(h))if(h[R]())return!0;return!1})()?c.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let R=n;R<M&&e.length>0;R++){const I=e.shift();I.abortController.signal.aborted?R--:m(I)}},S=(M,R)=>new Promise((I,B)=>{const O=new Image,j=M.url,Z=M.credentials;Z&&Z==="include"?O.crossOrigin="use-credentials":(Z&&Z==="same-origin"||!c.d(j))&&(O.crossOrigin="anonymous"),R.signal.addEventListener("abort",()=>{O.src="",B(c.c())}),O.fetchPriority="high",O.onload=()=>{O.onerror=O.onload=null,I({data:O})},O.onerror=()=>{O.onerror=O.onload=null,R.signal.aborted||B(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},O.src=j})}(Ot||(Ot={})),Ot.resetRequestQueue();class pt{constructor(e){this._transformRequestFn=e}transformRequest(e,n){return this._transformRequestFn&&this._transformRequestFn(e,n)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Ut(f){const e=[];if(typeof f=="string")e.push({id:"default",url:f});else if(f&&f.length>0){const n=[];for(const{id:l,url:h}of f){const m=`${l}${h}`;n.indexOf(m)===-1&&(n.push(m),e.push({id:l,url:h}))}}return e}function oi(f,e,n){try{const l=new URL(f);return l.pathname+=`${e}${n}`,l.toString()}catch{throw new Error(`Invalid sprite URL "${f}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Di(f){const{userImage:e}=f;return!!(e&&e.render&&e.render())&&(f.data.replace(new Uint8Array(e.data.buffer)),!0)}class Mi extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:n,promiseResolve:l}of this.requestors)l(this._getImagesForIds(n));this.requestors=[]}}getImage(e){const n=this.images[e];if(n&&!n.data&&n.spriteData){const l=n.spriteData;n.data=new c.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),n.spriteData=null}return n}addImage(e,n){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,n)&&(this.images[e]=n)}_validate(e,n){let l=!0;const h=n.data||n.spriteData;return this._validateStretch(n.stretchX,h&&h.width)||(this.fire(new c.k(new Error(`Image "${e}" has invalid "stretchX" value`))),l=!1),this._validateStretch(n.stretchY,h&&h.height)||(this.fire(new c.k(new Error(`Image "${e}" has invalid "stretchY" value`))),l=!1),this._validateContent(n.content,n)||(this.fire(new c.k(new Error(`Image "${e}" has invalid "content" value`))),l=!1),l}_validateStretch(e,n){if(!e)return!0;let l=0;for(const h of e){if(h[0]<l||h[1]<h[0]||n<h[1])return!1;l=h[1]}return!0}_validateContent(e,n){if(!e)return!0;if(e.length!==4)return!1;const l=n.spriteData,h=l&&l.width||n.data.width,m=l&&l.height||n.data.height;return!(e[0]<0||h<e[0]||e[1]<0||m<e[1]||e[2]<0||h<e[2]||e[3]<0||m<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,n,l=!0){const h=this.getImage(e);if(l&&(h.data.width!==n.data.width||h.data.height!==n.data.height))throw new Error(`size mismatch between old image (${h.data.width}x${h.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=h.version+1,this.images[e]=n,this.updatedImages[e]=!0}removeImage(e){const n=this.images[e];delete this.images[e],delete this.patterns[e],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((n,l)=>{let h=!0;if(!this.isLoaded())for(const m of e)this.images[m]||(h=!1);this.isLoaded()||h?n(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:n})})}_getImagesForIds(e){const n={};for(const l of e){let h=this.getImage(l);h||(this.fire(new c.l("styleimagemissing",{id:l})),h=this.getImage(l)),h?n[l]={data:h.data.clone(),pixelRatio:h.pixelRatio,sdf:h.sdf,version:h.version,stretchX:h.stretchX,stretchY:h.stretchY,content:h.content,textFitWidth:h.textFitWidth,textFitHeight:h.textFitHeight,hasRenderCallback:!!(h.userImage&&h.userImage.render)}:c.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return n}getPixelSize(){const{width:e,height:n}=this.atlasImage;return{width:e,height:n}}getPattern(e){const n=this.patterns[e],l=this.getImage(e);if(!l)return null;if(n&&n.position.version===l.version)return n.position;if(n)n.position.version=l.version;else{const h={w:l.data.width+2,h:l.data.height+2,x:0,y:0},m=new c.I(h,l);this.patterns[e]={bin:h,position:m}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new c.T(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const m in this.patterns)e.push(this.patterns[m].bin);const{w:n,h:l}=c.p(e),h=this.atlasImage;h.resize({width:n||1,height:l||1});for(const m in this.patterns){const{bin:y}=this.patterns[m],S=y.x+1,M=y.y+1,R=this.getImage(m).data,I=R.width,B=R.height;c.R.copy(R,h,{x:0,y:0},{x:S,y:M},{width:I,height:B}),c.R.copy(R,h,{x:0,y:B-1},{x:S,y:M-1},{width:I,height:1}),c.R.copy(R,h,{x:0,y:0},{x:S,y:M+B},{width:I,height:1}),c.R.copy(R,h,{x:I-1,y:0},{x:S-1,y:M},{width:1,height:B}),c.R.copy(R,h,{x:0,y:0},{x:S+I,y:M},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const n of e){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const l=this.getImage(n);l||c.w(`Image with ID: "${n}" was not found`),Di(l)&&this.updateImage(n,l)}}}const Jt=1e20;function wi(f,e,n,l,h,m,y,S,M){for(let R=e;R<e+l;R++)en(f,n*m+R,m,h,y,S,M);for(let R=n;R<n+h;R++)en(f,R*m+e,1,l,y,S,M)}function en(f,e,n,l,h,m,y){m[0]=0,y[0]=-Jt,y[1]=Jt,h[0]=f[e];for(let S=1,M=0,R=0;S<l;S++){h[S]=f[e+S*n];const I=S*S;do{const B=m[M];R=(h[S]-h[B]+I-B*B)/(S-B)/2}while(R<=y[M]&&--M>-1);M++,m[M]=S,y[M]=R,y[M+1]=Jt}for(let S=0,M=0;S<l;S++){for(;y[M+1]<S;)M++;const R=m[M],I=S-R;f[e+S*n]=h[R]+I*I}}class bn{constructor(e,n){this.requestManager=e,this.localIdeographFontFamily=n,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return c._(this,void 0,void 0,function*(){const n=[];for(const m in e)for(const y of e[m])n.push(this._getAndCacheGlyphsPromise(m,y));const l=yield Promise.all(n),h={};for(const{stack:m,id:y,glyph:S}of l)h[m]||(h[m]={}),h[m][y]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics};return h})}_getAndCacheGlyphsPromise(e,n){return c._(this,void 0,void 0,function*(){let l=this.entries[e];l||(l=this.entries[e]={glyphs:{},requests:{},ranges:{}});let h=l.glyphs[n];if(h!==void 0)return{stack:e,id:n,glyph:h};if(h=this._tinySDF(l,e,n),h)return l.glyphs[n]=h,{stack:e,id:n,glyph:h};const m=Math.floor(n/256);if(256*m>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[m])return{stack:e,id:n,glyph:h};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[m]){const S=bn.loadGlyphRange(e,m,this.url,this.requestManager);l.requests[m]=S}const y=yield l.requests[m];for(const S in y)this._doesCharSupportLocalGlyph(+S)||(l.glyphs[+S]=y[+S]);return l.ranges[m]=!0,{stack:e,id:n,glyph:y[n]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||c.u["CJK Unified Ideographs"](e)||c.u["Hangul Syllables"](e)||c.u.Hiragana(e)||c.u.Katakana(e)||c.u["CJK Symbols and Punctuation"](e)||c.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,n,l){const h=this.localIdeographFontFamily;if(!h||!this._doesCharSupportLocalGlyph(l))return;let m=e.tinySDF;if(!m){let S="400";/bold/i.test(n)?S="900":/medium/i.test(n)?S="500":/light/i.test(n)&&(S="200"),m=e.tinySDF=new bn.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:h,fontWeight:S})}const y=m.draw(String.fromCharCode(l));return{id:l,bitmap:new c.q({width:y.width||60,height:y.height||60},y.data),metrics:{width:y.glyphWidth/2||24,height:y.glyphHeight/2||24,left:y.glyphLeft/2+.5||0,top:y.glyphTop/2-27.5||-8,advance:y.glyphAdvance/2||24,isDoubleResolution:!0}}}}bn.loadGlyphRange=function(f,e,n,l){return c._(this,void 0,void 0,function*(){const h=256*e,m=h+255,y=l.transformRequest(n.replace("{fontstack}",f).replace("{range}",`${h}-${m}`),"Glyphs"),S=yield c.n(y,new AbortController);if(!S||!S.data)throw new Error(`Could not load glyph range. range: ${e}, ${h}-${m}`);const M={};for(const R of c.o(S.data))M[R.id]=R;return M})},bn.TinySDF=class{constructor({fontSize:f=24,buffer:e=3,radius:n=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:m="normal",fontStyle:y="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=n;const S=this.size=f+4*e,M=this._createCanvas(S),R=this.ctx=M.getContext("2d",{willReadFrequently:!0});R.font=`${y} ${m} ${f}px ${h}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(f){const e=document.createElement("canvas");return e.width=e.height=f,e}draw(f){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:m}=this.ctx.measureText(f),y=Math.ceil(n),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-h))),M=Math.min(this.size-this.buffer,y+Math.ceil(l)),R=S+2*this.buffer,I=M+2*this.buffer,B=Math.max(R*I,0),O=new Uint8ClampedArray(B),j={data:O,width:R,height:I,glyphWidth:S,glyphHeight:M,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(S===0||M===0)return j;const{ctx:Z,buffer:ie,gridInner:te,gridOuter:ne}=this;Z.clearRect(ie,ie,S,M),Z.fillText(f,ie,ie+y);const se=Z.getImageData(ie,ie,S,M);ne.fill(Jt,0,B),te.fill(0,0,B);for(let ue=0;ue<M;ue++)for(let oe=0;oe<S;oe++){const pe=se.data[4*(ue*S+oe)+3]/255;if(pe===0)continue;const ge=(ue+ie)*R+oe+ie;if(pe===1)ne[ge]=0,te[ge]=Jt;else{const le=.5-pe;ne[ge]=le>0?le*le:0,te[ge]=le<0?le*le:0}}wi(ne,0,0,R,I,R,this.f,this.v,this.z),wi(te,ie,ie,S,M,R,this.f,this.v,this.z);for(let ue=0;ue<B;ue++){const oe=Math.sqrt(ne[ue])-Math.sqrt(te[ue]);O[ue]=Math.round(255-255*(oe/this.radius+this.cutoff))}return j}};class Yn{constructor(){this.specification=c.v.light.position}possiblyEvaluate(e,n){return c.B(e.expression.evaluate(n))}interpolate(e,n,l){return{x:c.C.number(e.x,n.x,l),y:c.C.number(e.y,n.y,l),z:c.C.number(e.z,n.z,l)}}}let Ei;class Ke extends c.E{constructor(e){super(),Ei=Ei||new c.r({anchor:new c.D(c.v.light.anchor),position:new Yn,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.t(Ei),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,n={}){if(!this._validate(c.x,e,n))for(const l in e){const h=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),h):this._transitionable.setValue(l,h)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,l){return(!l||l.validate!==!1)&&c.y(this,e.call(c.z,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:c.v}))}}const yt=new c.r({"sky-color":new c.D(c.v.sky["sky-color"]),"horizon-color":new c.D(c.v.sky["horizon-color"]),"fog-color":new c.D(c.v.sky["fog-color"]),"fog-ground-blend":new c.D(c.v.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.v.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.v.sky["atmosphere-blend"])});class It extends c.E{constructor(e){super(),this._transitionable=new c.t(yt),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.F(0))}setSky(e,n={}){if(!this._validate(c.G,e,n)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in e){const h=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),h):this._transitionable.setValue(l,h)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,l={}){return(l==null?void 0:l.validate)!==!1&&c.y(this,e.call(c.z,c.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class mi{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,n){const l=e.join(",")+String(n);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(e,n)),this.dashEntry[l]}getDashRanges(e,n,l){const h=[];let m=e.length%2==1?-e[e.length-1]*l:0,y=e[0]*l,S=!0;h.push({left:m,right:y,isDash:S,zeroLength:e[0]===0});let M=e[0];for(let R=1;R<e.length;R++){S=!S;const I=e[R];m=M*l,M+=I,y=M*l,h.push({left:m,right:y,isDash:S,zeroLength:I===0})}return h}addRoundDash(e,n,l){const h=n/2;for(let m=-l;m<=l;m++){const y=this.width*(this.nextRow+l+m);let S=0,M=e[S];for(let R=0;R<this.width;R++){R/M.right>1&&(M=e[++S]);const I=Math.abs(R-M.left),B=Math.abs(R-M.right),O=Math.min(I,B);let j;const Z=m/l*(h+1);if(M.isDash){const ie=h-Math.abs(Z);j=Math.sqrt(O*O+ie*ie)}else j=h-Math.sqrt(O*O+Z*Z);this.data[y+R]=Math.max(0,Math.min(255,j+128))}}}addRegularDash(e){for(let S=e.length-1;S>=0;--S){const M=e[S],R=e[S+1];M.zeroLength?e.splice(S,1):R&&R.isDash===M.isDash&&(R.left=M.left,e.splice(S,1))}const n=e[0],l=e[e.length-1];n.isDash===l.isDash&&(n.left=l.left-this.width,l.right=n.right+this.width);const h=this.width*this.nextRow;let m=0,y=e[m];for(let S=0;S<this.width;S++){S/y.right>1&&(y=e[++m]);const M=Math.abs(S-y.left),R=Math.abs(S-y.right),I=Math.min(M,R);this.data[h+S]=Math.max(0,Math.min(255,(y.isDash?I:-I)+128))}}addDash(e,n){const l=n?7:0,h=2*l+1;if(this.nextRow+h>this.height)return c.w("LineAtlas out of space"),null;let m=0;for(let S=0;S<e.length;S++)m+=e[S];if(m!==0){const S=this.width/m,M=this.getDashRanges(e,this.width,S);n?this.addRoundDash(M,S,l):this.addRegularDash(M)}const y={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:m};return this.nextRow+=h,this.dirty=!0,y}bind(e){const n=e.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}const be="maplibre_preloaded_worker_pool";class Qe{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Qe.workerCount;)this.workers.push(new Worker(c.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[be]}numActive(){return Object.keys(this.active).length}}const lt=Math.floor(xe.hardwareConcurrency/2);let gt,Ct;function li(){return gt||(gt=new Qe),gt}Qe.workerCount=c.H(globalThis)?Math.max(Math.min(lt,3),1):1;class Vt{constructor(e,n){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=n;const l=this.workerPool.acquire(n);for(let h=0;h<l.length;h++){const m=new c.J(l[h],n);m.name=`Worker ${h}`,this.actors.push(m)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,n){const l=[];for(const h of this.actors)l.push(h.sendAsync({type:e,data:n}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(n=>{n.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,n){for(const l of this.actors)l.registerMessageHandler(e,n)}}function Kn(){return Ct||(Ct=new Vt(li(),c.K),Ct.registerMessageHandler("GR",(f,e,n)=>c.m(e,n))),Ct}function Fi(f,e){const n=c.L();return c.M(n,n,[1,1,0]),c.N(n,n,[.5*f.width,.5*f.height,1]),f.calculatePosMatrix?c.O(n,n,f.calculatePosMatrix(e.toUnwrapped())):n}function Hi(f,e,n,l,h,m,y){var S;const M=function(O,j,Z){if(O)for(const ie of O){const te=j[ie];if(te&&te.source===Z&&te.type==="fill-extrusion")return!0}else for(const ie in j){const te=j[ie];if(te.source===Z&&te.type==="fill-extrusion")return!0}return!1}((S=h==null?void 0:h.layers)!==null&&S!==void 0?S:null,e,f.id),R=m.maxPitchScaleFactor(),I=f.tilesIn(l,R,M);I.sort(po);const B=[];for(const O of I)B.push({wrappedTileID:O.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(e,n,f._state,O.queryGeometry,O.cameraQueryGeometry,O.scale,h,m,R,Fi(f.transform,O.tileID),y?(j,Z)=>y(O.tileID,j,Z):void 0)});return function(O,j){for(const Z in O)for(const ie of O[Z])dr(ie,j);return O}(function(O){const j={},Z={};for(const ie of O){const te=ie.queryResults,ne=ie.wrappedTileID,se=Z[ne]=Z[ne]||{};for(const ue in te){const oe=te[ue],pe=se[ue]=se[ue]||{},ge=j[ue]=j[ue]||[];for(const le of oe)pe[le.featureIndex]||(pe[le.featureIndex]=!0,ge.push(le))}}return j}(B),f)}function po(f,e){const n=f.tileID,l=e.tileID;return n.overscaledZ-l.overscaledZ||n.canonical.y-l.canonical.y||n.wrap-l.wrap||n.canonical.x-l.canonical.x}function dr(f,e){const n=f.feature,l=e.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=l}function mo(f,e,n){return c._(this,void 0,void 0,function*(){let l=f;if(f.url?l=(yield c.j(e.transformRequest(f.url,"Source"),n)).data:yield xe.frameAsync(n),!l)return null;const h=c.Q(c.e(l,f),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(h.vectorLayerIds=l.vector_layers.map(m=>m.id)),h})}class tn{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof c.S?new c.S(e.lng,e.lat):c.S.convert(e),this}setSouthWest(e){return this._sw=e instanceof c.S?new c.S(e.lng,e.lat):c.S.convert(e),this}extend(e){const n=this._sw,l=this._ne;let h,m;if(e instanceof c.S)h=e,m=e;else{if(!(e instanceof tn))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(tn.convert(e)):this.extend(c.S.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(c.S.convert(e)):this;if(h=e._sw,m=e._ne,!h||!m)return this}return n||l?(n.lng=Math.min(h.lng,n.lng),n.lat=Math.min(h.lat,n.lat),l.lng=Math.max(m.lng,l.lng),l.lat=Math.max(m.lat,l.lat)):(this._sw=new c.S(h.lng,h.lat),this._ne=new c.S(m.lng,m.lat)),this}getCenter(){return new c.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.S(this.getWest(),this.getNorth())}getSouthEast(){return new c.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:l}=c.S.convert(e);let h=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}static convert(e){return e instanceof tn?e:e&&new tn(e)}static fromLngLat(e,n=0){const l=360*n/40075017,h=l/Math.cos(Math.PI/180*e.lat);return new tn(new c.S(e.lng-h,e.lat-l),new c.S(e.lng+h,e.lat+l))}adjustAntiMeridian(){const e=new c.S(this._sw.lng,this._sw.lat),n=new c.S(this._ne.lng,this._ne.lat);return new tn(e,e.lng>n.lng?new c.S(n.lng+360,n.lat):n)}}class ra{constructor(e,n,l){this.bounds=tn.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=l||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const n=Math.pow(2,e.z),l=Math.floor(c.V(this.bounds.getWest())*n),h=Math.floor(c.U(this.bounds.getNorth())*n),m=Math.ceil(c.V(this.bounds.getEast())*n),y=Math.ceil(c.U(this.bounds.getSouth())*n);return e.x>=l&&e.x<m&&e.y>=h&&e.y<y}}class aa extends c.E{constructor(e,n,l,h){if(super(),this.id=e,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.Q(n,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h)}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield mo(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(c.e(this,e),e.bounds&&(this.tileBounds=new ra(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.k(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(n,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};l.request.collectResourceTiming=this._collectResourceTiming;let h="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((m,y)=>{e.reloadPromise={resolve:m,reject:y}})}else e.actor=this.dispatcher.getActor(),h="LT";e.abortController=new AbortController;try{const m=yield e.actor.sendAsync({type:h,data:l},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,m)}catch(m){if(delete e.abortController,e.aborted)return;if(m&&m.status!==404)throw m;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,n){if(n&&n.resourceTiming&&(e.resourceTiming=n.resourceTiming),n&&this.map._refreshExpiredTiles&&e.setExpiryData(n),e.loadVectorData(n,this.map.painter),e.reloadPromise){const l=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(l.resolve).catch(l.reject)}}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ol extends c.E{constructor(e,n,l,h){super(),this.id=e,this.dispatcher=l,this.setEventedParent(h),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},n),c.e(this,c.Q(n,["url","scheme","tileSize"]))}load(){return c._(this,arguments,void 0,function*(e=!1){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const n=yield mo(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,n&&(c.e(this,n),n.bounds&&(this.tileBounds=new ra(n.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(n){this._tileJSONRequest=null,this.fire(new c.k(n))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return c.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const l=yield Ot.getImage(this.map._requestManager.transformRequest(n,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&(l.cacheControl||l.expires)&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const h=this.map.painter.context,m=h.gl,y=l.data;e.texture=this.map.painter.getTileTexture(y.width),e.texture?e.texture.update(y,{useMipmap:!0}):(e.texture=new c.T(h,y,m.RGBA,{useMipmap:!0}),e.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE,m.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class Xi extends ol{constructor(e,n,l,h){super(e,n,l,h),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(n,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const h=yield Ot.getImage(l,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(h&&h.data){const m=h.data;this.map._refreshExpiredTiles&&(h.cacheControl||h.expires)&&e.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});const y=c.b(m)&&c.W()?m:yield this.readImageNow(m),S={type:this.type,uid:e.uid,source:this.id,rawImageData:y,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const M=yield e.actor.sendAsync({type:"LDT",data:S});e.dem=M,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(h){if(delete e.abortController,e.aborted)e.state="unloaded";else if(h)throw e.state="errored",h}})}readImageNow(e){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.X()){const n=e.width+2,l=e.height+2;try{return new c.R({width:n,height:l},yield c.Y(e,-1,-1,n,l))}catch{}}return xe.getImageData(e,1)})}_getNeighboringTiles(e){const n=e.canonical,l=Math.pow(2,n.z),h=(n.x-1+l)%l,m=n.x===0?e.wrap-1:e.wrap,y=(n.x+1+l)%l,S=n.x+1===l?e.wrap+1:e.wrap,M={};return M[new c.Z(e.overscaledZ,m,n.z,h,n.y).key]={backfilled:!1},M[new c.Z(e.overscaledZ,S,n.z,y,n.y).key]={backfilled:!1},n.y>0&&(M[new c.Z(e.overscaledZ,m,n.z,h,n.y-1).key]={backfilled:!1},M[new c.Z(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},M[new c.Z(e.overscaledZ,S,n.z,y,n.y-1).key]={backfilled:!1}),n.y+1<l&&(M[new c.Z(e.overscaledZ,m,n.z,h,n.y+1).key]={backfilled:!1},M[new c.Z(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},M[new c.Z(e.overscaledZ,S,n.z,y,n.y+1).key]={backfilled:!1}),M}unloadTile(e){return c._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class Ur extends c.E{constructor(e,n,l,h){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(h),this._data=n.data,this._options=c.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId,n.clusterMaxZoom!==void 0&&this.maxzoom<=n.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${n.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(n.buffer!==void 0?n.buffer:128),tolerance:this._pixelsToTileUnits(n.tolerance!==void 0?n.tolerance:.375),extent:c.$,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(n.clusterMaxZoom),minPoints:Math.max(2,n.clusterMinPoints||2),extent:c.$,radius:this._pixelsToTileUnits(n.clusterRadius||50),log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(c.$/this.tileSize)}_getClusterMaxZoom(e){const n=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||c.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${n}"`),n}load(){return c._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return c._(this,void 0,void 0,function*(){const e=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map(n=>n.coordinates).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return c._(this,void 0,void 0,function*(){const e=new tn,n=yield this.getData();let l;switch(n.type){case"FeatureCollection":l=n.features.map(h=>this.getCoordinatesFromGeometry(h.geometry)).flat(1/0);break;case"Feature":l=this.getCoordinatesFromGeometry(n.geometry);break;default:l=this.getCoordinatesFromGeometry(n)}if(l.length==0)return e;for(let h=0;h<l.length-1;h+=2)e.extend([l[h],l[h+1]]);return e})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,n,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:n,offset:l}})}_updateWorkerData(e){return c._(this,void 0,void 0,function*(){const n=c.e({type:this.type},this.workerOptions);e?n.dataDiff=e:typeof this._data=="string"?(n.request=this.map._requestManager.transformRequest(xe.resolveURL(this._data),"Source"),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new c.l("dataloading",{dataType:"source"}));try{const l=yield this.actor.sendAsync({type:"LD",data:n});if(this._pendingLoads--,this._removed||l.abandoned)return void this.fire(new c.l("dataabort",{dataType:"source"}));let h=null;l.resourceTiming&&l.resourceTiming[this.id]&&(h=l.resourceTiming[this.id].slice(0));const m={dataType:"source"};this._collectResourceTiming&&h&&h.length>0&&c.e(m,{resourceTiming:h}),this.fire(new c.l("data",Object.assign(Object.assign({},m),{sourceDataType:"metadata"}))),this.fire(new c.l("data",Object.assign(Object.assign({},m),{sourceDataType:"content"})))}catch(l){if(this._pendingLoads--,this._removed)return void this.fire(new c.l("dataabort",{dataType:"source"}));this.fire(new c.k(l))}})}loaded(){return this._pendingLoads===0}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.actor?"RT":"LT";e.actor=this.actor;const l={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};e.abortController=new AbortController;const h=yield this.actor.sendAsync({type:n,data:l},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(h,this.map.painter,n==="RT")})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class br extends c.E{constructor(e,n,l,h){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=l,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(h),this.options=n}load(e){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const n=yield Ot.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,n&&n.data&&(this.image=n.data,e&&(this.coordinates=e),this._finishLoading())}catch(n){this._request=null,this._loaded=!0,this.fire(new c.k(n))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const n=e.map(c.a0.fromLngLat);var l;return this.tileID=function(h){const m=c.a1.fromPoints(h),y=m.width(),S=m.height(),M=Math.max(y,S),R=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),I=Math.pow(2,R);return new c.a3(R,Math.floor((m.minX+m.maxX)/2*I),Math.floor((m.minY+m.maxY)/2*I))}(n),this.terrainTileRanges=this._getOverlappingTileRanges(n),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=n.map(h=>this.tileID.getTilePoint(h)._round()),this.flippedWindingOrder=((l=this.tileCoords)[1].x-l[0].x)*(l[2].y-l[0].y)-(l[1].y-l[0].y)*(l[2].x-l[0].x)<0,this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,n=e.gl;this.texture||(this.texture=new c.T(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const m=this.tiles[h];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,l=!0)}l&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return c._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:n,minY:l,maxX:h,maxY:m}=c.a1.fromPoints(e),y={};for(let S=0;S<=c.a2;S++){const M=Math.pow(2,S),R=Math.floor(n*M),I=Math.floor(l*M),B=Math.floor(h*M),O=Math.floor(m*M);y[S]={minTileX:R,minTileY:I,maxTileX:B,maxTileY:O}}return y}}class ks extends br{constructor(e,n,l,h){super(e,n,l,h),this.roundZoom=!0,this.type="video",this.options=n}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const n of e.urls)this.urls.push(this.map._requestManager.transformRequest(n,"Source").url);try{const n=yield c.a4(this.urls);if(this._loaded=!0,!n)return;this.video=n,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(n){this.fire(new c.k(n))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new c.k(new c.a5(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,n=e.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new c.T(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const m=this.tiles[h];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,l=!0)}l&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Sa extends br{constructor(e,n,l,h){super(e,n,l,h),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(y=>typeof y!="number"))||this.fire(new c.k(new c.a5(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.k(new c.a5(`sources.${e}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new c.k(new c.a5(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new c.k(new c.a5(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.k(new c.a5(`sources.${e}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){return c._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,l=n.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new c.T(n,this.canvas,l.RGBA,{premultiply:!0});let h=!1;for(const m in this.tiles){const y=this.tiles[m];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,h=!0)}h&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Wl={},Ls=f=>{switch(f){case"geojson":return Ur;case"image":return br;case"raster":return ol;case"raster-dem":return Xi;case"vector":return aa;case"video":return ks;case"canvas":return Sa}return Wl[f]},cs="RTLPluginLoaded";class go extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Kn()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(n=>{throw this.status="error",n})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return c._(this,arguments,void 0,function*(n,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=xe.resolveURL(n),!this.url)throw new Error(`requested url ${n} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return c._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.l(cs))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Vr=null;function nn(){return Vr||(Vr=new go),Vr}class nr{constructor(e,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=c.a6(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const n=e+this.timeAdded;n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,n,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(h,m){const y={};if(!m)return y;for(const S of h){const M=S.layerIds.map(R=>m.getLayer(R)).filter(Boolean);if(M.length!==0){S.layers=M,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(R=>M.filter(I=>I.id===R)[0]));for(const R of M)y[R.id]=S}}return y}(e.buckets,n==null?void 0:n.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const m=this.buckets[h];if(m instanceof c.a8){if(this.hasSymbolBuckets=!0,!l)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const m=this.buckets[h];if(m instanceof c.a8&&m.hasRTLText){this.hasRTLText=!0,nn().lazyLoad();break}}this.queryPadding=0;for(const h in this.buckets){const m=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(h).queryRadius(m))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new c.a7}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new c.T(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new c.T(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,l,h,m,y,S,M,R,I,B){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:m,scale:y,tileSize:this.tileSize,pixelPosMatrix:I,transform:M,params:S,queryPadding:this.queryPadding*R,getElevation:B},e,n,l):{}}querySourceFeatures(e,n){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),m=n&&n.sourceLayer?n.sourceLayer:"",y=h._geojsonTileLayer||h[m];if(!y)return;const S=c.a9(n&&n.filter),{z:M,x:R,y:I}=this.tileID.canonical,B={z:M,x:R,y:I};for(let O=0;O<y.length;O++){const j=y.feature(O);if(S.needGeometry){const te=c.aa(j,!0);if(!S.filter(new c.F(this.tileID.overscaledZ),te,this.tileID.canonical))continue}else if(!S.filter(new c.F(this.tileID.overscaledZ),j))continue;const Z=l.getId(j,m),ie=new c.ab(j,M,R,I,Z);ie.tile=B,e.push(ie)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const l=c.ac(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(n)if(this.expirationTime<n)h=!0;else{const m=this.expirationTime-n;m?this.expirationTime=l+Math.max(m,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const h in this.buckets){if(!n.style.hasLayer(h))continue;const m=this.buckets[h],y=m.layers[0].sourceLayer||"_geojsonTileLayer",S=l[y],M=e[y];if(!S||!M||Object.keys(M).length===0)continue;m.update(M,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});const R=n&&n.style&&n.style.getLayer(h);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<xe.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=xe.now()+e}setDependencies(e,n){const l={};for(const h of n)l[h]=!0;this.dependencies[e]=l}hasDependency(e,n){for(const l of e){const h=this.dependencies[l];if(h){for(const m of n)if(h[m])return!0}}return!1}}class rr{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,l){const h=e.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const m={value:n,timeout:void 0};if(l!==void 0&&(m.timeout=setTimeout(()=>{this.remove(e,m)},l)),this.data[h].push(m),this.order.push(h),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const l=e.wrapped().key,h=n===void 0?0:this.data[l].indexOf(n),m=this.data[l][h];return this.data[l].splice(h,1),m.timeout&&clearTimeout(m.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(m.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const l in this.data)for(const h of this.data[l])e(h.value)||n.push(h);for(const l of n)this.remove(l.value.tileID,l)}}class qc{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,l){const h=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][h]=this.stateChanges[e][h]||{},c.e(this.stateChanges[e][h],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const m in this.state[e])m!==h&&(this.deletedStates[e][m]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][h]===null){this.deletedStates[e][h]={};for(const m in this.state[e][h])l[m]||(this.deletedStates[e][h][m]=null)}else for(const m in l)this.deletedStates[e]&&this.deletedStates[e][h]&&this.deletedStates[e][h][m]===null&&delete this.deletedStates[e][h][m]}removeFeatureState(e,n,l){if(this.deletedStates[e]===null)return;const h=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&n!==void 0)this.deletedStates[e][h]!==null&&(this.deletedStates[e][h]=this.deletedStates[e][h]||{},this.deletedStates[e][h][l]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][h])for(l in this.deletedStates[e][h]={},this.stateChanges[e][h])this.deletedStates[e][h][l]=null;else this.deletedStates[e][h]=null;else this.deletedStates[e]=null}getState(e,n){const l=String(n),h=c.e({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const m=this.deletedStates[e][n];if(m===null)return{};for(const y in m)delete h[y]}return h}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const m={};for(const y in this.stateChanges[h])this.state[h][y]||(this.state[h][y]={}),c.e(this.state[h][y],this.stateChanges[h][y]),m[y]=this.state[h][y];l[h]=m}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const m={};if(this.deletedStates[h]===null)for(const y in this.state[h])m[y]={},this.state[h][y]={};else for(const y in this.deletedStates[h]){if(this.deletedStates[h][y]===null)this.state[h][y]={};else for(const S of Object.keys(this.deletedStates[h][y]))delete this.state[h][y][S];m[y]=this.state[h][y]}l[h]=l[h]||{},c.e(l[h],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const h in e)e[h].setFeatureState(l,n)}}const us=89.25;function Ae(f,e){const n=c.ag(e.lat,-c.ah,c.ah);return new c.P(c.V(e.lng)*f,c.U(n)*f)}function H(f,e){return new c.a0(e.x/f,e.y/f).toLngLat()}function Y(f){return f.cameraToCenterDistance*Math.min(.85*Math.tan(c.ad(90-f.pitch)),Math.tan(c.ad(us-f.pitch)))}function ee(f,e){const n=f.canonical,l=e/c.ae(n.z),h=n.x+Math.pow(2,n.z)*f.wrap,m=c.af(new Float64Array(16));return c.M(m,m,[h*l,n.y*l,0]),c.N(m,m,[l/c.$,l/c.$,1]),m}function ce(f,e,n,l,h){const m=c.a0.fromLngLat(f,e),y=h*c.ai(1,f.lat),S=y*Math.cos(c.ad(n)),M=Math.sqrt(y*y-S*S),R=M*Math.sin(c.ad(-l)),I=M*Math.cos(c.ad(-l));return new c.a0(m.x+R,m.y+I,m.z+S)}function ye(f,e,n){const l=e.intersectsFrustum(f);if(!n||l===0)return l;const h=e.intersectsPlane(n);return h===0?0:l===2&&h===2?2:1}function Ce(f,e,n){let l=0;const h=(n-e)/10;for(let m=0;m<10;m++)l+=h*Math.pow(Math.cos(e+(m+.5)/10*(n-e)),f);return l}function ke(f,e){return function(n,l,h,m,y){const S=2*((f-1)/c.aj(Math.cos(c.ad(us-y))/Math.cos(c.ad(us)))-1),M=Math.acos(h/m),R=2*Ce(S-1,0,c.ad(y/2)),I=Math.min(c.ad(us),M+c.ad(y/2)),B=Ce(S-1,Math.min(I,M-c.ad(y/2)),I),O=Math.atan(l/h),j=Math.hypot(l,h);let Z=n;return Z+=c.aj(m/j/Math.max(.5,Math.cos(c.ad(y/2)))),Z+=S*c.aj(Math.cos(O))/2,Z-=c.aj(Math.max(1,B/R/e))/2,Z}}const Se=ke(9.314,3);function Ze(f,e){const n=(e.roundZoom?Math.round:Math.floor)(f.zoom+c.aj(f.tileSize/e.tileSize));return Math.max(0,n)}function je(f,e){const n=f.getCameraFrustum(),l=f.getClippingPlane(),h=f.screenPointToMercatorCoordinate(f.getCameraPoint()),m=c.a0.fromLngLat(f.center,f.elevation);h.z=m.z+Math.cos(f.pitchInRadians)*f.cameraToCenterDistance/f.worldSize;const y=f.getCoveringTilesDetailsProvider(),S=y.allowVariableZoom(f,e),M=Ze(f,e),R=e.minzoom||0,I=e.maxzoom!==void 0?e.maxzoom:f.maxZoom,B=Math.min(Math.max(0,M),I),O=Math.pow(2,B),j=[O*h.x,O*h.y,0],Z=[O*m.x,O*m.y,0],ie=Math.hypot(m.x-h.x,m.y-h.y),te=Math.abs(m.z-h.z),ne=Math.hypot(ie,te),se=pe=>({zoom:0,x:0,y:0,wrap:pe,fullyVisible:!1}),ue=[],oe=[];if(f.renderWorldCopies&&y.allowWorldCopies())for(let pe=1;pe<=3;pe++)ue.push(se(-pe)),ue.push(se(pe));for(ue.push(se(0));ue.length>0;){const pe=ue.pop(),ge=pe.x,le=pe.y;let we=pe.fullyVisible;const Oe={x:ge,y:le,z:pe.zoom},Re=y.getTileBoundingVolume(Oe,pe.wrap,f.elevation,e);if(!we){const ut=ye(n,Re,l);if(ut===0)continue;we=ut===2}const De=y.distanceToTile2d(h.x,h.y,Oe,Re);let Be=M;S&&(Be=(e.calculateTileZoom||Se)(f.zoom+c.aj(f.tileSize/e.tileSize),De,te,ne,f.fov)),Be=(e.roundZoom?Math.round:Math.floor)(Be),Be=Math.max(0,Be);const dt=Math.min(Be,I);if(pe.wrap=y.getWrap(m,Oe,pe.wrap),pe.zoom>=dt){if(pe.zoom<R)continue;const ut=B-pe.zoom,it=j[0]-.5-(ge<<ut),wt=j[1]-.5-(le<<ut),Wt=e.reparseOverscaled?Math.max(pe.zoom,Be):pe.zoom;oe.push({tileID:new c.Z(pe.zoom===I?Wt:pe.zoom,pe.wrap,pe.zoom,ge,le),distanceSq:c.ak([Z[0]-.5-ge,Z[1]-.5-le]),tileDistanceToCamera:Math.sqrt(it*it+wt*wt)})}else for(let ut=0;ut<4;ut++)ue.push({zoom:pe.zoom+1,x:(ge<<1)+ut%2,y:(le<<1)+(ut>>1),wrap:pe.wrap,fullyVisible:we})}return oe.sort((pe,ge)=>pe.distanceSq-ge.distanceSq).map(pe=>pe.tileID)}const ze=c.a1.fromPoints([new c.P(0,0),new c.P(c.$,c.$)]);class Xe extends c.E{constructor(e,n,l){super(),this.id=e,this.dispatcher=l,this.on("data",h=>this._dataHandler(h)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((h,m,y,S)=>{const M=new(Ls(m.type))(h,m,y,S);if(M.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${M.id}`);return M})(e,n,l,this),this._tiles={},this._cache=new rr(0,h=>this._unloadTile(h)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new qc,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const n=this._tiles[e];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,n,l){return c._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,n,l)}catch(h){e.state="errored",h.status!==404?this._source.fire(new c.k(h,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new c.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const l=this._tiles[n];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(_e).map(e=>e.key)}getRenderableIds(e){const n=[];for(const l in this._tiles)this._isIdRenderable(l,e)&&n.push(this._tiles[l]);return e?n.sort((l,h)=>{const m=l.tileID,y=h.tileID,S=new c.P(m.canonical.x,m.canonical.y)._rotate(-this.transform.bearingInRadians),M=new c.P(y.canonical.x,y.canonical.y)._rotate(-this.transform.bearingInRadians);return m.overscaledZ-y.overscaledZ||M.y-S.y||M.x-S.x}).map(l=>l.tileID.key):n.map(l=>l.tileID).sort(_e).map(l=>l.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)e?this._reloadTile(n,"expired"):this._tiles[n].state!=="errored"&&this._reloadTile(n,"reloading")}}_reloadTile(e,n){return c._(this,void 0,void 0,function*(){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=n),yield this._loadTile(l,e,n))})}_tileLoaded(e,n,l){e.timeAdded=xe.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new c.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const n=this.getRenderableIds();for(let h=0;h<n.length;h++){const m=n[h];if(e.neighboringTiles&&e.neighboringTiles[m]){const y=this.getTileByID(m);l(e,y),l(y,e)}}function l(h,m){h.needsHillshadePrepare=!0,h.needsTerrainPrepare=!0;let y=m.tileID.canonical.x-h.tileID.canonical.x;const S=m.tileID.canonical.y-h.tileID.canonical.y,M=Math.pow(2,h.tileID.canonical.z),R=m.tileID.key;y===0&&S===0||Math.abs(S)>1||(Math.abs(y)>1&&(Math.abs(y+M)===1?y+=M:Math.abs(y-M)===1&&(y-=M)),m.dem&&h.dem&&(h.dem.backfillBorder(m.dem,y,S),h.neighboringTiles&&h.neighboringTiles[R]&&(h.neighboringTiles[R].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,l,h){for(const m in this._tiles){let y=this._tiles[m];if(h[m]||!y.hasData()||y.tileID.overscaledZ<=n||y.tileID.overscaledZ>l)continue;let S=y.tileID;for(;y&&y.tileID.overscaledZ>n+1;){const R=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[R.key],y&&y.hasData()&&(S=R)}let M=S;for(;M.overscaledZ>n;)if(M=M.scaledTo(M.overscaledZ-1),e[M.key]||e[M.canonical.key]){h[S.key]=S;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=n?l:null}for(let l=e.overscaledZ-1;l>=n;l--){const h=e.scaledTo(l),m=this._getLoadedTile(h);if(m)return m}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const n=Math.ceil(e.width/this._source.tileSize)+1,l=Math.ceil(e.height/this._source.tileSize)+1,h=Math.floor(n*l*(this._maxTileCacheZoomLevels===null?c.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._cache.setMaxSize(m)}handleWrapJump(e){const n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){const l={};for(const h in this._tiles){const m=this._tiles[h];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+n),l[m.tileID.key]=m}this._tiles=l;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(h,this._tiles[h])}}_updateCoveredAndRetainedTiles(e,n,l,h,m,y){const S={},M={},R=Object.keys(e),I=xe.now();for(const B of R){const O=e[B],j=this._tiles[B];if(!j||j.fadeEndTime!==0&&j.fadeEndTime<=I)continue;const Z=this.findLoadedParent(O,n),ie=this.findLoadedSibling(O),te=Z||ie||null;te&&(this._addTile(te.tileID),S[te.tileID.key]=te.tileID),M[B]=O}this._retainLoadedChildren(M,h,l,e);for(const B in S)e[B]||(this._coveredTiles[B]=!0,e[B]=S[B]);if(y){const B={},O={};for(const j of m)this._tiles[j.key].hasData()?B[j.key]=j:O[j.key]=j;for(const j in O){const Z=O[j].children(this._source.maxzoom);this._tiles[Z[0].key]&&this._tiles[Z[1].key]&&this._tiles[Z[2].key]&&this._tiles[Z[3].key]&&(B[Z[0].key]=e[Z[0].key]=Z[0],B[Z[1].key]=e[Z[1].key]=Z[1],B[Z[2].key]=e[Z[2].key]=Z[2],B[Z[3].key]=e[Z[3].key]=Z[3],delete O[j])}for(const j in O){const Z=O[j],ie=this.findLoadedParent(Z,this._source.minzoom),te=this.findLoadedSibling(Z),ne=ie||te||null;if(ne){B[ne.tileID.key]=e[ne.tileID.key]=ne.tileID;for(const se in B)B[se].isChildOf(ne.tileID)&&delete B[se]}}for(const j in this._tiles)B[j]||(this._coveredTiles[j]=!0)}}update(e,n){if(!this._sourceLoaded||this._paused)return;let l;this.transform=e,this.terrain=n,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(I=>new c.Z(I.canonical.z,I.wrap,I.canonical.z,I.canonical.x,I.canonical.y)):(l=je(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(l=l.filter(I=>this._source.hasTile(I)))):l=[];const h=Ze(e,this._source),m=Math.max(h-Xe.maxOverzooming,this._source.minzoom),y=Math.max(h+Xe.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const I={};for(const B of l)if(B.canonical.z>this._source.minzoom){const O=B.scaledTo(B.canonical.z-1);I[O.key]=O;const j=B.scaledTo(Math.max(this._source.minzoom,Math.min(B.canonical.z,5)));I[j.key]=j}l=l.concat(Object.values(I))}const S=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,S&&this.fire(new c.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const M=this._updateRetainedTiles(l,h);mt(this._source.type)&&this._updateCoveredAndRetainedTiles(M,m,y,h,l,n);for(const I in M)this._tiles[I].clearFadeHold();const R=c.al(this._tiles,M);for(const I of R){const B=this._tiles[I];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(I)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,n){var l;const h={},m={},y=Math.max(n-Xe.maxOverzooming,this._source.minzoom),S=Math.max(n+Xe.maxUnderzooming,this._source.minzoom),M={};for(const R of e){const I=this._addTile(R);h[R.key]=R,I.hasData()||n<this._source.maxzoom&&(M[R.key]=R)}this._retainLoadedChildren(M,n,S,h);for(const R of e){let I=this._tiles[R.key];if(I.hasData())continue;if(n+1>this._source.maxzoom){const O=R.children(this._source.maxzoom)[0],j=this.getTile(O);if(j&&j.hasData()){h[O.key]=O;continue}}else{const O=R.children(this._source.maxzoom);if(h[O[0].key]&&h[O[1].key]&&h[O[2].key]&&h[O[3].key])continue}let B=I.wasRequested();for(let O=R.overscaledZ-1;O>=y;--O){const j=R.scaledTo(O);if(m[j.key])break;if(m[j.key]=!0,I=this.getTile(j),!I&&B&&(I=this._addTile(j)),I){const Z=I.hasData();if((Z||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||B)&&(h[j.key]=j),B=I.wasRequested(),Z)break}}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let l,h=this._tiles[e].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){l=this._loadedParentTiles[h.key];break}n.push(h.key);const m=h.scaledTo(h.overscaledZ-1);if(l=this._getLoadedTile(m),l)break;h=m}for(const m of n)this._loadedParentTiles[m]=l}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const n=this._tiles[e].tileID,l=this._getLoadedTile(n);this._loadedSiblingTiles[n.key]=l}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const l=n;return n||(n=new nr(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,e.key,n.state)),n.uses++,this._tiles[e.key]=n,l||this._source.fire(new c.l("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=n.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}refreshTiles(e){for(const n in this._tiles)(this._isIdRenderable(n)||this._tiles[n].state=="errored")&&e.some(l=>l.equals(this._tiles[n].tileID.canonical))&&this._reloadTile(n,"expired")}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}_dataHandler(e){const n=e.sourceDataType;e.dataType==="source"&&n==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&n==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,n,l){const h=[],m=this.transform;if(!m)return h;const y=m.getCoveringTilesDetailsProvider().allowWorldCopies(),S=l?m.getCameraQueryGeometry(e):e,M=j=>m.screenPointToMercatorCoordinate(j,this.terrain),R=this.transformBbox(e,M,!y),I=this.transformBbox(S,M,!y),B=this.getIds(),O=c.a1.fromPoints(I);for(let j=0;j<B.length;j++){const Z=this._tiles[B[j]];if(Z.holdingForFade())continue;const ie=y?[Z.tileID]:[Z.tileID.unwrapTo(-1),Z.tileID.unwrapTo(0)],te=Math.pow(2,m.zoom-Z.tileID.overscaledZ),ne=n*Z.queryPadding*c.$/Z.tileSize/te;for(const se of ie){const ue=O.map(oe=>se.getTilePoint(new c.a0(oe.x,oe.y)));if(ue.expandBy(ne),ue.intersects(ze)){const oe=R.map(ge=>se.getTilePoint(ge)),pe=I.map(ge=>se.getTilePoint(ge));h.push({tile:Z,tileID:y?se:se.unwrapTo(0),queryGeometry:oe,cameraQueryGeometry:pe,scale:te})}}}return h}transformBbox(e,n,l){let h=e.map(n);if(l){const m=c.a1.fromPoints(e);m.shrinkBy(.001*Math.min(m.width(),m.height()));const y=m.map(n);c.a1.fromPoints(h).covers(y)||(h=h.map(S=>S.x>.5?new c.a0(S.x-1,S.y,S.z):S))}return h}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map(l=>this._tiles[l].tileID);return this.transform&&this.transform.populateCache(n),n}hasTransition(){if(this._source.hasTransition())return!0;if(mt(this._source.type)){const e=xe.now();for(const n in this._tiles)if(this._tiles[n].fadeEndTime>=e)return!0}return!1}setFeatureState(e,n,l){this._state.updateState(e=e||"_geojsonTileLayer",n,l)}removeFeatureState(e,n,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,l)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,l){const h=this._tiles[e];h&&h.setDependencies(n,l)}reloadTilesForDependencies(e,n){for(const l in this._tiles)this._tiles[l].hasDependency(e,n)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(e,n))}}function _e(f,e){const n=Math.abs(2*f.wrap)-+(f.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return f.overscaledZ-e.overscaledZ||l-n||e.canonical.y-f.canonical.y||e.canonical.x-f.canonical.x}function mt(f){return f==="raster"||f==="image"||f==="video"}Xe.maxOverzooming=10,Xe.maxUnderzooming=3;class Lt{constructor(e,n){this.reset(e,n)}reset(e,n){this.points=e||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=c.ag(e,0,1);let n=1,l=this._distances[n];const h=e*this.paddedLength+this.padding;for(;l<h&&n<this._distances.length;)l=this._distances[++n];const m=n-1,y=this._distances[m],S=l-y,M=S>0?(h-y)/S:0;return this.points[m].mult(1-M).add(this.points[n].mult(M))}}function vt(f,e){let n=!0;return f==="always"||f!=="never"&&e!=="never"||(n=!1),n}class At{constructor(e,n,l){const h=this.boxCells=[],m=this.circleCells=[];this.xCellCount=Math.ceil(e/l),this.yCellCount=Math.ceil(n/l);for(let y=0;y<this.xCellCount*this.yCellCount;y++)h.push([]),m.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=n,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,n,l,h,m){this._forEachCell(n,l,h,m,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(n),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(m)}insertCircle(e,n,l,h){this._forEachCell(n-h,l-h,n+h,l+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(n),this.circles.push(l),this.circles.push(h)}_insertBoxCell(e,n,l,h,m,y){this.boxCells[m].push(y)}_insertCircleCell(e,n,l,h,m,y){this.circleCells[m].push(y)}_query(e,n,l,h,m,y,S){if(l<0||e>this.width||h<0||n>this.height)return[];const M=[];if(e<=0&&n<=0&&this.width<=l&&this.height<=h){if(m)return[{key:null,x1:e,y1:n,x2:l,y2:h}];for(let R=0;R<this.boxKeys.length;R++)M.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const I=this.circles[3*R],B=this.circles[3*R+1],O=this.circles[3*R+2];M.push({key:this.circleKeys[R],x1:I-O,y1:B-O,x2:I+O,y2:B+O})}}else this._forEachCell(e,n,l,h,this._queryCell,M,{hitTest:m,overlapMode:y,seenUids:{box:{},circle:{}}},S);return M}query(e,n,l,h){return this._query(e,n,l,h,!1,null)}hitTest(e,n,l,h,m,y){return this._query(e,n,l,h,!0,m,y).length>0}hitTestCircle(e,n,l,h,m){const y=e-l,S=e+l,M=n-l,R=n+l;if(S<0||y>this.width||R<0||M>this.height)return!1;const I=[];return this._forEachCell(y,M,S,R,this._queryCellCircle,I,{hitTest:!0,overlapMode:h,circle:{x:e,y:n,radius:l},seenUids:{box:{},circle:{}}},m),I.length>0}_queryCell(e,n,l,h,m,y,S,M){const{seenUids:R,hitTest:I,overlapMode:B}=S,O=this.boxCells[m];if(O!==null){const Z=this.bboxes;for(const ie of O)if(!R.box[ie]){R.box[ie]=!0;const te=4*ie,ne=this.boxKeys[ie];if(e<=Z[te+2]&&n<=Z[te+3]&&l>=Z[te+0]&&h>=Z[te+1]&&(!M||M(ne))&&(!I||!vt(B,ne.overlapMode))&&(y.push({key:ne,x1:Z[te],y1:Z[te+1],x2:Z[te+2],y2:Z[te+3]}),I))return!0}}const j=this.circleCells[m];if(j!==null){const Z=this.circles;for(const ie of j)if(!R.circle[ie]){R.circle[ie]=!0;const te=3*ie,ne=this.circleKeys[ie];if(this._circleAndRectCollide(Z[te],Z[te+1],Z[te+2],e,n,l,h)&&(!M||M(ne))&&(!I||!vt(B,ne.overlapMode))){const se=Z[te],ue=Z[te+1],oe=Z[te+2];if(y.push({key:ne,x1:se-oe,y1:ue-oe,x2:se+oe,y2:ue+oe}),I)return!0}}}return!1}_queryCellCircle(e,n,l,h,m,y,S,M){const{circle:R,seenUids:I,overlapMode:B}=S,O=this.boxCells[m];if(O!==null){const Z=this.bboxes;for(const ie of O)if(!I.box[ie]){I.box[ie]=!0;const te=4*ie,ne=this.boxKeys[ie];if(this._circleAndRectCollide(R.x,R.y,R.radius,Z[te+0],Z[te+1],Z[te+2],Z[te+3])&&(!M||M(ne))&&!vt(B,ne.overlapMode))return y.push(!0),!0}}const j=this.circleCells[m];if(j!==null){const Z=this.circles;for(const ie of j)if(!I.circle[ie]){I.circle[ie]=!0;const te=3*ie,ne=this.circleKeys[ie];if(this._circlesCollide(Z[te],Z[te+1],Z[te+2],R.x,R.y,R.radius)&&(!M||M(ne))&&!vt(B,ne.overlapMode))return y.push(!0),!0}}}_forEachCell(e,n,l,h,m,y,S,M){const R=this._convertToXCellCoord(e),I=this._convertToYCellCoord(n),B=this._convertToXCellCoord(l),O=this._convertToYCellCoord(h);for(let j=R;j<=B;j++)for(let Z=I;Z<=O;Z++)if(m.call(this,e,n,l,h,this.xCellCount*Z+j,y,S,M))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,n,l,h,m,y){const S=h-e,M=m-n,R=l+y;return R*R>S*S+M*M}_circleAndRectCollide(e,n,l,h,m,y,S){const M=(y-h)/2,R=Math.abs(e-(h+M));if(R>M+l)return!1;const I=(S-m)/2,B=Math.abs(n-(m+I));if(B>I+l)return!1;if(R<=M||B<=I)return!0;const O=R-M,j=B-I;return O*O+j*j<=l*l}}function kt(f,e,n){const l=c.L();if(!f){const{vecSouth:B,vecEast:O}=Qt(e),j=X();j[0]=O[0],j[1]=O[1],j[2]=B[0],j[3]=B[1],h=j,(I=(y=(m=j)[0])*(R=m[3])-(M=m[2])*(S=m[1]))&&(h[0]=R*(I=1/I),h[1]=-S*I,h[2]=-M*I,h[3]=y*I),l[0]=j[0],l[1]=j[1],l[4]=j[2],l[5]=j[3]}var h,m,y,S,M,R,I;return c.N(l,l,[1/n,1/n,1]),l}function ei(f,e,n,l){if(f){const h=c.L();if(!e){const{vecSouth:m,vecEast:y}=Qt(n);h[0]=y[0],h[1]=y[1],h[4]=m[0],h[5]=m[1]}return c.N(h,h,[l,l,1]),h}return n.pixelsToClipSpaceMatrix}function Qt(f){const e=Math.cos(f.rollInRadians),n=Math.sin(f.rollInRadians),l=Math.cos(f.pitchInRadians),h=Math.cos(f.bearingInRadians),m=Math.sin(f.bearingInRadians),y=c.aq();y[0]=-h*l*n-m*e,y[1]=-m*l*n+h*e;const S=c.ar(y);S<1e-9?c.as(y):c.at(y,y,1/S);const M=c.aq();M[0]=h*l*e-m*n,M[1]=m*l*e+h*n;const R=c.ar(M);return R<1e-9?c.as(M):c.at(M,M,1/R),{vecEast:M,vecSouth:y}}function ci(f,e,n,l){let h;l?(h=[f,e,l(f,e),1],c.av(h,h,n)):(h=[f,e,0,1],Os(h,h,n));const m=h[3];return{point:new c.P(h[0]/m,h[1]/m),signedDistanceFromCamera:m,isOccluded:!1}}function Bt(f,e){return .5+f/e*.5}function ui(f,e){return f.x>=-e[0]&&f.x<=e[0]&&f.y>=-e[1]&&f.y<=e[1]}function Wn(f,e,n,l,h,m,y,S,M,R,I,B,O){const j=n?f.textSizeData:f.iconSizeData,Z=c.am(j,e.transform.zoom),ie=[256/e.width*2+1,256/e.height*2+1],te=n?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;te.clear();const ne=f.lineVertexArray,se=n?f.text.placedSymbolArray:f.icon.placedSymbolArray,ue=e.transform.width/e.transform.height;let oe=!1;for(let pe=0;pe<se.length;pe++){const ge=se.get(pe);if(ge.hidden||ge.writingMode===c.an.vertical&&!oe){hs(ge.numGlyphs,te);continue}oe=!1;const le=new c.P(ge.anchorX,ge.anchorY),we={getElevation:O,pitchedLabelPlaneMatrix:l,lineVertexArray:ne,pitchWithMap:m,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:le,unwrappedTileID:M,width:R,height:I,translation:B},Oe=Dt(ge.anchorX,ge.anchorY,we);if(!ui(Oe.point,ie)){hs(ge.numGlyphs,te);continue}const Re=Bt(e.transform.cameraToCenterDistance,Oe.signedDistanceFromCamera),De=c.ao(j,Z,ge),Be=m?De*e.transform.getPitchedTextCorrection(ge.anchorX,ge.anchorY,M)/Re:De*Re,dt=Yi({projectionContext:we,pitchedLabelPlaneMatrixInverse:h,symbol:ge,fontSize:Be,flip:!1,keepUpright:y,glyphOffsetArray:f.glyphOffsetArray,dynamicLayoutVertexArray:te,aspectRatio:ue,rotateToLine:S});oe=dt.useVertical,(dt.notEnoughRoom||oe||dt.needsFlipping&&Yi({projectionContext:we,pitchedLabelPlaneMatrixInverse:h,symbol:ge,fontSize:Be,flip:!0,keepUpright:y,glyphOffsetArray:f.glyphOffsetArray,dynamicLayoutVertexArray:te,aspectRatio:ue,rotateToLine:S}).notEnoughRoom)&&hs(ge.numGlyphs,te)}n?f.text.dynamicLayoutVertexBuffer.updateData(te):f.icon.dynamicLayoutVertexBuffer.updateData(te)}function ct(f,e,n,l,h,m,y,S){const M=m.glyphStartIndex+m.numGlyphs,R=m.lineStartIndex,I=m.lineStartIndex+m.lineLength,B=e.getoffsetX(m.glyphStartIndex),O=e.getoffsetX(M-1),j=fr(f*B,n,l,h,m.segment,R,I,S,y);if(!j)return null;const Z=fr(f*O,n,l,h,m.segment,R,I,S,y);return Z?S.projectionCache.anyProjectionOccluded?null:{first:j,last:Z}:null}function wn(f,e,n,l){return f===c.an.horizontal&&Math.abs(n.y-e.y)>Math.abs(n.x-e.x)*l?{useVertical:!0}:(f===c.an.vertical?e.y<n.y:e.x>n.x)?{needsFlipping:!0}:null}function Yi(f){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:n,symbol:l,fontSize:h,flip:m,keepUpright:y,glyphOffsetArray:S,dynamicLayoutVertexArray:M,aspectRatio:R,rotateToLine:I}=f,B=h/24,O=l.lineOffsetX*B,j=l.lineOffsetY*B;let Z;if(l.numGlyphs>1){const ie=l.glyphStartIndex+l.numGlyphs,te=l.lineStartIndex,ne=l.lineStartIndex+l.lineLength,se=ct(B,S,O,j,m,l,I,e);if(!se)return{notEnoughRoom:!0};const ue=qt(se.first.point.x,se.first.point.y,e,n),oe=qt(se.last.point.x,se.last.point.y,e,n);if(y&&!m){const pe=wn(l.writingMode,ue,oe,R);if(pe)return pe}Z=[se.first];for(let pe=l.glyphStartIndex+1;pe<ie-1;pe++){const ge=fr(B*S.getoffsetX(pe),O,j,m,l.segment,te,ne,e,I);if(!ge)return{notEnoughRoom:!0};Z.push(ge)}Z.push(se.last)}else{if(y&&!m){const te=ht(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,ne=l.lineStartIndex+l.segment+1,se=new c.P(e.lineVertexArray.getx(ne),e.lineVertexArray.gety(ne)),ue=ht(se.x,se.y,e),oe=ue.signedDistanceFromCamera>0?ue.point:Gr(e.tileAnchorPoint,se,te,1,e),pe=qt(te.x,te.y,e,n),ge=qt(oe.x,oe.y,e,n),le=wn(l.writingMode,pe,ge,R);if(le)return le}const ie=fr(B*S.getoffsetX(l.glyphStartIndex),O,j,m,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,e,I);if(!ie||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Z=[ie]}for(const ie of Z)c.au(M,ie.point,ie.angle);return{}}function Gr(f,e,n,l,h){const m=f.add(f.sub(e)._unit()),y=ht(m.x,m.y,h).point,S=n.sub(y);return n.add(S._mult(l/S.mag()))}function sa(f,e,n){const l=e.projectionCache;if(l.projections[f])return l.projections[f];const h=new c.P(e.lineVertexArray.getx(f),e.lineVertexArray.gety(f)),m=ht(h.x,h.y,e);if(m.signedDistanceFromCamera>0)return l.projections[f]=m.point,l.anyProjectionOccluded=l.anyProjectionOccluded||m.isOccluded,m.point;const y=f-n.direction;return Gr(n.distanceFromAnchor===0?e.tileAnchorPoint:new c.P(e.lineVertexArray.getx(y),e.lineVertexArray.gety(y)),h,n.previousVertex,n.absOffsetX-n.distanceFromAnchor+1,e)}function ht(f,e,n){const l=f+n.translation[0],h=e+n.translation[1];let m;return n.pitchWithMap?(m=ci(l,h,n.pitchedLabelPlaneMatrix,n.getElevation),m.isOccluded=!1):(m=n.transform.projectTileCoordinates(l,h,n.unwrappedTileID,n.getElevation),m.point.x=(.5*m.point.x+.5)*n.width,m.point.y=(.5*-m.point.y+.5)*n.height),m}function qt(f,e,n,l){if(n.pitchWithMap){const h=[f,e,0,1];return c.av(h,h,l),n.transform.projectTileCoordinates(h[0]/h[3],h[1]/h[3],n.unwrappedTileID,n.getElevation).point}return{x:f/n.width*2-1,y:1-e/n.height*2}}function Dt(f,e,n){return n.transform.projectTileCoordinates(f,e,n.unwrappedTileID,n.getElevation)}function Rr(f,e,n){return f._unit()._perp()._mult(e*n)}function Ql(f,e,n,l,h,m,y,S,M){if(S.projectionCache.offsets[f])return S.projectionCache.offsets[f];const R=n.add(e);if(f+M.direction<l||f+M.direction>=h)return S.projectionCache.offsets[f]=R,R;const I=sa(f+M.direction,S,M),B=Rr(I.sub(n),y,M.direction),O=n.add(B),j=I.add(B);return S.projectionCache.offsets[f]=c.aw(m,R,O,j)||R,S.projectionCache.offsets[f]}function fr(f,e,n,l,h,m,y,S,M){const R=l?f-e:f+e;let I=R>0?1:-1,B=0;l&&(I*=-1,B=Math.PI),I<0&&(B+=Math.PI);let O,j=I>0?m+h:m+h+1;S.projectionCache.cachedAnchorPoint?O=S.projectionCache.cachedAnchorPoint:(O=ht(S.tileAnchorPoint.x,S.tileAnchorPoint.y,S).point,S.projectionCache.cachedAnchorPoint=O);let Z,ie,te=O,ne=O,se=0,ue=0;const oe=Math.abs(R),pe=[];let ge;for(;se+ue<=oe;){if(j+=I,j<m||j>=y)return null;se+=ue,ne=te,ie=Z;const Oe={absOffsetX:oe,direction:I,distanceFromAnchor:se,previousVertex:ne};if(te=sa(j,S,Oe),n===0)pe.push(ne),ge=te.sub(ne);else{let Re;const De=te.sub(ne);Re=De.mag()===0?Rr(sa(j+I,S,Oe).sub(te),n,I):Rr(De,n,I),ie||(ie=ne.add(Re)),Z=Ql(j,Re,te,m,y,ie,n,S,Oe),pe.push(ie),ge=Z.sub(ie)}ue=ge.mag()}const le=ge._mult((oe-se)/ue)._add(ie||ne),we=B+Math.atan2(te.y-ne.y,te.x-ne.x);return pe.push(le),{point:le,angle:M?we:0,path:pe}}const Zt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function hs(f,e){for(let n=0;n<f;n++){const l=e.length;e.resize(l+4),e.float32.set(Zt,3*l)}}function Os(f,e,n){const l=e[0],h=e[1];return f[0]=n[0]*l+n[4]*h+n[12],f[1]=n[1]*l+n[5]*h+n[13],f[3]=n[3]*l+n[7]*h+n[15],f}const yn=100;class Jl{constructor(e,n=new At(e.width+200,e.height+200,25),l=new At(e.width+200,e.height+200,25)){this.transform=e,this.grid=n,this.ignoredGrid=l,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+yn,this.screenBottomBoundary=e.height+yn,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,n,l,h,m,y,S,M,R,I,B,O){const j=this.projectAndGetPerspectiveRatio(e.anchorPointX+M[0],e.anchorPointY+M[1],m,I,O),Z=l*j.perspectiveRatio;let ie;if(y||S)ie=this._projectCollisionBox(e,Z,h,m,y,S,M,j,I,B,O);else{const ge=j.x+(B?B.x*Z:0),le=j.y+(B?B.y*Z:0);ie={allPointsOccluded:!1,box:[ge+e.x1*Z,le+e.y1*Z,ge+e.x2*Z,le+e.y2*Z]}}const[te,ne,se,ue]=ie.box,oe=y?ie.allPointsOccluded:j.isOccluded;let pe=oe;return pe||(pe=j.perspectiveRatio<this.perspectiveRatioCutoff),pe||(pe=!this.isInsideGrid(te,ne,se,ue)),pe||n!=="always"&&this.grid.hitTest(te,ne,se,ue,n,R)?{box:[te,ne,se,ue],placeable:!1,offscreen:!1,occluded:oe}:{box:[te,ne,se,ue],placeable:!0,offscreen:this.isOffscreen(te,ne,se,ue),occluded:oe}}placeCollisionCircles(e,n,l,h,m,y,S,M,R,I,B,O,j,Z){const ie=[],te=new c.P(n.anchorX,n.anchorY),ne=this.getPerspectiveRatio(te.x,te.y,y,Z),se=(R?m*this.transform.getPitchedTextCorrection(n.anchorX,n.anchorY,y)/ne:m*ne)/c.aA,ue={getElevation:Z,pitchedLabelPlaneMatrix:S,lineVertexArray:l,pitchWithMap:R,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:te,unwrappedTileID:y,width:this.transform.width,height:this.transform.height,translation:j},oe=ct(se,h,n.lineOffsetX*se,n.lineOffsetY*se,!1,n,!1,ue);let pe=!1,ge=!1,le=!0;if(oe){const we=.5*B*ne+O,Oe=new c.P(-100,-100),Re=new c.P(this.screenRightBoundary,this.screenBottomBoundary),De=new Lt,Be=oe.first,dt=oe.last;let ut=[];for(let Wt=Be.path.length-1;Wt>=1;Wt--)ut.push(Be.path[Wt]);for(let Wt=1;Wt<dt.path.length;Wt++)ut.push(dt.path[Wt]);const it=2.5*we;if(R){const Wt=this.projectPathToScreenSpace(ut,ue);ut=Wt.some(gi=>gi.signedDistanceFromCamera<=0)?[]:Wt.map(gi=>gi.point)}let wt=[];if(ut.length>0){const Wt=ut[0].clone(),gi=ut[0].clone();for(let sn=1;sn<ut.length;sn++)Wt.x=Math.min(Wt.x,ut[sn].x),Wt.y=Math.min(Wt.y,ut[sn].y),gi.x=Math.max(gi.x,ut[sn].x),gi.y=Math.max(gi.y,ut[sn].y);wt=Wt.x>=Oe.x&&gi.x<=Re.x&&Wt.y>=Oe.y&&gi.y<=Re.y?[ut]:gi.x<Oe.x||Wt.x>Re.x||gi.y<Oe.y||Wt.y>Re.y?[]:c.ax([ut],Oe.x,Oe.y,Re.x,Re.y)}for(const Wt of wt){De.reset(Wt,.25*we);let gi=0;gi=De.length<=.5*we?1:Math.ceil(De.paddedLength/it)+1;for(let sn=0;sn<gi;sn++){const Ai=sn/Math.max(gi-1,1),un=De.lerp(Ai),zi=un.x+yn,Pi=un.y+yn;ie.push(zi,Pi,we,0);const Ii=zi-we,Gn=Pi-we,hi=zi+we,qn=Pi+we;if(le=le&&this.isOffscreen(Ii,Gn,hi,qn),ge=ge||this.isInsideGrid(Ii,Gn,hi,qn),e!=="always"&&this.grid.hitTestCircle(zi,Pi,we,e,I)&&(pe=!0,!M))return{circles:[],offscreen:!1,collisionDetected:pe}}}}return{circles:!M&&pe||!ge||ne<this.perspectiveRatioCutoff?[]:ie,offscreen:le,collisionDetected:pe}}projectPathToScreenSpace(e,n){const l=function(h,m){const y=c.L();return c.ap(y,m.pitchedLabelPlaneMatrix),h.map(S=>{const M=ci(S.x,S.y,y,m.getElevation),R=m.transform.projectTileCoordinates(M.point.x,M.point.y,m.unwrappedTileID,m.getElevation);return R.point.x=(.5*R.point.x+.5)*m.width,R.point.y=(.5*-R.point.y+.5)*m.height,R})}(e,n);return function(h){let m=0,y=0,S=0,M=0;for(let R=0;R<h.length;R++)h[R].isOccluded?(S=R+1,M=0):(M++,M>y&&(y=M,m=S));return h.slice(m,m+y)}(l)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[],l=new c.a1;for(const B of e){const O=new c.P(B.x+yn,B.y+yn);l.extend(O),n.push(O)}const{minX:h,minY:m,maxX:y,maxY:S}=l,M=this.grid.query(h,m,y,S).concat(this.ignoredGrid.query(h,m,y,S)),R={},I={};for(const B of M){const O=B.key;if(R[O.bucketInstanceId]===void 0&&(R[O.bucketInstanceId]={}),R[O.bucketInstanceId][O.featureIndex])continue;const j=[new c.P(B.x1,B.y1),new c.P(B.x2,B.y1),new c.P(B.x2,B.y2),new c.P(B.x1,B.y2)];c.ay(n,j)&&(R[O.bucketInstanceId][O.featureIndex]=!0,I[O.bucketInstanceId]===void 0&&(I[O.bucketInstanceId]=[]),I[O.bucketInstanceId].push(O.featureIndex))}return I}insertCollisionBox(e,n,l,h,m,y){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:m,collisionGroupID:y,overlapMode:n},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,n,l,h,m,y){const S=l?this.ignoredGrid:this.grid,M={bucketInstanceId:h,featureIndex:m,collisionGroupID:y,overlapMode:n};for(let R=0;R<e.length;R+=4)S.insertCircle(M,e[R],e[R+1],e[R+2])}projectAndGetPerspectiveRatio(e,n,l,h,m){if(m){let y;h?(y=[e,n,h(e,n),1],c.av(y,y,m)):(y=[e,n,0,1],Os(y,y,m));const S=y[3];return{x:(y[0]/S+1)/2*this.transform.width+yn,y:(-y[1]/S+1)/2*this.transform.height+yn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/S*.5,isOccluded:!1,signedDistanceFromCamera:S}}{const y=this.transform.projectTileCoordinates(e,n,l,h);return{x:(y.point.x+1)/2*this.transform.width+yn,y:(1-y.point.y)/2*this.transform.height+yn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5,isOccluded:y.isOccluded,signedDistanceFromCamera:y.signedDistanceFromCamera}}}getPerspectiveRatio(e,n,l,h){const m=this.transform.projectTileCoordinates(e,n,l,h);return .5+this.transform.cameraToCenterDistance/m.signedDistanceFromCamera*.5}isOffscreen(e,n,l,h){return l<yn||e>=this.screenRightBoundary||h<yn||n>this.screenBottomBoundary}isInsideGrid(e,n,l,h){return l>=0&&e<this.gridRightBoundary&&h>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const e=c.af([]);return c.M(e,e,[-100,-100,0]),e}_projectCollisionBox(e,n,l,h,m,y,S,M,R,I,B){let O=1,j=0,Z=0,ie=1;const te=e.anchorPointX+S[0],ne=e.anchorPointY+S[1];if(y&&!m){const ut=this.projectAndGetPerspectiveRatio(te+1,ne,h,R,B),it=ut.x-M.x,wt=Math.atan((ut.y-M.y)/it)+(it<0?Math.PI:0),Wt=Math.sin(wt),gi=Math.cos(wt);O=gi,j=Wt,Z=-Wt,ie=gi}else if(!y&&m){const ut=Qt(this.transform);O=ut.vecEast[0],j=ut.vecEast[1],Z=ut.vecSouth[0],ie=ut.vecSouth[1]}let se=M.x,ue=M.y,oe=n;m&&(se=te,ue=ne,oe=Math.pow(2,-(this.transform.zoom-l.overscaledZ)),oe*=this.transform.getPitchedTextCorrection(te,ne,h),I||(oe*=c.ag(.5+M.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),I&&(se+=O*I.x*oe+Z*I.y*oe,ue+=j*I.x*oe+ie*I.y*oe);const pe=e.x1*oe,ge=e.x2*oe,le=(pe+ge)/2,we=e.y1*oe,Oe=e.y2*oe,Re=(we+Oe)/2,De=[{offsetX:pe,offsetY:we},{offsetX:le,offsetY:we},{offsetX:ge,offsetY:we},{offsetX:ge,offsetY:Re},{offsetX:ge,offsetY:Oe},{offsetX:le,offsetY:Oe},{offsetX:pe,offsetY:Oe},{offsetX:pe,offsetY:Re}];let Be=[];for(const{offsetX:ut,offsetY:it}of De)Be.push(new c.P(se+O*ut+Z*it,ue+j*ut+ie*it));let dt=!1;if(m){const ut=Be.map(it=>this.projectAndGetPerspectiveRatio(it.x,it.y,h,R,B));dt=ut.some(it=>!it.isOccluded),Be=ut.map(it=>new c.P(it.x,it.y))}else dt=!0;return{box:c.az(Be),allPointsOccluded:!dt}}}class Bs{constructor(e,n,l,h){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?n:-n))):h&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class oa{constructor(e,n,l,h,m){this.text=new Bs(e?e.text:null,n,l,m),this.icon=new Bs(e?e.icon:null,n,h,m)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class qr{constructor(e,n,l){this.text=e,this.icon=n,this.skipFade=l}}class wr{constructor(e,n,l,h,m){this.bucketInstanceId=e,this.featureIndex=n,this.sourceLayerIndex=l,this.bucketIndex=h,this.tileID=m}}class rn{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const n=++this.maxGroupID;this.collisionGroups[e]={ID:n,predicate:l=>l.collisionGroupID===n}}return this.collisionGroups[e]}}function _o(f,e,n,l,h){const{horizontalAlign:m,verticalAlign:y}=c.aG(f);return new c.P(-(m-.5)*e+l[0]*h,-(y-.5)*n+l[1]*h)}class yo{constructor(e,n,l,h,m){this.transform=e.clone(),this.terrain=n,this.collisionIndex=new Jl(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new rn(h),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const n=this.terrain;return n?(l,h)=>n.getElevation(e,l,h):null}getBucketParts(e,n,l,h){const m=l.getBucket(n),y=l.latestFeatureIndex;if(!m||!y||n.id!==m.layerIds[0])return;const S=l.collisionBoxArray,M=m.layers[0].layout,R=m.layers[0].paint,I=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),B=l.tileSize/c.$,O=l.tileID.toUnwrapped(),j=M.get("text-rotation-alignment")==="map",Z=c.aB(l,1,this.transform.zoom),ie=c.aC(this.collisionIndex.transform,l,R.get("text-translate"),R.get("text-translate-anchor")),te=c.aC(this.collisionIndex.transform,l,R.get("icon-translate"),R.get("icon-translate-anchor")),ne=kt(j,this.transform,Z);this.retainedQueryData[m.bucketInstanceId]=new wr(m.bucketInstanceId,y,m.sourceLayerIndex,m.index,l.tileID);const se={bucket:m,layout:M,translationText:ie,translationIcon:te,unwrappedTileID:O,pitchedLabelPlaneMatrix:ne,scale:I,textPixelRatio:B,holdingForFade:l.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:c.am(m.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(m.sourceID)};if(h)for(const ue of m.sortKeyRanges){const{sortKey:oe,symbolInstanceStart:pe,symbolInstanceEnd:ge}=ue;e.push({sortKey:oe,symbolInstanceStart:pe,symbolInstanceEnd:ge,parameters:se})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:m.symbolInstances.length,parameters:se})}attemptAnchorPlacement(e,n,l,h,m,y,S,M,R,I,B,O,j,Z,ie,te,ne,se,ue,oe){const pe=c.aD[e.textAnchor],ge=[e.textOffset0,e.textOffset1],le=_o(pe,l,h,ge,m),we=this.collisionIndex.placeCollisionBox(n,O,M,R,I,S,y,te,B.predicate,ue,le,oe);if((!se||this.collisionIndex.placeCollisionBox(se,O,M,R,I,S,y,ne,B.predicate,ue,le,oe).placeable)&&we.placeable){let Oe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(Oe=this.prevPlacement.variableOffsets[j.crossTileID].anchor),j.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[j.crossTileID]={textOffset:ge,width:l,height:h,anchor:pe,textBoxScale:m,prevAnchor:Oe},this.markUsedJustification(Z,pe,j,ie),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,ie,j),this.placedOrientations[j.crossTileID]=ie),{shift:le,placedGlyphBoxes:we}}}placeLayerBucketPart(e,n,l){const{bucket:h,layout:m,translationText:y,translationIcon:S,unwrappedTileID:M,pitchedLabelPlaneMatrix:R,textPixelRatio:I,holdingForFade:B,collisionBoxArray:O,partiallyEvaluatedTextSize:j,collisionGroup:Z}=e.parameters,ie=m.get("text-optional"),te=m.get("icon-optional"),ne=c.aE(m,"text-overlap","text-allow-overlap"),se=ne==="always",ue=c.aE(m,"icon-overlap","icon-allow-overlap"),oe=ue==="always",pe=m.get("text-rotation-alignment")==="map",ge=m.get("text-pitch-alignment")==="map",le=m.get("icon-text-fit")!=="none",we=m.get("symbol-z-order")==="viewport-y",Oe=se&&(oe||!h.hasIconData()||te),Re=oe&&(se||!h.hasTextData()||ie);!h.collisionArrays&&O&&h.deserializeCollisionBoxes(O);const De=this.retainedQueryData[h.bucketInstanceId].tileID,Be=this._getTerrainElevationFunc(De),dt=this.transform.getFastPathSimpleProjectionMatrix(De),ut=(it,wt,Wt)=>{var gi,sn;if(n[it.crossTileID])return;if(B)return void(this.placements[it.crossTileID]=new qr(!1,!1,!1));let Ai=!1,un=!1,zi=!0,Pi=null,Ii={box:null,placeable:!1,offscreen:null,occluded:!1},Gn={placeable:!1},hi=null,qn=null,cr=null,io=0,Cs=0,pa=0;wt.textFeatureIndex?io=wt.textFeatureIndex:it.useRuntimeCollisionCircles&&(io=it.featureIndex),wt.verticalTextFeatureIndex&&(Cs=wt.verticalTextFeatureIndex);const ma=wt.textBox;if(ma){const ur=Ui=>{let Ri=c.an.horizontal;if(h.allowVerticalPlacement&&!Ui&&this.prevPlacement){const tr=this.prevPlacement.placedOrientations[it.crossTileID];tr&&(this.placedOrientations[it.crossTileID]=tr,Ri=tr,this.markUsedOrientation(h,Ri,it))}return Ri},ga=(Ui,Ri)=>{if(h.allowVerticalPlacement&&it.numVerticalGlyphVertices>0&&wt.verticalTextBox){for(const tr of h.writingModes)if(tr===c.an.vertical?(Ii=Ri(),Gn=Ii):Ii=Ui(),Ii&&Ii.placeable)break}else Ii=Ui()},As=it.textAnchorOffsetStartIndex,qo=it.textAnchorOffsetEndIndex;if(qo===As){const Ui=(Ri,tr)=>{const fn=this.collisionIndex.placeCollisionBox(Ri,ne,I,De,M,ge,pe,y,Z.predicate,Be,void 0,dt);return fn&&fn.placeable&&(this.markUsedOrientation(h,tr,it),this.placedOrientations[it.crossTileID]=tr),fn};ga(()=>Ui(ma,c.an.horizontal),()=>{const Ri=wt.verticalTextBox;return h.allowVerticalPlacement&&it.numVerticalGlyphVertices>0&&Ri?Ui(Ri,c.an.vertical):{box:null,offscreen:null}}),ur(Ii&&Ii.placeable)}else{let Ui=c.aD[(sn=(gi=this.prevPlacement)===null||gi===void 0?void 0:gi.variableOffsets[it.crossTileID])===null||sn===void 0?void 0:sn.anchor];const Ri=(fn,Cc,nd)=>{const mu=fn.x2-fn.x1,es=fn.y2-fn.y1,Zo=it.textBoxScale,Nn=le&&ue==="never"?Cc:null;let Wi=null,_r=ne==="never"?1:2,gu="never";Ui&&_r++;for(let Ar=0;Ar<_r;Ar++){for(let Ba=As;Ba<qo;Ba++){const Cn=h.textAnchorOffsets.get(Ba);if(Ui&&Cn.textAnchor!==Ui)continue;const ro=this.attemptAnchorPlacement(Cn,fn,mu,es,Zo,pe,ge,I,De,M,Z,gu,it,h,nd,y,S,Nn,Be);if(ro&&(Wi=ro.placedGlyphBoxes,Wi&&Wi.placeable))return Ai=!0,Pi=ro.shift,Wi}Ui?Ui=null:gu=ne}return l&&!Wi&&(Wi={box:this.collisionIndex.placeCollisionBox(ma,"always",I,De,M,ge,pe,y,Z.predicate,Be,void 0,dt).box,offscreen:!1,placeable:!1,occluded:!1}),Wi};ga(()=>Ri(ma,wt.iconBox,c.an.horizontal),()=>{const fn=wt.verticalTextBox;return h.allowVerticalPlacement&&(!Ii||!Ii.placeable)&&it.numVerticalGlyphVertices>0&&fn?Ri(fn,wt.verticalIconBox,c.an.vertical):{box:null,occluded:!0,offscreen:null}}),Ii&&(Ai=Ii.placeable,zi=Ii.offscreen);const tr=ur(Ii&&Ii.placeable);if(!Ai&&this.prevPlacement){const fn=this.prevPlacement.variableOffsets[it.crossTileID];fn&&(this.variableOffsets[it.crossTileID]=fn,this.markUsedJustification(h,fn.anchor,it,tr))}}}if(hi=Ii,Ai=hi&&hi.placeable,zi=hi&&hi.offscreen,it.useRuntimeCollisionCircles){const ur=h.text.placedSymbolArray.get(it.centerJustifiedTextSymbolIndex),ga=c.ao(h.textSizeData,j,ur),As=m.get("text-padding");qn=this.collisionIndex.placeCollisionCircles(ne,ur,h.lineVertexArray,h.glyphOffsetArray,ga,M,R,l,ge,Z.predicate,it.collisionCircleDiameter,As,y,Be),qn.circles.length&&qn.collisionDetected&&!l&&c.w("Collisions detected, but collision boxes are not shown"),Ai=se||qn.circles.length>0&&!qn.collisionDetected,zi=zi&&qn.offscreen}if(wt.iconFeatureIndex&&(pa=wt.iconFeatureIndex),wt.iconBox){const ur=ga=>this.collisionIndex.placeCollisionBox(ga,ue,I,De,M,ge,pe,S,Z.predicate,Be,le&&Pi?Pi:void 0,dt);Gn&&Gn.placeable&&wt.verticalIconBox?(cr=ur(wt.verticalIconBox),un=cr.placeable):(cr=ur(wt.iconBox),un=cr.placeable),zi=zi&&cr.offscreen}const no=ie||it.numHorizontalGlyphVertices===0&&it.numVerticalGlyphVertices===0,Il=te||it.numIconVertices===0;no||Il?Il?no||(un=un&&Ai):Ai=un&&Ai:un=Ai=un&&Ai;const Go=un&&cr.placeable;if(Ai&&hi.placeable&&this.collisionIndex.insertCollisionBox(hi.box,ne,m.get("text-ignore-placement"),h.bucketInstanceId,Gn&&Gn.placeable&&Cs?Cs:io,Z.ID),Go&&this.collisionIndex.insertCollisionBox(cr.box,ue,m.get("icon-ignore-placement"),h.bucketInstanceId,pa,Z.ID),qn&&Ai&&this.collisionIndex.insertCollisionCircles(qn.circles,ne,m.get("text-ignore-placement"),h.bucketInstanceId,io,Z.ID),l&&this.storeCollisionData(h.bucketInstanceId,Wt,wt,hi,cr,qn),it.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(h.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[it.crossTileID]=new qr((Ai||Oe)&&!(hi!=null&&hi.occluded),(un||Re)&&!(cr!=null&&cr.occluded),zi||h.justReloaded),n[it.crossTileID]=!0};if(we){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const it=h.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let wt=it.length-1;wt>=0;--wt){const Wt=it[wt];ut(h.symbolInstances.get(Wt),h.collisionArrays[Wt],Wt)}}else for(let it=e.symbolInstanceStart;it<e.symbolInstanceEnd;it++)ut(h.symbolInstances.get(it),h.collisionArrays[it],it);h.justReloaded=!1}storeCollisionData(e,n,l,h,m,y){if(l.textBox||l.iconBox){let S,M;this.collisionBoxArrays.has(e)?S=this.collisionBoxArrays.get(e):(S=new Map,this.collisionBoxArrays.set(e,S)),S.has(n)?M=S.get(n):(M={text:null,icon:null},S.set(n,M)),l.textBox&&(M.text=h.box),l.iconBox&&(M.icon=m.box)}if(y){let S=this.collisionCircleArrays[e];S===void 0&&(S=this.collisionCircleArrays[e]=[]);for(let M=0;M<y.circles.length;M+=4)S.push(y.circles[M+0]-yn),S.push(y.circles[M+1]-yn),S.push(y.circles[M+2]),S.push(y.collisionDetected?1:0)}}markUsedJustification(e,n,l,h){let m;m=h===c.an.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[c.aF(n)];const y=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const S of y)S>=0&&(e.text.placedSymbolArray.get(S).crossTileID=m>=0&&S!==m?0:l.crossTileID)}markUsedOrientation(e,n,l){const h=n===c.an.horizontal||n===c.an.horizontalOnly?n:0,m=n===c.an.vertical?n:0,y=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const S of y)e.text.placedSymbolArray.get(S).placedOrientation=h;l.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=m)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let l=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const h=n?n.symbolFadeChange(e):1,m=n?n.opacities:{},y=n?n.variableOffsets:{},S=n?n.placedOrientations:{};for(const M in this.placements){const R=this.placements[M],I=m[M];I?(this.opacities[M]=new oa(I,h,R.text,R.icon),l=l||R.text!==I.text.placed||R.icon!==I.icon.placed):(this.opacities[M]=new oa(null,h,R.text,R.icon,R.skipFade),l=l||R.text||R.icon)}for(const M in m){const R=m[M];if(!this.opacities[M]){const I=new oa(R,h,!1,!1);I.isHidden()||(this.opacities[M]=I,l=l||R.text.placed||R.icon.placed)}}for(const M in y)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=y[M]);for(const M in S)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=S[M]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:e)}updateLayerOpacities(e,n){const l={};for(const h of n){const m=h.getBucket(e);m&&h.latestFeatureIndex&&e.id===m.layerIds[0]&&this.updateBucketOpacities(m,h.tileID,l,h.collisionBoxArray)}}updateBucketOpacities(e,n,l,h){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const m=e.layers[0],y=m.layout,S=new oa(null,0,!1,!1,!0),M=y.get("text-allow-overlap"),R=y.get("icon-allow-overlap"),I=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),B=y.get("text-rotation-alignment")==="map",O=y.get("text-pitch-alignment")==="map",j=y.get("icon-text-fit")!=="none",Z=new oa(null,0,M&&(R||!e.hasIconData()||y.get("icon-optional")),R&&(M||!e.hasTextData()||y.get("text-optional")),!0);!e.collisionArrays&&h&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(h);const ie=(ne,se,ue)=>{for(let oe=0;oe<se/4;oe++)ne.opacityVertexArray.emplaceBack(ue);ne.hasVisibleVertices=ne.hasVisibleVertices||ue!==tc},te=this.collisionBoxArrays.get(e.bucketInstanceId);for(let ne=0;ne<e.symbolInstances.length;ne++){const se=e.symbolInstances.get(ne),{numHorizontalGlyphVertices:ue,numVerticalGlyphVertices:oe,crossTileID:pe}=se;let ge=this.opacities[pe];l[pe]?ge=S:ge||(ge=Z,this.opacities[pe]=ge),l[pe]=!0;const le=se.numIconVertices>0,we=this.placedOrientations[se.crossTileID],Oe=we===c.an.vertical,Re=we===c.an.horizontal||we===c.an.horizontalOnly;if(ue>0||oe>0){const Be=ec(ge.text);ie(e.text,ue,Oe?tc:Be),ie(e.text,oe,Re?tc:Be);const dt=ge.text.isHidden();[se.rightJustifiedTextSymbolIndex,se.centerJustifiedTextSymbolIndex,se.leftJustifiedTextSymbolIndex].forEach(wt=>{wt>=0&&(e.text.placedSymbolArray.get(wt).hidden=dt||Oe?1:0)}),se.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(se.verticalPlacedTextSymbolIndex).hidden=dt||Re?1:0);const ut=this.variableOffsets[se.crossTileID];ut&&this.markUsedJustification(e,ut.anchor,se,we);const it=this.placedOrientations[se.crossTileID];it&&(this.markUsedJustification(e,"left",se,it),this.markUsedOrientation(e,it,se))}if(le){const Be=ec(ge.icon),dt=!(j&&se.verticalPlacedIconSymbolIndex&&Oe);se.placedIconSymbolIndex>=0&&(ie(e.icon,se.numIconVertices,dt?Be:tc),e.icon.placedSymbolArray.get(se.placedIconSymbolIndex).hidden=ge.icon.isHidden()),se.verticalPlacedIconSymbolIndex>=0&&(ie(e.icon,se.numVerticalIconVertices,dt?tc:Be),e.icon.placedSymbolArray.get(se.verticalPlacedIconSymbolIndex).hidden=ge.icon.isHidden())}const De=te&&te.has(ne)?te.get(ne):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Be=e.collisionArrays[ne];if(Be){let dt=new c.P(0,0);if(Be.textBox||Be.verticalTextBox){let ut=!0;if(I){const it=this.variableOffsets[pe];it?(dt=_o(it.anchor,it.width,it.height,it.textOffset,it.textBoxScale),B&&dt._rotate(O?-this.transform.bearingInRadians:this.transform.bearingInRadians)):ut=!1}if(Be.textBox||Be.verticalTextBox){let it;Be.textBox&&(it=Oe),Be.verticalTextBox&&(it=Re),ll(e.textCollisionBox.collisionVertexArray,ge.text.placed,!ut||it,De.text,dt.x,dt.y)}}if(Be.iconBox||Be.verticalIconBox){const ut=!!(!Re&&Be.verticalIconBox);let it;Be.iconBox&&(it=ut),Be.verticalIconBox&&(it=!ut),ll(e.iconCollisionBox.collisionVertexArray,ge.icon.placed,it,De.icon,j?dt.x:0,j?dt.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,n){const l=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*l>e}setStale(){this.stale=!0}}function ll(f,e,n,l,h,m){l&&l.length!==0||(l=[0,0,0,0]);const y=l[0]-yn,S=l[1]-yn,M=l[2]-yn,R=l[3]-yn;f.emplaceBack(e?1:0,n?1:0,h||0,m||0,y,S),f.emplaceBack(e?1:0,n?1:0,h||0,m||0,M,S),f.emplaceBack(e?1:0,n?1:0,h||0,m||0,M,R),f.emplaceBack(e?1:0,n?1:0,h||0,m||0,y,R)}const vo=Math.pow(2,25),ds=Math.pow(2,24),Zr=Math.pow(2,17),Fu=Math.pow(2,16),$h=Math.pow(2,9),fs=Math.pow(2,8),Nu=Math.pow(2,1);function ec(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const e=f.placed?1:0,n=Math.floor(127*f.opacity);return n*vo+e*ds+n*Zr+e*Fu+n*$h+e*fs+n*Nu+e}const tc=0;class la{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,n,l,h,m){const y=this._bucketParts;for(;this._currentTileIndex<e.length;)if(n.getBucketParts(y,h,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,m())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,y.sort((S,M)=>S.sortKey-M.sortKey));this._currentPartIndex<y.length;)if(n.placeLayerBucketPart(y[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,m())return!0;return!1}}class Zc{constructor(e,n,l,h,m,y,S,M){this.placement=new yo(e,n,y,S,M),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(e,n,l){const h=xe.now(),m=()=>!this._forceFullPlacement&&xe.now()-h>2;for(;this._currentPlacementIndex>=0;){const y=n[e[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(y.type==="symbol"&&(!y.minzoom||y.minzoom<=S)&&(!y.maxzoom||y.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new la(y)),this._inProgressLayer.continuePlacement(l[y.source],this.placement,this._showCollisionBoxes,y,m))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const xo=512/c.$/2;class ic{constructor(e,n,l){this.tileID=e,this.bucketInstanceId=l,this._symbolsByKey={};const h=new Map;for(let m=0;m<n.length;m++){const y=n.get(m),S=y.key,M=h.get(S);M?M.push(y):h.set(S,[y])}for(const[m,y]of h){const S={positions:y.map(M=>({x:Math.floor(M.anchorX*xo),y:Math.floor(M.anchorY*xo)})),crossTileIDs:y.map(M=>M.crossTileID)};if(S.positions.length>128){const M=new c.aH(S.positions.length,16,Uint16Array);for(const{x:R,y:I}of S.positions)M.add(R,I);M.finish(),delete S.positions,S.index=M}this._symbolsByKey[m]=S}}getScaledCoordinates(e,n){const{x:l,y:h,z:m}=this.tileID.canonical,{x:y,y:S,z:M}=n.canonical,R=xo/Math.pow(2,M-m),I=(S*c.$+e.anchorY)*R,B=h*c.$*xo;return{x:Math.floor((y*c.$+e.anchorX)*R-l*c.$*xo),y:Math.floor(I-B)}}findMatches(e,n,l){const h=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let m=0;m<e.length;m++){const y=e.get(m);if(y.crossTileID)continue;const S=this._symbolsByKey[y.key];if(!S)continue;const M=this.getScaledCoordinates(y,n);if(S.index){const R=S.index.range(M.x-h,M.y-h,M.x+h,M.y+h).sort();for(const I of R){const B=S.crossTileIDs[I];if(!l[B]){l[B]=!0,y.crossTileID=B;break}}}else if(S.positions)for(let R=0;R<S.positions.length;R++){const I=S.positions[R],B=S.crossTileIDs[R];if(Math.abs(I.x-M.x)<=h&&Math.abs(I.y-M.y)<=h&&!l[B]){l[B]=!0,y.crossTileID=B;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Fs{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ju{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const n=Math.round((e-this.lng)/360);if(n!==0)for(const l in this.indexes){const h=this.indexes[l],m={};for(const y in h){const S=h[y];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+n),m[S.tileID.key]=S}this.indexes[l]=m}this.lng=e}addBucket(e,n,l){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let m=0;m<n.symbolInstances.length;m++)n.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const h=this.usedCrossTileIDs[e.overscaledZ];for(const m in this.indexes){const y=this.indexes[m];if(Number(m)>e.overscaledZ)for(const S in y){const M=y[S];M.tileID.isChildOf(e)&&M.findMatches(n.symbolInstances,e,h)}else{const S=y[e.scaledTo(Number(m)).key];S&&S.findMatches(n.symbolInstances,e,h)}}for(let m=0;m<n.symbolInstances.length;m++){const y=n.symbolInstances.get(m);y.crossTileID||(y.crossTileID=l.generate(),h[y.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new ic(e,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(e,n){for(const l of n.getCrossTileIDsLists())for(const h of l)delete this.usedCrossTileIDs[e][h]}removeStaleBuckets(e){let n=!1;for(const l in this.indexes){const h=this.indexes[l];for(const m in h)e[h[m].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,h[m]),delete h[m],n=!0)}return n}}class nc{constructor(){this.layerIndexes={},this.crossTileIDs=new Fs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,n,l){let h=this.layerIndexes[e.id];h===void 0&&(h=this.layerIndexes[e.id]=new ju);let m=!1;const y={};h.handleWrapJump(l);for(const S of n){const M=S.getBucket(e);M&&e.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(S.tileID,M,this.crossTileIDs)&&(m=!0),y[M.bucketInstanceId]=!0)}return h.removeStaleBuckets(y)&&(m=!0),m}pruneUnusedLayers(e){const n={};e.forEach(l=>{n[l]=!0});for(const l in this.layerIndexes)n[l]||delete this.layerIndexes[l]}}var ps="void main() {fragColor=vec4(1.0);}";const Va={prelude:ri(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:ri("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:ri("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:ri(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:ri(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ri(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ri(ps,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:ri(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:ri(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ri("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ri("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:ri(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:ri("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:ri(ps,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:ri(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:ri(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:ri(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:ri(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ri(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ri(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ri(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ri(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:ri(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ri(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ri(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ri(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ri(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:ri(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ri(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ri(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ri("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:ri("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:ri("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:ri("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:ri(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:ri("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function ri(f,e){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=e.match(/in ([\w]+) ([\w]+)/g),h=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=m?m.concat(h):h,S={};return{fragmentSource:f=f.replace(n,(M,R,I,B,O)=>(S[O]=!0,R==="define"?`
#ifndef HAS_UNIFORM_u_${O}
in ${I} ${B} ${O};
#else
uniform ${I} ${B} u_${O};
#endif
`:`
#ifdef HAS_UNIFORM_u_${O}
    ${I} ${B} ${O} = u_${O};
#endif
`)),vertexSource:e=e.replace(n,(M,R,I,B,O)=>{const j=B==="float"?"vec2":"vec4",Z=O.match(/color/)?"color":j;return S[O]?R==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
in ${I} ${j} a_${O};
out ${I} ${B} ${O};
#else
uniform ${I} ${B} u_${O};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = a_${O};
#else
    ${I} ${B} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = unpack_mix_${Z}(a_${O}, u_${O}_t);
#else
    ${I} ${B} ${O} = u_${O};
#endif
`:R==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
in ${I} ${j} a_${O};
#else
uniform ${I} ${B} u_${O};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${I} ${B} ${O} = a_${O};
#else
    ${I} ${B} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${I} ${B} ${O} = unpack_mix_${Z}(a_${O}, u_${O}_t);
#else
    ${I} ${B} ${O} = u_${O};
#endif
`}),staticAttributes:l,staticUniforms:y}}class Ga{constructor(e,n,l){this.vertexBuffer=e,this.indexBuffer=n,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Ta=c.aI([{name:"a_pos",type:"Int16",components:2}]);const bo="#define PROJECTION_MERCATOR",Uu="mercator";class cl{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Uu}get shaderDefine(){return bo}get shaderPreludeCode(){return Va.projectionMercator}get vertexShaderPreludeCode(){return Va.projectionMercator.vertexSource}get subdivisionGranularity(){return c.aJ.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,n,l,h,m){if(this._cachedMesh)return this._cachedMesh;const y=new c.aK;y.emplaceBack(0,0),y.emplaceBack(c.$,0),y.emplaceBack(0,c.$),y.emplaceBack(c.$,c.$);const S=e.createVertexBuffer(y,Ta.members),M=c.aL.simpleSegment(0,0,4,2),R=new c.aM;R.emplaceBack(1,0,2),R.emplaceBack(1,2,3);const I=e.createIndexBuffer(R);return this._cachedMesh=new Ga(S,I,M),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class Dr{constructor(e=0,n=0,l=0,h=0){if(isNaN(e)||e<0||isNaN(n)||n<0||isNaN(l)||l<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=l,this.right=h}interpolate(e,n,l){return n.top!=null&&e.top!=null&&(this.top=c.C.number(e.top,n.top,l)),n.bottom!=null&&e.bottom!=null&&(this.bottom=c.C.number(e.bottom,n.bottom,l)),n.left!=null&&e.left!=null&&(this.left=c.C.number(e.left,n.left,l)),n.right!=null&&e.right!=null&&(this.right=c.C.number(e.right,n.right,l)),this}getCenter(e,n){const l=c.ag((this.left+e-this.right)/2,0,e),h=c.ag((this.top+n-this.bottom)/2,0,n);return new c.P(l,h)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Dr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ma(f,e){if(!f.renderWorldCopies||f.lngRange)return;const n=e.lng-f.center.lng;e.lng+=n>180?-360:n<-180?360:0}function Kt(f){return Math.max(0,Math.floor(f))}class qa{constructor(e,n,l,h,m,y){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=y===void 0||!!y,this._minZoom=n||0,this._maxZoom=l||22,this._minPitch=h??0,this._maxPitch=m??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new c.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Kt(this._zoom),this._scale=c.ae(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Dr,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,n,l){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=Kt(this._zoom),this._scale=c.ae(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new Dr(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!l&&e.autoCalculateNearFarZ,n&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const n=c.aN(e,-180,180)*Math.PI/180;var l,h,m,y,S,M,R,I,B;this._bearingInRadians!==n&&(this._unmodified=!1,this._bearingInRadians=n,this._calcMatrices(),this._rotationMatrix=X(),l=this._rotationMatrix,m=-this._bearingInRadians,y=(h=this._rotationMatrix)[0],S=h[1],M=h[2],R=h[3],I=Math.sin(m),B=Math.cos(m),l[0]=y*B+M*I,l[1]=S*B+R*I,l[2]=y*-I+M*B,l[3]=S*-I+R*B)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const n=c.ag(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==n&&(this._unmodified=!1,this._pitchInRadians=n,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const n=e/180*Math.PI;this._rollInRadians!==n&&(this._unmodified=!1,this._rollInRadians=n,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return c.aO(this._fovInRadians)}setFov(e){e=c.ag(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=c.ad(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const n=this.getConstrained(this._center,e).zoom;this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this._tileZoom=Math.max(0,Math.floor(n)),this._scale=c.ae(n),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,n){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=n,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,n,l){this._unmodified=!1,this._edgeInsets.interpolate(e,n,l),this._constrain(),this._calcMatrices()}resize(e,n,l=!0){this._width=e,this._height=n,l&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new tn([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-c.ah,c.ah])}getConstrained(e,n){return this._callbacks.getConstrained(e,n)}getCameraQueryGeometry(e,n){if(n.length===1)return[n[0],e];{const{minX:l,minY:h,maxX:m,maxY:y}=c.a1.fromPoints(n).extend(e);return[new c.P(l,h),new c.P(m,h),new c.P(m,y),new c.P(l,y),new c.P(l,h)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:n,zoom:l}=this.getConstrained(this.center,this.zoom);this.setCenter(n),this.setZoom(l),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=c.af(new Float64Array(16));c.N(e,e,[this._width/2,-this._height/2,1]),c.M(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=c.af(new Float64Array(16)),c.N(e,e,[1,-1,1]),c.M(e,e,[-1,-1,0]),c.N(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,n,l,h){const m=l!==void 0?l:this.bearing,y=h=h!==void 0?h:this.pitch,S=c.a0.fromLngLat(e,n),M=-Math.cos(c.ad(y)),R=Math.sin(c.ad(y)),I=R*Math.sin(c.ad(m)),B=-R*Math.cos(c.ad(m));let O=this.elevation;const j=n-O;let Z;M*j>=0||Math.abs(M)<.1?(Z=1e4,O=n+Z*M):Z=-j/M;let ie,te,ne=c.aP(1,S.y),se=0;do{if(se+=1,se>10)break;te=Z/ne,ie=new c.a0(S.x+I*te,S.y+B*te),ne=1/ie.meterInMercatorCoordinateUnits()}while(Math.abs(Z-te*ne)>1e-12);return{center:ie.toLngLat(),elevation:O,zoom:c.aj(this.height/2/Math.tan(this.fovInRadians/2)/te/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const n=c.ai(1,this.center.lat)*this.worldSize,l=this.cameraToCenterDistance/n,h=c.a0.fromLngLat(this.center,this.elevation),m=ce(this.center,this.elevation,this.pitch,this.bearing,l);this._elevation=e;const y=this.calculateCenterFromCameraLngLatAlt(m.toLngLat(),c.aP(m.z,h.y),this.bearing,this.pitch);this._elevation=y.elevation,this._center=y.center,this.setZoom(y.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=c.ai(1,this.center.lat)*this.worldSize;return ce(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const n=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/n,e.canonical.y/n,1/n/c.$,1/n/c.$]}}class rc{constructor(e,n){this.min=e,this.max=n,this.center=c.aQ([],c.aR([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],l=c.aS(this.min),h=c.aS(this.max);for(let m=0;m<n.length;m++)l[m]=n[m]?this.min[m]:this.center[m],h[m]=n[m]?this.center[m]:this.max[m];return h[2]=this.max[2],new rc(l,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let n=!0;for(let l=0;l<e.planes.length;l++){const h=this.intersectsPlane(e.planes[l]);if(h===0)return 0;h===1&&(n=!1)}return n?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let n=e[3],l=e[3];for(let h=0;h<3;h++)e[h]>0?(n+=e[h]*this.min[h],l+=e[h]*this.max[h]):(l+=e[h]*this.min[h],n+=e[h]*this.max[h]);return n>=0?2:l<0?0:1}}class ac{distanceToTile2d(e,n,l,h){const m=h.distanceX([e,n]),y=h.distanceY([e,n]);return Math.hypot(m,y)}getWrap(e,n,l){return l}getTileBoundingVolume(e,n,l,h){var m,y;let S=l,M=l;if(h!=null&&h.terrain){const I=new c.Z(e.z,n,e.z,e.x,e.y),B=h.terrain.getMinMaxElevation(I);S=(m=B.minElevation)!==null&&m!==void 0?m:l,M=(y=B.maxElevation)!==null&&y!==void 0?y:l}const R=1<<e.z;return new rc([n+e.x/R,e.y/R,S],[n+(e.x+1)/R,(e.y+1)/R,M])}allowVariableZoom(e,n){const l=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,h=c.ag(78.5-l/2,0,60);return!!n.terrain||e.pitch>h}allowWorldCopies(){return!0}prepareNextFrame(){}}class ar{constructor(e,n,l){this.points=e,this.planes=n,this.aabb=l}static fromInvProjectionMatrix(e,n=1,l=0,h,m){const y=m?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],S=Math.pow(2,l),M=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(O=>function(j,Z,ie,te){const ne=c.av([],j,Z),se=1/ne[3]/ie*te;return c.aX(ne,ne,[se,se,1/ne[3],se])}(O,e,n,S));h&&function(O,j,Z,ie){const te=ie?4:0,ne=ie?0:4;let se=0;const ue=[],oe=[];for(let le=0;le<4;le++){const we=c.aT([],O[le+ne],O[le+te]),Oe=c.aY(we);c.aQ(we,we,1/Oe),ue.push(Oe),oe.push(we)}for(let le=0;le<4;le++){const we=c.aZ(O[le+te],oe[le],Z);se=we!==null&&we>=0?Math.max(se,we):Math.max(se,ue[le])}const pe=function(le,we){const Oe=c.aT([],le[we[0]],le[we[1]]),Re=c.aT([],le[we[2]],le[we[1]]),De=[0,0,0,0];return c.aU(De,c.aV([],Oe,Re)),De[3]=-c.aW(De,le[we[0]]),De}(O,j),ge=function(le,we){const Oe=c.a_(le),Re=c.a$([],le,1/Oe),De=c.aT([],we,c.aQ([],Re,c.aW(we,Re))),Be=c.a_(De);if(Be>0){const dt=Math.sqrt(1-Re[3]*Re[3]),ut=c.aQ([],Re,-Re[3]),it=c.aR([],ut,c.aQ([],De,dt/Be));return c.b0(we,it)}return null}(Z,pe);if(ge!==null){const le=ge/c.aW(oe[0],pe);se=Math.min(se,le)}for(let le=0;le<4;le++){const we=Math.min(se,ue[le]);O[le+ne]=[O[le+te][0]+oe[le][0]*we,O[le+te][1]+oe[le][1]*we,O[le+te][2]+oe[le][2]*we,1]}}(M,y[0],h,m);const R=y.map(O=>{const j=c.aT([],M[O[0]],M[O[1]]),Z=c.aT([],M[O[2]],M[O[1]]),ie=c.aU([],c.aV([],j,Z)),te=-c.aW(ie,M[O[1]]);return ie.concat(te)}),I=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],B=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const O of M)for(let j=0;j<3;j++)I[j]=Math.min(I[j],O[j]),B[j]=Math.max(B[j],O[j]);return new ar(M,R,new rc(I,B))}}class on{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,n,l){return this._helper.interpolatePadding(e,n,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,n,l=!0){this._helper.resize(e,n,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,n){this._helper.overrideNearFarZ(e,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,n){}constructor(e,n,l,h,m){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new qa({calcMatrices:()=>{this._calcMatrices()},getConstrained:(y,S)=>this.getConstrained(y,S)},e,n,l,h,m),this._coveringTilesDetailsProvider=new ac}clone(){const e=new on;return e.apply(this),e}apply(e,n,l){this._helper.apply(e,n,l)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const n=[new c.b1(0,e)];if(this._helper._renderWorldCopies){const l=this.screenPointToMercatorCoordinate(new c.P(0,0)),h=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,0)),m=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,this._helper._height)),y=this.screenPointToMercatorCoordinate(new c.P(0,this._helper._height)),S=Math.floor(Math.min(l.x,h.x,m.x,y.x)),M=Math.floor(Math.max(l.x,h.x,m.x,y.x)),R=1;for(let I=S-R;I<=M+R;I++)I!==0&&n.push(new c.b1(I,e))}return n}getCameraFrustum(){return ar.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const n=this.screenPointToLocation(this.centerPoint,e),l=e?e.getElevationForLngLatZoom(n,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(l)}setLocationAtPoint(e,n){const l=c.ai(this.elevation,this.center.lat),h=this.screenPointToMercatorCoordinateAtZ(n,l),m=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,l),y=c.a0.fromLngLat(e),S=new c.a0(y.x-(h.x-m.x),y.y-(h.y-m.y));this.setCenter(S==null?void 0:S.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,n){return n?this.coordinatePoint(c.a0.fromLngLat(e),n.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(c.a0.fromLngLat(e))}screenPointToLocation(e,n){var l;return(l=this.screenPointToMercatorCoordinate(e,n))===null||l===void 0?void 0:l.toLngLat()}screenPointToMercatorCoordinate(e,n){if(n){const l=n.pointCoordinate(e);if(l!=null)return l}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,n){const l=n||0,h=[e.x,e.y,0,1],m=[e.x,e.y,1,1];c.av(h,h,this._pixelMatrixInverse),c.av(m,m,this._pixelMatrixInverse);const y=h[3],S=m[3],M=h[1]/y,R=m[1]/S,I=h[2]/y,B=m[2]/S,O=I===B?0:(l-I)/(B-I);return new c.a0(c.C.number(h[0]/y,m[0]/S,O)/this.worldSize,c.C.number(M,R,O)/this.worldSize,l)}coordinatePoint(e,n=0,l=this._pixelMatrix){const h=[e.x*this.worldSize,e.y*this.worldSize,n,1];return c.av(h,h,l),new c.P(h[0]/h[3],h[1]/h[3])}getBounds(){const e=Math.max(0,this._helper._height/2-Y(this));return new tn().extend(this.screenPointToLocation(new c.P(0,e))).extend(this.screenPointToLocation(new c.P(this._helper._width,e))).extend(this.screenPointToLocation(new c.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new c.P(0,this._helper._height)))}isPointOnMapSurface(e,n){return n?n.pointCoordinate(e)!=null:e.y>this.height/2-Y(this)}calculatePosMatrix(e,n=!1,l){var h;const m=(h=e.key)!==null&&h!==void 0?h:c.b2(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),y=n?this._alignedPosMatrixCache:this._posMatrixCache;if(y.has(m)){const R=y.get(m);return l?R.f32:R.f64}const S=ee(e,this.worldSize);c.O(S,n?this._alignedProjMatrix:this._viewProjMatrix,S);const M={f64:S,f32:new Float32Array(S)};return y.set(m,M),l?M.f32:M.f64}calculateFogMatrix(e){const n=e.key,l=this._fogMatrixCacheF32;if(l.has(n))return l.get(n);const h=ee(e,this.worldSize);return c.O(h,this._fogMatrix,h),l.set(n,new Float32Array(h)),l.get(n)}getConstrained(e,n){n=c.ag(+n,this.minZoom,this.maxZoom);const l={center:new c.S(e.lng,e.lat),zoom:n};let h=this._helper._lngRange;if(!this._helper._renderWorldCopies&&h===null){const ue=179.9999999999;h=[-ue,ue]}const m=this.tileSize*c.ae(l.zoom);let y=0,S=m,M=0,R=m,I=0,B=0;const{x:O,y:j}=this.size;if(this._helper._latRange){const ue=this._helper._latRange;y=c.U(ue[1])*m,S=c.U(ue[0])*m,S-y<j&&(I=j/(S-y))}h&&(M=c.aN(c.V(h[0])*m,0,m),R=c.aN(c.V(h[1])*m,0,m),R<M&&(R+=m),R-M<O&&(B=O/(R-M)));const{x:Z,y:ie}=Ae(m,e);let te,ne;const se=Math.max(B||0,I||0);if(se){const ue=new c.P(B?(R+M)/2:Z,I?(S+y)/2:ie);return l.center=H(m,ue).wrap(),l.zoom+=c.aj(se),l}if(this._helper._latRange){const ue=j/2;ie-ue<y&&(ne=y+ue),ie+ue>S&&(ne=S-ue)}if(h){const ue=(M+R)/2;let oe=Z;this._helper._renderWorldCopies&&(oe=c.aN(Z,ue-m/2,ue+m/2));const pe=O/2;oe-pe<M&&(te=M+pe),oe+pe>R&&(te=R-pe)}if(te!==void 0||ne!==void 0){const ue=new c.P(te??Z,ne??ie);l.center=H(m,ue).wrap()}return l}calculateCenterFromCameraLngLatAlt(e,n,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(e,n,l,h)}_calculateNearFarZIfNeeded(e,n,l){if(!this._helper.autoCalculateNearFarZ)return;const h=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),m=e-h*this._helper._pixelPerMeter/Math.cos(n),y=h<0?m:e,S=Math.PI/2+this.pitchInRadians,M=c.ad(this.fov)*(Math.abs(Math.cos(c.ad(this.roll)))*this.height+Math.abs(Math.sin(c.ad(this.roll)))*this.width)/this.height*(.5+l.y/this.height),R=Math.sin(M)*y/Math.sin(c.ag(Math.PI-S-M,.01,Math.PI-.01)),I=Y(this),B=Math.atan(I/this._helper.cameraToCenterDistance),O=c.ad(.75),j=B>O?2*B*(.5+l.y/(2*I)):O,Z=Math.sin(j)*y/Math.sin(c.ag(Math.PI-S-j,.01,Math.PI-.01)),ie=Math.min(R,Z);this._helper._farZ=1.01*(Math.cos(Math.PI/2-n)*ie+y),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,n=Ae(this.worldSize,this.center),l=n.x,h=n.y;this._helper._pixelPerMeter=c.ai(1,this.center.lat)*this.worldSize;const m=c.ad(Math.min(this.pitch,us)),y=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(m));let S;this._calculateNearFarZIfNeeded(y,m,e),S=new Float64Array(16),c.b3(S,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),c.ap(this._invProjMatrix,S),S[8]=2*-e.x/this._helper._width,S[9]=2*e.y/this._helper._height,this._projectionMatrix=c.b4(S),c.N(S,S,[1,-1,1]),c.M(S,S,[0,0,-this._helper.cameraToCenterDistance]),c.b5(S,S,-this.rollInRadians),c.b6(S,S,this.pitchInRadians),c.b5(S,S,-this.bearingInRadians),c.M(S,S,[-l,-h,0]),this._mercatorMatrix=c.N([],S,[this.worldSize,this.worldSize,this.worldSize]),c.N(S,S,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=c.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,S),c.M(S,S,[0,0,-this.elevation]),this._viewProjMatrix=S,this._invViewProjMatrix=c.ap([],S);const M=[0,0,-1,1];c.av(M,M,this._invViewProjMatrix),this._cameraPosition=[M[0]/M[3],M[1]/M[3],M[2]/M[3]],this._fogMatrix=new Float64Array(16),c.b3(this._fogMatrix,this.fovInRadians,this.width/this.height,y,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,c.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),c.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),c.b5(this._fogMatrix,this._fogMatrix,-this.rollInRadians),c.b6(this._fogMatrix,this._fogMatrix,this.pitchInRadians),c.b5(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),c.M(this._fogMatrix,this._fogMatrix,[-l,-h,0]),c.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),c.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=c.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,S);const R=this._helper._width%2/2,I=this._helper._height%2/2,B=Math.cos(this.bearingInRadians),O=Math.sin(-this.bearingInRadians),j=l-Math.round(l)+B*R+O*I,Z=h-Math.round(h)+B*I+O*R,ie=new Float64Array(S);if(c.M(ie,ie,[j>.5?j-1:j,Z>.5?Z-1:Z,0]),this._alignedProjMatrix=ie,S=c.ap(new Float64Array(16),this._pixelMatrix),!S)throw new Error("failed to invert matrix");this._pixelMatrixInverse=S,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new c.P(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return c.av(n,n,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=c.ai(1,this.center.lat)*this.worldSize;return ce(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,n){const l=c.a0.fromLngLat(e),h=[l.x*this.worldSize,l.y*this.worldSize,n,1];return c.av(h,h,this._viewProjMatrix),h[2]/h[3]}getProjectionData(e){const{overscaledTileID:n,aligned:l,applyTerrainMatrix:h}=e,m=this._helper.getMercatorTileCoordinates(n),y=n?this.calculatePosMatrix(n,l,!0):null;let S;return S=n&&n.terrainRttPosMatrix32f&&h?n.terrainRttPosMatrix32f:y||c.b7(),{mainMatrix:S,tileMercatorCoords:m,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:S}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,n,l){return 1}transformLightDirection(e){return c.aS(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,n,l,h){const m=this.calculatePosMatrix(l);let y;h?(y=[e,n,h(e,n),1],c.av(y,y,m)):(y=[e,n,0,1],Os(y,y,m));const S=y[3];return{point:new c.P(y[0]/S,y[1]/S),signedDistanceFromCamera:S,isOccluded:!1}}populateCache(e){for(const n of e)this.calculatePosMatrix(n)}getMatrixForModel(e,n){const l=c.a0.fromLngLat(e,n),h=l.meterInMercatorCoordinateUnits(),m=c.b8();return c.M(m,m,[l.x,l.y,l.z]),c.b5(m,m,Math.PI),c.b6(m,m,Math.PI/2),c.N(m,m,[-h,h,h]),m}getProjectionDataForCustomLayer(e=!0){const n=new c.Z(0,0,0,0,0),l=this.getProjectionData({overscaledTileID:n,applyGlobeMatrix:e}),h=ee(n,this.worldSize);c.O(h,this._viewProjMatrix,h),l.tileMercatorCoords=[0,0,1,1];const m=[c.$,c.$,this.worldSize/this._helper.pixelsPerMeter],y=c.b9();return c.N(y,h,m),l.fallbackMatrix=y,l.mainMatrix=y,l}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function ln(){c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Ln(f){if(f.useSlerp)if(f.k<1){const e=c.ba(f.startEulerAngles.roll,f.startEulerAngles.pitch,f.startEulerAngles.bearing),n=c.ba(f.endEulerAngles.roll,f.endEulerAngles.pitch,f.endEulerAngles.bearing),l=new Float64Array(4);c.bb(l,e,n,f.k);const h=c.bc(l);f.tr.setRoll(h.roll),f.tr.setPitch(h.pitch),f.tr.setBearing(h.bearing)}else f.tr.setRoll(f.endEulerAngles.roll),f.tr.setPitch(f.endEulerAngles.pitch),f.tr.setBearing(f.endEulerAngles.bearing);else f.tr.setRoll(c.C.number(f.startEulerAngles.roll,f.endEulerAngles.roll,f.k)),f.tr.setPitch(c.C.number(f.startEulerAngles.pitch,f.endEulerAngles.pitch,f.k)),f.tr.setBearing(c.C.number(f.startEulerAngles.bearing,f.endEulerAngles.bearing,f.k))}function ki(f,e,n,l,h){const m=h.padding,y=Ae(h.worldSize,n.getNorthWest()),S=Ae(h.worldSize,n.getNorthEast()),M=Ae(h.worldSize,n.getSouthEast()),R=Ae(h.worldSize,n.getSouthWest()),I=c.ad(-l),B=y.rotate(I),O=S.rotate(I),j=M.rotate(I),Z=R.rotate(I),ie=new c.P(Math.max(B.x,O.x,Z.x,j.x),Math.max(B.y,O.y,Z.y,j.y)),te=new c.P(Math.min(B.x,O.x,Z.x,j.x),Math.min(B.y,O.y,Z.y,j.y)),ne=ie.sub(te),se=(h.width-(m.left+m.right+e.left+e.right))/ne.x,ue=(h.height-(m.top+m.bottom+e.top+e.bottom))/ne.y;if(ue<0||se<0)return void ln();const oe=Math.min(c.aj(h.scale*Math.min(se,ue)),f.maxZoom),pe=c.P.convert(f.offset),ge=new c.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(c.ad(l)),le=pe.add(ge).mult(h.scale/c.ae(oe));return{center:H(h.worldSize,y.add(M).div(2).sub(le)),zoom:oe,bearing:l}}class Ea{get useGlobeControls(){return!1}handlePanInertia(e,n){return{easingOffset:e,easingCenter:n.center}}handleMapControlsRollPitchBearingZoom(e,n){e.bearingDelta&&n.setBearing(n.bearing+e.bearingDelta),e.pitchDelta&&n.setPitch(n.pitch+e.pitchDelta),e.rollDelta&&n.setRoll(n.roll+e.rollDelta),e.zoomDelta&&n.setZoom(n.zoom+e.zoomDelta)}handleMapControlsPan(e,n,l){e.around.distSqr(n.centerPoint)<.01||n.setLocationAtPoint(l,e.around)}cameraForBoxAndBearing(e,n,l,h,m){return ki(e,n,l,h,m)}handleJumpToCenterZoom(e,n){e.zoom!==(n.zoom!==void 0?+n.zoom:e.zoom)&&e.setZoom(+n.zoom),n.center!==void 0&&e.setCenter(c.S.convert(n.center))}handleEaseTo(e,n){const l=e.zoom,h=e.padding,m={roll:e.roll,pitch:e.pitch,bearing:e.bearing},y={roll:n.roll===void 0?e.roll:n.roll,pitch:n.pitch===void 0?e.pitch:n.pitch,bearing:n.bearing===void 0?e.bearing:n.bearing},S=n.zoom!==void 0,M=!e.isPaddingEqual(n.padding);let R=!1;const I=S?+n.zoom:e.zoom;let B=e.centerPoint.add(n.offsetAsPoint);const O=e.screenPointToLocation(B),{center:j,zoom:Z}=e.getConstrained(c.S.convert(n.center||O),I??l);Ma(e,j);const ie=Ae(e.worldSize,O),te=Ae(e.worldSize,j).sub(ie),ne=c.ae(Z-l);return R=Z!==l,{easeFunc:se=>{if(R&&e.setZoom(c.C.number(l,Z,se)),c.bd(m,y)||Ln({startEulerAngles:m,endEulerAngles:y,tr:e,k:se,useSlerp:m.roll!=y.roll}),M&&(e.interpolatePadding(h,n.padding,se),B=e.centerPoint.add(n.offsetAsPoint)),n.around)e.setLocationAtPoint(n.around,n.aroundPoint);else{const ue=c.ae(e.zoom-l),oe=Z>l?Math.min(2,ne):Math.max(.5,ne),pe=Math.pow(oe,1-se),ge=H(e.worldSize,ie.add(te.mult(se*pe)).mult(ue));e.setLocationAtPoint(e.renderWorldCopies?ge.wrap():ge,B)}},isZooming:R,elevationCenter:j}}handleFlyTo(e,n){const l=n.zoom!==void 0,h=e.zoom,m=e.getConstrained(c.S.convert(n.center||n.locationAtOffset),l?+n.zoom:h),y=m.center,S=m.zoom;Ma(e,y);const M=Ae(e.worldSize,n.locationAtOffset),R=Ae(e.worldSize,y).sub(M),I=R.mag(),B=c.ae(S-h);let O;if(n.minZoom!==void 0){const j=Math.min(+n.minZoom,h,S),Z=e.getConstrained(y,j).zoom;O=c.ae(Z-h)}return{easeFunc:(j,Z,ie,te)=>{e.setZoom(j===1?S:h+c.aj(Z));const ne=j===1?y:H(e.worldSize,M.add(R.mult(ie)).mult(Z));e.setLocationAtPoint(e.renderWorldCopies?ne.wrap():ne,te)},scaleOfZoom:B,targetCenter:y,scaleOfMinZoom:O,pixelPathLength:I}}}class si{constructor(e,n,l){this.blendFunction=e,this.blendColor=n,this.mask=l}}si.Replace=[1,0],si.disabled=new si(si.Replace,c.be.transparent,[!1,!1,!1,!1]),si.unblended=new si(si.Replace,c.be.transparent,[!0,!0,!0,!0]),si.alphaBlended=new si([1,771],c.be.transparent,[!0,!0,!0,!0]);const sr=2305;class $t{constructor(e,n,l){this.enable=e,this.mode=n,this.frontFace=l}}$t.disabled=new $t(!1,1029,sr),$t.backCCW=new $t(!0,1029,sr),$t.frontCCW=new $t(!0,1028,sr);class Xt{constructor(e,n,l){this.func=e,this.mask=n,this.range=l}}Xt.ReadOnly=!1,Xt.ReadWrite=!0,Xt.disabled=new Xt(519,Xt.ReadOnly,[0,1]);const Za=7680;class Ft{constructor(e,n,l,h,m,y){this.test=e,this.ref=n,this.mask=l,this.fail=h,this.depthFail=m,this.pass=y}}Ft.disabled=new Ft({func:519,mask:0},0,0,Za,Za,Za);const On=new WeakMap;function Sn(f){var e;if(On.has(f))return On.get(f);{const n=(e=f.getParameter(f.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return On.set(f,n),n}}class ms{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const n=e.context,l=n.gl;this._texFormat=l.RGBA,this._texType=l.UNSIGNED_BYTE;const h=new c.aK;h.emplaceBack(-1,-1),h.emplaceBack(2,-1),h.emplaceBack(-1,2);const m=new c.aM;m.emplaceBack(0,1,2),this._fullscreenTriangle=new Ga(n.createVertexBuffer(h,Ta.members),n.createIndexBuffer(m),c.aL.simpleSegment(0,0,h.length,m.length)),this._resultBuffer=new Uint8Array(4),n.activeTexture.set(l.TEXTURE1);const y=l.createTexture();l.bindTexture(l.TEXTURE_2D,y),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texImage2D(l.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=n.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(y),Sn(l)&&(this._pbo=l.createBuffer(),l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.bufferData(l.PIXEL_PACK_BUFFER,4,l.STREAM_READ),l.bindBuffer(l.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,n){const l=this._updateCount;return this._readbackQueue?l>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():l>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,n),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,n=e.gl;e.activeTexture.set(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,n){const l=this._cachedRenderContext.context,h=l.gl;if(this._bindFramebuffer(),l.viewport.set([0,0,this._texWidth,this._texHeight]),l.clear({color:c.be.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(l,h.TRIANGLES,Xt.disabled,Ft.disabled,si.unblended,$t.disabled,((m,y)=>({u_input:m,u_output_expected:y}))(e,n),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Sn(h)){h.bindBuffer(h.PIXEL_PACK_BUFFER,this._pbo),h.readBuffer(h.COLOR_ATTACHMENT0),h.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),h.bindBuffer(h.PIXEL_PACK_BUFFER,null);const m=h.fenceSync(h.SYNC_GPU_COMMANDS_COMPLETE,0);h.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:m}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Sn(e)){const n=e.clientWaitSync(this._readbackQueue.sync,0,0);if(n===e.WAIT_FAILED)return c.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(n===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=ms._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let n=0;return n+=e[0]/256,n+=e[1]/65536,n+=e[2]/16777216,e[3]<127&&(n=-n),n/128}}const Qn=c.$/128;function Vu(f,e){const n=f.granularity!==void 0?Math.max(f.granularity,1):1,l=n+(f.generateBorders?2:0),h=n+(f.extendToNorthPole||f.generateBorders?1:0)+(f.extendToSouthPole||f.generateBorders?1:0),m=l+1,y=h+1,S=f.generateBorders?-1:0,M=f.generateBorders||f.extendToNorthPole?-1:0,R=n+(f.generateBorders?1:0),I=n+(f.generateBorders||f.extendToSouthPole?1:0),B=m*y,O=l*h*6,j=m*y>65536;if(j&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const Z=j||e==="32bit",ie=new Int16Array(2*B);let te=0;for(let ue=M;ue<=I;ue++)for(let oe=S;oe<=R;oe++){let pe=oe/n*c.$;oe===-1&&(pe=-Qn),oe===n+1&&(pe=c.$+Qn);let ge=ue/n*c.$;ue===-1&&(ge=f.extendToNorthPole?c.bg:-Qn),ue===n+1&&(ge=f.extendToSouthPole?c.bh:c.$+Qn),ie[te++]=pe,ie[te++]=ge}const ne=Z?new Uint32Array(O):new Uint16Array(O);let se=0;for(let ue=0;ue<h;ue++)for(let oe=0;oe<l;oe++){const pe=oe+1+ue*m,ge=oe+(ue+1)*m,le=oe+1+(ue+1)*m;ne[se++]=oe+ue*m,ne[se++]=ge,ne[se++]=pe,ne[se++]=pe,ne[se++]=ge,ne[se++]=le}return{vertices:ie.buffer.slice(0),indices:ne.buffer.slice(0),uses32bitIndices:Z}}const ca=new c.aJ({fill:new c.bi(128,2),line:new c.bi(512,0),tile:new c.bi(128,32),stencil:new c.bi(128,1),circle:3});class $c{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Va.projectionGlobe}get vertexShaderPreludeCode(){return Va.projectionMercator.vertexSource}get subdivisionGranularity(){return ca}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new ms(e));const n=c.U(this._errorQueryLatitudeDegrees),l=2*Math.atan(Math.exp(Math.PI-n*Math.PI*2))-.5*Math.PI,h=this._errorMeasurement.updateErrorLoop(n,l),m=xe.now();h!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=h,this._errorMeasurementLastChangeTime=m);const y=Math.min(Math.max((m-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=c.bj(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,c.bk(y))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,n,l,h,m){const y=(m==="stencil"?ca.stencil:ca.tile).getGranularityForZoomLevel(n.z);return this._getMesh(e,{granularity:y,generateBorders:l,extendToNorthPole:n.y===0&&h,extendToSouthPole:n.y===(1<<n.z)-1&&h})}_getMesh(e,n){const l=this._getMeshKey(n);if(l in this._tileMeshCache)return this._tileMeshCache[l];const h=function(m,y){const S=Vu(y,"16bit"),M=c.aK.deserialize({arrayBuffer:S.vertices,length:S.vertices.byteLength/2/2}),R=c.aM.deserialize({arrayBuffer:S.indices,length:S.indices.byteLength/2/3});return new Ga(m.createVertexBuffer(M,Ta.members),m.createIndexBuffer(R),c.aL.simpleSegment(0,0,M.length,R.length))}(e,n);return this._tileMeshCache[l]=h,h}recalculate(e){}hasTransition(){const e=xe.now();let n=!1;return n=n||(e-this._errorMeasurementLastChangeTime)/1e3<.7,n=n||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,n}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const ul=new c.r({type:new c.D(c.v.projection.type)});class Ns extends c.E{constructor(e){super(),this._transitionable=new c.t(ul),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.F(0)),this._mercatorProjection=new cl,this._verticalPerspectiveProjection=new $c}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof c.bl){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,n,l,h,m){return this.currentProjection.getMeshFromTileID(e,n,l,h,m)}setProjection(e){this._transitionable.setValue("type",(e==null?void 0:e.type)||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function hl(f){const e=dl(f.worldSize,f.center.lat);return 2*Math.PI*e}function Ca(f,e,n,l,h){const m=1/(1<<h),y=e/c.$*m+l*m,S=c.bn((f/c.$*m+n*m)*Math.PI*2+Math.PI,2*Math.PI),M=2*Math.atan(Math.exp(Math.PI-y*Math.PI*2))-.5*Math.PI,R=Math.cos(M),I=new Float64Array(3);return I[0]=Math.sin(S)*R,I[1]=Math.sin(M),I[2]=Math.cos(S)*R,I}function Jn(f){return function(e,n){const l=Math.cos(n),h=new Float64Array(3);return h[0]=Math.sin(e)*l,h[1]=Math.sin(n),h[2]=Math.cos(e)*l,h}(f.lng*Math.PI/180,f.lat*Math.PI/180)}function dl(f,e){return f/(2*Math.PI)/Math.cos(e*Math.PI/180)}function wo(f){const e=Math.asin(f[1])/Math.PI*180,n=Math.sqrt(f[0]*f[0]+f[2]*f[2]);if(n>1e-6){const l=f[0]/n,h=Math.acos(f[2]/n),m=(l>0?h:-h)/Math.PI*180;return new c.S(c.aN(m,-180,180),e)}return new c.S(0,e)}function fl(f){return Math.cos(f*Math.PI/180)}function Bn(f,e){const n=fl(f),l=fl(e);return c.aj(l/n)}function sc(f,e){const n=f.rotate(e.bearingInRadians),l=e.zoom+Bn(e.center.lat,0),h=c.bj(1/fl(e.center.lat),1/fl(Math.min(Math.abs(e.center.lat),60)),c.bm(l,7,3,0,1)),m=360/hl({worldSize:e.worldSize,center:{lat:e.center.lat}});return new c.S(e.center.lng-n.x*m*h,c.ag(e.center.lat+n.y*m,-c.ah,c.ah))}function pl(f){const e=.5*f,n=Math.sin(e),l=Math.cos(e);return Math.log(n+l)-Math.log(l-n)}function ml(f,e,n,l){const h=f.lat+n*l;if(Math.abs(n)>1){const m=(Math.sign(f.lat+n)!==Math.sign(f.lat)?-Math.abs(f.lat):Math.abs(f.lat))*Math.PI/180,y=Math.abs(f.lat+n)*Math.PI/180,S=pl(m+l*(y-m)),M=pl(m),R=pl(y);return new c.S(f.lng+e*((S-M)/(R-M)),h)}return new c.S(f.lng+e*l,h)}class Hh{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,n,l,h){const m=`${e.z}_${e.x}_${e.y}_${h!=null&&h.terrain?"t":""}`,y=this._cache.get(m);if(y)return y;const S=this._cachePrevious.get(m);if(S)return this._cache.set(m,S),S;const M=this._boundingVolumeFactory(e,n,l,h);return this._cache.set(m,M),this._hadAnyChanges=!0,M}}class js{constructor(e,n,l,h){this.min=l,this.max=h,this.points=e,this.planes=n}static fromAabb(e,n){const l=[];for(let h=0;h<8;h++)l.push([1&~h?e[0]:n[0],(h>>1&1)==1?n[1]:e[1],(h>>2&1)==1?n[2]:e[2]]);return new js(l,[[-1,0,0,n[0]],[1,0,0,-e[0]],[0,-1,0,n[1]],[0,1,0,-e[1]],[0,0,-1,n[2]],[0,0,1,-e[2]]],e,n)}static fromCenterSizeAngles(e,n,l){const h=c.bq([],l[0],l[1],l[2]),m=c.br([],[n[0],0,0],h),y=c.br([],[0,n[1],0],h),S=c.br([],[0,0,n[2]],h),M=[...e],R=[...e];for(let B=0;B<8;B++)for(let O=0;O<3;O++){const j=e[O]+m[O]*(1&~B?-1:1)+y[O]*((B>>1&1)==1?1:-1)+S[O]*((B>>2&1)==1?1:-1);M[O]=Math.min(M[O],j),R[O]=Math.max(R[O],j)}const I=[];for(let B=0;B<8;B++){const O=[...e];c.aR(O,O,c.aQ([],m,1&~B?-1:1)),c.aR(O,O,c.aQ([],y,(B>>1&1)==1?1:-1)),c.aR(O,O,c.aQ([],S,(B>>2&1)==1?1:-1)),I.push(O)}return new js(I,[[...m,-c.aW(m,I[0])],[...y,-c.aW(y,I[0])],[...S,-c.aW(S,I[0])],[-m[0],-m[1],-m[2],-c.aW(m,I[7])],[-y[0],-y[1],-y[2],-c.aW(y,I[7])],[-S[0],-S[1],-S[2],-c.aW(S,I[7])]],M,R)}intersectsFrustum(e){let n=!0;const l=this.points.length,h=this.planes.length,m=e.planes.length,y=e.points.length;for(let S=0;S<m;S++){const M=e.planes[S];let R=0;for(let I=0;I<l;I++){const B=this.points[I];M[0]*B[0]+M[1]*B[1]+M[2]*B[2]+M[3]>=0&&R++}if(R===0)return 0;R<l&&(n=!1)}if(n)return 2;for(let S=0;S<h;S++){const M=this.planes[S];let R=0;for(let I=0;I<y;I++){const B=e.points[I];M[0]*B[0]+M[1]*B[1]+M[2]*B[2]+M[3]>=0&&R++}if(R===0)return 0}return 1}intersectsPlane(e){const n=this.points.length;let l=0;for(let h=0;h<n;h++){const m=this.points[h];e[0]*m[0]+e[1]*m[1]+e[2]*m[2]+e[3]>=0&&l++}return l===n?2:l===0?0:1}}function oc(f,e,n){const l=f-e;return l<0?-l:Math.max(0,l-n)}function Gu(f,e,n,l,h){const m=f-n;let y;return y=m<0?Math.min(-m,1+m-h):m>1?Math.min(Math.max(m-h,0),1-m):0,Math.max(y,oc(e,l,h))}class $d{constructor(){this._boundingVolumeCache=new Hh(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,n,l,h){const m=1<<l.z,y=1/m,S=l.x/m,M=l.y/m;let R=2;return R=Math.min(R,Gu(e,n,S,M,y)),R=Math.min(R,Gu(e,n,S+.5,-M-y,y)),R=Math.min(R,Gu(e,n,S+.5,2-M-y,y)),R}getWrap(e,n,l){const h=1<<n.z,m=1/h,y=n.x/h,S=oc(e.x,y,m),M=oc(e.x,y-1,m),R=oc(e.x,y+1,m),I=Math.min(S,M,R);return I===R?1:I===M?-1:0}allowVariableZoom(e,n){return Ze(e,n)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,n,l,h){return this._boundingVolumeCache.getTileBoundingVolume(e,n,l,h)}_computeTileBoundingVolume(e,n,l,h){var m,y;let S=l,M=l;if(h!=null&&h.terrain){const R=new c.Z(e.z,n,e.z,e.x,e.y),I=h.terrain.getMinMaxElevation(R);S=(m=I.minElevation)!==null&&m!==void 0?m:l,M=(y=I.maxElevation)!==null&&y!==void 0?y:l}if(S/=c.bt,M/=c.bt,S+=1,M+=1,e.z<=0)return js.fromAabb([-M,-M,-M],[M,M,M]);if(e.z===1)return js.fromAabb([e.x===0?-M:0,e.y===0?0:-M,-M],[e.x===0?0:M,e.y===0?M:0,M]);{const R=[Ca(0,0,e.x,e.y,e.z),Ca(c.$,0,e.x,e.y,e.z),Ca(c.$,c.$,e.x,e.y,e.z),Ca(0,c.$,e.x,e.y,e.z)],I=[];for(const De of R)I.push(c.aQ([],De,M));if(M!==S)for(const De of R)I.push(c.aQ([],De,S));e.y===0&&I.push([0,1,0]),e.y===(1<<e.z)-1&&I.push([0,-1,0]);const B=[1,1,1],O=[-1,-1,-1];for(const De of I)for(let Be=0;Be<3;Be++)B[Be]=Math.min(B[Be],De[Be]),O[Be]=Math.max(O[Be],De[Be]);const j=Ca(c.$/2,c.$/2,e.x,e.y,e.z),Z=c.aV([],[0,1,0],j);c.aU(Z,Z);const ie=c.aV([],j,Z);c.aU(ie,ie);const te=c.aV([],R[2],R[1]);c.aU(te,te);const ne=c.aV([],R[0],R[3]);c.aU(ne,ne),I.push(c.aQ([],j,M)),e.y>=(1<<e.z)/2&&I.push(c.aQ([],Ca(c.$/2,0,e.x,e.y,e.z),M)),e.y<(1<<e.z)/2&&I.push(c.aQ([],Ca(c.$/2,c.$,e.x,e.y,e.z),M));const se=or(j,I),ue=or(ie,I),oe=[-j[0],-j[1],-j[2],se.max],pe=[j[0],j[1],j[2],-se.min],ge=[-ie[0],-ie[1],-ie[2],ue.max],le=[ie[0],ie[1],ie[2],-ue.min],we=[...te,0],Oe=[...ne,0],Re=[];return e.y===0?Re.push(c.bs(Oe,we,oe),c.bs(Oe,we,pe)):Re.push(c.bs(ge,we,oe),c.bs(ge,we,pe),c.bs(ge,Oe,oe),c.bs(ge,Oe,pe)),e.y===(1<<e.z)-1?Re.push(c.bs(Oe,we,oe),c.bs(Oe,we,pe)):Re.push(c.bs(le,we,oe),c.bs(le,we,pe),c.bs(le,Oe,oe),c.bs(le,Oe,pe)),new js(Re,[oe,pe,ge,le,we,Oe],B,O)}}}function or(f,e){let n=1/0,l=-1/0;for(const h of e){const m=c.aW(f,h);n=Math.min(n,m),l=Math.max(l,m)}return{min:n,max:l}}class gl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,n,l){return this._helper.interpolatePadding(e,n,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,n){this._helper.resize(e,n)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,n){this._helper.overrideNearFarZ(e,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=c.bu(),this._projectionMatrix=c.b8(),this._globeViewProjMatrix32f=c.b7(),this._globeViewProjMatrixNoCorrection=c.b8(),this._globeViewProjMatrixNoCorrectionInverted=c.b8(),this._globeProjMatrixInverted=c.b8(),this._cameraPosition=c.bo(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new qa({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,n)=>this.getConstrained(e,n)}),this._coveringTilesDetailsProvider=new $d}clone(){const e=new gl;return e.apply(this),e}apply(e,n){this._globeLatitudeErrorCorrectionRadians=n||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=c.bo();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:n,applyGlobeMatrix:l}=e,h=this._helper.getMercatorTileCoordinates(n);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:h,clippingPlane:this._cachedClippingPlane,projectionTransition:l?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const n=this.pitchInRadians,l=this.cameraToCenterDistance/e,h=Math.sin(n)*l,m=Math.cos(n)*l+1,y=1/Math.sqrt(h*h+m*m)*1;let S=-h,M=m;const R=Math.sqrt(S*S+M*M);S/=R,M/=R;const I=[0,S,M];c.bv(I,I,[0,0,0],-this.bearingInRadians),c.bw(I,I,[0,0,0],-1*this.center.lat*Math.PI/180),c.bx(I,I,[0,0,0],this.center.lng*Math.PI/180);const B=1/c.aY(I);return c.aQ(I,I,B),[...I,-y*B]}isLocationOccluded(e){return!this.isSurfacePointVisible(Jn(e))}transformLightDirection(e){const n=this._helper._center.lng*Math.PI/180,l=this._helper._center.lat*Math.PI/180,h=Math.cos(l),m=[Math.sin(n)*h,Math.sin(l),Math.cos(n)*h],y=[m[2],0,-m[0]],S=[0,0,0];c.aV(S,y,m),c.aU(y,y),c.aU(S,S);const M=[0,0,0];return c.aU(M,[y[0]*e[0]+S[0]*e[1]+m[0]*e[2],y[1]*e[0]+S[1]*e[1]+m[1]*e[2],y[2]*e[0]+S[2]*e[1]+m[2]*e[2]]),M}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,n,l){const h=function(S,M,R){const I=1/(1<<R.z);return new c.a0(S/c.$*I+R.x*I,M/c.$*I+R.y*I)}(e,n,l.canonical),m=(y=h.y,[c.bn(h.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-y*Math.PI*2))-.5*Math.PI]);var y;return this.getCircleRadiusCorrection()/Math.cos(m[1])}projectTileCoordinates(e,n,l,h){const m=l.canonical,y=Ca(e,n,m.x,m.y,m.z),S=1+(h?h(e,n):0)/c.bt,M=[y[0]*S,y[1]*S,y[2]*S,1];c.av(M,M,this._globeViewProjMatrixNoCorrection);const R=this._cachedClippingPlane,I=R[0]*y[0]+R[1]*y[1]+R[2]*y[2]+R[3]<0;return{point:new c.P(M[0]/M[3],M[1]/M[3]),signedDistanceFromCamera:M[3],isOccluded:I}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=dl(this.worldSize,this.center.lat),n=c.b9(),l=c.b9();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),c.b3(n,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const h=this.centerOffset;n[8]=2*-h.x/this._helper._width,n[9]=2*h.y/this._helper._height,this._projectionMatrix=c.b4(n),this._globeProjMatrixInverted=c.b9(),c.ap(this._globeProjMatrixInverted,n),c.M(n,n,[0,0,-this.cameraToCenterDistance]),c.b5(n,n,this.rollInRadians),c.b6(n,n,-this.pitchInRadians),c.b5(n,n,this.bearingInRadians),c.M(n,n,[0,0,-e]);const m=c.bo();m[0]=e,m[1]=e,m[2]=e,c.b6(l,n,this.center.lat*Math.PI/180),c.by(l,l,-this.center.lng*Math.PI/180),c.N(l,l,m),this._globeViewProjMatrixNoCorrection=l,c.b6(n,n,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),c.by(n,n,-this.center.lng*Math.PI/180),c.N(n,n,m),this._globeViewProjMatrix32f=new Float32Array(n),this._globeViewProjMatrixNoCorrectionInverted=c.b9(),c.ap(this._globeViewProjMatrixNoCorrectionInverted,l);const y=c.bo();this._cameraPosition=c.bo(),this._cameraPosition[2]=this.cameraToCenterDistance/e,c.bv(this._cameraPosition,this._cameraPosition,y,-this.rollInRadians),c.bw(this._cameraPosition,this._cameraPosition,y,this.pitchInRadians),c.bv(this._cameraPosition,this._cameraPosition,y,-this.bearingInRadians),c.aR(this._cameraPosition,this._cameraPosition,[0,0,1]),c.bw(this._cameraPosition,this._cameraPosition,y,-this.center.lat*Math.PI/180),c.bx(this._cameraPosition,this._cameraPosition,y,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const S=c.b4(this._globeViewProjMatrixNoCorrectionInverted);c.N(S,S,[1,1,-1]),this._cachedFrustum=ar.fromInvProjectionMatrix(S,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){c.w("calculateFogMatrix is not supported on globe projection.");const n=c.b9();return c.af(n),n}getVisibleUnwrappedCoordinates(e){return[new c.b1(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&c.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,n){if(!this._globeViewProjMatrixNoCorrection)return 1;const l=Jn(e);c.aQ(l,l,1+n/c.bt);const h=c.bu();return c.av(h,[l[0],l[1],l[2],1],this._globeViewProjMatrixNoCorrection),h[2]/h[3]}populateCache(e){}getBounds(){const e=.5*this.width,n=.5*this.height,l=[new c.P(0,0),new c.P(e,0),new c.P(this.width,0),new c.P(this.width,n),new c.P(this.width,this.height),new c.P(e,this.height),new c.P(0,this.height),new c.P(0,n)],h=[];for(const B of l)h.push(this.unprojectScreenPoint(B));let m=0,y=0,S=0,M=0;const R=this.center;for(const B of h){const O=c.bz(R.lng,B.lng),j=c.bz(R.lat,B.lat);O<y&&(y=O),O>m&&(m=O),j<M&&(M=j),j>S&&(S=j)}const I=[R.lng+y,R.lat+M,R.lng+m,R.lat+S];return this.isSurfacePointOnScreen([0,1,0])&&(I[3]=90,I[0]=-180,I[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(I[1]=-90,I[0]=-180,I[2]=180),new tn(I)}getConstrained(e,n){const l=c.ag(e.lat,-c.ah,c.ah),h=c.ag(+n,this.minZoom+Bn(0,l),this.maxZoom);return{center:new c.S(e.lng,l),zoom:h}}calculateCenterFromCameraLngLatAlt(e,n,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(e,n,l,h)}setLocationAtPoint(e,n){const l=Jn(this.unprojectScreenPoint(n)),h=Jn(e),m=c.bo();c.bA(m);const y=c.bo();c.bx(y,l,m,-this.center.lng*Math.PI/180),c.bw(y,y,m,this.center.lat*Math.PI/180);const S=h[0]*h[0]+h[2]*h[2],M=y[0]*y[0];if(S<M)return;const R=Math.sqrt(S-M),I=-R,B=c.bB(h[0],h[2],y[0],R),O=c.bB(h[0],h[2],y[0],I),j=c.bo();c.bx(j,h,m,-B);const Z=c.bB(j[1],j[2],y[1],y[2]),ie=c.bo();c.bx(ie,h,m,-O);const te=c.bB(ie[1],ie[2],y[1],y[2]),ne=.5*Math.PI,se=Z>=-ne&&Z<=ne,ue=te>=-ne&&te<=ne;let oe,pe;if(se&&ue){const Oe=this.center.lng*Math.PI/180,Re=this.center.lat*Math.PI/180;c.bC(B,Oe)+c.bC(Z,Re)<c.bC(O,Oe)+c.bC(te,Re)?(oe=B,pe=Z):(oe=O,pe=te)}else if(se)oe=B,pe=Z;else{if(!ue)return;oe=O,pe=te}const ge=oe/Math.PI*180,le=pe/Math.PI*180,we=this.center.lat;this.setCenter(new c.S(ge,c.ag(le,-90,90))),this.setZoom(this.zoom+Bn(we,this.center.lat))}locationToScreenPoint(e,n){const l=Jn(e);if(n){const h=n.getElevationForLngLatZoom(e,this._helper._tileZoom);c.aQ(l,l,1+h/c.bt)}return this._projectSurfacePointToScreen(l)}_projectSurfacePointToScreen(e){const n=c.bu();return c.av(n,[...e,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],new c.P((.5*n[0]+.5)*this.width,(.5*-n[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,n){if(n){const l=n.pointCoordinate(e);if(l)return l}return c.a0.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,n){var l;return(l=this.screenPointToMercatorCoordinate(e,n))===null||l===void 0?void 0:l.toLngLat()}isPointOnMapSurface(e,n){const l=this._cameraPosition,h=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(l,h)}getRayDirectionFromPixel(e){const n=c.bu();n[0]=e.x/this.width*2-1,n[1]=-1*(e.y/this.height*2-1),n[2]=1,n[3]=1,c.av(n,n,this._globeViewProjMatrixNoCorrectionInverted),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3];const l=c.bo();l[0]=n[0]-this._cameraPosition[0],l[1]=n[1]-this._cameraPosition[1],l[2]=n[2]-this._cameraPosition[2];const h=c.bo();return c.aU(h,l),h}isSurfacePointVisible(e){const n=this._cachedClippingPlane;return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const n=c.bu();return c.av(n,[...e,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3],n[0]>-1&&n[0]<1&&n[1]>-1&&n[1]<1&&n[2]>-1&&n[2]<1}rayPlanetIntersection(e,n){const l=c.aW(e,n),h=c.bo(),m=c.bo();c.aQ(m,n,l),c.aT(h,e,m);const y=1-c.aW(h,h);if(y<0)return null;const S=c.aW(e,e)-1,M=-l+(l<0?1:-1)*Math.sqrt(y),R=S/M,I=M;return{tMin:Math.min(R,I),tMax:Math.max(R,I)}}unprojectScreenPoint(e){const n=this._cameraPosition,l=this.getRayDirectionFromPixel(e),h=this.rayPlanetIntersection(n,l);if(h){const I=c.bo();c.aR(I,n,[l[0]*h.tMin,l[1]*h.tMin,l[2]*h.tMin]);const B=c.bo();return c.aU(B,I),wo(B)}const m=this._cachedClippingPlane,y=m[0]*l[0]+m[1]*l[1]+m[2]*l[2],S=-c.b0(m,n)/y,M=c.bo();if(S>0)c.aR(M,n,[l[0]*S,l[1]*S,l[2]*S]);else{const I=c.bo();c.aR(I,n,[2*l[0],2*l[1],2*l[2]]);const B=c.b0(this._cachedClippingPlane,I);c.aT(M,I,[this._cachedClippingPlane[0]*B,this._cachedClippingPlane[1]*B,this._cachedClippingPlane[2]*B])}const R=function(I){const B=c.bo();return B[0]=I[0]*-I[3],B[1]=I[1]*-I[3],B[2]=I[2]*-I[3],{center:B,radius:Math.sqrt(1-I[3]*I[3])}}(m);return wo(function(I,B,O){const j=c.bo();c.aT(j,O,I);const Z=c.bo();return c.bp(Z,I,j,B/c.a_(j)),Z}(R.center,R.radius,M))}getMatrixForModel(e,n){const l=c.S.convert(e),h=1/c.bt,m=c.b8();return c.by(m,m,l.lng/180*Math.PI),c.b6(m,m,-l.lat/180*Math.PI),c.M(m,m,[0,0,1+n/c.bt]),c.b6(m,m,.5*Math.PI),c.N(m,m,[h,h,h]),m}getProjectionDataForCustomLayer(e=!0){const n=this.getProjectionData({overscaledTileID:new c.Z(0,0,0,0,0),applyGlobeMatrix:e});return n.tileMercatorCoords=[0,0,1,1],n}getFastPathSimpleProjectionMatrix(e){}}class $r{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,n,l){return this._helper.interpolatePadding(e,n,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,n,l=!0){this._helper.resize(e,n,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,n){this._helper.overrideNearFarZ(e,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,n){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=n,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new qa({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,n)=>this.getConstrained(e,n)}),this._globeness=1,this._mercatorTransform=new on,this._verticalPerspectiveTransform=new gl}clone(){const e=new $r;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const n=this._mercatorTransform.getProjectionData(e),l=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?l.mainMatrix:n.mainMatrix,clippingPlane:l.clippingPlane,tileMercatorCoords:l.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:n.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return c.bj(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return c.bj(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,n,l){const h=this._mercatorTransform.getPitchedTextCorrection(e,n,l),m=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,n,l);return c.bj(h,m,this._globeness)}projectTileCoordinates(e,n,l,h){return this.currentTransform.projectTileCoordinates(e,n,l,h)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,n){return this.currentTransform.lngLatToCameraDepth(e,n)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,n){return this.currentTransform.getConstrained(e,n)}calculateCenterFromCameraLngLatAlt(e,n,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(e,n,l,h)}setLocationAtPoint(e,n){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,n),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,n),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,n){return this.currentTransform.locationToScreenPoint(e,n)}screenPointToMercatorCoordinate(e,n){return this.currentTransform.screenPointToMercatorCoordinate(e,n)}screenPointToLocation(e,n){return this.currentTransform.screenPointToLocation(e,n)}isPointOnMapSurface(e,n){return this.currentTransform.isPointOnMapSurface(e,n)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,n){return this.currentTransform.getMatrixForModel(e,n)}getProjectionDataForCustomLayer(e=!0){const n=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return n;const l=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return l.fallbackMatrix=n.mainMatrix,l}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Ir{get useGlobeControls(){return!0}handlePanInertia(e,n){const l=sc(e,n);return Math.abs(l.lng-n.center.lng)>180&&(l.lng=n.center.lng+179.5*Math.sign(l.lng-n.center.lng)),{easingCenter:l,easingOffset:new c.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,n){const l=e.around,h=n.screenPointToLocation(l);e.bearingDelta&&n.setBearing(n.bearing+e.bearingDelta),e.pitchDelta&&n.setPitch(n.pitch+e.pitchDelta),e.rollDelta&&n.setRoll(n.roll+e.rollDelta);const m=n.zoom;e.zoomDelta&&n.setZoom(n.zoom+e.zoomDelta);const y=n.zoom-m;if(y===0)return;const S=c.bz(n.center.lng,h.lng),M=S/(Math.abs(S/180)+1),R=c.bz(n.center.lat,h.lat),I=n.getRayDirectionFromPixel(l),B=n.cameraPosition,O=-1*c.aW(B,I),j=c.bo();c.aR(j,B,[I[0]*O,I[1]*O,I[2]*O]);const Z=c.aY(j)-1,ie=Math.exp(.5*-Math.max(Z-.3,0)),te=dl(n.worldSize,n.center.lat)/Math.min(n.width,n.height),ne=c.bm(te,.9,.5,1,.25),se=(1-c.ae(-y))*Math.min(ie,ne),ue=n.center.lat,oe=n.zoom,pe=new c.S(n.center.lng+M*se,c.ag(n.center.lat+R*se,-c.ah,c.ah));n.setLocationAtPoint(h,l);const ge=n.center,le=c.bm(Math.abs(S),45,85,0,1),we=c.bm(te,.75,.35,0,1),Oe=Math.pow(Math.max(le,we),.25),Re=c.bz(ge.lng,pe.lng),De=c.bz(ge.lat,pe.lat);n.setCenter(new c.S(ge.lng+Re*Oe,ge.lat+De*Oe).wrap()),n.setZoom(oe+Bn(ue,n.center.lat))}handleMapControlsPan(e,n,l){if(!e.panDelta)return;const h=n.center.lat,m=n.zoom;n.setCenter(sc(e.panDelta,n).wrap()),n.setZoom(m+Bn(h,n.center.lat))}cameraForBoxAndBearing(e,n,l,h,m){const y=ki(e,n,l,h,m),S=n.left/m.width*2-1,M=(m.width-n.right)/m.width*2-1,R=n.top/m.height*-2+1,I=(m.height-n.bottom)/m.height*-2+1,B=c.bz(l.getWest(),l.getEast())<0,O=B?l.getEast():l.getWest(),j=B?l.getWest():l.getEast(),Z=Math.max(l.getNorth(),l.getSouth()),ie=Math.min(l.getNorth(),l.getSouth()),te=O+.5*c.bz(O,j),ne=Z+.5*c.bz(Z,ie),se=m.clone();se.setCenter(y.center),se.setBearing(y.bearing),se.setPitch(0),se.setRoll(0),se.setZoom(y.zoom);const ue=se.modelViewProjectionMatrix,oe=[Jn(l.getNorthWest()),Jn(l.getNorthEast()),Jn(l.getSouthWest()),Jn(l.getSouthEast()),Jn(new c.S(j,ne)),Jn(new c.S(O,ne)),Jn(new c.S(te,Z)),Jn(new c.S(te,ie))],pe=Jn(y.center);let ge=Number.POSITIVE_INFINITY;for(const le of oe)S<0&&(ge=Ir.getLesserNonNegativeNonNull(ge,Ir.solveVectorScale(le,pe,ue,"x",S))),M>0&&(ge=Ir.getLesserNonNegativeNonNull(ge,Ir.solveVectorScale(le,pe,ue,"x",M))),R>0&&(ge=Ir.getLesserNonNegativeNonNull(ge,Ir.solveVectorScale(le,pe,ue,"y",R))),I<0&&(ge=Ir.getLesserNonNegativeNonNull(ge,Ir.solveVectorScale(le,pe,ue,"y",I)));if(Number.isFinite(ge)&&ge!==0)return y.zoom=se.zoom+c.aj(ge),y;ln()}handleJumpToCenterZoom(e,n){const l=e.center.lat,h=e.getConstrained(n.center?c.S.convert(n.center):e.center,e.zoom).center;e.setCenter(h.wrap());const m=n.zoom!==void 0?+n.zoom:e.zoom+Bn(l,h.lat);e.zoom!==m&&e.setZoom(m)}handleEaseTo(e,n){const l=e.zoom,h=e.center,m=e.padding,y={roll:e.roll,pitch:e.pitch,bearing:e.bearing},S={roll:n.roll===void 0?e.roll:n.roll,pitch:n.pitch===void 0?e.pitch:n.pitch,bearing:n.bearing===void 0?e.bearing:n.bearing},M=n.zoom!==void 0,R=!e.isPaddingEqual(n.padding);let I=!1;const B=n.center?c.S.convert(n.center):h,O=e.getConstrained(B,l).center;Ma(e,O);const j=e.clone();j.setCenter(O),j.setZoom(M?+n.zoom:l+Bn(h.lat,B.lat)),j.setBearing(n.bearing);const Z=new c.P(c.ag(e.centerPoint.x+n.offsetAsPoint.x,0,e.width),c.ag(e.centerPoint.y+n.offsetAsPoint.y,0,e.height));j.setLocationAtPoint(O,Z);const ie=(n.offset&&n.offsetAsPoint.mag())>0?j.center:O,te=M?+n.zoom:l+Bn(h.lat,ie.lat),ne=l+Bn(h.lat,0),se=te+Bn(ie.lat,0),ue=c.bz(h.lng,ie.lng),oe=c.bz(h.lat,ie.lat),pe=c.ae(se-ne);return I=te!==l,{easeFunc:ge=>{if(c.bd(y,S)||Ln({startEulerAngles:y,endEulerAngles:S,tr:e,k:ge,useSlerp:y.roll!=S.roll}),R&&e.interpolatePadding(m,n.padding,ge),n.around)c.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(n.around,n.aroundPoint);else{const le=se>ne?Math.min(2,pe):Math.max(.5,pe),we=Math.pow(le,1-ge),Oe=ml(h,ue,oe,ge*we);e.setCenter(Oe.wrap())}if(I){const le=c.C.number(ne,se,ge)+Bn(0,e.center.lat);e.setZoom(le)}},isZooming:I,elevationCenter:ie}}handleFlyTo(e,n){const l=n.zoom!==void 0,h=e.center,m=e.zoom,y=e.padding,S=!e.isPaddingEqual(n.padding),M=e.getConstrained(c.S.convert(n.center||n.locationAtOffset),m).center,R=l?+n.zoom:e.zoom+Bn(e.center.lat,M.lat),I=e.clone();I.setCenter(M),I.setZoom(R),I.setBearing(n.bearing);const B=new c.P(c.ag(e.centerPoint.x+n.offsetAsPoint.x,0,e.width),c.ag(e.centerPoint.y+n.offsetAsPoint.y,0,e.height));I.setLocationAtPoint(M,B);const O=I.center;Ma(e,O);const j=function(oe,pe,ge){const le=Jn(pe),we=Jn(ge),Oe=c.aW(le,we),Re=Math.acos(Oe),De=hl(oe);return Re/(2*Math.PI)*De}(e,h,O),Z=m+Bn(h.lat,0),ie=R+Bn(O.lat,0),te=c.ae(ie-Z);let ne;if(typeof n.minZoom=="number"){const oe=+n.minZoom+Bn(O.lat,0),pe=Math.min(oe,Z,ie)+Bn(0,O.lat),ge=e.getConstrained(O,pe).zoom+Bn(O.lat,0);ne=c.ae(ge-Z)}const se=c.bz(h.lng,O.lng),ue=c.bz(h.lat,O.lat);return{easeFunc:(oe,pe,ge,le)=>{const we=ml(h,se,ue,ge);S&&e.interpolatePadding(y,n.padding,oe);const Oe=oe===1?O:we;e.setCenter(Oe.wrap());const Re=Z+c.aj(pe);e.setZoom(oe===1?R:Re+Bn(0,Oe.lat))},scaleOfZoom:te,targetCenter:O,scaleOfMinZoom:ne,pixelPathLength:j}}static solveVectorScale(e,n,l,h,m){const y=h==="x"?[l[0],l[4],l[8],l[12]]:[l[1],l[5],l[9],l[13]],S=[l[3],l[7],l[11],l[15]],M=e[0]*y[0]+e[1]*y[1]+e[2]*y[2],R=e[0]*S[0]+e[1]*S[1]+e[2]*S[2],I=n[0]*y[0]+n[1]*y[1]+n[2]*y[2],B=n[0]*S[0]+n[1]*S[1]+n[2]*S[2];return I+m*R===M+m*B||S[3]*(M-I)+y[3]*(B-R)+M*B==I*R?null:(I+y[3]-m*B-m*S[3])/(I-M-m*B+m*R)}static getLesserNonNegativeNonNull(e,n){return n!==null&&n>=0&&n<e?n:e}}class Hc{constructor(e){this._globe=e,this._mercatorCameraHelper=new Ea,this._verticalPerspectiveCameraHelper=new Ir}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,n){return this.currentHelper.handlePanInertia(e,n)}handleMapControlsRollPitchBearingZoom(e,n){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,n)}handleMapControlsPan(e,n,l){this.currentHelper.handleMapControlsPan(e,n,l)}cameraForBoxAndBearing(e,n,l,h,m){return this.currentHelper.cameraForBoxAndBearing(e,n,l,h,m)}handleJumpToCenterZoom(e,n){this.currentHelper.handleJumpToCenterZoom(e,n)}handleEaseTo(e,n){return this.currentHelper.handleEaseTo(e,n)}handleFlyTo(e,n){return this.currentHelper.handleFlyTo(e,n)}}const lc=(f,e)=>c.y(f,e&&e.filter(n=>n.identifier!=="source.canvas")),_l=c.bD();class qu extends c.E{constructor(e,n={}){super(),this._rtlPluginLoaded=()=>{for(const l in this.sourceCaches){const h=this.sourceCaches[l].getSource().type;h!=="vector"&&h!=="geojson"||this.sourceCaches[l].reload()}},this.map=e,this.dispatcher=new Vt(li(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(l,h)=>this.getGlyphs(l,h)),this.dispatcher.registerMessageHandler("GI",(l,h)=>this.getImages(l,h)),this.imageManager=new Mi,this.imageManager.setEventedParent(this),this.glyphManager=new bn(e._requestManager,n.localIdeographFontFamily),this.lineAtlas=new mi(256,512),this.crossTileSymbolIndex=new nc,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.bE,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",c.bF()),nn().on(cs,this._rtlPluginLoaded),this.on("data",l=>{if(l.dataType!=="source"||l.sourceDataType!=="metadata")return;const h=this.sourceCaches[l.sourceId];if(!h)return;const m=h.getSource();if(m&&m.vectorLayerIds)for(const y in this._layers){const S=this._layers[y];S.source===m.id&&this._validateLayer(S)}})}setGlobalStateProperty(e,n){var l,h,m;this._checkLoaded();const y=n===null?(m=(h=(l=this.stylesheet.state)===null||l===void 0?void 0:l[e])===null||h===void 0?void 0:h.default)!==null&&m!==void 0?m:null:n;if(c.bG(y,this._globalState[e]))return this;this._globalState[e]=y;const S=this._findGlobalStateAffectedSources([e]);for(const M in this.sourceCaches)S.has(M)&&(this._reloadSource(M),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const n=[];for(const h in e)!c.bG(this._globalState[h],e[h].default)&&(n.push(h),this._globalState[h]=e[h].default);const l=this._findGlobalStateAffectedSources(n);for(const h in this.sourceCaches)l.has(h)&&(this._reloadSource(h),this._changed=!0)}_findGlobalStateAffectedSources(e){if(e.length===0)return new Set;const n=new Set;for(const l in this._layers){const h=this._layers[l],m=h.getLayoutAffectingGlobalStateRefs();for(const y of e)m.has(y)&&n.add(h.source)}return n}loadURL(e,n={},l){this.fire(new c.l("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const h=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const m=this._loadStyleRequest;c.j(h,this._loadStyleRequest).then(y=>{this._loadStyleRequest=null,this._load(y.data,n,l)}).catch(y=>{this._loadStyleRequest=null,y&&!m.signal.aborted&&this.fire(new c.k(y))})}loadJSON(e,n={},l){this.fire(new c.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,xe.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,n.validate=n.validate!==!1,this._load(e,n,l)}).catch(()=>{})}loadEmpty(){this.fire(new c.l("dataloading",{dataType:"style"})),this._load(_l,{validate:!1})}_load(e,n,l){var h,m,y;const S=n.transformStyle?n.transformStyle(l,e):e;if(!n.validate||!lc(this,c.z(S))){this._loaded=!0,this.stylesheet=S;for(const M in S.sources)this.addSource(M,S.sources[M],{validate:!1});S.sprite?this._loadSprite(S.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(S.glyphs),this._createLayers(),this.light=new Ke(this.stylesheet.light),this._setProjectionInternal(((h=this.stylesheet.projection)===null||h===void 0?void 0:h.type)||"mercator"),this.sky=new It(this.stylesheet.sky),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.setGlobalState((y=this.stylesheet.state)!==null&&y!==void 0?y:null),this.fire(new c.l("data",{dataType:"style"})),this.fire(new c.l("style.load"))}}_createLayers(){const e=c.bH(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(n=>n.id),this._layers={},this._serializedLayers=null;for(const n of e){const l=c.bI(n);l.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=l}}_loadSprite(e,n=!1,l=void 0){let h;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(m,y,S,M){return c._(this,void 0,void 0,function*(){const R=Ut(m),I=S>1?"@2x":"",B={},O={};for(const{id:j,url:Z}of R){const ie=y.transformRequest(oi(Z,I,".json"),"SpriteJSON");B[j]=c.j(ie,M);const te=y.transformRequest(oi(Z,I,".png"),"SpriteImage");O[j]=Ot.getImage(te,M)}return yield Promise.all([...Object.values(B),...Object.values(O)]),function(j,Z){return c._(this,void 0,void 0,function*(){const ie={};for(const te in j){ie[te]={};const ne=xe.getImageCanvasContext((yield Z[te]).data),se=(yield j[te]).data;for(const ue in se){const{width:oe,height:pe,x:ge,y:le,sdf:we,pixelRatio:Oe,stretchX:Re,stretchY:De,content:Be,textFitWidth:dt,textFitHeight:ut}=se[ue];ie[te][ue]={data:null,pixelRatio:Oe,sdf:we,stretchX:Re,stretchY:De,content:Be,textFitWidth:dt,textFitHeight:ut,spriteData:{width:oe,height:pe,x:ge,y:le,context:ne}}}}return ie})}(B,O)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(m=>{if(this._spriteRequest=null,m)for(const y in m){this._spritesImagesIds[y]=[];const S=this._spritesImagesIds[y]?this._spritesImagesIds[y].filter(M=>!(M in m)):[];for(const M of S)this.imageManager.removeImage(M),this._changedImages[M]=!0;for(const M in m[y]){const R=y==="default"?M:`${y}:${M}`;this._spritesImagesIds[y].push(R),R in this.imageManager.images?this.imageManager.updateImage(R,m[y][M],!1):this.imageManager.addImage(R,m[y][M]),n&&(this._changedImages[R]=!0)}}}).catch(m=>{this._spriteRequest=null,h=m,this.fire(new c.k(h))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"})),l&&l(h)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}_validateLayer(e){const n=this.sourceCaches[e.source];if(!n)return;const l=e.sourceLayer;if(!l)return;const h=n.getSource();(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(l)===-1)&&this.fire(new c.k(new Error(`Source layer "${l}" does not exist on source "${h.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,n=!1){const l=this._serializedAllLayers();if(!e||e.length===0)return Object.values(n?c.bJ(l):l);const h=[];for(const m of e)if(l[m]){const y=n?c.bJ(l[m]):l[m];h.push(y)}return h}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const n=Object.keys(this._layers);for(const l of n){const h=this._layers[l];h.type!=="custom"&&(e[l]=h.serialize())}return e}hasTransitions(){var e,n,l;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((n=this.sky)===null||n===void 0)&&n.hasTransition()||!((l=this.projection)===null||l===void 0)&&l.hasTransition())return!0;for(const h in this.sourceCaches)if(this.sourceCaches[h].hasTransition())return!0;for(const h in this._layers)if(this._layers[h].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const n=this._changed;if(n){const h=Object.keys(this._updatedLayers),m=Object.keys(this._removedLayers);(h.length||m.length)&&this._updateWorkerLayers(h,m);for(const y in this._updatedSources){const S=this._updatedSources[y];if(S==="reload")this._reloadSource(y);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(y)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const y in this._updatedPaintProps)this._layers[y].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const l={};for(const h in this.sourceCaches){const m=this.sourceCaches[h];l[h]=m.used,m.used=!1}for(const h of this._order){const m=this._layers[h];m.recalculate(e,this._availableImages),!m.isHidden(e.zoom)&&m.source&&(this.sourceCaches[m.source].used=!0)}for(const h in l){const m=this.sourceCaches[h];!!l[h]!=!!m.used&&m.fire(new c.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:h}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,n&&this.fire(new c.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,n){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,n={}){var l;this._checkLoaded();const h=this.serialize();if(e=n.transformStyle?n.transformStyle(h,e):e,((l=n.validate)===null||l===void 0||l)&&lc(this,c.z(e)))return!1;(e=c.bJ(e)).layers=c.bH(e.layers);const m=c.bK(h,e),y=this._getOperationsToPerform(m);if(y.unimplemented.length>0)throw new Error(`Unimplemented: ${y.unimplemented.join(", ")}.`);if(y.operations.length===0)return!1;for(const S of y.operations)S();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const n=[],l=[];for(const h of e)switch(h.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":n.push(()=>this.addLayer.apply(this,h.args));break;case"removeLayer":n.push(()=>this.removeLayer.apply(this,h.args));break;case"setPaintProperty":n.push(()=>this.setPaintProperty.apply(this,h.args));break;case"setLayoutProperty":n.push(()=>this.setLayoutProperty.apply(this,h.args));break;case"setFilter":n.push(()=>this.setFilter.apply(this,h.args));break;case"addSource":n.push(()=>this.addSource.apply(this,h.args));break;case"removeSource":n.push(()=>this.removeSource.apply(this,h.args));break;case"setLayerZoomRange":n.push(()=>this.setLayerZoomRange.apply(this,h.args));break;case"setLight":n.push(()=>this.setLight.apply(this,h.args));break;case"setGeoJSONSourceData":n.push(()=>this.setGeoJSONSourceData.apply(this,h.args));break;case"setGlyphs":n.push(()=>this.setGlyphs.apply(this,h.args));break;case"setSprite":n.push(()=>this.setSprite.apply(this,h.args));break;case"setTerrain":n.push(()=>this.map.setTerrain.apply(this,h.args));break;case"setSky":n.push(()=>this.setSky.apply(this,h.args));break;case"setProjection":this.setProjection.apply(this,h.args);break;case"setGlobalState":n.push(()=>this.setGlobalState.apply(this,h.args));break;case"setTransition":n.push(()=>{});break;default:l.push(h.command)}return{operations:n,unimplemented:l}}addImage(e,n){if(this.getImage(e))return this.fire(new c.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,n),this._afterImageUpdated(e)}updateImage(e,n){this.imageManager.updateImage(e,n)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new c.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,n,l={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(c.z.source,`sources.${e}`,n,null,l))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const h=this.sourceCaches[e]=new Xe(e,n,this.dispatcher);h.style=this,h.setEventedParent(this,()=>({isSourceLoaded:h.loaded(),source:h.serialize(),sourceId:e})),h.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===e)return this.fire(new c.k(new Error(`Source "${e}" cannot be removed while layer "${l}" is using it.`)));const n=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],n.fire(new c.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,n){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const l=this.sourceCaches[e].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(n),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,n,l={}){this._checkLoaded();const h=e.id;if(this.getLayer(h))return void this.fire(new c.k(new Error(`Layer "${h}" already exists on this map.`)));let m;if(e.type==="custom"){if(lc(this,c.bL(e)))return;m=c.bI(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(h,e.source),e=c.bJ(e),e=c.e(e,{source:h})),this._validate(c.z.layer,`layers.${h}`,e,{arrayIndex:-1},l))return;m=c.bI(e),this._validateLayer(m),m.setEventedParent(this,{layer:{id:h}})}const y=n?this._order.indexOf(n):this._order.length;if(n&&y===-1)this.fire(new c.k(new Error(`Cannot add layer "${h}" before non-existing layer "${n}".`)));else{if(this._order.splice(y,0,h),this._layerOrderChanged=!0,this._layers[h]=m,this._removedLayers[h]&&m.source&&m.type!=="custom"){const S=this._removedLayers[h];delete this._removedLayers[h],S.type!==m.type?this._updatedSources[m.source]="clear":(this._updatedSources[m.source]="reload",this.sourceCaches[m.source].pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map)}}moveLayer(e,n){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new c.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===n)return;const l=this._order.indexOf(e);this._order.splice(l,1);const h=n?this._order.indexOf(n):this._order.length;n&&h===-1?this.fire(new c.k(new Error(`Cannot move layer "${e}" before non-existing layer "${n}".`))):(this._order.splice(h,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const n=this._layers[e];if(!n)return void this.fire(new c.k(new Error(`Cannot remove non-existing layer "${e}".`)));n.setEventedParent(null);const l=this._order.indexOf(e);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,n,l){this._checkLoaded();const h=this.getLayer(e);h?h.minzoom===n&&h.maxzoom===l||(n!=null&&(h.minzoom=n),l!=null&&(h.maxzoom=l),this._updateLayer(h)):this.fire(new c.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,n,l={}){this._checkLoaded();const h=this.getLayer(e);if(h){if(!c.bG(h.filter,n))return n==null?(h.setFilter(void 0),void this._updateLayer(h)):void(this._validate(c.z.filter,`layers.${h.id}.filter`,n,null,l)||(h.setFilter(c.bJ(n)),this._updateLayer(h)))}else this.fire(new c.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return c.bJ(this.getLayer(e).filter)}setLayoutProperty(e,n,l,h={}){this._checkLoaded();const m=this.getLayer(e);m?c.bG(m.getLayoutProperty(n),l)||(m.setLayoutProperty(n,l,h),this._updateLayer(m)):this.fire(new c.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,n){const l=this.getLayer(e);if(l)return l.getLayoutProperty(n);this.fire(new c.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,n,l,h={}){this._checkLoaded();const m=this.getLayer(e);m?c.bG(m.getPaintProperty(n),l)||(m.setPaintProperty(n,l,h)&&this._updateLayer(m),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new c.k(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,n){return this.getLayer(e).getPaintProperty(n)}setFeatureState(e,n){this._checkLoaded();const l=e.source,h=e.sourceLayer,m=this.sourceCaches[l];if(m===void 0)return void this.fire(new c.k(new Error(`The source '${l}' does not exist in the map's style.`)));const y=m.getSource().type;y==="geojson"&&h?this.fire(new c.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):y!=="vector"||h?(e.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),m.setFeatureState(h,e.id,n)):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,n){this._checkLoaded();const l=e.source,h=this.sourceCaches[l];if(h===void 0)return void this.fire(new c.k(new Error(`The source '${l}' does not exist in the map's style.`)));const m=h.getSource().type,y=m==="vector"?e.sourceLayer:void 0;m!=="vector"||y?n&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new c.k(new Error("A feature id is required to remove its specific state property."))):h.removeFeatureState(y,e.id,n):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const n=e.source,l=e.sourceLayer,h=this.sourceCaches[n];if(h!==void 0)return h.getSource().type!=="vector"||l?(e.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),h.getFeatureState(l,e.id)):void this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.k(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=c.bM(this.sourceCaches,m=>m.serialize()),n=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,h=this.stylesheet;return c.bN({version:h.version,name:h.name,metadata:h.metadata,light:h.light,sky:h.sky,center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,sprite:h.sprite,glyphs:h.glyphs,transition:h.transition,projection:h.projection,sources:e,layers:n,terrain:l},m=>m!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const n=y=>this._layers[y].type==="fill-extrusion",l={},h=[];for(let y=this._order.length-1;y>=0;y--){const S=this._order[y];if(n(S)){l[S]=y;for(const M of e){const R=M[S];if(R)for(const I of R)h.push(I)}}}h.sort((y,S)=>S.intersectionZ-y.intersectionZ);const m=[];for(let y=this._order.length-1;y>=0;y--){const S=this._order[y];if(n(S))for(let M=h.length-1;M>=0;M--){const R=h[M].feature;if(l[R.layer.id]<y)break;m.push(R),h.pop()}else for(const M of e){const R=M[S];if(R)for(const I of R)m.push(I.feature)}}return m}queryRenderedFeatures(e,n,l){n&&n.filter&&this._validate(c.z.filter,"queryRenderedFeatures.filter",n.filter,null,n);const h={};if(n&&n.layers){if(!(Array.isArray(n.layers)||n.layers instanceof Set))return this.fire(new c.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const R of n.layers){const I=this._layers[R];if(!I)return this.fire(new c.k(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];h[I.source]=!0}}const m=[];n.availableImages=this._availableImages;const y=this._serializedAllLayers(),S=n.layers instanceof Set?n.layers:Array.isArray(n.layers)?new Set(n.layers):null,M=Object.assign(Object.assign({},n),{layers:S});for(const R in this.sourceCaches)n.layers&&!h[R]||m.push(Hi(this.sourceCaches[R],this._layers,y,e,M,l,this.map.terrain?(I,B,O)=>this.map.terrain.getElevation(I,B,O):void 0));return this.placement&&m.push(function(R,I,B,O,j,Z,ie){const te={},ne=Z.queryRenderedSymbols(O),se=[];for(const ue of Object.keys(ne).map(Number))se.push(ie[ue]);se.sort(po);for(const ue of se){const oe=ue.featureIndex.lookupSymbolFeatures(ne[ue.bucketInstanceId],I,ue.bucketIndex,ue.sourceLayerIndex,j.filter,j.layers,j.availableImages,R);for(const pe in oe){const ge=te[pe]=te[pe]||[],le=oe[pe];le.sort((we,Oe)=>{const Re=ue.featureSortOrder;if(Re){const De=Re.indexOf(we.featureIndex);return Re.indexOf(Oe.featureIndex)-De}return Oe.featureIndex-we.featureIndex});for(const we of le)ge.push(we)}}return function(ue,oe,pe){for(const ge in ue)for(const le of ue[ge])dr(le,pe[oe[ge].source]);return ue}(te,R,B)}(this._layers,y,this.sourceCaches,e,M,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(m)}querySourceFeatures(e,n){n&&n.filter&&this._validate(c.z.filter,"querySourceFeatures.filter",n.filter,null,n);const l=this.sourceCaches[e];return l?function(h,m){const y=h.getRenderableIds().map(R=>h.getTileByID(R)),S=[],M={};for(let R=0;R<y.length;R++){const I=y[R],B=I.tileID.canonical.key;M[B]||(M[B]=!0,I.querySourceFeatures(S,m))}return S}(l,n):[]}getLight(){return this.light.getLight()}setLight(e,n={}){this._checkLoaded();const l=this.light.getLight();let h=!1;for(const y in e)if(!c.bG(e[y],l[y])){h=!0;break}if(!h)return;const m={now:xe.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(m)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,n={}){this._checkLoaded();const l=this.getSky();let h=!1;if(!e&&!l)return;if(e&&!l)h=!0;else if(!e&&l)h=!0;else for(const y in e)if(!c.bG(e[y],l[y])){h=!0;break}if(!h)return;const m={now:xe.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,n),this.sky.updateTransitions(m)}_setProjectionInternal(e){const n=function(l){if(Array.isArray(l)){const h=new Ns({type:l});return{projection:h,transform:new $r,cameraHelper:new Hc(h)}}switch(l){case"mercator":return{projection:new cl,transform:new on,cameraHelper:new Ea};case"globe":{const h=new Ns({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:h,transform:new $r,cameraHelper:new Hc(h)}}case"vertical-perspective":return{projection:new $c,transform:new gl,cameraHelper:new Ir};default:return c.w(`Unknown projection name: ${l}. Falling back to mercator projection.`),{projection:new cl,transform:new on,cameraHelper:new Ea}}}(e);this.projection=n.projection,this.map.migrateProjection(n.transform,n.cameraHelper);for(const l in this.sourceCaches)this.sourceCaches[l].reload()}_validate(e,n,l,h,m={}){return(!m||m.validate!==!1)&&lc(this,e.call(c.z,c.e({key:n,style:this.serialize(),value:l,styleSpec:c.v},h)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),nn().off(cs,this._rtlPluginLoaded);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.sourceCaches){const l=this.sourceCaches[n];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const n in this.sourceCaches)this.sourceCaches[n].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,n,l,h,m=!1){let y=!1,S=!1;const M={};for(const R of this._order){const I=this._layers[R];if(I.type!=="symbol")continue;if(!M[I.source]){const O=this.sourceCaches[I.source];M[I.source]=O.getRenderableIds(!0).map(j=>O.getTileByID(j)).sort((j,Z)=>Z.tileID.overscaledZ-j.tileID.overscaledZ||(j.tileID.isLessThan(Z.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(I,M[I.source],e.center.lng);y=y||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((m=m||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(xe.now(),e.zoom))&&(this.pauseablePlacement=new Zc(e,this.map.terrain,this._order,m,n,l,h,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(xe.now()),S=!0),y&&this.pauseablePlacement.placement.setStale()),S||y)for(const R of this._order){const I=this._layers[R];I.type==="symbol"&&this.placement.updateLayerOpacities(I,M[I.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(xe.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,n){return c._(this,void 0,void 0,function*(){const l=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();const h=this.sourceCaches[n.source];return h&&h.setDependencies(n.tileID.key,n.type,n.icons),l})}getGlyphs(e,n){return c._(this,void 0,void 0,function*(){const l=yield this.glyphManager.getGlyphs(n.stacks),h=this.sourceCaches[n.source];return h&&h.setDependencies(n.tileID.key,n.type,[""]),l})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,n={}){this._checkLoaded(),e&&this._validate(c.z.glyphs,"glyphs",e,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,n,l={},h){this._checkLoaded();const m=[{id:e,url:n}],y=[...Ut(this.stylesheet.sprite),...m];this._validate(c.z.sprite,"sprite",y,null,l)||(this.stylesheet.sprite=y,this._loadSprite(m,!0,h))}removeSprite(e){this._checkLoaded();const n=Ut(this.stylesheet.sprite);if(n.find(l=>l.id===e)){if(this._spritesImagesIds[e])for(const l of this._spritesImagesIds[e])this.imageManager.removeImage(l),this._changedImages[l]=!0;n.splice(n.findIndex(l=>l.id===e),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}else this.fire(new c.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Ut(this.stylesheet.sprite)}setSprite(e,n={},l){this._checkLoaded(),e&&this._validate(c.z.sprite,"sprite",e,null,n)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,l):(this._unloadSprite(),l&&l(null)))}}var Hd=c.aI([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Xd{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,n,l,h,m,y,S,M,R){this.context=e;let I=this.boundPaintVertexBuffers.length!==h.length;for(let B=0;!I&&B<h.length;B++)this.boundPaintVertexBuffers[B]!==h[B]&&(I=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==l||I||this.boundIndexBuffer!==m||this.boundVertexOffset!==y||this.boundDynamicVertexBuffer!==S||this.boundDynamicVertexBuffer2!==M||this.boundDynamicVertexBuffer3!==R?this.freshBind(n,l,h,m,y,S,M,R):(e.bindVertexArray.set(this.vao),S&&S.bind(),m&&m.dynamicDraw&&m.bind(),M&&M.bind(),R&&R.bind())}freshBind(e,n,l,h,m,y,S,M){const R=e.numAttributes,I=this.context,B=I.gl;this.vao&&this.destroy(),this.vao=I.createVertexArray(),I.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=h,this.boundVertexOffset=m,this.boundDynamicVertexBuffer=y,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=M,n.enableAttributes(B,e);for(const O of l)O.enableAttributes(B,e);y&&y.enableAttributes(B,e),S&&S.enableAttributes(B,e),M&&M.enableAttributes(B,e),n.bind(),n.setVertexAttribPointers(B,e,m);for(const O of l)O.bind(),O.setVertexAttribPointers(B,e,m);y&&(y.bind(),y.setVertexAttribPointers(B,e,m)),h&&h.bind(),S&&(S.bind(),S.setVertexAttribPointers(B,e,m)),M&&(M.bind(),M.setVertexAttribPointers(B,e,m)),I.currentNumAttributes=R}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Yd=(f,e,n,l,h)=>({u_texture:0,u_ele_delta:f,u_fog_matrix:e,u_fog_color:n?n.properties.get("fog-color"):c.be.white,u_fog_ground_blend:n?n.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:h?0:n?n.calculateFogBlendOpacity(l):0,u_horizon_color:n?n.properties.get("horizon-color"):c.be.white,u_horizon_fog_blend:n?n.properties.get("horizon-fog-blend"):1,u_is_globe_mode:h?1:0}),Kd={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Xc(f){const e=[];for(let n=0;n<f.length;n++){if(f[n]===null)continue;const l=f[n].split(" ");e.push(l.pop())}return e}class Yc{constructor(e,n,l,h,m,y,S,M,R=[]){const I=e.gl;this.program=I.createProgram();const B=Xc(n.staticAttributes),O=l?l.getBinderAttributes():[],j=B.concat(O),Z=Va.prelude.staticUniforms?Xc(Va.prelude.staticUniforms):[],ie=S.staticUniforms?Xc(S.staticUniforms):[],te=n.staticUniforms?Xc(n.staticUniforms):[],ne=l?l.getBinderUniforms():[],se=Z.concat(ie).concat(te).concat(ne),ue=[];for(const Re of se)ue.indexOf(Re)<0&&ue.push(Re);const oe=l?l.defines():[];Sn(I)&&oe.unshift("#version 300 es"),m&&oe.push("#define OVERDRAW_INSPECTOR;"),y&&oe.push("#define TERRAIN3D;"),M&&oe.push(M),R&&oe.push(...R);let pe=oe.concat(Va.prelude.fragmentSource,S.fragmentSource,n.fragmentSource).join(`
`),ge=oe.concat(Va.prelude.vertexSource,S.vertexSource,n.vertexSource).join(`
`);Sn(I)||(pe=function(Re){return Re.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(pe),ge=function(Re){return Re.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(ge));const le=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);if(I.shaderSource(le,pe),I.compileShader(le),!I.getShaderParameter(le,I.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${I.getShaderInfoLog(le)}`);I.attachShader(this.program,le);const we=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);if(I.shaderSource(we,ge),I.compileShader(we),!I.getShaderParameter(we,I.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${I.getShaderInfoLog(we)}`);I.attachShader(this.program,we),this.attributes={};const Oe={};this.numAttributes=j.length;for(let Re=0;Re<this.numAttributes;Re++)j[Re]&&(I.bindAttribLocation(this.program,Re,j[Re]),this.attributes[j[Re]]=Re);if(I.linkProgram(this.program),!I.getProgramParameter(this.program,I.LINK_STATUS))throw new Error(`Program failed to link: ${I.getProgramInfoLog(this.program)}`);I.deleteShader(we),I.deleteShader(le);for(let Re=0;Re<ue.length;Re++){const De=ue[Re];if(De&&!Oe[De]){const Be=I.getUniformLocation(this.program,De);Be&&(Oe[De]=Be)}}this.fixedUniforms=h(e,Oe),this.terrainUniforms=((Re,De)=>({u_depth:new c.bO(Re,De.u_depth),u_terrain:new c.bO(Re,De.u_terrain),u_terrain_dim:new c.bf(Re,De.u_terrain_dim),u_terrain_matrix:new c.bQ(Re,De.u_terrain_matrix),u_terrain_unpack:new c.bR(Re,De.u_terrain_unpack),u_terrain_exaggeration:new c.bf(Re,De.u_terrain_exaggeration)}))(e,Oe),this.projectionUniforms=((Re,De)=>({u_projection_matrix:new c.bQ(Re,De.u_projection_matrix),u_projection_tile_mercator_coords:new c.bR(Re,De.u_projection_tile_mercator_coords),u_projection_clipping_plane:new c.bR(Re,De.u_projection_clipping_plane),u_projection_transition:new c.bf(Re,De.u_projection_transition),u_projection_fallback_matrix:new c.bQ(Re,De.u_projection_fallback_matrix)}))(e,Oe),this.binderUniforms=l?l.getUniforms(e,Oe):[]}draw(e,n,l,h,m,y,S,M,R,I,B,O,j,Z,ie,te,ne,se,ue){const oe=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(l),e.setStencilMode(h),e.setColorMode(m),e.setCullFace(y),M){e.activeTexture.set(oe.TEXTURE2),oe.bindTexture(oe.TEXTURE_2D,M.depthTexture),e.activeTexture.set(oe.TEXTURE3),oe.bindTexture(oe.TEXTURE_2D,M.texture);for(const ge in this.terrainUniforms)this.terrainUniforms[ge].set(M[ge])}if(R)for(const ge in R)this.projectionUniforms[Kd[ge]].set(R[ge]);if(S)for(const ge in this.fixedUniforms)this.fixedUniforms[ge].set(S[ge]);te&&te.setUniforms(e,this.binderUniforms,Z,{zoom:ie});let pe=0;switch(n){case oe.LINES:pe=2;break;case oe.TRIANGLES:pe=3;break;case oe.LINE_STRIP:pe=1}for(const ge of j.get()){const le=ge.vaos||(ge.vaos={});(le[I]||(le[I]=new Xd)).bind(e,this,B,te?te.getPaintVertexBuffers():[],O,ge.vertexOffset,ne,se,ue),oe.drawElements(n,ge.primitiveLength*pe,oe.UNSIGNED_SHORT,ge.primitiveOffset*pe*2)}}}function yl(f,e,n){const l=1/c.aB(n,1,e.transform.tileZoom),h=Math.pow(2,n.tileID.overscaledZ),m=n.tileSize*Math.pow(2,e.transform.tileZoom)/h,y=m*(n.tileID.canonical.x+n.tileID.wrap*h),S=m*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[l,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[y>>16,S>>16],u_pixel_coord_lower:[65535&y,65535&S]}}const gs=(f,e,n,l)=>{const h=f.style.light,m=h.properties.get("position"),y=[m.x,m.y,m.z],S=c.bU();h.properties.get("anchor")==="viewport"&&c.bV(S,f.transform.bearingInRadians),c.bW(y,y,S);const M=f.transform.transformLightDirection(y),R=h.properties.get("color");return{u_lightpos:y,u_lightpos_globe:M,u_lightintensity:h.properties.get("intensity"),u_lightcolor:[R.r,R.g,R.b],u_vertical_gradient:+e,u_opacity:n,u_fill_translate:l}},Zu=(f,e,n,l,h,m,y)=>c.e(gs(f,e,n,l),yl(m,f,y),{u_height_factor:-Math.pow(2,h.overscaledZ)/y.tileSize/8}),cc=(f,e,n,l)=>c.e(yl(e,f,n),{u_fill_translate:l}),Aa=(f,e)=>({u_world:f,u_fill_translate:e}),Xh=(f,e,n,l,h)=>c.e(cc(f,e,n,h),{u_world:l}),Kc=(f,e,n,l,h)=>{const m=f.transform;let y,S,M=0;if(n.paint.get("circle-pitch-alignment")==="map"){const R=c.aB(e,1,m.zoom);y=!0,S=[R,R],M=R/(c.$*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*h}else y=!1,S=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(n.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+y,u_device_pixel_ratio:f.pixelRatio,u_extrude_scale:S,u_globe_extrude_scale:M,u_translate:l}},vl=f=>({u_pixel_extrude_scale:[1/f.width,1/f.height]}),$a=f=>({u_viewport_size:[f.width,f.height]}),Yh=(f,e=1)=>({u_color:f,u_overlay:0,u_overlay_scale:e}),uc=(f,e,n,l)=>{const h=c.aB(f,1,e)/(c.$*Math.pow(2,f.tileID.overscaledZ))*2*Math.PI*l;return{u_extrude_scale:c.aB(f,1,e),u_intensity:n,u_globe_extrude_scale:h}},Kh=(f,e,n,l)=>{const h=c.L();c.bX(h,0,f.width,f.height,0,0,1);const m=f.context.gl;return{u_matrix:h,u_world:[m.drawingBufferWidth,m.drawingBufferHeight],u_image:n,u_color_ramp:l,u_opacity:e.paint.get("heatmap-opacity")}},So=(f,e,n)=>{const l=n.paint.get("hillshade-accent-color");let h;switch(n.paint.get("hillshade-method")){case"basic":h=4;break;case"combined":h=1;break;case"igor":h=2;break;case"multidirectional":h=3;break;default:h=0}const m=n.getIlluminationProperties();for(let y=0;y<m.directionRadians.length;y++)n.paint.get("hillshade-illumination-anchor")==="viewport"&&(m.directionRadians[y]+=f.transform.bearingInRadians);return{u_image:0,u_latrange:xl(0,e.tileID),u_exaggeration:n.paint.get("hillshade-exaggeration"),u_altitudes:m.altitudeRadians,u_azimuths:m.directionRadians,u_accent:l,u_method:h,u_highlights:m.highlightColor,u_shadows:m.shadowColor}},Wh=(f,e)=>{const n=e.stride,l=c.L();return c.bX(l,0,c.$,-c.$,0,0,1),c.M(l,l,[0,-c.$,0]),{u_matrix:l,u_image:1,u_dimension:[n,n],u_zoom:f.overscaledZ,u_unpack:e.getUnpackVector()}};function xl(f,e){const n=Math.pow(2,e.canonical.z),l=e.canonical.y;return[new c.a0(0,l/n).toLngLat().lat,new c.a0(0,(l+1)/n).toLngLat().lat]}const hc=(f,e,n=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:n,u_opacity:f.paint.get("color-relief-opacity")}),Wc=(f,e,n,l)=>{const h=f.transform;return{u_translation:fc(f,e,n),u_ratio:l/c.aB(e,1,h.zoom),u_device_pixel_ratio:f.pixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},bl=(f,e,n,l,h)=>c.e(Wc(f,e,n,l),{u_image:0,u_image_height:h}),$u=(f,e,n,l,h)=>{const m=f.transform,y=dc(e,m);return{u_translation:fc(f,e,n),u_texsize:e.imageAtlasTexture.size,u_ratio:l/c.aB(e,1,m.zoom),u_device_pixel_ratio:f.pixelRatio,u_image:0,u_scale:[y,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Hu=(f,e,n,l,h,m)=>{const y=f.lineAtlas,S=dc(e,f.transform),M=n.layout.get("line-cap")==="round",R=y.getDash(h.from,M),I=y.getDash(h.to,M),B=R.width*m.fromScale,O=I.width*m.toScale;return c.e(Wc(f,e,n,l),{u_patternscale_a:[S/B,-R.height/2],u_patternscale_b:[S/O,-I.height/2],u_sdfgamma:y.width/(256*Math.min(B,O)*f.pixelRatio)/2,u_image:0,u_tex_y_a:R.y,u_tex_y_b:I.y,u_mix:m.t})};function dc(f,e){return 1/c.aB(f,1,e.tileZoom)}function fc(f,e,n){return c.aC(f.transform,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Us=(f,e,n,l,h)=>{return{u_tl_parent:f,u_scale_parent:e,u_buffer_scale:1,u_fade_t:n.mix,u_opacity:n.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(y=l.paint.get("raster-saturation"),y>0?1-1/(1.001-y):-y),u_contrast_factor:(m=l.paint.get("raster-contrast"),m>0?1/(1-m):1+m),u_spin_weights:Xu(l.paint.get("raster-hue-rotate")),u_coords_top:[h[0].x,h[0].y,h[1].x,h[1].y],u_coords_bottom:[h[3].x,h[3].y,h[2].x,h[2].y]};var m,y};function Xu(f){f*=Math.PI/180;const e=Math.sin(f),n=Math.cos(f);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}const Qc=(f,e,n,l,h,m,y,S,M,R,I,B,O)=>{const j=y.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:j.cameraToCenterDistance,u_pitch:j.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:j.width/j.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_label_plane_matrix:S,u_coord_matrix:M,u_is_text:+I,u_pitch_with_map:+l,u_is_along_line:h,u_is_variable_anchor:m,u_texsize:B,u_texture:0,u_translation:R,u_pitched_scale:O}},wl=(f,e,n,l,h,m,y,S,M,R,I,B,O,j)=>{const Z=y.transform;return c.e(Qc(f,e,n,l,h,m,y,S,M,R,I,B,j),{u_gamma_scale:l?Math.cos(Z.pitch*Math.PI/180)*Z.cameraToCenterDistance:1,u_device_pixel_ratio:y.pixelRatio,u_is_halo:1})},Wd=(f,e,n,l,h,m,y,S,M,R,I,B,O)=>c.e(wl(f,e,n,l,h,m,y,S,M,R,!0,I,0,O),{u_texsize_icon:B,u_texture_icon:1}),Jc=(f,e)=>({u_opacity:f,u_color:e}),Qd=(f,e,n,l,h)=>c.e(function(m,y,S,M){const R=S.imageManager.getPattern(m.from.toString()),I=S.imageManager.getPattern(m.to.toString()),{width:B,height:O}=S.imageManager.getPixelSize(),j=Math.pow(2,M.tileID.overscaledZ),Z=M.tileSize*Math.pow(2,S.transform.tileZoom)/j,ie=Z*(M.tileID.canonical.x+M.tileID.wrap*j),te=Z*M.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:R.tl,u_pattern_br_a:R.br,u_pattern_tl_b:I.tl,u_pattern_br_b:I.br,u_texsize:[B,O],u_mix:y.t,u_pattern_size_a:R.displaySize,u_pattern_size_b:I.displaySize,u_scale_a:y.fromScale,u_scale_b:y.toScale,u_tile_units_to_pixels:1/c.aB(M,1,S.transform.tileZoom),u_pixel_coord_upper:[ie>>16,te>>16],u_pixel_coord_lower:[65535&ie,65535&te]}}(n,h,e,l),{u_opacity:f}),Qh=(f,e)=>{},kr={fillExtrusion:(f,e)=>({u_lightpos:new c.bS(f,e.u_lightpos),u_lightpos_globe:new c.bS(f,e.u_lightpos_globe),u_lightintensity:new c.bf(f,e.u_lightintensity),u_lightcolor:new c.bS(f,e.u_lightcolor),u_vertical_gradient:new c.bf(f,e.u_vertical_gradient),u_opacity:new c.bf(f,e.u_opacity),u_fill_translate:new c.bT(f,e.u_fill_translate)}),fillExtrusionPattern:(f,e)=>({u_lightpos:new c.bS(f,e.u_lightpos),u_lightpos_globe:new c.bS(f,e.u_lightpos_globe),u_lightintensity:new c.bf(f,e.u_lightintensity),u_lightcolor:new c.bS(f,e.u_lightcolor),u_vertical_gradient:new c.bf(f,e.u_vertical_gradient),u_height_factor:new c.bf(f,e.u_height_factor),u_opacity:new c.bf(f,e.u_opacity),u_fill_translate:new c.bT(f,e.u_fill_translate),u_image:new c.bO(f,e.u_image),u_texsize:new c.bT(f,e.u_texsize),u_pixel_coord_upper:new c.bT(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.bT(f,e.u_pixel_coord_lower),u_scale:new c.bS(f,e.u_scale),u_fade:new c.bf(f,e.u_fade)}),fill:(f,e)=>({u_fill_translate:new c.bT(f,e.u_fill_translate)}),fillPattern:(f,e)=>({u_image:new c.bO(f,e.u_image),u_texsize:new c.bT(f,e.u_texsize),u_pixel_coord_upper:new c.bT(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.bT(f,e.u_pixel_coord_lower),u_scale:new c.bS(f,e.u_scale),u_fade:new c.bf(f,e.u_fade),u_fill_translate:new c.bT(f,e.u_fill_translate)}),fillOutline:(f,e)=>({u_world:new c.bT(f,e.u_world),u_fill_translate:new c.bT(f,e.u_fill_translate)}),fillOutlinePattern:(f,e)=>({u_world:new c.bT(f,e.u_world),u_image:new c.bO(f,e.u_image),u_texsize:new c.bT(f,e.u_texsize),u_pixel_coord_upper:new c.bT(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.bT(f,e.u_pixel_coord_lower),u_scale:new c.bS(f,e.u_scale),u_fade:new c.bf(f,e.u_fade),u_fill_translate:new c.bT(f,e.u_fill_translate)}),circle:(f,e)=>({u_camera_to_center_distance:new c.bf(f,e.u_camera_to_center_distance),u_scale_with_map:new c.bO(f,e.u_scale_with_map),u_pitch_with_map:new c.bO(f,e.u_pitch_with_map),u_extrude_scale:new c.bT(f,e.u_extrude_scale),u_device_pixel_ratio:new c.bf(f,e.u_device_pixel_ratio),u_globe_extrude_scale:new c.bf(f,e.u_globe_extrude_scale),u_translate:new c.bT(f,e.u_translate)}),collisionBox:(f,e)=>({u_pixel_extrude_scale:new c.bT(f,e.u_pixel_extrude_scale)}),collisionCircle:(f,e)=>({u_viewport_size:new c.bT(f,e.u_viewport_size)}),debug:(f,e)=>({u_color:new c.bP(f,e.u_color),u_overlay:new c.bO(f,e.u_overlay),u_overlay_scale:new c.bf(f,e.u_overlay_scale)}),depth:Qh,clippingMask:Qh,heatmap:(f,e)=>({u_extrude_scale:new c.bf(f,e.u_extrude_scale),u_intensity:new c.bf(f,e.u_intensity),u_globe_extrude_scale:new c.bf(f,e.u_globe_extrude_scale)}),heatmapTexture:(f,e)=>({u_matrix:new c.bQ(f,e.u_matrix),u_world:new c.bT(f,e.u_world),u_image:new c.bO(f,e.u_image),u_color_ramp:new c.bO(f,e.u_color_ramp),u_opacity:new c.bf(f,e.u_opacity)}),hillshade:(f,e)=>({u_image:new c.bO(f,e.u_image),u_latrange:new c.bT(f,e.u_latrange),u_exaggeration:new c.bf(f,e.u_exaggeration),u_altitudes:new c.bZ(f,e.u_altitudes),u_azimuths:new c.bZ(f,e.u_azimuths),u_accent:new c.bP(f,e.u_accent),u_method:new c.bO(f,e.u_method),u_shadows:new c.bY(f,e.u_shadows),u_highlights:new c.bY(f,e.u_highlights)}),hillshadePrepare:(f,e)=>({u_matrix:new c.bQ(f,e.u_matrix),u_image:new c.bO(f,e.u_image),u_dimension:new c.bT(f,e.u_dimension),u_zoom:new c.bf(f,e.u_zoom),u_unpack:new c.bR(f,e.u_unpack)}),colorRelief:(f,e)=>({u_image:new c.bO(f,e.u_image),u_unpack:new c.bR(f,e.u_unpack),u_dimension:new c.bT(f,e.u_dimension),u_elevation_stops:new c.bO(f,e.u_elevation_stops),u_color_stops:new c.bO(f,e.u_color_stops),u_color_ramp_size:new c.bO(f,e.u_color_ramp_size),u_opacity:new c.bf(f,e.u_opacity)}),line:(f,e)=>({u_translation:new c.bT(f,e.u_translation),u_ratio:new c.bf(f,e.u_ratio),u_device_pixel_ratio:new c.bf(f,e.u_device_pixel_ratio),u_units_to_pixels:new c.bT(f,e.u_units_to_pixels)}),lineGradient:(f,e)=>({u_translation:new c.bT(f,e.u_translation),u_ratio:new c.bf(f,e.u_ratio),u_device_pixel_ratio:new c.bf(f,e.u_device_pixel_ratio),u_units_to_pixels:new c.bT(f,e.u_units_to_pixels),u_image:new c.bO(f,e.u_image),u_image_height:new c.bf(f,e.u_image_height)}),linePattern:(f,e)=>({u_translation:new c.bT(f,e.u_translation),u_texsize:new c.bT(f,e.u_texsize),u_ratio:new c.bf(f,e.u_ratio),u_device_pixel_ratio:new c.bf(f,e.u_device_pixel_ratio),u_image:new c.bO(f,e.u_image),u_units_to_pixels:new c.bT(f,e.u_units_to_pixels),u_scale:new c.bS(f,e.u_scale),u_fade:new c.bf(f,e.u_fade)}),lineSDF:(f,e)=>({u_translation:new c.bT(f,e.u_translation),u_ratio:new c.bf(f,e.u_ratio),u_device_pixel_ratio:new c.bf(f,e.u_device_pixel_ratio),u_units_to_pixels:new c.bT(f,e.u_units_to_pixels),u_patternscale_a:new c.bT(f,e.u_patternscale_a),u_patternscale_b:new c.bT(f,e.u_patternscale_b),u_sdfgamma:new c.bf(f,e.u_sdfgamma),u_image:new c.bO(f,e.u_image),u_tex_y_a:new c.bf(f,e.u_tex_y_a),u_tex_y_b:new c.bf(f,e.u_tex_y_b),u_mix:new c.bf(f,e.u_mix)}),raster:(f,e)=>({u_tl_parent:new c.bT(f,e.u_tl_parent),u_scale_parent:new c.bf(f,e.u_scale_parent),u_buffer_scale:new c.bf(f,e.u_buffer_scale),u_fade_t:new c.bf(f,e.u_fade_t),u_opacity:new c.bf(f,e.u_opacity),u_image0:new c.bO(f,e.u_image0),u_image1:new c.bO(f,e.u_image1),u_brightness_low:new c.bf(f,e.u_brightness_low),u_brightness_high:new c.bf(f,e.u_brightness_high),u_saturation_factor:new c.bf(f,e.u_saturation_factor),u_contrast_factor:new c.bf(f,e.u_contrast_factor),u_spin_weights:new c.bS(f,e.u_spin_weights),u_coords_top:new c.bR(f,e.u_coords_top),u_coords_bottom:new c.bR(f,e.u_coords_bottom)}),symbolIcon:(f,e)=>({u_is_size_zoom_constant:new c.bO(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bO(f,e.u_is_size_feature_constant),u_size_t:new c.bf(f,e.u_size_t),u_size:new c.bf(f,e.u_size),u_camera_to_center_distance:new c.bf(f,e.u_camera_to_center_distance),u_pitch:new c.bf(f,e.u_pitch),u_rotate_symbol:new c.bO(f,e.u_rotate_symbol),u_aspect_ratio:new c.bf(f,e.u_aspect_ratio),u_fade_change:new c.bf(f,e.u_fade_change),u_label_plane_matrix:new c.bQ(f,e.u_label_plane_matrix),u_coord_matrix:new c.bQ(f,e.u_coord_matrix),u_is_text:new c.bO(f,e.u_is_text),u_pitch_with_map:new c.bO(f,e.u_pitch_with_map),u_is_along_line:new c.bO(f,e.u_is_along_line),u_is_variable_anchor:new c.bO(f,e.u_is_variable_anchor),u_texsize:new c.bT(f,e.u_texsize),u_texture:new c.bO(f,e.u_texture),u_translation:new c.bT(f,e.u_translation),u_pitched_scale:new c.bf(f,e.u_pitched_scale)}),symbolSDF:(f,e)=>({u_is_size_zoom_constant:new c.bO(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bO(f,e.u_is_size_feature_constant),u_size_t:new c.bf(f,e.u_size_t),u_size:new c.bf(f,e.u_size),u_camera_to_center_distance:new c.bf(f,e.u_camera_to_center_distance),u_pitch:new c.bf(f,e.u_pitch),u_rotate_symbol:new c.bO(f,e.u_rotate_symbol),u_aspect_ratio:new c.bf(f,e.u_aspect_ratio),u_fade_change:new c.bf(f,e.u_fade_change),u_label_plane_matrix:new c.bQ(f,e.u_label_plane_matrix),u_coord_matrix:new c.bQ(f,e.u_coord_matrix),u_is_text:new c.bO(f,e.u_is_text),u_pitch_with_map:new c.bO(f,e.u_pitch_with_map),u_is_along_line:new c.bO(f,e.u_is_along_line),u_is_variable_anchor:new c.bO(f,e.u_is_variable_anchor),u_texsize:new c.bT(f,e.u_texsize),u_texture:new c.bO(f,e.u_texture),u_gamma_scale:new c.bf(f,e.u_gamma_scale),u_device_pixel_ratio:new c.bf(f,e.u_device_pixel_ratio),u_is_halo:new c.bO(f,e.u_is_halo),u_translation:new c.bT(f,e.u_translation),u_pitched_scale:new c.bf(f,e.u_pitched_scale)}),symbolTextAndIcon:(f,e)=>({u_is_size_zoom_constant:new c.bO(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bO(f,e.u_is_size_feature_constant),u_size_t:new c.bf(f,e.u_size_t),u_size:new c.bf(f,e.u_size),u_camera_to_center_distance:new c.bf(f,e.u_camera_to_center_distance),u_pitch:new c.bf(f,e.u_pitch),u_rotate_symbol:new c.bO(f,e.u_rotate_symbol),u_aspect_ratio:new c.bf(f,e.u_aspect_ratio),u_fade_change:new c.bf(f,e.u_fade_change),u_label_plane_matrix:new c.bQ(f,e.u_label_plane_matrix),u_coord_matrix:new c.bQ(f,e.u_coord_matrix),u_is_text:new c.bO(f,e.u_is_text),u_pitch_with_map:new c.bO(f,e.u_pitch_with_map),u_is_along_line:new c.bO(f,e.u_is_along_line),u_is_variable_anchor:new c.bO(f,e.u_is_variable_anchor),u_texsize:new c.bT(f,e.u_texsize),u_texsize_icon:new c.bT(f,e.u_texsize_icon),u_texture:new c.bO(f,e.u_texture),u_texture_icon:new c.bO(f,e.u_texture_icon),u_gamma_scale:new c.bf(f,e.u_gamma_scale),u_device_pixel_ratio:new c.bf(f,e.u_device_pixel_ratio),u_is_halo:new c.bO(f,e.u_is_halo),u_translation:new c.bT(f,e.u_translation),u_pitched_scale:new c.bf(f,e.u_pitched_scale)}),background:(f,e)=>({u_opacity:new c.bf(f,e.u_opacity),u_color:new c.bP(f,e.u_color)}),backgroundPattern:(f,e)=>({u_opacity:new c.bf(f,e.u_opacity),u_image:new c.bO(f,e.u_image),u_pattern_tl_a:new c.bT(f,e.u_pattern_tl_a),u_pattern_br_a:new c.bT(f,e.u_pattern_br_a),u_pattern_tl_b:new c.bT(f,e.u_pattern_tl_b),u_pattern_br_b:new c.bT(f,e.u_pattern_br_b),u_texsize:new c.bT(f,e.u_texsize),u_mix:new c.bf(f,e.u_mix),u_pattern_size_a:new c.bT(f,e.u_pattern_size_a),u_pattern_size_b:new c.bT(f,e.u_pattern_size_b),u_scale_a:new c.bf(f,e.u_scale_a),u_scale_b:new c.bf(f,e.u_scale_b),u_pixel_coord_upper:new c.bT(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.bT(f,e.u_pixel_coord_lower),u_tile_units_to_pixels:new c.bf(f,e.u_tile_units_to_pixels)}),terrain:(f,e)=>({u_texture:new c.bO(f,e.u_texture),u_ele_delta:new c.bf(f,e.u_ele_delta),u_fog_matrix:new c.bQ(f,e.u_fog_matrix),u_fog_color:new c.bP(f,e.u_fog_color),u_fog_ground_blend:new c.bf(f,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.bf(f,e.u_fog_ground_blend_opacity),u_horizon_color:new c.bP(f,e.u_horizon_color),u_horizon_fog_blend:new c.bf(f,e.u_horizon_fog_blend),u_is_globe_mode:new c.bf(f,e.u_is_globe_mode)}),terrainDepth:(f,e)=>({u_ele_delta:new c.bf(f,e.u_ele_delta)}),terrainCoords:(f,e)=>({u_texture:new c.bO(f,e.u_texture),u_terrain_coords_id:new c.bf(f,e.u_terrain_coords_id),u_ele_delta:new c.bf(f,e.u_ele_delta)}),projectionErrorMeasurement:(f,e)=>({u_input:new c.bf(f,e.u_input),u_output_expected:new c.bf(f,e.u_output_expected)}),atmosphere:(f,e)=>({u_sun_pos:new c.bS(f,e.u_sun_pos),u_atmosphere_blend:new c.bf(f,e.u_atmosphere_blend),u_globe_position:new c.bS(f,e.u_globe_position),u_globe_radius:new c.bf(f,e.u_globe_radius),u_inv_proj_matrix:new c.bQ(f,e.u_inv_proj_matrix)}),sky:(f,e)=>({u_sky_color:new c.bP(f,e.u_sky_color),u_horizon_color:new c.bP(f,e.u_horizon_color),u_horizon:new c.bT(f,e.u_horizon),u_horizon_normal:new c.bT(f,e.u_horizon_normal),u_sky_horizon_blend:new c.bf(f,e.u_sky_horizon_blend),u_sky_blend:new c.bf(f,e.u_sky_blend)})};class Sl{constructor(e,n,l){this.context=e;const h=e.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Yu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class eu{constructor(e,n,l,h){this.length=n.length,this.attributes=l,this.itemSize=n.bytesPerElement,this.dynamicDraw=h,this.context=e;const m=e.gl;this.buffer=m.createBuffer(),e.bindVertexBuffer.set(this.buffer),m.bufferData(m.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,n){for(let l=0;l<this.attributes.length;l++){const h=n.attributes[this.attributes[l].name];h!==void 0&&e.enableVertexAttribArray(h)}}setVertexAttribPointers(e,n,l){for(let h=0;h<this.attributes.length;h++){const m=this.attributes[h],y=n.attributes[m.name];y!==void 0&&e.vertexAttribPointer(y,m.components,e[Yu[m.type]],!1,this.itemSize,m.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class vi{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class pc extends vi{getDefault(){return c.be.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class za extends vi{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Ku extends vi{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Vs extends vi{getDefault(){return[!0,!0,!0,!0]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class mc extends vi{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Tl extends vi{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class gc extends vi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const n=this.current;(e.func!==n.func||e.ref!==n.ref||e.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Gs extends vi{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class _s extends vi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=e,this.dirty=!1}}class Ml extends vi{getDefault(){return[0,1]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Wu extends vi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=e,this.dirty=!1}}class Jh extends vi{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class To extends vi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.BLEND):n.disable(n.BLEND),this.current=e,this.dirty=!1}}class Qu extends vi{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class ed extends vi{getDefault(){return c.be.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ju extends vi{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class tu extends vi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=e,this.dirty=!1}}class iu extends vi{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class nu extends vi{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class ru extends vi{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class qs extends vi{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Mo extends vi{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class pr extends vi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Hr extends vi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Xr extends vi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Yr extends vi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Zs extends vi{getDefault(){return null}set(e){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ys extends vi{getDefault(){return null}set(e){var n;if(e===this.current&&!this.dirty)return;const l=this.gl;Sn(l)?l.bindVertexArray(e):(n=l.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Eo extends vi{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Co extends vi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Ao extends vi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Pa extends vi{constructor(e,n){super(e),this.context=e,this.parent=n}getDefault(){return null}}class eh extends Pa{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class vs extends Pa{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ra extends Pa{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const th="Framebuffer is not complete";class Sr{constructor(e,n,l,h,m){this.context=e,this.width=n,this.height=l;const y=e.gl,S=this.framebuffer=y.createFramebuffer();if(this.colorAttachment=new eh(e,S),h)this.depthAttachment=m?new Ra(e,S):new vs(e,S);else if(m)throw new Error("Stencil cannot be set without depth");if(y.checkFramebufferStatus(y.FRAMEBUFFER)!==y.FRAMEBUFFER_COMPLETE)throw new Error(th)}destroy(){const e=this.context.gl,n=this.colorAttachment.get();if(n&&e.deleteTexture(n),this.depthAttachment){const l=this.depthAttachment.get();l&&e.deleteRenderbuffer(l)}e.deleteFramebuffer(this.framebuffer)}}class ti{constructor(e){var n,l;if(this.gl=e,this.clearColor=new pc(this),this.clearDepth=new za(this),this.clearStencil=new Ku(this),this.colorMask=new Vs(this),this.depthMask=new mc(this),this.stencilMask=new Tl(this),this.stencilFunc=new gc(this),this.stencilOp=new Gs(this),this.stencilTest=new _s(this),this.depthRange=new Ml(this),this.depthTest=new Wu(this),this.depthFunc=new Jh(this),this.blend=new To(this),this.blendFunc=new Qu(this),this.blendColor=new ed(this),this.blendEquation=new Ju(this),this.cullFace=new tu(this),this.cullFaceSide=new iu(this),this.frontFace=new nu(this),this.program=new ru(this),this.activeTexture=new qs(this),this.viewport=new Mo(this),this.bindFramebuffer=new pr(this),this.bindRenderbuffer=new Hr(this),this.bindTexture=new Xr(this),this.bindVertexBuffer=new Yr(this),this.bindElementBuffer=new Zs(this),this.bindVertexArray=new ys(this),this.pixelStoreUnpack=new Eo(this),this.pixelStoreUnpackPremultiplyAlpha=new Co(this),this.pixelStoreUnpackFlipY=new Ao(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Sn(e)){this.HALF_FLOAT=e.HALF_FLOAT;const h=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=e.RGBA16F)!==null&&n!==void 0?n:h==null?void 0:h.RGBA16F_EXT,this.RGB16F=(l=e.RGB16F)!==null&&l!==void 0?l:h==null?void 0:h.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const h=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=h==null?void 0:h.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,n){return new Sl(this,e,n)}createVertexBuffer(e,n,l){return new eu(this,e,n,l)}createRenderbuffer(e,n,l){const h=this.gl,m=h.createRenderbuffer();return this.bindRenderbuffer.set(m),h.renderbufferStorage(h.RENDERBUFFER,e,n,l),this.bindRenderbuffer.set(null),m}createFramebuffer(e,n,l,h){return new Sr(this,e,n,l,h)}clear({color:e,depth:n,stencil:l}){const h=this.gl;let m=0;e&&(m|=h.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(m|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),l!==void 0&&(m|=h.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),h.clear(m)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){c.bG(e.blendFunction,si.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Sn(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var n;return Sn(this.gl)?this.gl.deleteVertexArray(e):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let Tr;function ih(f,e,n,l,h){const m=f.context,y=f.transform,S=m.gl,M=f.useProgram("collisionBox"),R=[];let I=0,B=0;for(let ne=0;ne<l.length;ne++){const se=l[ne],ue=e.getTile(se).getBucket(n);if(!ue)continue;const oe=h?ue.textCollisionBox:ue.iconCollisionBox,pe=ue.collisionCircleArray;pe.length>0&&(R.push({circleArray:pe,circleOffset:B,coord:se}),I+=pe.length/4,B=I),oe&&M.draw(m,S.LINES,Xt.disabled,Ft.disabled,f.colorModeForRenderPass(),$t.disabled,vl(f.transform),f.style.map.terrain&&f.style.map.terrain.getTerrainData(se),y.getProjectionData({overscaledTileID:se,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),n.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,null,f.transform.zoom,null,null,oe.collisionVertexBuffer)}if(!h||!R.length)return;const O=f.useProgram("collisionCircle"),j=new c.b_;j.resize(4*I),j._trim();let Z=0;for(const ne of R)for(let se=0;se<ne.circleArray.length/4;se++){const ue=4*se,oe=ne.circleArray[ue+0],pe=ne.circleArray[ue+1],ge=ne.circleArray[ue+2],le=ne.circleArray[ue+3];j.emplace(Z++,oe,pe,ge,le,0),j.emplace(Z++,oe,pe,ge,le,1),j.emplace(Z++,oe,pe,ge,le,2),j.emplace(Z++,oe,pe,ge,le,3)}(!Tr||Tr.length<2*I)&&(Tr=function(ne){const se=2*ne,ue=new c.c0;ue.resize(se),ue._trim();for(let oe=0;oe<se;oe++){const pe=6*oe;ue.uint16[pe+0]=4*oe+0,ue.uint16[pe+1]=4*oe+1,ue.uint16[pe+2]=4*oe+2,ue.uint16[pe+3]=4*oe+2,ue.uint16[pe+4]=4*oe+3,ue.uint16[pe+5]=4*oe+0}return ue}(I));const ie=m.createIndexBuffer(Tr,!0),te=m.createVertexBuffer(j,c.b$.members,!0);for(const ne of R){const se=$a(f.transform);O.draw(m,S.TRIANGLES,Xt.disabled,Ft.disabled,f.colorModeForRenderPass(),$t.disabled,se,f.style.map.terrain&&f.style.map.terrain.getTerrainData(ne.coord),null,n.id,te,ie,c.aL.simpleSegment(0,2*ne.circleOffset,ne.circleArray.length,ne.circleArray.length/2),null,f.transform.zoom,null,null,null)}te.destroy(),ie.destroy()}const _c=c.af(new Float32Array(16));function Da(f,e,n,l,h,m){const{horizontalAlign:y,verticalAlign:S}=c.aG(f);return new c.P((-(y-.5)*e/h+l[0])*m,(-(S-.5)*n/h+l[1])*m)}function nh(f,e,n,l,h,m){const y=e.tileAnchorPoint.add(new c.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let S=l.mult(m);n||(S=S.rotate(-h));const M=y.add(S);return ci(M.x,M.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(n){const S=ht(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(f),M=Math.atan(S.y/S.x)+(S.x<0?Math.PI:0);return f.add(l.rotate(M))}return f.add(l)}function rh(f,e,n,l,h,m,y,S,M,R,I,B){const O=f.text.placedSymbolArray,j=f.text.dynamicLayoutVertexArray,Z=f.icon.dynamicLayoutVertexArray,ie={};j.clear();for(let te=0;te<O.length;te++){const ne=O.get(te),se=ne.hidden||!ne.crossTileID||f.allowVerticalPlacement&&!ne.placedOrientation?null:l[ne.crossTileID];if(se){const ue=new c.P(ne.anchorX,ne.anchorY),oe={getElevation:B,width:h.width,height:h.height,pitchedLabelPlaneMatrix:m,pitchWithMap:n,transform:h,tileAnchorPoint:ue,translation:R,unwrappedTileID:I},pe=n?Dt(ue.x,ue.y,oe):ht(ue.x,ue.y,oe),ge=Bt(h.cameraToCenterDistance,pe.signedDistanceFromCamera);let le=c.ao(f.textSizeData,S,ne)*ge/c.aA;n&&(le*=f.tilePixelRatio/y);const{width:we,height:Oe,anchor:Re,textOffset:De,textBoxScale:Be}=se,dt=Da(Re,we,Oe,De,Be,le),ut=h.getPitchedTextCorrection(ue.x+R[0],ue.y+R[1],I),it=nh(pe.point,oe,e,dt,-h.bearingInRadians,ut),wt=f.allowVerticalPlacement&&ne.placedOrientation===c.an.vertical?Math.PI/2:0;for(let Wt=0;Wt<ne.numGlyphs;Wt++)c.au(j,it,wt);M&&ne.associatedIconIndex>=0&&(ie[ne.associatedIconIndex]={shiftedAnchor:it,angle:wt})}else hs(ne.numGlyphs,j)}if(M){Z.clear();const te=f.icon.placedSymbolArray;for(let ne=0;ne<te.length;ne++){const se=te.get(ne);if(se.hidden)hs(se.numGlyphs,Z);else{const ue=ie[ne];if(ue)for(let oe=0;oe<se.numGlyphs;oe++)c.au(Z,ue.shiftedAnchor,ue.angle);else hs(se.numGlyphs,Z)}}f.icon.dynamicLayoutVertexBuffer.updateData(Z)}f.text.dynamicLayoutVertexBuffer.updateData(j)}function zo(f,e,n){return n.iconsInText&&e?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function Po(f,e,n,l,h,m,y,S,M,R,I,B,O){const j=f.context,Z=j.gl,ie=f.transform,te=S==="map",ne=M==="map",se=S!=="viewport"&&n.layout.get("symbol-placement")!=="point",ue=te&&!ne&&!se,oe=!n.layout.get("symbol-sort-key").isConstant();let pe=!1;const ge=f.getDepthModeForSublayer(0,Xt.ReadOnly),le=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),we=[],Oe=ie.getCircleRadiusCorrection();for(const Re of l){const De=e.getTile(Re),Be=De.getBucket(n);if(!Be)continue;const dt=h?Be.text:Be.icon;if(!dt||!dt.segments.get().length||!dt.hasVisibleVertices)continue;const ut=dt.programConfigurations.get(n.id),it=h||Be.sdfIcons,wt=h?Be.textSizeData:Be.iconSizeData,Wt=ne||ie.pitch!==0,gi=f.useProgram(zo(it,h,Be),ut),sn=c.am(wt,ie.zoom),Ai=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Re);let un,zi,Pi,Ii,Gn=[0,0],hi=null;if(h)zi=De.glyphAtlasTexture,Pi=Z.LINEAR,un=De.glyphAtlasTexture.size,Be.iconsInText&&(Gn=De.imageAtlasTexture.size,hi=De.imageAtlasTexture,Ii=Wt||f.options.rotating||f.options.zooming||wt.kind==="composite"||wt.kind==="camera"?Z.LINEAR:Z.NEAREST);else{const Ui=n.layout.get("icon-size").constantOr(0)!==1||Be.iconsNeedLinear;zi=De.imageAtlasTexture,Pi=it||f.options.rotating||f.options.zooming||Ui||Wt?Z.LINEAR:Z.NEAREST,un=De.imageAtlasTexture.size}const qn=c.aB(De,1,f.transform.zoom),cr=kt(te,f.transform,qn),io=c.L();c.ap(io,cr);const Cs=ei(ne,te,f.transform,qn),pa=c.aC(ie,De,m,y),ma=ie.getProjectionData({overscaledTileID:Re,applyGlobeMatrix:!O,applyTerrainMatrix:!0}),no=le&&Be.hasTextData(),Il=n.layout.get("icon-text-fit")!=="none"&&no&&Be.hasIconData();if(se){const Ui=f.style.map.terrain?(tr,fn)=>f.style.map.terrain.getElevation(Re,tr,fn):null,Ri=n.layout.get("text-rotation-alignment")==="map";Wn(Be,f,h,cr,io,ne,R,Ri,Re.toUnwrapped(),ie.width,ie.height,pa,Ui)}const Go=h&&le||Il,ur=se||Go?_c:ne?cr:f.transform.clipSpaceToPixelsMatrix,ga=it&&n.paint.get(h?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let As;As=it?Be.iconsInText?Wd(wt.kind,sn,ue,ne,se,Go,f,ur,Cs,pa,un,Gn,Oe):wl(wt.kind,sn,ue,ne,se,Go,f,ur,Cs,pa,h,un,0,Oe):Qc(wt.kind,sn,ue,ne,se,Go,f,ur,Cs,pa,h,un,Oe);const qo={program:gi,buffers:dt,uniformValues:As,projectionData:ma,atlasTexture:zi,atlasTextureIcon:hi,atlasInterpolation:Pi,atlasInterpolationIcon:Ii,isSDF:it,hasHalo:ga};if(oe&&Be.canOverlap){pe=!0;const Ui=dt.segments.get();for(const Ri of Ui)we.push({segments:new c.aL([Ri]),sortKey:Ri.sortKey,state:qo,terrainData:Ai})}else we.push({segments:dt.segments,sortKey:0,state:qo,terrainData:Ai})}pe&&we.sort((Re,De)=>Re.sortKey-De.sortKey);for(const Re of we){const De=Re.state;if(j.activeTexture.set(Z.TEXTURE0),De.atlasTexture.bind(De.atlasInterpolation,Z.CLAMP_TO_EDGE),De.atlasTextureIcon&&(j.activeTexture.set(Z.TEXTURE1),De.atlasTextureIcon&&De.atlasTextureIcon.bind(De.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),De.isSDF){const Be=De.uniformValues;De.hasHalo&&(Be.u_is_halo=1,Ro(De.buffers,Re.segments,n,f,De.program,ge,I,B,Be,De.projectionData,Re.terrainData)),Be.u_is_halo=0}Ro(De.buffers,Re.segments,n,f,De.program,ge,I,B,De.uniformValues,De.projectionData,Re.terrainData)}}function Ro(f,e,n,l,h,m,y,S,M,R,I){const B=l.context;h.draw(B,B.gl.TRIANGLES,m,y,S,$t.backCCW,M,I,R,n.id,f.layoutVertexBuffer,f.indexBuffer,e,n.paint,l.transform.zoom,f.programConfigurations.get(n.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function Do(f,e,n,l,h){const m=f.context,y=m.gl,S=Ft.disabled,M=new si([y.ONE,y.ONE],c.be.transparent,[!0,!0,!0,!0]),R=e.getBucket(n);if(!R)return;const I=l.key;let B=n.heatmapFbos.get(I);B||(B=mr(m,e.tileSize,e.tileSize),n.heatmapFbos.set(I,B)),m.bindFramebuffer.set(B.framebuffer),m.viewport.set([0,0,e.tileSize,e.tileSize]),m.clear({color:c.be.transparent});const O=R.programConfigurations.get(n.id),j=f.useProgram("heatmap",O,!h),Z=f.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ie=f.style.map.terrain.getTerrainData(l);j.draw(m,y.TRIANGLES,Xt.disabled,S,M,$t.disabled,uc(e,f.transform.zoom,n.paint.get("heatmap-intensity"),1),ie,Z,n.id,R.layoutVertexBuffer,R.indexBuffer,R.segments,n.paint,f.transform.zoom,O)}function Mr(f,e,n,l,h){const m=f.context,y=m.gl,S=f.transform;m.setColorMode(f.colorModeForRenderPass());const M=Ha(m,e),R=n.key,I=e.heatmapFbos.get(R);if(!I)return;m.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,I.colorAttachment.get()),m.activeTexture.set(y.TEXTURE1),M.bind(y.LINEAR,y.CLAMP_TO_EDGE);const B=S.getProjectionData({overscaledTileID:n,applyTerrainMatrix:h,applyGlobeMatrix:!l});f.useProgram("heatmapTexture").draw(m,y.TRIANGLES,Xt.disabled,Ft.disabled,f.colorModeForRenderPass(),$t.disabled,Kh(f,e,0,1),null,B,e.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments,e.paint,S.zoom),I.destroy(),e.heatmapFbos.delete(R)}function mr(f,e,n){var l,h;const m=f.gl,y=m.createTexture();m.bindTexture(m.TEXTURE_2D,y),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.LINEAR);const S=(l=f.HALF_FLOAT)!==null&&l!==void 0?l:m.UNSIGNED_BYTE,M=(h=f.RGBA16F)!==null&&h!==void 0?h:m.RGBA;m.texImage2D(m.TEXTURE_2D,0,M,e,n,0,m.RGBA,S,null);const R=f.createFramebuffer(e,n,!1,!1);return R.colorAttachment.set(y),R}function Ha(f,e){return e.colorRampTexture||(e.colorRampTexture=new c.T(f,e.colorRamp,f.gl.RGBA)),e.colorRampTexture}function Ia(f,e,n,l,h){if(!n||!l||!l.imageAtlas)return;const m=l.imageAtlas.patternPositions;let y=m[n.to.toString()],S=m[n.from.toString()];if(!y&&S&&(y=S),!S&&y&&(S=y),!y||!S){const M=h.getPaintProperty(e);y=m[M],S=m[M]}y&&S&&f.setConstantPatternPositions(y,S)}function Kr(f,e,n,l,h,m,y,S){const M=f.context.gl,R="fill-pattern",I=n.paint.get(R),B=I&&I.constantOr(1),O=n.getCrossfadeParameters();let j,Z,ie,te,ne;const se=f.transform,ue=n.paint.get("fill-translate"),oe=n.paint.get("fill-translate-anchor");y?(Z=B&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",j=M.LINES):(Z=B?"fillPattern":"fill",j=M.TRIANGLES);const pe=I.constantOr(null);for(const ge of l){const le=e.getTile(ge);if(B&&!le.patternsLoaded())continue;const we=le.getBucket(n);if(!we)continue;const Oe=we.programConfigurations.get(n.id),Re=f.useProgram(Z,Oe),De=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ge);B&&(f.context.activeTexture.set(M.TEXTURE0),le.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),Oe.updatePaintBuffers(O)),Ia(Oe,R,pe,le,n);const Be=se.getProjectionData({overscaledTileID:ge,applyGlobeMatrix:!S,applyTerrainMatrix:!0}),dt=c.aC(se,le,ue,oe);if(y){te=we.indexBuffer2,ne=we.segments2;const it=[M.drawingBufferWidth,M.drawingBufferHeight];ie=Z==="fillOutlinePattern"&&B?Xh(f,O,le,it,dt):Aa(it,dt)}else te=we.indexBuffer,ne=we.segments,ie=B?cc(f,O,le,dt):{u_fill_translate:dt};const ut=f.stencilModeForClipping(ge);Re.draw(f.context,j,h,ut,m,$t.backCCW,ie,De,Be,n.id,we.layoutVertexBuffer,te,ne,n.paint,f.transform.zoom,Oe)}}function ua(f,e,n,l,h,m,y,S){const M=f.context,R=M.gl,I="fill-extrusion-pattern",B=n.paint.get(I),O=B.constantOr(1),j=n.getCrossfadeParameters(),Z=n.paint.get("fill-extrusion-opacity"),ie=B.constantOr(null),te=f.transform;for(const ne of l){const se=e.getTile(ne),ue=se.getBucket(n);if(!ue)continue;const oe=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ne),pe=ue.programConfigurations.get(n.id),ge=f.useProgram(O?"fillExtrusionPattern":"fillExtrusion",pe);O&&(f.context.activeTexture.set(R.TEXTURE0),se.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),pe.updatePaintBuffers(j));const le=te.getProjectionData({overscaledTileID:ne,applyGlobeMatrix:!S,applyTerrainMatrix:!0});Ia(pe,I,ie,se,n);const we=c.aC(te,se,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),Oe=n.paint.get("fill-extrusion-vertical-gradient"),Re=O?Zu(f,Oe,Z,we,ne,j,se):gs(f,Oe,Z,we);ge.draw(M,M.gl.TRIANGLES,h,m,y,$t.backCCW,Re,oe,le,n.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,n.paint,f.transform.zoom,pe,f.style.map.terrain&&ue.centroidVertexBuffer)}}function Io(f,e,n,l,h,m,y,S,M){var R;const I=f.style.projection,B=f.context,O=f.transform,j=B.gl,Z=[`#define NUM_ILLUMINATION_SOURCES ${n.paint.get("hillshade-highlight-color").values.length}`],ie=f.useProgram("hillshade",null,!1,Z),te=!f.options.moving;for(const ne of l){const se=e.getTile(ne),ue=se.fbo;if(!ue)continue;const oe=I.getMeshFromTileID(B,ne.canonical,S,!0,"raster"),pe=(R=f.style.map.terrain)===null||R===void 0?void 0:R.getTerrainData(ne);B.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,ue.colorAttachment.get());const ge=O.getProjectionData({overscaledTileID:ne,aligned:te,applyGlobeMatrix:!M,applyTerrainMatrix:!0});ie.draw(B,j.TRIANGLES,m,h[ne.overscaledZ],y,$t.backCCW,So(f,se,n),pe,ge,n.id,oe.vertexBuffer,oe.indexBuffer,oe.segments)}}function ko(f,e,n,l,h,m,y,S,M){var R;const I=f.style.projection,B=f.context,O=f.transform,j=B.gl,Z=f.useProgram("colorRelief"),ie=!f.options.moving;let te=!0,ne=0;for(const se of l){const ue=e.getTile(se),oe=ue.dem;if(te){const Re=j.getParameter(j.MAX_TEXTURE_SIZE),{elevationTexture:De,colorTexture:Be}=n.getColorRampTextures(B,Re,oe.getUnpackVector());B.activeTexture.set(j.TEXTURE1),De.bind(j.NEAREST,j.CLAMP_TO_EDGE),B.activeTexture.set(j.TEXTURE4),Be.bind(j.LINEAR,j.CLAMP_TO_EDGE),te=!1,ne=De.size[0]}if(!oe||!oe.data)continue;const pe=oe.stride,ge=oe.getPixels();if(B.activeTexture.set(j.TEXTURE0),B.pixelStoreUnpackPremultiplyAlpha.set(!1),ue.demTexture=ue.demTexture||f.getTileTexture(pe),ue.demTexture){const Re=ue.demTexture;Re.update(ge,{premultiply:!1}),Re.bind(j.LINEAR,j.CLAMP_TO_EDGE)}else ue.demTexture=new c.T(B,ge,j.RGBA,{premultiply:!1}),ue.demTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const le=I.getMeshFromTileID(B,se.canonical,S,!0,"raster"),we=(R=f.style.map.terrain)===null||R===void 0?void 0:R.getTerrainData(se),Oe=O.getProjectionData({overscaledTileID:se,aligned:ie,applyGlobeMatrix:!M,applyTerrainMatrix:!0});Z.draw(B,j.TRIANGLES,m,h[se.overscaledZ],y,$t.backCCW,hc(n,ue.dem,ne),we,Oe,n.id,le.vertexBuffer,le.indexBuffer,le.segments)}}const yc=[new c.P(0,0),new c.P(c.$,0),new c.P(c.$,c.$),new c.P(0,c.$)];function vn(f,e,n,l,h,m,y,S,M=!1,R=!1){const I=l[l.length-1].overscaledZ,B=f.context,O=B.gl,j=f.useProgram("raster"),Z=f.transform,ie=f.style.projection,te=f.colorModeForRenderPass(),ne=!f.options.moving;for(const se of l){const ue=f.getDepthModeForSublayer(se.overscaledZ-I,n.paint.get("raster-opacity")===1?Xt.ReadWrite:Xt.ReadOnly,O.LESS),oe=e.getTile(se);oe.registerFadeDuration(n.paint.get("raster-fade-duration"));const pe=e.findLoadedParent(se,0),ge=e.findLoadedSibling(se),le=xn(oe,pe||ge||null,e,n,f.transform,f.style.map.terrain);let we,Oe;const Re=n.paint.get("raster-resampling")==="nearest"?O.NEAREST:O.LINEAR;B.activeTexture.set(O.TEXTURE0),oe.texture.bind(Re,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),B.activeTexture.set(O.TEXTURE1),pe?(pe.texture.bind(Re,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),we=Math.pow(2,pe.tileID.overscaledZ-oe.tileID.overscaledZ),Oe=[oe.tileID.canonical.x*we%1,oe.tileID.canonical.y*we%1]):oe.texture.bind(Re,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),oe.texture.useMipmap&&B.extTextureFilterAnisotropic&&f.transform.pitch>20&&O.texParameterf(O.TEXTURE_2D,B.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,B.extTextureFilterAnisotropicMax);const De=f.style.map.terrain&&f.style.map.terrain.getTerrainData(se),Be=Z.getProjectionData({overscaledTileID:se,aligned:ne,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),dt=Us(Oe||[0,0],we||1,le,n,S),ut=ie.getMeshFromTileID(B,se.canonical,m,y,"raster");j.draw(B,O.TRIANGLES,ue,h?h[se.overscaledZ]:Ft.disabled,te,M?$t.frontCCW:$t.backCCW,dt,De,Be,n.id,ut.vertexBuffer,ut.indexBuffer,ut.segments)}}function xn(f,e,n,l,h,m){const y=l.paint.get("raster-fade-duration");if(!m&&y>0){const S=xe.now(),M=(S-f.timeAdded)/y,R=e?(S-e.timeAdded)/y:-1,I=n.getSource(),B=Ze(h,{tileSize:I.tileSize,roundZoom:I.roundZoom}),O=!e||Math.abs(e.tileID.overscaledZ-B)>Math.abs(f.tileID.overscaledZ-B),j=O&&f.refreshedUponExpiration?1:c.ag(O?M:1-R,0,1);return f.refreshedUponExpiration&&M>=1&&(f.refreshedUponExpiration=!1),e?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}const Si=new c.be(1,0,0,1),Xa=new c.be(0,1,0,1),ha=new c.be(0,0,1,1),au=new c.be(1,0,1,1),$s=new c.be(0,1,1,1);function El(f,e,n,l){Hs(f,0,e+n/2,f.transform.width,n,l)}function vc(f,e,n,l){Hs(f,e-n/2,0,n,f.transform.height,l)}function Hs(f,e,n,l,h,m){const y=f.context,S=y.gl;S.enable(S.SCISSOR_TEST),S.scissor(e*f.pixelRatio,n*f.pixelRatio,l*f.pixelRatio,h*f.pixelRatio),y.clear({color:m}),S.disable(S.SCISSOR_TEST)}function Cl(f,e,n){const l=f.context,h=l.gl,m=f.useProgram("debug"),y=Xt.disabled,S=Ft.disabled,M=f.colorModeForRenderPass(),R="$debug",I=f.style.map.terrain&&f.style.map.terrain.getTerrainData(n);l.activeTexture.set(h.TEXTURE0);const B=e.getTileByID(n.key).latestRawTileData,O=Math.floor((B&&B.byteLength||0)/1024),j=e.getTile(n).tileSize,Z=512/Math.min(j,512)*(n.overscaledZ/f.transform.zoom)*.5;let ie=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(ie+=` => ${n.overscaledZ}`),function(ne,se){ne.initDebugOverlayCanvas();const ue=ne.debugOverlayCanvas,oe=ne.context.gl,pe=ne.debugOverlayCanvas.getContext("2d");pe.clearRect(0,0,ue.width,ue.height),pe.shadowColor="white",pe.shadowBlur=2,pe.lineWidth=1.5,pe.strokeStyle="white",pe.textBaseline="top",pe.font="bold 36px Open Sans, sans-serif",pe.fillText(se,5,5),pe.strokeText(se,5,5),ne.debugOverlayTexture.update(ue),ne.debugOverlayTexture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE)}(f,`${ie} ${O}kB`);const te=f.transform.getProjectionData({overscaledTileID:n,applyGlobeMatrix:!0,applyTerrainMatrix:!0});m.draw(l,h.TRIANGLES,y,S,si.alphaBlended,$t.disabled,Yh(c.be.transparent,Z),null,te,R,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments),m.draw(l,h.LINE_STRIP,y,S,M,$t.disabled,Yh(c.be.red),I,te,R,f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments)}function cn(f,e,n,l){const{isRenderingGlobe:h}=l,m=f.context,y=m.gl,S=f.transform,M=f.colorModeForRenderPass(),R=f.getDepthModeFor3D(),I=f.useProgram("terrain");m.bindFramebuffer.set(null),m.viewport.set([0,0,f.width,f.height]);for(const B of n){const O=e.getTerrainMesh(B.tileID),j=f.renderToTexture.getTexture(B),Z=e.getTerrainData(B.tileID);m.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,j.texture);const ie=e.getMeshFrameDelta(S.zoom),te=S.calculateFogMatrix(B.tileID.toUnwrapped()),ne=Yd(ie,te,f.style.sky,S.pitch,h),se=S.getProjectionData({overscaledTileID:B.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});I.draw(m,y.TRIANGLES,R,Ft.disabled,M,$t.backCCW,ne,Z,se,"terrain",O.vertexBuffer,O.indexBuffer,O.segments)}}function da(f,e){if(!e.mesh){const n=new c.aK;n.emplaceBack(-1,-1),n.emplaceBack(1,-1),n.emplaceBack(1,1),n.emplaceBack(-1,1);const l=new c.aM;l.emplaceBack(0,1,2),l.emplaceBack(0,2,3),e.mesh=new Ga(f.createVertexBuffer(n,Ta.members),f.createIndexBuffer(l),c.aL.simpleSegment(0,0,n.length,l.length))}return e.mesh}class Lr{constructor(e,n){this.context=new ti(e),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.af(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Xe.maxUnderzooming+Xe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new nc}resize(e,n,l){if(this.width=Math.floor(e*l),this.height=Math.floor(n*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style._order)this.style._layers[h].resize()}setup(){const e=this.context,n=new c.aK;n.emplaceBack(0,0),n.emplaceBack(c.$,0),n.emplaceBack(0,c.$),n.emplaceBack(c.$,c.$),this.tileExtentBuffer=e.createVertexBuffer(n,Ta.members),this.tileExtentSegments=c.aL.simpleSegment(0,0,4,2);const l=new c.aK;l.emplaceBack(0,0),l.emplaceBack(c.$,0),l.emplaceBack(0,c.$),l.emplaceBack(c.$,c.$),this.debugBuffer=e.createVertexBuffer(l,Ta.members),this.debugSegments=c.aL.simpleSegment(0,0,4,5);const h=new c.c5;h.emplaceBack(0,0,0,0),h.emplaceBack(c.$,0,c.$,0),h.emplaceBack(0,c.$,0,c.$),h.emplaceBack(c.$,c.$,c.$,c.$),this.rasterBoundsBuffer=e.createVertexBuffer(h,Hd.members),this.rasterBoundsSegments=c.aL.simpleSegment(0,0,4,2);const m=new c.aK;m.emplaceBack(0,0),m.emplaceBack(c.$,0),m.emplaceBack(0,c.$),m.emplaceBack(c.$,c.$),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(m,Ta.members),this.rasterBoundsSegmentsPosOnly=c.aL.simpleSegment(0,0,4,5);const y=new c.aK;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(y,Ta.members),this.viewportSegments=c.aL.simpleSegment(0,0,4,2);const S=new c.c6;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(S);const M=new c.aM;M.emplaceBack(1,0,2),M.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(M);const R=this.context.gl;this.stencilClearMode=new Ft({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.tileExtentMesh=new Ga(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=c.L();c.bX(l,0,this.width,this.height,0,0,1),c.N(l,l,[n.drawingBufferWidth,n.drawingBufferHeight,0]);const h={mainMatrix:l,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:l};this.useProgram("clippingMask",null,!0).draw(e,n.TRIANGLES,Xt.disabled,this.stencilClearMode,si.disabled,$t.disabled,null,null,h,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,n,l){if(this.currentStencilSource===e.source||!e.isTileClipped()||!n||!n.length)return;this.currentStencilSource=e.source,this.nextStencilID+n.length>256&&this.clearStencil();const h=this.context;h.setColorMode(si.disabled),h.setDepthMode(Xt.disabled);const m={};for(const y of n)m[y.key]=this.nextStencilID++;this._renderTileMasks(m,n,l,!0),this._renderTileMasks(m,n,l,!1),this._tileClippingMaskIDs=m}_renderTileMasks(e,n,l,h){const m=this.context,y=m.gl,S=this.style.projection,M=this.transform,R=this.useProgram("clippingMask");for(const I of n){const B=e[I.key],O=this.style.map.terrain&&this.style.map.terrain.getTerrainData(I),j=S.getMeshFromTileID(this.context,I.canonical,h,!0,"stencil"),Z=M.getProjectionData({overscaledTileID:I,applyGlobeMatrix:!l,applyTerrainMatrix:!0});R.draw(m,y.TRIANGLES,Xt.disabled,new Ft({func:y.ALWAYS,mask:0},B,255,y.KEEP,y.KEEP,y.REPLACE),si.disabled,l?$t.disabled:$t.backCCW,null,O,Z,"$clipping",j.vertexBuffer,j.indexBuffer,j.segments)}}_renderTilesDepthBuffer(){const e=this.context,n=e.gl,l=this.style.projection,h=this.transform,m=this.useProgram("depth"),y=this.getDepthModeFor3D(),S=je(h,{tileSize:h.tileSize});for(const M of S){const R=this.style.map.terrain&&this.style.map.terrain.getTerrainData(M),I=l.getMeshFromTileID(this.context,M.canonical,!0,!0,"raster"),B=h.getProjectionData({overscaledTileID:M,applyGlobeMatrix:!0,applyTerrainMatrix:!0});m.draw(e,n.TRIANGLES,y,Ft.disabled,si.disabled,$t.backCCW,null,R,B,"$clipping",I.vertexBuffer,I.indexBuffer,I.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,n=this.context.gl;return new Ft({func:n.NOTEQUAL,mask:255},e,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(e){const n=this.context.gl;return new Ft({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,n.KEEP,n.KEEP,n.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const n=this.context.gl,l=e.sort((y,S)=>S.overscaledZ-y.overscaledZ),h=l[l.length-1].overscaledZ,m=l[0].overscaledZ-h+1;if(m>1){this.currentStencilSource=void 0,this.nextStencilID+m>256&&this.clearStencil();const y={};for(let S=0;S<m;S++)y[S+h]=new Ft({func:n.GEQUAL,mask:255},S+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=m,[y,l]}return[{[h]:Ft.disabled},l]}stencilConfigForOverlapTwoPass(e){const n=this.context.gl,l=e.sort((y,S)=>S.overscaledZ-y.overscaledZ),h=l[l.length-1].overscaledZ,m=l[0].overscaledZ-h+1;if(this.clearStencil(),m>1){const y={},S={};for(let M=0;M<m;M++)y[M+h]=new Ft({func:n.GREATER,mask:255},m+1+M,255,n.KEEP,n.KEEP,n.REPLACE),S[M+h]=new Ft({func:n.GREATER,mask:255},1+M,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID=2*m+1,[y,S,l]}return this.nextStencilID=3,[{[h]:new Ft({func:n.GREATER,mask:255},2,255,n.KEEP,n.KEEP,n.REPLACE)},{[h]:new Ft({func:n.GREATER,mask:255},1,255,n.KEEP,n.KEEP,n.REPLACE)},l]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new si([e.CONSTANT_COLOR,e.ONE],new c.be(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?si.unblended:si.alphaBlended}getDepthModeForSublayer(e,n,l){if(!this.opaquePassEnabledForLayer())return Xt.disabled;const h=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Xt(l||this.context.gl.LEQUAL,n,[h,h])}getDepthModeFor3D(){return new Xt(this.context.gl.LEQUAL,Xt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){var l,h;this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(xe.now()),this.imageManager.beginFrame();const m=this.style._order,y=this.style.sourceCaches,S={},M={},R={},I={isRenderingToTexture:!1,isRenderingGlobe:((l=e.projection)===null||l===void 0?void 0:l.transitionState)>0};for(const O in y){const j=y[O];j.used&&j.prepare(this.context),S[O]=j.getVisibleCoordinates(!1),M[O]=S[O].slice().reverse(),R[O]=j.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let O=0;O<m.length;O++)if(this.style._layers[m[O]].is3D()){this.opaquePassCutoff=O;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const O of m){const j=this.style._layers[O];if(!j.hasOffscreenPass()||j.isHidden(this.transform.zoom))continue;const Z=M[j.source];(j.type==="custom"||Z.length)&&this.renderLayer(this,y[j.source],j,Z,I)}if((h=this.style.projection)===null||h===void 0||h.updateGPUdependent({context:this.context,useProgram:O=>this.useProgram(O)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?c.be.black:c.be.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(O,j){const Z=O.context,ie=Z.gl,te=((ge,le,we)=>{const Oe=Math.cos(le.rollInRadians),Re=Math.sin(le.rollInRadians),De=Y(le),Be=le.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:ge.properties.get("sky-color"),u_horizon_color:ge.properties.get("horizon-color"),u_horizon:[(le.width/2-De*Re)*we,(le.height/2+De*Oe)*we],u_horizon_normal:[-Re,Oe],u_sky_horizon_blend:ge.properties.get("sky-horizon-blend")*le.height/2*we,u_sky_blend:Be}})(j,O.style.map.transform,O.pixelRatio),ne=new Xt(ie.LEQUAL,Xt.ReadWrite,[0,1]),se=Ft.disabled,ue=O.colorModeForRenderPass(),oe=O.useProgram("sky"),pe=da(Z,j);oe.draw(Z,ie.TRIANGLES,ne,se,ue,$t.disabled,te,null,void 0,"sky",pe.vertexBuffer,pe.indexBuffer,pe.segments)}(this,this.style.sky),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const O=this.style._layers[m[this.currentLayer]],j=y[O.source],Z=S[O.source];this._renderTileClippingMasks(O,Z,!1),this.renderLayer(this,j,O,Z,I)}this.renderPass="translucent";let B=!1;for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const O=this.style._layers[m[this.currentLayer]],j=y[O.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(O,I))continue;this.opaquePassEnabledForLayer()||B||(B=!0,I.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const Z=(O.type==="symbol"?R:M)[O.source];this._renderTileClippingMasks(O,S[O.source],!!this.renderToTexture),this.renderLayer(this,j,O,Z,I)}if(I.isRenderingGlobe&&function(O,j,Z){const ie=O.context,te=ie.gl,ne=O.useProgram("atmosphere"),se=new Xt(te.LEQUAL,Xt.ReadOnly,[0,1]),ue=O.transform,oe=function(Be,dt){const ut=Be.properties.get("position"),it=[-ut.x,-ut.y,-ut.z],wt=c.af(new Float64Array(16));return Be.properties.get("anchor")==="map"&&(c.b5(wt,wt,dt.rollInRadians),c.b6(wt,wt,-dt.pitchInRadians),c.b5(wt,wt,dt.bearingInRadians),c.b6(wt,wt,dt.center.lat*Math.PI/180),c.by(wt,wt,-dt.center.lng*Math.PI/180)),c.c4(it,it,wt),it}(Z,O.transform),pe=ue.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ge=j.properties.get("atmosphere-blend")*pe.projectionTransition;if(ge===0)return;const le=dl(ue.worldSize,ue.center.lat),we=ue.inverseProjectionMatrix,Oe=new Float64Array(4);Oe[3]=1,c.av(Oe,Oe,ue.modelViewProjectionMatrix),Oe[0]/=Oe[3],Oe[1]/=Oe[3],Oe[2]/=Oe[3],Oe[3]=1,c.av(Oe,Oe,we),Oe[0]/=Oe[3],Oe[1]/=Oe[3],Oe[2]/=Oe[3],Oe[3]=1;const Re=((Be,dt,ut,it,wt)=>({u_sun_pos:Be,u_atmosphere_blend:dt,u_globe_position:ut,u_globe_radius:it,u_inv_proj_matrix:wt}))(oe,ge,[Oe[0],Oe[1],Oe[2]],le,we),De=da(ie,j);ne.draw(ie,te.TRIANGLES,se,Ft.disabled,si.alphaBlended,$t.disabled,Re,null,null,"atmosphere",De.vertexBuffer,De.indexBuffer,De.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const O=function(j,Z){let ie=null;const te=Object.values(j._layers).flatMap(oe=>oe.source&&!oe.isHidden(Z)?[j.sourceCaches[oe.source]]:[]),ne=te.filter(oe=>oe.getSource().type==="vector"),se=te.filter(oe=>oe.getSource().type!=="vector"),ue=oe=>{(!ie||ie.getSource().maxzoom<oe.getSource().maxzoom)&&(ie=oe)};return ne.forEach(oe=>ue(oe)),ie||se.forEach(oe=>ue(oe)),ie}(this.style,this.transform.zoom);O&&function(j,Z,ie){for(let te=0;te<ie.length;te++)Cl(j,Z,ie[te])}(this,O,O.getVisibleCoordinates())}this.options.showPadding&&function(O){const j=O.transform.padding;El(O,O.transform.height-(j.top||0),3,Si),El(O,j.bottom||0,3,Xa),vc(O,j.left||0,3,ha),vc(O,O.transform.width-(j.right||0),3,au);const Z=O.transform.centerPoint;(function(ie,te,ne,se){Hs(ie,te-1,ne-10,2,20,se),Hs(ie,te-10,ne-1,20,2,se)})(O,Z.x,O.transform.height-Z.y,$s)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const n=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let h=this.terrainFacilitator.dirty;h||(h=e?!c.c7(n,l):!c.c8(n,l)),h||(h=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),h&&(c.c9(n,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(m,y){const S=m.context,M=S.gl,R=m.transform,I=si.unblended,B=new Xt(M.LEQUAL,Xt.ReadWrite,[0,1]),O=y.sourceCache.getRenderableTiles(),j=m.useProgram("terrainDepth");S.bindFramebuffer.set(y.getFramebuffer("depth").framebuffer),S.viewport.set([0,0,m.width/devicePixelRatio,m.height/devicePixelRatio]),S.clear({color:c.be.transparent,depth:1});for(const Z of O){const ie=y.getTerrainMesh(Z.tileID),te=y.getTerrainData(Z.tileID),ne=R.getProjectionData({overscaledTileID:Z.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),se={u_ele_delta:y.getMeshFrameDelta(R.zoom)};j.draw(S,M.TRIANGLES,B,Ft.disabled,I,$t.backCCW,se,te,ne,"terrain",ie.vertexBuffer,ie.indexBuffer,ie.segments)}S.bindFramebuffer.set(null),S.viewport.set([0,0,m.width,m.height])}(this,this.style.map.terrain),function(m,y){const S=m.context,M=S.gl,R=m.transform,I=si.unblended,B=new Xt(M.LEQUAL,Xt.ReadWrite,[0,1]),O=y.getCoordsTexture(),j=y.sourceCache.getRenderableTiles(),Z=m.useProgram("terrainCoords");S.bindFramebuffer.set(y.getFramebuffer("coords").framebuffer),S.viewport.set([0,0,m.width/devicePixelRatio,m.height/devicePixelRatio]),S.clear({color:c.be.transparent,depth:1}),y.coordsIndex=[];for(const ie of j){const te=y.getTerrainMesh(ie.tileID),ne=y.getTerrainData(ie.tileID);S.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,O.texture);const se={u_terrain_coords_id:(255-y.coordsIndex.length)/255,u_texture:0,u_ele_delta:y.getMeshFrameDelta(R.zoom)},ue=R.getProjectionData({overscaledTileID:ie.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Z.draw(S,M.TRIANGLES,B,Ft.disabled,I,$t.backCCW,se,ne,ue,"terrain",te.vertexBuffer,te.indexBuffer,te.segments),y.coordsIndex.push(ie.tileID.key)}S.bindFramebuffer.set(null),S.viewport.set([0,0,m.width,m.height])}(this,this.style.map.terrain))}renderLayer(e,n,l,h,m){l.isHidden(this.transform.zoom)||(l.type==="background"||l.type==="custom"||(h||[]).length)&&(this.id=l.id,c.ca(l)?function(y,S,M,R,I,B){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:O}=B,j=Ft.disabled,Z=y.colorModeForRenderPass();(M._unevaluatedLayout.hasValue("text-variable-anchor")||M._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ie,te,ne,se,ue,oe,pe,ge,le){const we=te.transform,Oe=te.style.map.terrain,Re=ue==="map",De=oe==="map";for(const Be of ie){const dt=se.getTile(Be),ut=dt.getBucket(ne);if(!ut||!ut.text||!ut.text.segments.get().length)continue;const it=c.am(ut.textSizeData,we.zoom),wt=c.aB(dt,1,te.transform.zoom),Wt=kt(Re,te.transform,wt),gi=ne.layout.get("icon-text-fit")!=="none"&&ut.hasIconData();if(it){const sn=Math.pow(2,we.zoom-dt.tileID.overscaledZ),Ai=Oe?(un,zi)=>Oe.getElevation(Be,un,zi):null;rh(ut,Re,De,le,we,Wt,sn,it,gi,c.aC(we,dt,pe,ge),Be.toUnwrapped(),Ai)}}}(R,y,M,S,M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),I),M.paint.get("icon-opacity").constantOr(1)!==0&&Po(y,S,M,R,!1,M.paint.get("icon-translate"),M.paint.get("icon-translate-anchor"),M.layout.get("icon-rotation-alignment"),M.layout.get("icon-pitch-alignment"),M.layout.get("icon-keep-upright"),j,Z,O),M.paint.get("text-opacity").constantOr(1)!==0&&Po(y,S,M,R,!0,M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),M.layout.get("text-keep-upright"),j,Z,O),S.map.showCollisionBoxes&&(ih(y,S,M,R,!0),ih(y,S,M,R,!1))}(e,n,l,h,this.style.placement.variableOffsets,m):c.cb(l)?function(y,S,M,R,I){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:B}=I,O=M.paint.get("circle-opacity"),j=M.paint.get("circle-stroke-width"),Z=M.paint.get("circle-stroke-opacity"),ie=!M.layout.get("circle-sort-key").isConstant();if(O.constantOr(1)===0&&(j.constantOr(1)===0||Z.constantOr(1)===0))return;const te=y.context,ne=te.gl,se=y.transform,ue=y.getDepthModeForSublayer(0,Xt.ReadOnly),oe=Ft.disabled,pe=y.colorModeForRenderPass(),ge=[],le=se.getCircleRadiusCorrection();for(let we=0;we<R.length;we++){const Oe=R[we],Re=S.getTile(Oe),De=Re.getBucket(M);if(!De)continue;const Be=M.paint.get("circle-translate"),dt=M.paint.get("circle-translate-anchor"),ut=c.aC(se,Re,Be,dt),it=De.programConfigurations.get(M.id),wt=y.useProgram("circle",it),Wt=De.layoutVertexBuffer,gi=De.indexBuffer,sn=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Oe),Ai={programConfiguration:it,program:wt,layoutVertexBuffer:Wt,indexBuffer:gi,uniformValues:Kc(y,Re,M,ut,le),terrainData:sn,projectionData:se.getProjectionData({overscaledTileID:Oe,applyGlobeMatrix:!B,applyTerrainMatrix:!0})};if(ie){const un=De.segments.get();for(const zi of un)ge.push({segments:new c.aL([zi]),sortKey:zi.sortKey,state:Ai})}else ge.push({segments:De.segments,sortKey:0,state:Ai})}ie&&ge.sort((we,Oe)=>we.sortKey-Oe.sortKey);for(const we of ge){const{programConfiguration:Oe,program:Re,layoutVertexBuffer:De,indexBuffer:Be,uniformValues:dt,terrainData:ut,projectionData:it}=we.state;Re.draw(te,ne.TRIANGLES,ue,oe,pe,$t.backCCW,dt,ut,it,M.id,De,Be,we.segments,M.paint,y.transform.zoom,Oe)}}(e,n,l,h,m):c.cc(l)?function(y,S,M,R,I){if(M.paint.get("heatmap-opacity")===0)return;const B=y.context,{isRenderingToTexture:O,isRenderingGlobe:j}=I;if(y.style.map.terrain){for(const Z of R){const ie=S.getTile(Z);S.hasRenderableParent(Z)||(y.renderPass==="offscreen"?Do(y,ie,M,Z,j):y.renderPass==="translucent"&&Mr(y,M,Z,O,j))}B.viewport.set([0,0,y.width,y.height])}else y.renderPass==="offscreen"?function(Z,ie,te,ne){const se=Z.context,ue=se.gl,oe=Z.transform,pe=Ft.disabled,ge=new si([ue.ONE,ue.ONE],c.be.transparent,[!0,!0,!0,!0]);(function(le,we,Oe){const Re=le.gl;le.activeTexture.set(Re.TEXTURE1),le.viewport.set([0,0,we.width/4,we.height/4]);let De=Oe.heatmapFbos.get(c.c1);De?(Re.bindTexture(Re.TEXTURE_2D,De.colorAttachment.get()),le.bindFramebuffer.set(De.framebuffer)):(De=mr(le,we.width/4,we.height/4),Oe.heatmapFbos.set(c.c1,De))})(se,Z,te),se.clear({color:c.be.transparent});for(let le=0;le<ne.length;le++){const we=ne[le];if(ie.hasRenderableParent(we))continue;const Oe=ie.getTile(we),Re=Oe.getBucket(te);if(!Re)continue;const De=Re.programConfigurations.get(te.id),Be=Z.useProgram("heatmap",De),dt=oe.getProjectionData({overscaledTileID:we,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),ut=oe.getCircleRadiusCorrection();Be.draw(se,ue.TRIANGLES,Xt.disabled,pe,ge,$t.backCCW,uc(Oe,oe.zoom,te.paint.get("heatmap-intensity"),ut),null,dt,te.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,te.paint,oe.zoom,De)}se.viewport.set([0,0,Z.width,Z.height])}(y,S,M,R):y.renderPass==="translucent"&&function(Z,ie){const te=Z.context,ne=te.gl;te.setColorMode(Z.colorModeForRenderPass());const se=ie.heatmapFbos.get(c.c1);se&&(te.activeTexture.set(ne.TEXTURE0),ne.bindTexture(ne.TEXTURE_2D,se.colorAttachment.get()),te.activeTexture.set(ne.TEXTURE1),Ha(te,ie).bind(ne.LINEAR,ne.CLAMP_TO_EDGE),Z.useProgram("heatmapTexture").draw(te,ne.TRIANGLES,Xt.disabled,Ft.disabled,Z.colorModeForRenderPass(),$t.disabled,Kh(Z,ie,0,1),null,null,ie.id,Z.viewportBuffer,Z.quadTriangleIndexBuffer,Z.viewportSegments,ie.paint,Z.transform.zoom))}(y,M)}(e,n,l,h,m):c.cd(l)?function(y,S,M,R,I){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:B}=I,O=M.paint.get("line-opacity"),j=M.paint.get("line-width");if(O.constantOr(1)===0||j.constantOr(1)===0)return;const Z=y.getDepthModeForSublayer(0,Xt.ReadOnly),ie=y.colorModeForRenderPass(),te=M.paint.get("line-dasharray"),ne=M.paint.get("line-pattern"),se=ne.constantOr(1),ue=M.paint.get("line-gradient"),oe=M.getCrossfadeParameters(),pe=se?"linePattern":te?"lineSDF":ue?"lineGradient":"line",ge=y.context,le=ge.gl,we=y.transform;let Oe=!0;for(const Re of R){const De=S.getTile(Re);if(se&&!De.patternsLoaded())continue;const Be=De.getBucket(M);if(!Be)continue;const dt=Be.programConfigurations.get(M.id),ut=y.context.program.get(),it=y.useProgram(pe,dt),wt=Oe||it.program!==ut,Wt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Re),gi=ne.constantOr(null);if(gi&&De.imageAtlas){const Pi=De.imageAtlas,Ii=Pi.patternPositions[gi.to.toString()],Gn=Pi.patternPositions[gi.from.toString()];Ii&&Gn&&dt.setConstantPatternPositions(Ii,Gn)}const sn=we.getProjectionData({overscaledTileID:Re,applyGlobeMatrix:!B,applyTerrainMatrix:!0}),Ai=we.getPixelScale(),un=se?$u(y,De,M,Ai,oe):te?Hu(y,De,M,Ai,te,oe):ue?bl(y,De,M,Ai,Be.lineClipsArray.length):Wc(y,De,M,Ai);if(se)ge.activeTexture.set(le.TEXTURE0),De.imageAtlasTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE),dt.updatePaintBuffers(oe);else if(te&&(wt||y.lineAtlas.dirty))ge.activeTexture.set(le.TEXTURE0),y.lineAtlas.bind(ge);else if(ue){const Pi=Be.gradients[M.id];let Ii=Pi.texture;if(M.gradientVersion!==Pi.version){let Gn=256;if(M.stepInterpolant){const hi=S.getSource().maxzoom,qn=Re.canonical.z===hi?Math.ceil(1<<y.transform.maxZoom-Re.canonical.z):1;Gn=c.ag(c.c2(Be.maxLineLength/c.$*1024*qn),256,ge.maxTextureSize)}Pi.gradient=c.c3({expression:M.gradientExpression(),evaluationKey:"lineProgress",resolution:Gn,image:Pi.gradient||void 0,clips:Be.lineClipsArray}),Pi.texture?Pi.texture.update(Pi.gradient):Pi.texture=new c.T(ge,Pi.gradient,le.RGBA),Pi.version=M.gradientVersion,Ii=Pi.texture}ge.activeTexture.set(le.TEXTURE0),Ii.bind(M.stepInterpolant?le.NEAREST:le.LINEAR,le.CLAMP_TO_EDGE)}const zi=y.stencilModeForClipping(Re);it.draw(ge,le.TRIANGLES,Z,zi,ie,$t.disabled,un,Wt,sn,M.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,M.paint,y.transform.zoom,dt,Be.layoutVertexBuffer2),Oe=!1}}(e,n,l,h,m):c.ce(l)?function(y,S,M,R,I){const B=M.paint.get("fill-color"),O=M.paint.get("fill-opacity");if(O.constantOr(1)===0)return;const{isRenderingToTexture:j}=I,Z=y.colorModeForRenderPass(),ie=M.paint.get("fill-pattern"),te=y.opaquePassEnabledForLayer()&&!ie.constantOr(1)&&B.constantOr(c.be.transparent).a===1&&O.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===te){const ne=y.getDepthModeForSublayer(1,y.renderPass==="opaque"?Xt.ReadWrite:Xt.ReadOnly);Kr(y,S,M,R,ne,Z,!1,j)}if(y.renderPass==="translucent"&&M.paint.get("fill-antialias")){const ne=y.getDepthModeForSublayer(M.getPaintProperty("fill-outline-color")?2:0,Xt.ReadOnly);Kr(y,S,M,R,ne,Z,!0,j)}}(e,n,l,h,m):c.cf(l)?function(y,S,M,R,I){const B=M.paint.get("fill-extrusion-opacity");if(B===0)return;const{isRenderingToTexture:O}=I;if(y.renderPass==="translucent"){const j=new Xt(y.context.gl.LEQUAL,Xt.ReadWrite,y.depthRangeFor3D);if(B!==1||M.paint.get("fill-extrusion-pattern").constantOr(1))ua(y,S,M,R,j,Ft.disabled,si.disabled,O),ua(y,S,M,R,j,y.stencilModeFor3D(),y.colorModeForRenderPass(),O);else{const Z=y.colorModeForRenderPass();ua(y,S,M,R,j,Ft.disabled,Z,O)}}}(e,n,l,h,m):c.cg(l)?function(y,S,M,R,I){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const{isRenderingToTexture:B}=I,O=y.context,j=y.style.projection.useSubdivision,Z=y.getDepthModeForSublayer(0,Xt.ReadOnly),ie=y.colorModeForRenderPass();if(y.renderPass==="offscreen")(function(te,ne,se,ue,oe,pe,ge){const le=te.context,we=le.gl;for(const Oe of se){const Re=ne.getTile(Oe),De=Re.dem;if(!De||!De.data||!Re.needsHillshadePrepare)continue;const Be=De.dim,dt=De.stride,ut=De.getPixels();if(le.activeTexture.set(we.TEXTURE1),le.pixelStoreUnpackPremultiplyAlpha.set(!1),Re.demTexture=Re.demTexture||te.getTileTexture(dt),Re.demTexture){const wt=Re.demTexture;wt.update(ut,{premultiply:!1}),wt.bind(we.NEAREST,we.CLAMP_TO_EDGE)}else Re.demTexture=new c.T(le,ut,we.RGBA,{premultiply:!1}),Re.demTexture.bind(we.NEAREST,we.CLAMP_TO_EDGE);le.activeTexture.set(we.TEXTURE0);let it=Re.fbo;if(!it){const wt=new c.T(le,{width:Be,height:Be,data:null},we.RGBA);wt.bind(we.LINEAR,we.CLAMP_TO_EDGE),it=Re.fbo=le.createFramebuffer(Be,Be,!0,!1),it.colorAttachment.set(wt.texture)}le.bindFramebuffer.set(it.framebuffer),le.viewport.set([0,0,Be,Be]),te.useProgram("hillshadePrepare").draw(le,we.TRIANGLES,oe,pe,ge,$t.disabled,Wh(Re.tileID,De),null,null,ue.id,te.rasterBoundsBuffer,te.quadTriangleIndexBuffer,te.rasterBoundsSegments),Re.needsHillshadePrepare=!1}})(y,S,R,M,Z,Ft.disabled,ie),O.viewport.set([0,0,y.width,y.height]);else if(y.renderPass==="translucent")if(j){const[te,ne,se]=y.stencilConfigForOverlapTwoPass(R);Io(y,S,M,se,te,Z,ie,!1,B),Io(y,S,M,se,ne,Z,ie,!0,B)}else{const[te,ne]=y.getStencilConfigForOverlapAndUpdateStencilID(R);Io(y,S,M,ne,te,Z,ie,!1,B)}}(e,n,l,h,m):c.ch(l)?function(y,S,M,R,I){if(y.renderPass!=="translucent"||!R.length)return;const{isRenderingToTexture:B}=I,O=y.style.projection.useSubdivision,j=y.getDepthModeForSublayer(0,Xt.ReadOnly),Z=y.colorModeForRenderPass();if(O){const[ie,te,ne]=y.stencilConfigForOverlapTwoPass(R);ko(y,S,M,ne,ie,j,Z,!1,B),ko(y,S,M,ne,te,j,Z,!0,B)}else{const[ie,te]=y.getStencilConfigForOverlapAndUpdateStencilID(R);ko(y,S,M,te,ie,j,Z,!1,B)}}(e,n,l,h,m):c.ci(l)?function(y,S,M,R,I){if(y.renderPass!=="translucent"||M.paint.get("raster-opacity")===0||!R.length)return;const{isRenderingToTexture:B}=I,O=S.getSource(),j=y.style.projection.useSubdivision;if(O instanceof br)vn(y,S,M,R,null,!1,!1,O.tileCoords,O.flippedWindingOrder,B);else if(j){const[Z,ie,te]=y.stencilConfigForOverlapTwoPass(R);vn(y,S,M,te,Z,!1,!0,yc,!1,B),vn(y,S,M,te,ie,!0,!0,yc,!1,B)}else{const[Z,ie]=y.getStencilConfigForOverlapAndUpdateStencilID(R);vn(y,S,M,ie,Z,!1,!0,yc,!1,B)}}(e,n,l,h,m):c.cj(l)?function(y,S,M,R,I){const B=M.paint.get("background-color"),O=M.paint.get("background-opacity");if(O===0)return;const{isRenderingToTexture:j}=I,Z=y.context,ie=Z.gl,te=y.style.projection,ne=y.transform,se=ne.tileSize,ue=M.paint.get("background-pattern");if(y.isPatternMissing(ue))return;const oe=!ue&&B.a===1&&O===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==oe)return;const pe=Ft.disabled,ge=y.getDepthModeForSublayer(0,oe==="opaque"?Xt.ReadWrite:Xt.ReadOnly),le=y.colorModeForRenderPass(),we=y.useProgram(ue?"backgroundPattern":"background"),Oe=R||je(ne,{tileSize:se,terrain:y.style.map.terrain});ue&&(Z.activeTexture.set(ie.TEXTURE0),y.imageManager.bind(y.context));const Re=M.getCrossfadeParameters();for(const De of Oe){const Be=ne.getProjectionData({overscaledTileID:De,applyGlobeMatrix:!j,applyTerrainMatrix:!0}),dt=ue?Qd(O,y,ue,{tileID:De,tileSize:se},Re):Jc(O,B),ut=y.style.map.terrain&&y.style.map.terrain.getTerrainData(De),it=te.getMeshFromTileID(Z,De.canonical,!1,!0,"raster");we.draw(Z,ie.TRIANGLES,ge,pe,le,$t.backCCW,dt,ut,Be,M.id,it.vertexBuffer,it.indexBuffer,it.segments)}}(e,0,l,h,m):c.ck(l)&&function(y,S,M,R){const{isRenderingGlobe:I}=R,B=y.context,O=M.implementation,j=y.style.projection,Z=y.transform,ie=Z.getProjectionDataForCustomLayer(I),te={farZ:Z.farZ,nearZ:Z.nearZ,fov:Z.fov*Math.PI/180,modelViewProjectionMatrix:Z.modelViewProjectionMatrix,projectionMatrix:Z.projectionMatrix,shaderData:{variantName:j.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${j.shaderPreludeCode.vertexSource}`,define:j.shaderDefine},defaultProjectionData:ie},ne=O.renderingMode?O.renderingMode:"2d";if(y.renderPass==="offscreen"){const se=O.prerender;se&&(y.setCustomLayerDefaults(),B.setColorMode(y.colorModeForRenderPass()),se.call(O,B.gl,te),B.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),B.setColorMode(y.colorModeForRenderPass()),B.setStencilMode(Ft.disabled);const se=ne==="3d"?y.getDepthModeFor3D():y.getDepthModeForSublayer(0,Xt.ReadOnly);B.setDepthMode(se),O.render(B.gl,te),B.setDirty(),y.setBaseState(),B.bindFramebuffer.set(null)}}(e,0,l,m))}saveTileTexture(e){const n=this._tileTextures[e.size[0]];n?n.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const n=this._tileTextures[e];return n&&n.length>0?n.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const n=this.imageManager.getPattern(e.from.toString()),l=this.imageManager.getPattern(e.to.toString());return!n||!l}useProgram(e,n,l=!1,h=[]){this.cache=this.cache||{};const m=!!this.style.map.terrain,y=this.style.projection,S=l?Va.projectionMercator:y.shaderPreludeCode,M=l?bo:y.shaderDefine,R=e+(n?n.cacheKey:"")+`/${l?Uu:y.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(m?"/terrain":"")+(h?`/${h.join("/")}`:"");return this.cache[R]||(this.cache[R]=new Yc(this.context,Va[e],n,kr[e],this._showOverdrawInspector,m,S,M,h)),this.cache[R]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:n}=this.context.gl;return this.width!==e||this.height!==n}}function Ya(f,e){let n,l=!1,h=null,m=null;const y=()=>{h=null,l&&(f.apply(m,n),h=setTimeout(y,e),l=!1)};return(...S)=>(l=!0,m=this,n=S,h||y(),h)}class Wr{constructor(e){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let l;return n.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(l=h)}),(l&&l[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(!this._isValidHash(n))return!1;const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:l,pitch:+(n[4]||0)}),!0},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,n)},this._removeHash=()=>{const n=this._getCurrentHash();if(n.length===0)return;const l=n.join("/");let h=l;h.split("&").length>0&&(h=h.split("&")[0]),this._hashName&&(h=`${this._hashName}=${l}`);let m=window.location.hash.replace(h,"");m.startsWith("#&")?m=m.slice(0,1)+m.slice(2):m==="#"&&(m="");let y=window.location.href.replace(/(#.+)?$/,m);y=y.replace("&&","&"),window.history.replaceState(window.history.state,null,y)},this._updateHash=Ya(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const n=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,h=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),m=Math.pow(10,h),y=Math.round(n.lng*m)/m,S=Math.round(n.lat*m)/m,M=this._map.getBearing(),R=this._map.getPitch();let I="";if(I+=e?`/${y}/${S}/${l}`:`${l}/${S}/${y}`,(M||R)&&(I+="/"+Math.round(10*M)/10),R&&(I+=`/${Math.round(R)}`),this._hashName){const B=this._hashName;let O=!1;const j=window.location.hash.slice(1).split("&").map(Z=>{const ie=Z.split("=")[0];return ie===B?(O=!0,`${ie}=${I}`):Z}).filter(Z=>Z);return O||j.push(`${B}=${I}`),`#${j.join("&")}`}return`#${I}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new c.S(+e[2],+e[1])}catch{return!1}const n=+e[0],l=+(e[3]||0),h=+(e[4]||0);return n>=this._map.getMinZoom()&&n<=this._map.getMaxZoom()&&l>=-180&&l<=180&&h>=this._map.getMinPitch()&&h<=this._map.getMaxPitch()}}const Qr={linearity:.3,easing:c.cl(0,0,.3,1)},Or=c.e({deceleration:2500,maxSpeed:1400},Qr),xc=c.e({deceleration:20,maxSpeed:1400},Qr),Lo=c.e({deceleration:1e3,maxSpeed:360},Qr),Oo=c.e({deceleration:1e3,maxSpeed:90},Qr),bc=c.e({deceleration:1e3,maxSpeed:360},Qr);class Xs{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:xe.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,n=xe.now();for(;e.length>0&&n-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,roll:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:m}of this._inertiaBuffer)n.zoom+=m.zoomDelta||0,n.bearing+=m.bearingDelta||0,n.pitch+=m.pitchDelta||0,n.roll+=m.rollDelta||0,m.panDelta&&n.pan._add(m.panDelta),m.around&&(n.around=m.around),m.pinchAround&&(n.pinchAround=m.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,h={};if(n.pan.mag()){const m=xs(n.pan.mag(),l,c.e({},Or,e||{})),y=n.pan.mult(m.amount/n.pan.mag()),S=this._map.cameraHelper.handlePanInertia(y,this._map.transform);h.center=S.easingCenter,h.offset=S.easingOffset,Tn(h,m)}if(n.zoom){const m=xs(n.zoom,l,xc);h.zoom=this._map.transform.zoom+m.amount,Tn(h,m)}if(n.bearing){const m=xs(n.bearing,l,Lo);h.bearing=this._map.transform.bearing+c.ag(m.amount,-179,179),Tn(h,m)}if(n.pitch){const m=xs(n.pitch,l,Oo);h.pitch=this._map.transform.pitch+m.amount,Tn(h,m)}if(n.roll){const m=xs(n.roll,l,bc);h.roll=this._map.transform.roll+c.ag(m.amount,-179,179),Tn(h,m)}if(h.zoom||h.bearing){const m=n.pinchAround===void 0?n.around:n.pinchAround;h.around=m?this._map.unproject(m):this._map.getCenter()}return this.clear(),c.e(h,{noMoveStart:!0})}}function Tn(f,e){(!f.duration||f.duration<e.duration)&&(f.duration=e.duration,f.easing=e.easing)}function xs(f,e,n){const{maxSpeed:l,linearity:h,deceleration:m}=n,y=c.ag(f*h/(e/1e3),-l,l),S=Math.abs(y)/(m*h);return{easing:n.easing,duration:1e3*S,amount:y*(S/2)}}class Er extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,l,h={}){l=l instanceof MouseEvent?l:new MouseEvent(e,l);const m=de.mousePos(n.getCanvas(),l),y=n.unproject(m);super(e,c.e({point:m,lngLat:y,originalEvent:l},h)),this._defaultPrevented=!1,this.target=n}}class ka extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,l){const h=e==="touchend"?l.changedTouches:l.touches,m=de.touchPos(n.getCanvasContainer(),h),y=m.map(M=>n.unproject(M)),S=m.reduce((M,R,I,B)=>M.add(R.div(B.length)),new c.P(0,0));super(e,{points:m,point:S,lngLats:y,lngLat:n.unproject(S),originalEvent:l}),this._defaultPrevented=!1}}class ah extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,l){super(e,{originalEvent:l}),this._defaultPrevented=!1}}class td{constructor(e,n){this._map=e,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new ah(e.type,this._map,e))}mousedown(e,n){return this._mousedownPos=n,this._firePreventable(new Er(e.type,this._map,e))}mouseup(e){this._map.fire(new Er(e.type,this._map,e))}click(e,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new Er(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Er(e.type,this._map,e))}mouseover(e){this._map.fire(new Er(e.type,this._map,e))}mouseout(e){this._map.fire(new Er(e.type,this._map,e))}touchstart(e){return this._firePreventable(new ka(e.type,this._map,e))}touchmove(e){this._map.fire(new ka(e.type,this._map,e))}touchend(e){this._map.fire(new ka(e.type,this._map,e))}touchcancel(e){this._map.fire(new ka(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Fn{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Er(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Er("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Er(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ys{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(c.P.convert(e),this._map.terrain)}}class Bo{constructor(e,n){this._map=e,this._tr=new Ys(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,n){this.isEnabled()&&e.shiftKey&&e.button===0&&(de.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(e,n){if(!this._active)return;const l=n;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const h=this._startPos;this._lastPos=l,this._box||(this._box=de.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const m=Math.min(h.x,l.x),y=Math.max(h.x,l.x),S=Math.min(h.y,l.y),M=Math.max(h.y,l.y);de.setTransform(this._box,`translate(${m}px,${S}px)`),this._box.style.width=y-m+"px",this._box.style.height=M-S+"px"}mouseupWindow(e,n){if(!this._active||e.button!==0)return;const l=this._startPos,h=n;if(this.reset(),de.suppressClick(),l.x!==h.x||l.y!==h.y)return this._map.fire(new c.l("boxzoomend",{originalEvent:e})),{cameraAnimation:m=>m.fitScreenCoordinates(l,h,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(de.remove(this._box),this._box=null),de.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new c.l(e,{originalEvent:n}))}}function Ks(f,e){if(f.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${f.length}, points ${e.length}`);const n={};for(let l=0;l<f.length;l++)n[f[l].identifier]=e[l];return n}class su{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,n,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),l.length===this.numTouches&&(this.centroid=function(h){const m=new c.P(0,0);for(const y of h)m._add(y);return m.div(h.length)}(n),this.touches=Ks(l,n)))}touchmove(e,n,l){if(this.aborted||!this.centroid)return;const h=Ks(l,n);for(const m in this.touches){const y=h[m];(!y||y.dist(this.touches[m])>30)&&(this.aborted=!0)}}touchend(e,n,l){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const h=!this.aborted&&this.centroid;if(this.reset(),h)return h}}}class bs{constructor(e){this.singleTap=new su(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,n,l){this.singleTap.touchstart(e,n,l)}touchmove(e,n,l){this.singleTap.touchmove(e,n,l)}touchend(e,n,l){const h=this.singleTap.touchend(e,n,l);if(h){const m=e.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(h)<30;if(m&&y||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}}}class ws{constructor(e){this._tr=new Ys(e),this._zoomIn=new bs({numTouches:1,numTaps:2}),this._zoomOut=new bs({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,n,l){this._zoomIn.touchstart(e,n,l),this._zoomOut.touchstart(e,n,l)}touchmove(e,n,l){this._zoomIn.touchmove(e,n,l),this._zoomOut.touchmove(e,n,l)}touchend(e,n,l){const h=this._zoomIn.touchend(e,n,l),m=this._zoomOut.touchend(e,n,l),y=this._tr;return h?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:y.zoom+1,around:y.unproject(h)},{originalEvent:e})}):m?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:y.zoom-1,around:y.unproject(m)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Al{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const n=this._moveFunction(...e);if(n.bearingDelta||n.pitchDelta||n.rollDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(e,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(n)?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,n){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const h=Array.isArray(n)?n[0]:n;return!this._moved&&h.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=h,this._move(l,h))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&de.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Jr=0,La=2,sh={[Jr]:1,[La]:2};class Mn{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const n=de.mouseButton(e);this._eventButton=n}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(n,l){const h=sh[l];return n.buttons===void 0||(n.buttons&h)!==h}(e,this._eventButton)}isValidEndEvent(e){return de.mouseButton(e)===this._eventButton}}class Ws{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class ou{constructor(e=new Mn({checkCorrectEvent:()=>!0}),n=new Ws){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=n}_executeRelevantHandler(e,n,l){return e instanceof MouseEvent?n(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?l(e):void 0}startMove(e){this._executeRelevantHandler(e,n=>this.mouseMoveStateManager.startMove(n),n=>this.oneFingerTouchMoveStateManager.startMove(n))}endMove(e){this._executeRelevantHandler(e,n=>this.mouseMoveStateManager.endMove(n),n=>this.oneFingerTouchMoveStateManager.endMove(n))}isValidStartEvent(e){return this._executeRelevantHandler(e,n=>this.mouseMoveStateManager.isValidStartEvent(n),n=>this.oneFingerTouchMoveStateManager.isValidStartEvent(n))}isValidMoveEvent(e){return this._executeRelevantHandler(e,n=>this.mouseMoveStateManager.isValidMoveEvent(n),n=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(n))}isValidEndEvent(e){return this._executeRelevantHandler(e,n=>this.mouseMoveStateManager.isValidEndEvent(n),n=>this.oneFingerTouchMoveStateManager.isValidEndEvent(n))}}const wc=f=>{f.mousedown=f.dragStart,f.mousemoveWindow=f.dragMove,f.mouseup=f.dragEnd,f.contextmenu=e=>{e.preventDefault()}};class Sc{constructor(e,n){this._clickTolerance=e.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,n,l){return this._calculateTransform(e,n,l)}touchmove(e,n,l){if(this._active){if(!this._shouldBePrevented(l.length))return e.preventDefault(),this._calculateTransform(e,n,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,n,l){this._calculateTransform(e,n,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,l){l.length>0&&(this._active=!0);const h=Ks(l,n),m=new c.P(0,0),y=new c.P(0,0);let S=0;for(const R in h){const I=h[R],B=this._touches[R];B&&(m._add(I),y._add(I.sub(B)),S++,h[R]=I)}if(this._touches=h,this._shouldBePrevented(S)||!y.mag())return;const M=y.div(S);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:m.div(S),panDelta:M}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lu{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,n,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([n[0],n[1]]))}touchmove(e,n,l){if(!this._firstTwoTouches)return;e.preventDefault();const[h,m]=this._firstTwoTouches,y=Qs(l,n,h),S=Qs(l,n,m);if(!y||!S)return;const M=this._aroundCenter?null:y.add(S).div(2);return this._move([y,S],M,e)}touchend(e,n,l){if(!this._firstTwoTouches)return;const[h,m]=this._firstTwoTouches,y=Qs(l,n,h),S=Qs(l,n,m);y&&S||(this._active&&de.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Qs(f,e,n){for(let l=0;l<f.length;l++)if(f[l].identifier===n)return e[l]}function Js(f,e){return Math.log(f/e)/Math.LN2}class Oa extends lu{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,n){const l=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Js(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Js(this._distance,l),pinchAround:n}}}function _t(f,e){return 180*f.angleWith(e)/Math.PI}class cu extends lu{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,n,l){const h=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:_t(this._vector,h),pinchAround:n}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const n=25/(Math.PI*this._minDiameter)*360,l=_t(e,this._startVector);return Math.abs(l)<n}}function Ss(f){return Math.abs(f.y)>Math.abs(f.x)}class uu extends lu{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,n,l){super.touchstart(e,n,l),this._currentTouchCount=l.length}_start(e){this._lastPoints=e,Ss(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,n,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const h=e[0].sub(this._lastPoints[0]),m=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(h,m,l.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(h.y+m.y)/2*-.5}):void 0}gestureBeginsVertically(e,n,l){if(this._valid!==void 0)return this._valid;const h=e.mag()>=2,m=n.mag()>=2;if(!h&&!m)return;if(!h||!m)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const y=e.y>0==n.y>0;return Ss(e)&&Ss(n)&&y}}const zl={panStep:100,bearingStep:15,pitchStep:10};class ea{constructor(e){this._tr=new Ys(e);const n=zl;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let n=0,l=0,h=0,m=0,y=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?l=-1:(e.preventDefault(),m=-1);break;case 39:e.shiftKey?l=1:(e.preventDefault(),m=1);break;case 38:e.shiftKey?h=1:(e.preventDefault(),y=-1);break;case 40:e.shiftKey?h=-1:(e.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(l=0,h=0),{cameraAnimation:S=>{const M=this._tr;S.easeTo({duration:300,easeId:"keyboardHandler",easing:Tc,zoom:n?Math.round(M.zoom)+n*(e.shiftKey?2:1):M.zoom,bearing:M.bearing+l*this._bearingStep,pitch:M.pitch+h*this._pitchStep,offset:[-m*this._panStep,-y*this._panStep],center:M.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Tc(f){return f*(2-f)}const ii=4.000244140625,Ka=1/450;class Ts{constructor(e,n){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=e,this._tr=new Ys(e),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Ka}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let n=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const l=xe.now(),h=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,n!==0&&n%ii==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(h*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=de.mousePos(this._map.getCanvas(),e),l=this._tr;this._aroundPoint=this._aroundCenter?l.transform.locationToScreenPoint(c.S.convert(l.center)):n,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const S=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=S),typeof this._targetZoom=="number"&&(this._targetZoom+=S)}if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>ii?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&M!==0&&(M=1/M);const R=typeof this._targetZoom!="number"?e.scale:c.ae(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),c.aj(R*M)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,l=this._startZoom,h=this._easing;let m,y=!1;if(this._type==="wheel"&&l&&h){const S=xe.now()-this._lastWheelEventTime,M=Math.min((S+5)/200,1),R=h(M);m=c.C.number(l,n,R),M<1?this._frameId||(this._frameId=!0):y=!0}else m=n,y=!0;return this._active=!0,y&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=m,{noInertia:!0,needsRenderFrame:!y,zoomDelta:m-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=c.cn;if(this._prevEase){const l=this._prevEase,h=(xe.now()-l.start)/l.duration,m=l.easing(h+.01)-l.easing(h),y=.27/Math.sqrt(m*m+1e-4)*.01,S=Math.sqrt(.0729-y*y);n=c.cl(y,S,.25,1)}return this._prevEase={start:xe.now(),duration:e,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class eo{constructor(e,n){this._clickZoom=e,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class oh{constructor(e){this._tr=new Ys(e),this.reset()}reset(){this._active=!1}dblclick(e,n){return e.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lh{constructor(){this._tap=new bs({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,n,l){if(!this._swipePoint)if(this._tapTime){const h=n[0],m=e.timeStamp-this._tapTime<500,y=this._tapPoint.dist(h)<30;m&&y?l.length>0&&(this._swipePoint=h,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(e,n,l)}touchmove(e,n,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const h=n[0],m=h.y-this._swipePoint.y;return this._swipePoint=h,e.preventDefault(),this._active=!0,{zoomDelta:m/128}}}else this._tap.touchmove(e,n,l)}touchend(e,n,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const h=this._tap.touchend(e,n,l);h&&(this._tapTime=e.timeStamp,this._tapPoint=h)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fo{constructor(e,n,l){this._el=e,this._mousePan=n,this._touchPan=l}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class to{constructor(e,n,l,h){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=n,this._mousePitch=l,this._mouseRoll=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class hu{constructor(e,n,l,h){this._el=e,this._touchZoom=n,this._touchRotate=l,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ch{constructor(e,n){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=n,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=de.create("div","maplibregl-cooperative-gesture-screen",e);let n=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(n=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),h=document.createElement("div");h.className="maplibregl-desktop-message",h.textContent=n,this._container.appendChild(h);const m=document.createElement("div");m.className="maplibregl-mobile-message",m.textContent=l,this._container.appendChild(m),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(de.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,n){this._enabled&&(this._map.fire(new c.l("cooperativegestureprevented",{gestureType:e,originalEvent:n})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Wa=f=>f.zoom||f.drag||f.roll||f.pitch||f.rotate;class du extends c.l{}function fu(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta||f.rollDelta}class Qa{constructor(e,n){this.handleWindowEvent=h=>{this.handleEvent(h,`${h.type}Window`)},this.handleEvent=(h,m)=>{if(h.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const y=h.type==="renderFrame"?void 0:h,S={needsRenderFrame:!1},M={},R={};for(const{handlerName:O,handler:j,allowed:Z}of this._handlers){if(!j.isEnabled())continue;let ie;if(this._blockedByActive(R,Z,O))j.reset();else if(j[m||h.type]){if(c.co(h,m||h.type)){const te=de.mousePos(this._map.getCanvas(),h);ie=j[m||h.type](h,te)}else if(c.cp(h,m||h.type)){const te=this._getMapTouches(h.touches),ne=de.touchPos(this._map.getCanvas(),te);ie=j[m||h.type](h,ne,te)}else c.cq(m||h.type)||(ie=j[m||h.type](h));this.mergeHandlerResult(S,M,ie,O,y),ie&&ie.needsRenderFrame&&this._triggerRenderFrame()}(ie||j.isActive())&&(R[O]=j)}const I={};for(const O in this._previousActiveHandlers)R[O]||(I[O]=y);this._previousActiveHandlers=R,(Object.keys(I).length||fu(S))&&(this._changes.push([S,M,I]),this._triggerRenderFrame()),(Object.keys(R).length||fu(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=S;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Xs(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[h,m,y]of this._listeners)de.addEventListener(h,m,h===document?this.handleWindowEvent:this.handleEvent,y)}destroy(){for(const[e,n,l]of this._listeners)de.removeEventListener(e,n,e===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(e){const n=this._map,l=n.getCanvasContainer();this._add("mapEvent",new td(n,e));const h=n.boxZoom=new Bo(n,e);this._add("boxZoom",h),e.interactive&&e.boxZoom&&h.enable();const m=n.cooperativeGestures=new ch(n,e.cooperativeGestures);this._add("cooperativeGestures",m),e.cooperativeGestures&&m.enable();const y=new ws(n),S=new oh(n);n.doubleClickZoom=new eo(S,y),this._add("tapZoom",y),this._add("clickZoom",S),e.interactive&&e.doubleClickZoom&&n.doubleClickZoom.enable();const M=new lh;this._add("tapDragZoom",M);const R=n.touchPitch=new uu(n);this._add("touchPitch",R),e.interactive&&e.touchPitch&&n.touchPitch.enable(e.touchPitch);const I=()=>n.project(n.getCenter()),B=function({enable:oe,clickTolerance:pe,aroundCenter:ge=!0,minPixelCenterThreshold:le=100,rotateDegreesPerPixelMoved:we=.8},Oe){const Re=new Mn({checkCorrectEvent:De=>de.mouseButton(De)===0&&De.ctrlKey||de.mouseButton(De)===2&&!De.ctrlKey});return new Al({clickTolerance:pe,move:(De,Be)=>{const dt=Oe();if(ge&&Math.abs(dt.y-De.y)>le)return{bearingDelta:c.cm(new c.P(De.x,Be.y),Be,dt)};let ut=(Be.x-De.x)*we;return ge&&Be.y<dt.y&&(ut=-ut),{bearingDelta:ut}},moveStateManager:Re,enable:oe,assignEvents:wc})}(e,I),O=function({enable:oe,clickTolerance:pe,pitchDegreesPerPixelMoved:ge=-.5}){const le=new Mn({checkCorrectEvent:we=>de.mouseButton(we)===0&&we.ctrlKey||de.mouseButton(we)===2});return new Al({clickTolerance:pe,move:(we,Oe)=>({pitchDelta:(Oe.y-we.y)*ge}),moveStateManager:le,enable:oe,assignEvents:wc})}(e),j=function({enable:oe,clickTolerance:pe,rollDegreesPerPixelMoved:ge=.3},le){const we=new Mn({checkCorrectEvent:Oe=>de.mouseButton(Oe)===2&&Oe.ctrlKey});return new Al({clickTolerance:pe,move:(Oe,Re)=>{const De=le();let Be=(Re.x-Oe.x)*ge;return Re.y<De.y&&(Be=-Be),{rollDelta:Be}},moveStateManager:we,enable:oe,assignEvents:wc})}(e,I);n.dragRotate=new to(e,B,O,j),this._add("mouseRotate",B,["mousePitch"]),this._add("mousePitch",O,["mouseRotate","mouseRoll"]),this._add("mouseRoll",j,["mousePitch"]),e.interactive&&e.dragRotate&&n.dragRotate.enable();const Z=function({enable:oe,clickTolerance:pe}){const ge=new Mn({checkCorrectEvent:le=>de.mouseButton(le)===0&&!le.ctrlKey});return new Al({clickTolerance:pe,move:(le,we)=>({around:we,panDelta:we.sub(le)}),activateOnStart:!0,moveStateManager:ge,enable:oe,assignEvents:wc})}(e),ie=new Sc(e,n);n.dragPan=new Fo(l,Z,ie),this._add("mousePan",Z),this._add("touchPan",ie,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&n.dragPan.enable(e.dragPan);const te=new cu,ne=new Oa;n.touchZoomRotate=new hu(l,ne,te,M),this._add("touchRotate",te,["touchPan","touchZoom"]),this._add("touchZoom",ne,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&n.touchZoomRotate.enable(e.touchZoomRotate);const se=n.scrollZoom=new Ts(n,()=>this._triggerRenderFrame());this._add("scrollZoom",se,["mousePan"]),e.interactive&&e.scrollZoom&&n.scrollZoom.enable(e.scrollZoom);const ue=n.keyboard=new ea(n);this._add("keyboard",ue),e.interactive&&e.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new Fn(n))}_add(e,n,l){this._handlers.push({handlerName:e,handler:n,allowed:l}),this._handlersById[e]=n}stop(e){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Wa(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,n,l){for(const h in e)if(h!==l&&(!n||n.indexOf(h)<0))return!0;return!1}_getMapTouches(e){const n=[];for(const l of e)this._el.contains(l.target)&&n.push(l);return n}mergeHandlerResult(e,n,l,h,m){if(!l)return;c.e(e,l);const y={handlerName:h,originalEvent:l.originalEvent||m};l.zoomDelta!==void 0&&(n.zoom=y),l.panDelta!==void 0&&(n.drag=y),l.rollDelta!==void 0&&(n.roll=y),l.pitchDelta!==void 0&&(n.pitch=y),l.bearingDelta!==void 0&&(n.rotate=y)}_applyChanges(){const e={},n={},l={};for(const[h,m,y]of this._changes)h.panDelta&&(e.panDelta=(e.panDelta||new c.P(0,0))._add(h.panDelta)),h.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+h.zoomDelta),h.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+h.bearingDelta),h.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+h.pitchDelta),h.rollDelta&&(e.rollDelta=(e.rollDelta||0)+h.rollDelta),h.around!==void 0&&(e.around=h.around),h.pinchAround!==void 0&&(e.pinchAround=h.pinchAround),h.noInertia&&(e.noInertia=h.noInertia),c.e(n,m),c.e(l,y);this._updateMapTransform(e,n,l),this._changes=[]}_updateMapTransform(e,n,l){const h=this._map,m=h._getTransformForUpdate(),y=h.terrain;if(!(fu(e)||y&&this._terrainMovement))return this._fireEvents(n,l,!0);h._stop(!0);let{panDelta:S,zoomDelta:M,bearingDelta:R,pitchDelta:I,rollDelta:B,around:O,pinchAround:j}=e;j!==void 0&&(O=j),O=O||h.transform.centerPoint,y&&!m.isPointOnMapSurface(O)&&(O=m.centerPoint);const Z={panDelta:S,zoomDelta:M,rollDelta:B,pitchDelta:I,bearingDelta:R,around:O};this._map.cameraHelper.useGlobeControls&&!m.isPointOnMapSurface(O)&&(O=m.centerPoint);const ie=O.distSqr(m.centerPoint)<.01?m.center:m.screenPointToLocation(S?O.sub(S):O);y?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(Z,m),this._terrainMovement||!n.drag&&!n.zoom?n.drag&&this._terrainMovement?m.setCenter(m.screenPointToLocation(m.centerPoint.sub(S))):this._map.cameraHelper.handleMapControlsPan(Z,m,ie):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(Z,m,ie))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(Z,m),this._map.cameraHelper.handleMapControlsPan(Z,m,ie)),h._applyUpdatedTransform(m),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(n,l,!0)}_fireEvents(e,n,l){const h=Wa(this._eventsInProgress),m=Wa(e),y={};for(const B in e){const{originalEvent:O}=e[B];this._eventsInProgress[B]||(y[`${B}start`]=O),this._eventsInProgress[B]=e[B]}!h&&m&&this._fireEvent("movestart",m.originalEvent);for(const B in y)this._fireEvent(B,y[B]);m&&this._fireEvent("move",m.originalEvent);for(const B in e){const{originalEvent:O}=e[B];this._fireEvent(B,O)}const S={};let M;for(const B in this._eventsInProgress){const{handlerName:O,originalEvent:j}=this._eventsInProgress[B];this._handlersById[O].isActive()||(delete this._eventsInProgress[B],M=n[O]||j,S[`${B}end`]=M)}for(const B in S)this._fireEvent(B,S[B]);const R=Wa(this._eventsInProgress),I=(h||m)&&!R;if(I&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const B=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&B.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(B)}if(l&&I){this._updatingCamera=!0;const B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;!B||!B.essential&&xe.prefersReducedMotion?(this._map.fire(new c.l("moveend",{originalEvent:M})),O(this._map.getBearing())&&this._map.resetNorth()):(O(B.bearing||this._map.getBearing())&&(B.bearing=0),B.freezeElevation=!0,this._map.easeTo(B,{originalEvent:M})),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new c.l(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new du("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ni extends c.E{constructor(e,n,l){super(),this._renderFrameCallback=()=>{const h=Math.min((xe.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=l.bearingSnap,this.cameraHelper=n,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,n){e.apply(this.transform),this.transform=e,this.cameraHelper=n}getCenter(){return new c.S(this.transform.center.lng,this.transform.center.lat)}setCenter(e,n){return this.jumpTo({center:e},n)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,n){return this.jumpTo({elevation:e},n),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,n,l){return e=c.P.convert(e).mult(-1),this.panTo(this.transform.center,c.e({offset:e},n),l)}panTo(e,n,l){return this.easeTo(c.e({center:e},n),l)}getZoom(){return this.transform.zoom}setZoom(e,n){return this.jumpTo({zoom:e},n),this}zoomTo(e,n,l){return this.easeTo(c.e({zoom:e},n),l)}zoomIn(e,n){return this.zoomTo(this.getZoom()+1,e,n),this}zoomOut(e,n){return this.zoomTo(this.getZoom()-1,e,n),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,n){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new c.l("movestart",n)).fire(new c.l("move",n)).fire(new c.l("moveend",n))),this}getBearing(){return this.transform.bearing}setBearing(e,n){return this.jumpTo({bearing:e},n),this}getPadding(){return this.transform.padding}setPadding(e,n){return this.jumpTo({padding:e},n),this}rotateTo(e,n,l){return this.easeTo(c.e({bearing:e},n),l)}resetNorth(e,n){return this.rotateTo(0,c.e({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo(c.e({bearing:0,pitch:0,roll:0,duration:1e3},e),n),this}snapToNorth(e,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,n):this}getPitch(){return this.transform.pitch}setPitch(e,n){return this.jumpTo({pitch:e},n),this}getRoll(){return this.transform.roll}setRoll(e,n){return this.jumpTo({roll:e},n),this}cameraForBounds(e,n){e=tn.convert(e).adjustAntiMeridian();const l=n&&n.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),l,n)}_cameraForBoxAndBearing(e,n,l,h){const m={top:0,bottom:0,right:0,left:0};if(typeof(h=c.e({padding:m,offset:[0,0],maxZoom:this.transform.maxZoom},h)).padding=="number"){const R=h.padding;h.padding={top:R,bottom:R,right:R,left:R}}const y=c.e(m,h.padding);h.padding=y;const S=this.transform,M=new tn(e,n);return this.cameraHelper.cameraForBoxAndBearing(h,y,M,l,S)}fitBounds(e,n,l){return this._fitInternal(this.cameraForBounds(e,n),n,l)}fitScreenCoordinates(e,n,l,h,m){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(c.P.convert(e)),this.transform.screenPointToLocation(c.P.convert(n)),l,h),h,m)}_fitInternal(e,n,l){return e?(delete(n=c.e(e,n)).padding,n.linear?this.easeTo(n,l):this.flyTo(n,l)):this}jumpTo(e,n){this.stop();const l=this._getTransformForUpdate();let h=!1,m=!1,y=!1;const S=l.zoom;this.cameraHelper.handleJumpToCenterZoom(l,e);const M=l.zoom!==S;return"elevation"in e&&l.elevation!==+e.elevation&&l.setElevation(+e.elevation),"bearing"in e&&l.bearing!==+e.bearing&&(h=!0,l.setBearing(+e.bearing)),"pitch"in e&&l.pitch!==+e.pitch&&(m=!0,l.setPitch(+e.pitch)),"roll"in e&&l.roll!==+e.roll&&(y=!0,l.setRoll(+e.roll)),e.padding==null||l.isPaddingEqual(e.padding)||l.setPadding(e.padding),this._applyUpdatedTransform(l),this.fire(new c.l("movestart",n)).fire(new c.l("move",n)),M&&this.fire(new c.l("zoomstart",n)).fire(new c.l("zoom",n)).fire(new c.l("zoomend",n)),h&&this.fire(new c.l("rotatestart",n)).fire(new c.l("rotate",n)).fire(new c.l("rotateend",n)),m&&this.fire(new c.l("pitchstart",n)).fire(new c.l("pitch",n)).fire(new c.l("pitchend",n)),y&&this.fire(new c.l("rollstart",n)).fire(new c.l("roll",n)).fire(new c.l("rollend",n)),this.fire(new c.l("moveend",n))}calculateCameraOptionsFromTo(e,n,l,h=0){const m=c.a0.fromLngLat(e,n),y=c.a0.fromLngLat(l,h),S=y.x-m.x,M=y.y-m.y,R=y.z-m.z,I=Math.hypot(S,M,R);if(I===0)throw new Error("Can't calculate camera options with same From and To");const B=Math.hypot(S,M),O=c.aj(this.transform.cameraToCenterDistance/I/this.transform.tileSize),j=180*Math.atan2(S,-M)/Math.PI;let Z=180*Math.acos(B/I)/Math.PI;return Z=R<0?90-Z:90+Z,{center:y.toLngLat(),elevation:h,zoom:O,pitch:Z,bearing:j}}calculateCameraOptionsFromCameraLngLatAltRotation(e,n,l,h,m){const y=this.transform.calculateCenterFromCameraLngLatAlt(e,n,l,h);return{center:y.center,elevation:y.elevation,zoom:y.zoom,bearing:l,pitch:h,roll:m}}easeTo(e,n){this._stop(!1,e.easeId),((e=c.e({offset:[0,0],duration:500,easing:c.cn},e)).animate===!1||!e.essential&&xe.prefersReducedMotion)&&(e.duration=0);const l=this._getTransformForUpdate(),h=this.getBearing(),m=l.pitch,y=l.roll,S="bearing"in e?this._normalizeBearing(e.bearing,h):h,M="pitch"in e?+e.pitch:m,R="roll"in e?this._normalizeBearing(e.roll,y):y,I="padding"in e?e.padding:l.padding,B=c.P.convert(e.offset);let O,j;e.around&&(O=c.S.convert(e.around),j=l.locationToScreenPoint(O));const Z={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},ie=this.cameraHelper.handleEaseTo(l,{bearing:S,pitch:M,roll:R,padding:I,around:O,aroundPoint:j,offsetAsPoint:B,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||h!==S,this._pitching=this._pitching||M!==m,this._rolling=this._rolling||R!==y,this._padding=!l.isPaddingEqual(I),this._zooming=this._zooming||ie.isZooming,this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,Z),this.terrain&&this._prepareElevation(ie.elevationCenter),this._ease(te=>{ie.easeFunc(te),this.terrain&&!e.freezeElevation&&this._updateElevation(te),this._applyUpdatedTransform(l),this._fireMoveEvents(n)},te=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n,te)},e),this}_prepareEase(e,n,l={}){this._moving=!0,n||l.moving||this.fire(new c.l("movestart",e)),this._zooming&&!l.zooming&&this.fire(new c.l("zoomstart",e)),this._rotating&&!l.rotating&&this.fire(new c.l("rotatestart",e)),this._pitching&&!l.pitching&&this.fire(new c.l("pitchstart",e)),this._rolling&&!l.rolling&&this.fire(new c.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&n!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(l-(n-(l*e+this._elevationStart))/(1-e)),this._elevationTarget=n}this.transform.setElevation(c.C.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const n=e.getCameraLngLat(),l=e.getCameraAltitude(),h=this.terrain?this.terrain.getElevationForLngLatZoom(n,e.zoom):0;if(l<h){const m=this.calculateCameraOptionsFromTo(n,h,e.center,e.elevation);return{pitch:m.pitch,zoom:m.zoom}}return{}}_applyUpdatedTransform(e){const n=[];if(n.push(h=>this._elevateCameraIfInsideTerrain(h)),this.transformCameraUpdate&&n.push(h=>this.transformCameraUpdate(h)),!n.length)return;const l=e.clone();for(const h of n){const m=l.clone(),{center:y,zoom:S,roll:M,pitch:R,bearing:I,elevation:B}=h(m);y&&m.setCenter(y),B!==void 0&&m.setElevation(B),S!==void 0&&m.setZoom(S),M!==void 0&&m.setRoll(M),R!==void 0&&m.setPitch(R),I!==void 0&&m.setBearing(I),l.apply(m)}this.transform.apply(l)}_fireMoveEvents(e){this.fire(new c.l("move",e)),this._zooming&&this.fire(new c.l("zoom",e)),this._rotating&&this.fire(new c.l("rotate",e)),this._pitching&&this.fire(new c.l("pitch",e)),this._rolling&&this.fire(new c.l("roll",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const l=this._zooming,h=this._rotating,m=this._pitching,y=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,l&&this.fire(new c.l("zoomend",e)),h&&this.fire(new c.l("rotateend",e)),m&&this.fire(new c.l("pitchend",e)),y&&this.fire(new c.l("rollend",e)),this.fire(new c.l("moveend",e))}flyTo(e,n){if(!e.essential&&xe.prefersReducedMotion){const Be=c.Q(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Be,n)}this.stop(),e=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.cn},e);const l=this._getTransformForUpdate(),h=l.bearing,m=l.pitch,y=l.roll,S=l.padding,M="bearing"in e?this._normalizeBearing(e.bearing,h):h,R="pitch"in e?+e.pitch:m,I="roll"in e?this._normalizeBearing(e.roll,y):y,B="padding"in e?e.padding:l.padding,O=c.P.convert(e.offset);let j=l.centerPoint.add(O);const Z=l.screenPointToLocation(j),ie=this.cameraHelper.handleFlyTo(l,{bearing:M,pitch:R,roll:I,padding:B,locationAtOffset:Z,offsetAsPoint:O,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let te=e.curve;const ne=Math.max(l.width,l.height),se=ne/ie.scaleOfZoom,ue=ie.pixelPathLength;typeof ie.scaleOfMinZoom=="number"&&(te=Math.sqrt(ne/ie.scaleOfMinZoom/ue*2));const oe=te*te;function pe(Be){const dt=(se*se-ne*ne+(Be?-1:1)*oe*oe*ue*ue)/(2*(Be?se:ne)*oe*ue);return Math.log(Math.sqrt(dt*dt+1)-dt)}function ge(Be){return(Math.exp(Be)-Math.exp(-Be))/2}function le(Be){return(Math.exp(Be)+Math.exp(-Be))/2}const we=pe(!1);let Oe=function(Be){return le(we)/le(we+te*Be)},Re=function(Be){return ne*((le(we)*(ge(dt=we+te*Be)/le(dt))-ge(we))/oe)/ue;var dt},De=(pe(!0)-we)/te;if(Math.abs(ue)<2e-6||!isFinite(De)){if(Math.abs(ne-se)<1e-6)return this.easeTo(e,n);const Be=se<ne?-1:1;De=Math.abs(Math.log(se/ne))/te,Re=()=>0,Oe=dt=>Math.exp(Be*te*dt)}return e.duration="duration"in e?+e.duration:1e3*De/("screenSpeed"in e?+e.screenSpeed/te:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=h!==M,this._pitching=R!==m,this._rolling=I!==y,this._padding=!l.isPaddingEqual(B),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(ie.targetCenter),this._ease(Be=>{const dt=Be*De,ut=1/Oe(dt),it=Re(dt);this._rotating&&l.setBearing(c.C.number(h,M,Be)),this._pitching&&l.setPitch(c.C.number(m,R,Be)),this._rolling&&l.setRoll(c.C.number(y,I,Be)),this._padding&&(l.interpolatePadding(S,B,Be),j=l.centerPoint.add(O)),ie.easeFunc(Be,ut,it,j),this.terrain&&!e.freezeElevation&&this._updateElevation(Be),this._applyUpdatedTransform(l),this._fireMoveEvents(n)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,n){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,n)}return e||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(e,n,l){l.animate===!1||l.duration===0?(e(1),n()):(this._easeStart=xe.now(),this._easeOptions=l,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,n){e=c.aN(e,-180,180);const l=Math.abs(e-n);return Math.abs(e-360-n)<l&&(e-=360),Math.abs(e+360-n)<l&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(c.S.convert(e),this.transform.tileZoom):null}}const fa={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ni{constructor(e=fa){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=de.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=de.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=de.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){de.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,n){const l=this._map._getUIString(`AttributionControl.${n}`);e.title=l,e.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(h=>typeof h!="string"?"":h)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}const n=this._map.style.sourceCaches;for(const h in n){const m=n[h];if(m.used||m.usedForTerrain){const y=m.getSource();y.attribution&&e.indexOf(y.attribution)<0&&e.push(y.attribution)}}e=e.filter(h=>String(h).trim()),e.sort((h,m)=>h.length-m.length),e=e.filter((h,m)=>{for(let y=m+1;y<e.length;y++)if(e[y].indexOf(h)>=0)return!1;return!0});const l=e.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,e.length?(this._innerContainer.innerHTML=de.sanitize(l),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ci{constructor(e={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const l=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=de.create("div","maplibregl-ctrl");const n=de.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){de.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class En{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const n=++this._id;return this._queue.push({callback:e,id:n,cancelled:!1}),n}remove(e){const n=this._currentlyRunning,l=n?this._queue.concat(n):this._queue;for(const h of l)if(h.id===e)return void(h.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const l of n)if(!l.cancelled&&(l.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Mc=c.aI([{name:"a_pos3d",type:"Int16",components:3}]);class Pl extends c.E{constructor(e){super(),this._lastTilesetChange=xe.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,n){this.sourceCache.update(e,n),this._renderableTilesKeys=[];const l={};for(const h of je(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))l[h.key]=!0,this._renderableTilesKeys.push(h.key),this._tiles[h.key]||(h.terrainRttPosMatrix32f=new Float64Array(16),c.bX(h.terrainRttPosMatrix32f,0,c.$,c.$,0,0,1),this._tiles[h.key]=new nr(h,this.tileSize),this._lastTilesetChange=xe.now());for(const h in this._tiles)l[h]||delete this._tiles[h]}freeRtt(e){for(const n in this._tiles){const l=this._tiles[n];(!e||l.tileID.equals(e)||l.tileID.isChildOf(e)||e.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,n){return n?this._getTerrainCoordsForTileRanges(e,n):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const n={};for(const l of this._renderableTilesKeys){const h=this._tiles[l].tileID,m=e.clone(),y=c.b9();if(h.canonical.equals(e.canonical))c.bX(y,0,c.$,c.$,0,0,1);else if(h.canonical.isChildOf(e.canonical)){const S=h.canonical.z-e.canonical.z,M=h.canonical.x-(h.canonical.x>>S<<S),R=h.canonical.y-(h.canonical.y>>S<<S),I=c.$>>S;c.bX(y,0,I,I,0,0,1),c.M(y,y,[-M*I,-R*I,0])}else{if(!e.canonical.isChildOf(h.canonical))continue;{const S=e.canonical.z-h.canonical.z,M=e.canonical.x-(e.canonical.x>>S<<S),R=e.canonical.y-(e.canonical.y>>S<<S),I=c.$>>S;c.bX(y,0,c.$,c.$,0,0,1),c.M(y,y,[M*I,R*I,0]),c.N(y,y,[1/2**S,1/2**S,0])}}m.terrainRttPosMatrix32f=new Float32Array(y),n[l]=m}return n}_getTerrainCoordsForTileRanges(e,n){const l={};for(const h of this._renderableTilesKeys){const m=this._tiles[h].tileID;if(!this._isWithinTileRanges(m,n))continue;const y=e.clone(),S=c.b9();if(m.canonical.z===e.canonical.z){const M=e.canonical.x-m.canonical.x,R=e.canonical.y-m.canonical.y;c.bX(S,0,c.$,c.$,0,0,1),c.M(S,S,[M*c.$,R*c.$,0])}else if(m.canonical.z>e.canonical.z){const M=m.canonical.z-e.canonical.z,R=m.canonical.x-(m.canonical.x>>M<<M),I=m.canonical.y-(m.canonical.y>>M<<M),B=e.canonical.x-(m.canonical.x>>M),O=e.canonical.y-(m.canonical.y>>M),j=c.$>>M;c.bX(S,0,j,j,0,0,1),c.M(S,S,[-R*j+B*c.$,-I*j+O*c.$,0])}else{const M=e.canonical.z-m.canonical.z,R=e.canonical.x-(e.canonical.x>>M<<M),I=e.canonical.y-(e.canonical.y>>M<<M),B=(e.canonical.x>>M)-m.canonical.x,O=(e.canonical.y>>M)-m.canonical.y,j=c.$<<M;c.bX(S,0,j,j,0,0,1),c.M(S,S,[R*c.$+B*j,I*c.$+O*j,0])}y.terrainRttPosMatrix32f=new Float32Array(S),l[h]=y}return l}getSourceTile(e,n){const l=this.sourceCache._source;let h=e.overscaledZ-this.deltaZoom;if(h>l.maxzoom&&(h=l.maxzoom),h<l.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(h).key);let m=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!m||!m.dem)&&n)for(;h>=l.minzoom&&(!m||!m.dem);)m=this.sourceCache.getTileByID(e.scaledTo(h--).key);return m}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,n){return n[e.canonical.z]&&e.canonical.x>=n[e.canonical.z].minTileX&&e.canonical.x<=n[e.canonical.z].maxTileX&&e.canonical.y>=n[e.canonical.z].minTileY&&e.canonical.y<=n[e.canonical.z].maxTileY}}class gr{constructor(e,n,l){this._meshCache={},this.painter=e,this.sourceCache=new Pl(n),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,n,l,h=c.$){var m;if(!(n>=0&&n<h&&l>=0&&l<h))return 0;const y=this.getTerrainData(e),S=(m=y.tile)===null||m===void 0?void 0:m.dem;if(!S)return 0;const M=c.cr([],[n/h*c.$,l/h*c.$],y.u_terrain_matrix),R=[M[0]*S.dim,M[1]*S.dim],I=Math.floor(R[0]),B=Math.floor(R[1]),O=R[0]-I,j=R[1]-B;return S.get(I,B)*(1-O)*(1-j)+S.get(I+1,B)*O*(1-j)+S.get(I,B+1)*(1-O)*j+S.get(I+1,B+1)*O*j}getElevationForLngLatZoom(e,n){if(!c.cs(n,e.wrap()))return 0;const{tileID:l,mercatorX:h,mercatorY:m}=this._getOverscaledTileIDFromLngLatZoom(e,n);return this.getElevation(l,h%c.$,m%c.$,c.$)}getElevation(e,n,l,h=c.$){return this.getDEMElevation(e,n,l,h)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const h=this.painter.context,m=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new c.T(h,m,h.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new c.T(h,new c.R({width:1,height:1}),h.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.af([])}const n=this.sourceCache.getSourceTile(e,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const h=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new c.T(h,n.dem.getPixels(),h.gl.RGBA,{premultiply:!1}),n.demTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const l=n&&n+n.tileID.key+e.key;if(l&&!this._demMatrixCache[l]){const h=this.sourceCache.sourceCache._source.maxzoom;let m=e.canonical.z-n.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=h?m=e.canonical.z-h:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const y=e.canonical.x-(e.canonical.x>>m<<m),S=e.canonical.y-(e.canonical.y>>m<<m),M=c.ct(new Float64Array(16),[1/(c.$<<m),1/(c.$<<m),0]);c.M(M,M,[y*c.$,S*c.$,0]),this._demMatrixCache[e.key]={matrix:M,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(e){const n=this.painter,l=n.width/devicePixelRatio,h=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===h||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new c.T(n.context,{width:l,height:h,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new c.T(n.context,{width:l,height:h,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(l,h,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,l,h))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let m=0,y=0;m<this._coordsTextureSize;m++)for(let S=0;S<this._coordsTextureSize;S++,y+=4)n[y+0]=255&S,n[y+1]=255&m,n[y+2]=S>>8<<4|m>>8,n[y+3]=0;const l=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),h=new c.T(e,l,e.gl.RGBA,{premultiply:!1});return h.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=h,h}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const n=new Uint8Array(4),l=this.painter.context,h=l.gl,m=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),y=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),S=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),h.readPixels(m,S-y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,n),l.bindFramebuffer.set(null);const M=n[0]+(n[2]>>4<<8),R=n[1]+((15&n[2])<<8),I=this.coordsIndex[255-n[3]],B=I&&this.sourceCache.getTileByID(I);if(!B)return null;const O=this._coordsTextureSize,j=(1<<B.tileID.canonical.z)*O;return new c.a0((B.tileID.canonical.x*O+M)/j+B.tileID.wrap,(B.tileID.canonical.y*O+R)/j,this.getElevation(B.tileID,M,R,O))}depthAtPoint(e){const n=new Uint8Array(4),l=this.painter.context,h=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),h.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,n),l.bindFramebuffer.set(null),(n[0]/16777216+n[1]/65536+n[2]/256+n[3])/256}getTerrainMesh(e){var n;const l=((n=this.painter.style.projection)===null||n===void 0?void 0:n.transitionState)>0,h=l&&e.canonical.y===0,m=l&&e.canonical.y===(1<<e.canonical.z)-1,y=`m_${h?"n":""}_${m?"s":""}`;if(this._meshCache[y])return this._meshCache[y];const S=this.painter.context,M=new c.cu,R=new c.aM,I=this.meshSize,B=c.$/I,O=I*I;for(let le=0;le<=I;le++)for(let we=0;we<=I;we++)M.emplaceBack(we*B,le*B,0);for(let le=0;le<O;le+=I+1)for(let we=0;we<I;we++)R.emplaceBack(we+le,I+we+le+1,I+we+le+2),R.emplaceBack(we+le,I+we+le+2,we+le+1);const j=M.length,Z=j+(I+1),ie=(I+1)*I,te=h?c.bg:0,ne=h?0:1,se=m?c.bh:c.$,ue=m?0:1;for(let le=0;le<=I;le++)M.emplaceBack(le*B,te,ne);for(let le=0;le<=I;le++)M.emplaceBack(le*B,se,ue);for(let le=0;le<I;le++)R.emplaceBack(ie+le,Z+le,Z+le+1),R.emplaceBack(ie+le,Z+le+1,ie+le+1),R.emplaceBack(0+le,j+le+1,j+le),R.emplaceBack(0+le,0+le+1,j+le+1);const oe=M.length,pe=oe+2*(I+1);for(const le of[0,1])for(let we=0;we<=I;we++)for(const Oe of[0,1])M.emplaceBack(le*c.$,we*B,Oe);for(let le=0;le<2*I;le+=2)R.emplaceBack(oe+le,oe+le+1,oe+le+3),R.emplaceBack(oe+le,oe+le+3,oe+le+2),R.emplaceBack(pe+le,pe+le+3,pe+le+1),R.emplaceBack(pe+le,pe+le+2,pe+le+3);const ge=new Ga(S.createVertexBuffer(M,Mc.members),S.createIndexBuffer(R),c.aL.simpleSegment(0,0,M.length,R.length));return this._meshCache[y]=ge,ge}getMeshFrameDelta(e){return 2*Math.PI*c.bt/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,n){var l;const{tileID:h}=this._getOverscaledTileIDFromLngLatZoom(e,n);return(l=this.getMinMaxElevation(h).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(e){const n=this.getTerrainData(e).tile,l={minElevation:null,maxElevation:null};return n&&n.dem&&(l.minElevation=n.dem.min*this.exaggeration,l.maxElevation=n.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(e,n){const l=c.a0.fromLngLat(e.wrap()),h=(1<<n)*c.$,m=l.x*h,y=l.y*h,S=Math.floor(m/c.$),M=Math.floor(y/c.$);return{tileID:new c.Z(n,0,n,S,M),mercatorX:m,mercatorY:y}}}class No{constructor(e,n,l){this._context=e,this._size=n,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new c.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(l.texture),{id:e,fbo:n,texture:l,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(n=>e.id!==n),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const xt={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class zt{constructor(e,n){this.painter=e,this.terrain=n,this.pool=new No(e.context,30,n.sourceCache.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(l=>!e._layers[l].isHidden(n)),this._coordsAscending={};for(const l in e.sourceCaches){this._coordsAscending[l]={};const h=e.sourceCaches[l].getVisibleCoordinates(),m=e.sourceCaches[l].getSource(),y=m instanceof br?m.terrainTileRanges:null;for(const S of h){const M=this.terrain.sourceCache.getTerrainCoords(S,y);for(const R in M)this._coordsAscending[l][R]||(this._coordsAscending[l][R]=[]),this._coordsAscending[l][R].push(M[R])}}this._coordsAscendingStr={};for(const l of e._order){const h=e._layers[l],m=h.source;if(xt[h.type]&&!this._coordsAscendingStr[m]){this._coordsAscendingStr[m]={};for(const y in this._coordsAscending[m])this._coordsAscendingStr[m][y]=this._coordsAscending[m][y].map(S=>S.key).sort().join()}}for(const l of this._renderableTiles)for(const h in this._coordsAscendingStr){const m=this._coordsAscendingStr[h][l.tileID.key];m&&m!==l.rttCoords[h]&&(l.rtt=[])}}renderLayer(e,n){if(e.isHidden(this.painter.transform.zoom))return!1;const l=Object.assign(Object.assign({},n),{isRenderingToTexture:!0}),h=e.type,m=this.painter,y=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(xt[h]&&(this._prevType&&xt[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(e.id),!y))return!0;if(xt[this._prevType]||xt[h]&&y){this._prevType=h;const S=this._stacks.length-1,M=this._stacks[S]||[];for(const R of this._renderableTiles){if(this.pool.isFull()&&(cn(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(R),R.rtt[S]){const B=this.pool.getObjectForId(R.rtt[S].id);if(B.stamp===R.rtt[S].stamp){this.pool.useObject(B);continue}}const I=this.pool.getOrCreateFreeObject();this.pool.useObject(I),this.pool.stampObject(I),R.rtt[S]={id:I.id,stamp:I.stamp},m.context.bindFramebuffer.set(I.fbo.framebuffer),m.context.clear({color:c.be.transparent,stencil:0}),m.currentStencilSource=void 0;for(let B=0;B<M.length;B++){const O=m.style._layers[M[B]],j=O.source?this._coordsAscending[O.source][R.tileID.key]:[R.tileID];m.context.viewport.set([0,0,I.fbo.width,I.fbo.height]),m._renderTileClippingMasks(O,j,!0),m.renderLayer(m,m.style.sourceCaches[O.source],O,j,l),O.source&&(R.rttCoords[O.source]=this._coordsAscendingStr[O.source][R.tileID.key])}}return cn(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects(),xt[h]}return!1}}const pu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},dn=J,jo={hash:!1,interactive:!0,bearingSnap:7,attributionControl:fa,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},lr={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class uh{constructor(e,n,l=!1){this.mousedown=m=>{this.startMove(m,de.mousePos(this.element,m)),de.addEventListener(window,"mousemove",this.mousemove),de.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=m=>{this.move(m,de.mousePos(this.element,m))},this.mouseup=m=>{this._rotatePitchHanlder.dragEnd(m),this.offTemp()},this.touchstart=m=>{m.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=de.touchPos(this.element,m.targetTouches)[0],this.startMove(m,this._startPos),de.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),de.addEventListener(window,"touchend",this.touchend))},this.touchmove=m=>{m.targetTouches.length!==1?this.reset():(this._lastPos=de.touchPos(this.element,m.targetTouches)[0],this.move(m,this._lastPos))},this.touchend=m=>{m.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=n;const h=new ou;this._rotatePitchHanlder=new Al({clickTolerance:3,move:(m,y)=>{const S=n.getBoundingClientRect(),M=new c.P((S.bottom-S.top)/2,(S.right-S.left)/2);return{bearingDelta:c.cm(new c.P(m.x,y.y),y,M),pitchDelta:l?-.5*(y.y-m.y):void 0}},moveStateManager:h,enable:!0,assignEvents:()=>{}}),this.map=e,de.addEventListener(n,"mousedown",this.mousedown),de.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),de.addEventListener(n,"touchcancel",this.reset)}startMove(e,n){this._rotatePitchHanlder.dragStart(e,n),de.disableDrag()}move(e,n){const l=this.map,{bearingDelta:h,pitchDelta:m}=this._rotatePitchHanlder.dragMove(e,n)||{};h&&l.setBearing(l.getBearing()+h),m&&l.setPitch(l.getPitch()+m)}off(){const e=this.element;de.removeEventListener(e,"mousedown",this.mousedown),de.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),de.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),de.removeEventListener(window,"touchend",this.touchend),de.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){de.enableDrag(),de.removeEventListener(window,"mousemove",this.mousemove),de.removeEventListener(window,"mouseup",this.mouseup),de.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),de.removeEventListener(window,"touchend",this.touchend)}}let er;function id(f,e,n,l=!1){if(l||!n.getCoveringTilesDetailsProvider().allowWorldCopies())return f==null?void 0:f.wrap();const h=new c.S(f.lng,f.lat);if(f=new c.S(f.lng,f.lat),e){const m=new c.S(f.lng-360,f.lat),y=new c.S(f.lng+360,f.lat),S=n.locationToScreenPoint(f).distSqr(e);n.locationToScreenPoint(m).distSqr(e)<S?f=m:n.locationToScreenPoint(y).distSqr(e)<S&&(f=y)}for(;Math.abs(f.lng-n.center.lng)>180;){const m=n.locationToScreenPoint(f);if(m.x>=0&&m.y>=0&&m.x<=n.width&&m.y<=n.height)break;f.lng>n.center.lng?f.lng-=360:f.lng+=360}return f.lng!==h.lng&&n.isPointOnMapSurface(n.locationToScreenPoint(f))?f:h}const Ms={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ki(f,e,n){const l=f.classList;for(const h in Ms)l.remove(`maplibregl-${n}-anchor-${h}`);l.add(`maplibregl-${n}-anchor-${e}`)}class an extends c.E{constructor(e){if(super(),this._onKeyPress=n=>{const l=n.code,h=n.charCode||n.keyCode;l!=="Space"&&l!=="Enter"&&h!==32&&h!==13||this.togglePopup()},this._onMapClick=n=>{const l=n.originalEvent.target,h=this._element;this._popup&&(l===h||h.contains(l))&&this.togglePopup()},this._update=n=>{if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();((n==null?void 0:n.type)==="terrain"||(n==null?void 0:n.type)==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=id(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let m="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?m="rotateX(0deg)":this._pitchAlignment==="map"&&(m=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||n&&n.type!=="moveend"||(this._pos=this._pos.round()),de.setTransform(this._element,`${Ms[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${m} ${h}`),xe.frameAsync(new AbortController).then(()=>{this._updateOpacity(n&&n.type==="moveend")}).catch(()=>{})},this._onMove=n=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.l("dragstart"))),this.fire(new c.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.l("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=c.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=de.create("div");const n=de.createNS("http://www.w3.org/2000/svg","svg"),l=41,h=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${l}px`),n.setAttributeNS(null,"width",`${h}px`),n.setAttributeNS(null,"viewBox",`0 0 ${h} ${l}`);const m=de.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"stroke","none"),m.setAttributeNS(null,"stroke-width","1"),m.setAttributeNS(null,"fill","none"),m.setAttributeNS(null,"fill-rule","evenodd");const y=de.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"fill-rule","nonzero");const S=de.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");const M=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ne of M){const se=de.createNS("http://www.w3.org/2000/svg","ellipse");se.setAttributeNS(null,"opacity","0.04"),se.setAttributeNS(null,"cx","10.5"),se.setAttributeNS(null,"cy","5.80029008"),se.setAttributeNS(null,"rx",ne.rx),se.setAttributeNS(null,"ry",ne.ry),S.appendChild(se)}const R=de.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill",this._color);const I=de.createNS("http://www.w3.org/2000/svg","path");I.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),R.appendChild(I);const B=de.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"opacity","0.25"),B.setAttributeNS(null,"fill","#000000");const O=de.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),B.appendChild(O);const j=de.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(6.0, 7.0)"),j.setAttributeNS(null,"fill","#FFFFFF");const Z=de.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ie=de.createNS("http://www.w3.org/2000/svg","circle");ie.setAttributeNS(null,"fill","#000000"),ie.setAttributeNS(null,"opacity","0.25"),ie.setAttributeNS(null,"cx","5.5"),ie.setAttributeNS(null,"cy","5.5"),ie.setAttributeNS(null,"r","5.4999962");const te=de.createNS("http://www.w3.org/2000/svg","circle");te.setAttributeNS(null,"fill","#FFFFFF"),te.setAttributeNS(null,"cx","5.5"),te.setAttributeNS(null,"cy","5.5"),te.setAttributeNS(null,"r","5.4999962"),Z.appendChild(ie),Z.appendChild(te),y.appendChild(S),y.appendChild(R),y.appendChild(B),y.appendChild(j),y.appendChild(Z),n.appendChild(y),n.setAttributeNS(null,"height",l*this._scale+"px"),n.setAttributeNS(null,"width",h*this._scale+"px"),this._element.appendChild(n),this._offset=c.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()}),Ki(this._element,this._anchor,"marker"),e&&e.className)for(const n of e.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),de.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=c.S.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const h=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(38.1-13.5+h)],"bottom-right":[-h,-1*(38.1-13.5+h)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var n,l;const h=(n=this._map)===null||n===void 0?void 0:n.terrain,m=this._map.transform.isLocationOccluded(this._lngLat);if(!h||m){const j=m?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==j&&(this._element.style.opacity=j))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const y=this._map,S=y.terrain.depthAtPoint(this._pos),M=y.terrain.getElevationForLngLatZoom(this._lngLat,y.transform.tileZoom);if(y.transform.lngLatToCameraDepth(this._lngLat,M)-S<.006)return void(this._element.style.opacity=this._opacity);const R=-this._offset.y/y.transform.pixelsPerMeter,I=Math.sin(y.getPitch()*Math.PI/180)*R,B=y.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),O=y.transform.lngLatToCameraDepth(this._lngLat,M+I)-B>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&O&&this._popup.remove(),this._element.style.opacity=O?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=c.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,n){return(this._opacity===void 0||e===void 0&&n===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),n!==void 0&&(this._opacityWhenCovered=n),this._map&&this._updateOpacity(!0),this}}const Cr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ji=0,Ja=!1;const Uo={maxWidth:100,unit:"metric"};function Vo(f,e,n){const l=n&&n.maxWidth||100,h=f._container.clientHeight/2,m=f._container.clientWidth/2,y=f.unproject([m-l/2,h]),S=f.unproject([m+l/2,h]),M=Math.round(f.project(S).x-f.project(y).x),R=Math.min(l,M,f._container.clientWidth),I=y.distanceTo(S);if(n&&n.unit==="imperial"){const B=3.2808*I;B>5280?Es(e,R,B/5280,f._getUIString("ScaleControl.Miles")):Es(e,R,B,f._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?Es(e,R,I/1852,f._getUIString("ScaleControl.NauticalMiles")):I>=1e3?Es(e,R,I/1e3,f._getUIString("ScaleControl.Kilometers")):Es(e,R,I,f._getUIString("ScaleControl.Meters"))}function Es(f,e,n,l){const h=function(m){const y=Math.pow(10,`${Math.floor(m)}`.length-1);let S=m/y;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(M){const R=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*R)/R}(S),y*S}(n);f.style.width=e*(h/n)+"px",f.innerHTML=`${h}&nbsp;${l}`}const ta={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Rl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Dl(f){if(f){if(typeof f=="number"){const e=Math.round(Math.abs(f)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,f),"top-left":new c.P(e,e),"top-right":new c.P(-e,e),bottom:new c.P(0,-f),"bottom-left":new c.P(e,-e),"bottom-right":new c.P(-e,-e),left:new c.P(f,0),right:new c.P(-f,0)}}if(f instanceof c.P||Array.isArray(f)){const e=c.P.convert(f);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:c.P.convert(f.center||[0,0]),top:c.P.convert(f.top||[0,0]),"top-left":c.P.convert(f["top-left"]||[0,0]),"top-right":c.P.convert(f["top-right"]||[0,0]),bottom:c.P.convert(f.bottom||[0,0]),"bottom-left":c.P.convert(f["bottom-left"]||[0,0]),"bottom-right":c.P.convert(f["bottom-right"]||[0,0]),left:c.P.convert(f.left||[0,0]),right:c.P.convert(f.right||[0,0])}}return Dl(new c.P(0,0))}const Ec=J;A.AJAXError=c.cy,A.Event=c.l,A.Evented=c.E,A.LngLat=c.S,A.MercatorCoordinate=c.a0,A.Point=c.P,A.addProtocol=c.cz,A.config=c.a,A.removeProtocol=c.cA,A.AttributionControl=ni,A.BoxZoomHandler=Bo,A.CanvasSource=Sa,A.CooperativeGesturesHandler=ch,A.DoubleClickZoomHandler=eo,A.DragPanHandler=Fo,A.DragRotateHandler=to,A.EdgeInsets=Dr,A.FullscreenControl=class extends c.E{constructor(f={}){super(),this._onFullscreenChange=()=>{var e;let n=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=n==null?void 0:n.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)n=n.shadowRoot.fullscreenElement;n===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=de.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){de.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const f=this._fullscreenButton=de.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);de.create("span","maplibregl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},A.GeoJSONSource=Ur,A.GeolocateControl=class extends c.E{constructor(f){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new c.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const n=new c.S(e.coords.longitude,e.coords.latitude),l=e.coords.accuracy,h=this._map.getBearing(),m=c.e({bearing:h},this.options.fitBoundsOptions),y=tn.fromLngLat(n,l);this._map.fitBounds(y,m,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const n=new c.S(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Ja)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=de.create("button","maplibregl-ctrl-geolocate",this._container),de.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=de.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new an({element:this._dotElement}),this._circleElement=de.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new an({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.l("trackuserlocationend")),this.fire(new c.l("userlocationlostfocus")))})}},this.options=c.e({},Cr,f)}onAdd(f){return this._map=f,this._container=de.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return c._(this,arguments,void 0,function*(e=!1){if(er!==void 0&&!e)return er;if(window.navigator.permissions===void 0)return er=!!window.navigator.geolocation,er;try{er=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{er=!!window.navigator.geolocation}return er})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),de.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ji=0,Ja=!1}_isOutOfMapMaxBounds(f){const e=this._map.getMaxBounds(),n=f.coords;return e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const f=this._map.getBounds(),e=f.getSouthEast(),n=f.getNorthEast(),l=e.distanceTo(n),h=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ji--,Ja=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.l("trackuserlocationstart")),this.fire(new c.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ji++,ji>1?(f={maximumAge:6e5,timeout:0},Ja=!0):(f=this.options.positionOptions,Ja=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},A.GlobeControl=class{constructor(){this._toggleProjection=()=>{var f;const e=(f=this._map.getProjection())===null||f===void 0?void 0:f.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var f;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((f=this._map.getProjection())===null||f===void 0?void 0:f.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(f){return this._map=f,this._container=de.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=de.create("button","maplibregl-ctrl-globe",this._container),de.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){de.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},A.Hash=Wr,A.ImageSource=br,A.KeyboardHandler=ea,A.LngLatBounds=tn,A.LogoControl=Ci,A.Map=class extends Ni{constructor(f){var e,n;c.cv.mark(c.cw.create);const l=Object.assign(Object.assign(Object.assign({},jo),f),{canvasContextAttributes:Object.assign(Object.assign({},jo.canvasContextAttributes),f.canvasContextAttributes)});if(l.minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const h=new on,m=new Ea;if(l.minZoom!==void 0&&h.setMinZoom(l.minZoom),l.maxZoom!==void 0&&h.setMaxZoom(l.maxZoom),l.minPitch!==void 0&&h.setMinPitch(l.minPitch),l.maxPitch!==void 0&&h.setMaxPitch(l.maxPitch),l.renderWorldCopies!==void 0&&h.setRenderWorldCopies(l.renderWorldCopies),super(h,m,{bearingSnap:l.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new En,this._controls=[],this._mapId=c.a6(),this._contextLost=S=>{S.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new c.l("webglcontextlost",{originalEvent:S}))},this._contextRestored=S=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.l("webglcontextrestored",{originalEvent:S}))},this._onMapScroll=S=>{if(S.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=l.interactive,this._maxTileCacheSize=l.maxTileCacheSize,this._maxTileCacheZoomLevels=l.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},l.canvasContextAttributes),this._trackResize=l.trackResize===!0,this._bearingSnap=l.bearingSnap,this._centerClampedToGround=l.centerClampedToGround,this._refreshExpiredTiles=l.refreshExpiredTiles===!0,this._fadeDuration=l.fadeDuration,this._crossSourceCollisions=l.crossSourceCollisions===!0,this._collectResourceTiming=l.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},pu),l.locale),this._clickTolerance=l.clickTolerance,this._overridePixelRatio=l.pixelRatio,this._maxCanvasSize=l.maxCanvasSize,this.transformCameraUpdate=l.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=l.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Ot.addThrottleControl(()=>this.isMoving()),this._requestManager=new pt(l.transformRequest),typeof l.container=="string"){if(this._container=document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(l.maxBounds&&this.setMaxBounds(l.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let S=!1;const M=Ya(R=>{this._trackResize&&!this._removed&&(this.resize(R),this.redraw())},50);this._resizeObserver=new ResizeObserver(R=>{S?M(R):S=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Qa(this,l),this._hash=l.hash&&new Wr(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,elevation:l.elevation,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,roll:l.roll}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,c.e({},l.fitBoundsOptions,{duration:0}))));const y=typeof l.style=="string"||((n=(e=l.style)===null||e===void 0?void 0:e.projection)===null||n===void 0?void 0:n.type)!=="globe";this.resize(null,y),this._localIdeographFontFamily=l.localIdeographFontFamily,this._validateStyle=l.validateStyle,l.style&&this.setStyle(l.style,{localIdeographFontFamily:l.localIdeographFontFamily}),l.attributionControl&&this.addControl(new ni(typeof l.attributionControl=="boolean"?void 0:l.attributionControl)),l.maplibreLogo&&this.addControl(new Ci,l.logoPosition),this.on("style.load",()=>{if(y||this._resizeTransform(),this.transform.unmodified){const S=c.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(S)}}),this.on("data",S=>{this._update(S.dataType==="style"),this.fire(new c.l(`${S.dataType}data`,S))}),this.on("dataloading",S=>{this.fire(new c.l(`${S.dataType}dataloading`,S))}),this.on("dataabort",S=>{this.fire(new c.l("sourcedataabort",S))})}_getMapId(){return this._mapId}setGlobalStateProperty(f,e){return this.style.setGlobalStateProperty(f,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(f,e){if(e===void 0&&(e=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new c.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=f.onAdd(this);this._controls.push(f);const l=this._controlPositions[e];return e.indexOf("bottom")!==-1?l.insertBefore(n,l.firstChild):l.appendChild(n),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new c.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(f);return e>-1&&this._controls.splice(e,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}calculateCameraOptionsFromTo(f,e,n,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(f,e,n,l)}resize(f,e=!0){const[n,l]=this._containerDimensions(),h=this._getClampedPixelRatio(n,l);if(this._resizeCanvas(n,l,h),this.painter.resize(n,l,h),this.painter.overLimit()){const y=this.painter.context.gl;this._maxCanvasSize=[y.drawingBufferWidth,y.drawingBufferHeight];const S=this._getClampedPixelRatio(n,l);this._resizeCanvas(n,l,S),this.painter.resize(n,l,S)}this._resizeTransform(e);const m=!this._moving;return m&&(this.stop(),this.fire(new c.l("movestart",f)).fire(new c.l("move",f))),this.fire(new c.l("resize",f)),m&&this.fire(new c.l("moveend",f)),this}_resizeTransform(f=!0){var e;const[n,l]=this._containerDimensions();this.transform.resize(n,l,f),(e=this._requestedCameraState)===null||e===void 0||e.resize(n,l,f)}_getClampedPixelRatio(f,e){const{0:n,1:l}=this._maxCanvasSize,h=this.getPixelRatio(),m=f*h,y=e*h;return Math.min(m>n?n/m:1,y>l?l/y:1)*h}getPixelRatio(){var f;return(f=this._overridePixelRatio)!==null&&f!==void 0?f:devicePixelRatio}setPixelRatio(f){this._overridePixelRatio=f,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(f){return this.transform.setMaxBounds(tn.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.setMinZoom(f),this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.setMaxZoom(f),this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.setMinPitch(f),this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(f>=this.transform.minPitch)return this.transform.setMaxPitch(f),this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.setRenderWorldCopies(f),this._update()}project(f){return this.transform.locationToScreenPoint(c.S.convert(f),this.style&&this.terrain)}unproject(f){return this.transform.screenPointToLocation(c.P.convert(f),this.terrain)}isMoving(){var f;return this._moving||((f=this.handlers)===null||f===void 0?void 0:f.isMoving())}isZooming(){var f;return this._zooming||((f=this.handlers)===null||f===void 0?void 0:f.isZooming())}isRotating(){var f;return this._rotating||((f=this.handlers)===null||f===void 0?void 0:f.isRotating())}_createDelegatedListener(f,e,n){if(f==="mouseenter"||f==="mouseover"){let l=!1;return{layers:e,listener:n,delegates:{mousemove:m=>{const y=e.filter(M=>this.getLayer(M)),S=y.length!==0?this.queryRenderedFeatures(m.point,{layers:y}):[];S.length?l||(l=!0,n.call(this,new Er(f,this,m.originalEvent,{features:S}))):l=!1},mouseout:()=>{l=!1}}}}if(f==="mouseleave"||f==="mouseout"){let l=!1;return{layers:e,listener:n,delegates:{mousemove:y=>{const S=e.filter(M=>this.getLayer(M));(S.length!==0?this.queryRenderedFeatures(y.point,{layers:S}):[]).length?l=!0:l&&(l=!1,n.call(this,new Er(f,this,y.originalEvent)))},mouseout:y=>{l&&(l=!1,n.call(this,new Er(f,this,y.originalEvent)))}}}}{const l=h=>{const m=e.filter(S=>this.getLayer(S)),y=m.length!==0?this.queryRenderedFeatures(h.point,{layers:m}):[];y.length&&(h.features=y,n.call(this,h),delete h.features)};return{layers:e,listener:n,delegates:{[f]:l}}}}_saveDelegatedListener(f,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(e)}_removeDelegatedListener(f,e,n){if(!this._delegatedListeners||!this._delegatedListeners[f])return;const l=this._delegatedListeners[f];for(let h=0;h<l.length;h++){const m=l[h];if(m.listener===n&&m.layers.length===e.length&&m.layers.every(y=>e.includes(y))){for(const y in m.delegates)this.off(y,m.delegates[y]);return void l.splice(h,1)}}}on(f,e,n){if(n===void 0)return super.on(f,e);const l=typeof e=="string"?[e]:e,h=this._createDelegatedListener(f,l,n);this._saveDelegatedListener(f,h);for(const m in h.delegates)this.on(m,h.delegates[m]);return{unsubscribe:()=>{this._removeDelegatedListener(f,l,n)}}}once(f,e,n){if(n===void 0)return super.once(f,e);const l=typeof e=="string"?[e]:e,h=this._createDelegatedListener(f,l,n);for(const m in h.delegates){const y=h.delegates[m];h.delegates[m]=(...S)=>{this._removeDelegatedListener(f,l,n),y(...S)}}this._saveDelegatedListener(f,h);for(const m in h.delegates)this.once(m,h.delegates[m]);return this}off(f,e,n){return n===void 0?super.off(f,e):(this._removeDelegatedListener(f,typeof e=="string"?[e]:e,n),this)}queryRenderedFeatures(f,e){if(!this.style)return[];let n;const l=f instanceof c.P||Array.isArray(f),h=l?f:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(l?{}:f)||{},h instanceof c.P||typeof h[0]=="number")n=[c.P.convert(h)];else{const m=c.P.convert(h[0]),y=c.P.convert(h[1]);n=[m,new c.P(y.x,m.y),y,new c.P(m.x,y.y),m]}return this.style.queryRenderedFeatures(n,e,this.transform)}querySourceFeatures(f,e){return this.style.querySourceFeatures(f,e)}setStyle(f,e){return(e=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(f,e))}setTransformRequest(f){return this._requestManager.setTransformRequest(f),this}_getUIString(f){const e=this._locale[f];if(e==null)throw new Error(`Missing UI string '${f}'`);return e}_updateStyle(f,e){var n,l;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(f,e));const h=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!f)),f?(this.style=new qu(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f,e,h):this.style.loadJSON(f,e,h),this):((l=(n=this.style)===null||n===void 0?void 0:n.projection)===null||l===void 0||l.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new qu(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,e){if(typeof f=="string"){const n=this._requestManager.transformRequest(f,"Style");c.j(n,new AbortController).then(l=>{this._updateDiff(l.data,e)}).catch(l=>{l&&this.fire(new c.k(l))})}else typeof f=="object"&&this._updateDiff(f,e)}_updateDiff(f,e){try{this.style.setState(f,e)&&this._update(!0)}catch(n){c.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(f,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(f,e){return this._lazyInitEmptyStyle(),this.style.addSource(f,e),this._update(!0)}isSourceLoaded(f){const e=this.style&&this.style.sourceCaches[f];if(e!==void 0)return e.loaded();this.fire(new c.k(new Error(`There is no source with ID '${f}'`)))}setTerrain(f){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),f){const e=this.style.sourceCaches[f.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${f.source}`);this.terrain===null&&e.reload();for(const n in this.style._layers){const l=this.style._layers[n];l.type==="hillshade"&&l.source===f.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),l.type==="color-relief"&&l.source===f.source&&c.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new gr(this.painter,e,f),this.painter.renderToTexture=new zt(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=n=>{var l;n.dataType==="style"?this.terrain.sourceCache.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==f.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((l=n.source)===null||l===void 0?void 0:l.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new c.l("terrain",{terrain:f})),this}getTerrain(){var f,e;return(e=(f=this.terrain)===null||f===void 0?void 0:f.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const f=this.style&&this.style.sourceCaches;for(const e in f){const n=f[e]._tiles;for(const l in n){const h=n[l];if(h.state!=="loaded"&&h.state!=="errored")return!1}}return!0}removeSource(f){return this.style.removeSource(f),this._update(!0)}getSource(f){return this.style.getSource(f)}setSourceTileLodParams(f,e,n){if(n){const l=this.getSource(n);if(!l)throw new Error(`There is no source with ID "${n}", cannot set LOD parameters`);l.calculateTileZoom=ke(Math.max(1,f),Math.max(1,e))}else for(const l in this.style.sourceCaches)this.style.sourceCaches[l].getSource().calculateTileZoom=ke(Math.max(1,f),Math.max(1,e));return this._update(!0),this}refreshTiles(f,e){const n=this.style.sourceCaches[f];if(!n)throw new Error(`There is no source cache with ID "${f}", cannot refresh tile`);e===void 0?n.reload(!0):n.refreshTiles(e.map(l=>new c.a3(l.z,l.x,l.y)))}addImage(f,e,n={}){const{pixelRatio:l=1,sdf:h=!1,stretchX:m,stretchY:y,content:S,textFitWidth:M,textFitHeight:R}=n;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||c.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:I,height:B,data:O}=e,j=e;return this.style.addImage(f,{data:new c.R({width:I,height:B},new Uint8Array(O)),pixelRatio:l,stretchX:m,stretchY:y,content:S,textFitWidth:M,textFitHeight:R,sdf:h,version:0,userImage:j}),j.onAdd&&j.onAdd(this,f),this}}{const{width:I,height:B,data:O}=xe.getImageData(e);this.style.addImage(f,{data:new c.R({width:I,height:B},O),pixelRatio:l,stretchX:m,stretchY:y,content:S,textFitWidth:M,textFitHeight:R,sdf:h,version:0})}}updateImage(f,e){const n=this.style.getImage(f);if(!n)return this.fire(new c.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=e instanceof HTMLImageElement||c.b(e)?xe.getImageData(e):e,{width:h,height:m,data:y}=l;if(h===void 0||m===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(h!==n.data.width||m!==n.data.height)return this.fire(new c.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(e instanceof HTMLImageElement||c.b(e));return n.data.replace(y,S),this.style.updateImage(f,n),this}getImage(f){return this.style.getImage(f)}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new c.k(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f){return Ot.getImage(this._requestManager.transformRequest(f,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(f,e){return this._lazyInitEmptyStyle(),this.style.addLayer(f,e),this._update(!0)}moveLayer(f,e){return this.style.moveLayer(f,e),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(f,e,n){return this.style.setLayerZoomRange(f,e,n),this._update(!0)}setFilter(f,e,n={}){return this.style.setFilter(f,e,n),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,e,n,l={}){return this.style.setPaintProperty(f,e,n,l),this._update(!0)}getPaintProperty(f,e){return this.style.getPaintProperty(f,e)}setLayoutProperty(f,e,n,l={}){return this.style.setLayoutProperty(f,e,n,l),this._update(!0)}getLayoutProperty(f,e){return this.style.getLayoutProperty(f,e)}setGlyphs(f,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(f,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(f,e,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(f,e,n,l=>{l||this._update(!0)}),this}removeSprite(f){return this._lazyInitEmptyStyle(),this.style.removeSprite(f),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(f,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(f,e,n=>{n||this._update(!0)}),this}setLight(f,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(f,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(f,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(f,e){return this.style.setFeatureState(f,e),this._update()}removeFeatureState(f,e){return this.style.removeFeatureState(f,e),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let f=0,e=0;return this._container&&(f=this._container.clientWidth||400,e=this._container.clientHeight||300),[f,e]}_setupContainer(){const f=this._container;f.classList.add("maplibregl-map");const e=this._canvasContainer=de.create("div","maplibregl-canvas-container",f);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=de.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),l=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],l);const h=this._controlContainer=de.create("div","maplibregl-control-container",f),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{m[y]=de.create("div",`maplibregl-ctrl-${y} `,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,e,n){this._canvas.width=Math.floor(n*f),this._canvas.height=Math.floor(n*e),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const f=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{e={requestedAttributes:f},l&&(e.statusMessage=l.statusMessage,e.type=l.type)},{once:!0});let n=null;if(n=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,f):this._canvas.getContext("webgl2",f)||this._canvas.getContext("webgl",f),!n){const l="Failed to initialize WebGL";throw e?(e.message=l,new Error(JSON.stringify(e))):new Error(l)}this.painter=new Lr(n,this.transform),Ee.testSupport(n)}migrateProjection(f,e){super.migrateProjection(f,e),this.painter.transform=f,this.fire(new c.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_render(f){var e,n,l,h,m;const y=this._idleTriggered?this._fadeDuration:0,S=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._removed)return;let M=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const B=this.transform.zoom,O=xe.now();this.style.zoomHistory.update(B,O);const j=new c.F(B,{now:O,fadeDuration:y,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),Z=j.crossFadingFactor();Z===1&&Z===this._crossFadingFactor||(M=!0,this._crossFadingFactor=Z),this.style.update(j)}const R=((n=this.style.projection)===null||n===void 0?void 0:n.transitionState)>0!==S;(l=this.style.projection)===null||l===void 0||l.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((h=this.style.projection)===null||h===void 0?void 0:h.transitionState,(m=this.style.projection)===null||m===void 0?void 0:m.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||R)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,R),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,showPadding:this.showPadding}),this.fire(new c.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.cv.mark(c.cw.load),this.fire(new c.l("load"))),this.style&&(this.style.hasTransitions()||M)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const I=this._sourcesDirty||this._styleDirty||this._placementDirty;return I||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.l("idle")),!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,c.cv.mark(c.cw.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var f;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ot.removeThrottleControl(this._imageQueueHandle),(f=this._resizeObserver)===null||f===void 0||f.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),de.remove(this._canvasContainer),de.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),c.cv.clearMetrics(),this._removed=!0,this.fire(new c.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,xe.frame(this._frameRequest,f=>{c.cv.frame(f),this._frameRequest=null;try{this._render(f)}catch(e){if(!c.cx(e)&&!function(n){return n.message===th}(e))throw e}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get version(){return dn}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(f){return this._lazyInitEmptyStyle(),this.style.setProjection(f),this._update(!0)}},A.MapMouseEvent=Er,A.MapTouchEvent=ka,A.MapWheelEvent=ah,A.Marker=an,A.NavigationControl=class{constructor(f){this._updateZoomButtons=()=>{const e=this._map.getZoom(),n=e===this._map.getMaxZoom(),l=e===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,n)=>{const l=this._map._getUIString(`NavigationControl.${n}`);e.title=l,e.setAttribute("aria-label",l)},this.options=c.e({},lr,f),this._container=de.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),de.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),de.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=de.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new uh(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){de.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,e){const n=de.create("button",f,this._container);return n.type="button",n.addEventListener("click",e),n}},A.Popup=class extends c.E{constructor(f){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&de.remove(this._content),this._container&&(de.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=de.create("div","maplibregl-popup",this._map.getContainer()),this._tip=de.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const y of this.options.className.split(" "))this._container.classList.add(y);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=id(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const n=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let l=this.options.anchor;const h=Dl(this.options.offset);if(!l){const y=this._container.offsetWidth,S=this._container.offsetHeight;let M;M=n.y+h.bottom.y<S?["top"]:n.y>this._map.transform.height-S?["bottom"]:[],n.x<y/2?M.push("left"):n.x>this._map.transform.width-y/2&&M.push("right"),l=M.length===0?"bottom":M.join("-")}let m=n.add(h[l]);this.options.subpixelPositioning||(m=m.round()),de.setTransform(this._container,`${Ms[l]} translate(${m.x}px,${m.y}px)`),Ki(this._container,l,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(ta),f)}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=c.S.convert(f),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const e=document.createDocumentFragment(),n=document.createElement("body");let l;for(n.innerHTML=f;l=n.firstChild,l;)e.appendChild(l);return this.setDOMContent(e)}getMaxWidth(){var f;return(f=this._container)===null||f===void 0?void 0:f.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=de.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){return this._container&&this._container.classList.add(f),this}removeClassName(f){return this._container&&this._container.classList.remove(f),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){if(this._container)return this._container.classList.toggle(f)}setSubpixelPositioning(f){this.options.subpixelPositioning=f}_createCloseButton(){this.options.closeButton&&(this._closeButton=de.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Rl);f&&f.focus()}},A.RasterDEMTileSource=Xi,A.RasterTileSource=ol,A.ScaleControl=class{constructor(f){this._onMove=()=>{Vo(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Vo(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Uo),f)}getDefaultPosition(){return"bottom-left"}onAdd(f){return this._map=f,this._container=de.create("div","maplibregl-ctrl maplibregl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){de.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},A.ScrollZoomHandler=Ts,A.Style=qu,A.TerrainControl=class{constructor(f){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=f}onAdd(f){return this._map=f,this._container=de.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=de.create("button","maplibregl-ctrl-terrain",this._container),de.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){de.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},A.TwoFingersTouchPitchHandler=uu,A.TwoFingersTouchRotateHandler=cu,A.TwoFingersTouchZoomHandler=Oa,A.TwoFingersTouchZoomRotateHandler=hu,A.VectorTileSource=aa,A.VideoSource=ks,A.addSourceType=(f,e)=>c._(void 0,void 0,void 0,function*(){if(Ls(f))throw new Error(`A source type called "${f}" already exists.`);((n,l)=>{Wl[n]=l})(f,e)}),A.clearPrewarmedResources=function(){const f=gt;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(be),gt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},A.createTileMesh=Vu,A.getMaxParallelImageRequests=function(){return c.a.MAX_PARALLEL_IMAGE_REQUESTS},A.getRTLTextPluginStatus=function(){return nn().getRTLTextPluginStatus()},A.getVersion=function(){return Ec},A.getWorkerCount=function(){return Qe.workerCount},A.getWorkerUrl=function(){return c.a.WORKER_URL},A.importScriptInWorkers=function(f){return Kn().broadcast("IS",f)},A.prewarm=function(){li().acquire(be)},A.setMaxParallelImageRequests=function(f){c.a.MAX_PARALLEL_IMAGE_REQUESTS=f},A.setRTLTextPlugin=function(f,e){return nn().setRTLTextPlugin(f,e)},A.setWorkerCount=function(f){Qe.workerCount=f},A.setWorkerUrl=function(f){c.a.WORKER_URL=f}});var F=z;return F})}(cm)),cm.exports}var b0=x0();const w0=E_(b0);var Wm={exports:{}},i_;function S0(){return i_||(i_=1,function(v){var w={};function z(F){return Math.floor(Math.abs(F)+.5)*(F>=0?1:-1)}function E(F,A,c){F=z(F*c),A=z(A*c);var J=(F-A)*2;J<0&&(J=-J-1);for(var X="";J>=32;)X+=String.fromCharCode((32|J&31)+63),J/=32;return X+=String.fromCharCode((J|0)+63),X}w.decode=function(F,A){for(var c=0,J=0,X=0,re=[],Te=0,xe=0,de=null,Ee,We,Ve=Math.pow(10,Number.isInteger(A)?A:5);c<F.length;){de=null,Te=1,xe=0;do de=F.charCodeAt(c++)-63,xe+=(de&31)*Te,Te*=32;while(de>=32);Ee=xe&1?(-xe-1)/2:xe/2,Te=1,xe=0;do de=F.charCodeAt(c++)-63,xe+=(de&31)*Te,Te*=32;while(de>=32);We=xe&1?(-xe-1)/2:xe/2,J+=Ee,X+=We,re.push([J/Ve,X/Ve])}return re},w.encode=function(F,A){if(!F.length)return"";for(var c=Math.pow(10,Number.isInteger(A)?A:5),J=E(F[0][0],0,c)+E(F[0][1],0,c),X=1;X<F.length;X++){var re=F[X],Te=F[X-1];J+=E(re[0],Te[0],c),J+=E(re[1],Te[1],c)}return J};function L(F){for(var A=[],c=0;c<F.length;c++){var J=F[c].slice();A.push([J[1],J[0]])}return A}w.fromGeoJSON=function(F,A){if(F&&F.type==="Feature"&&(F=F.geometry),!F||F.type!=="LineString")throw new Error("Input must be a GeoJSON LineString");return w.encode(L(F.coordinates),A)},w.toGeoJSON=function(F,A){var c=w.decode(F,A);return{type:"LineString",coordinates:L(c)}},v.exports&&(v.exports=w)}(Wm)),Wm.exports}var T0=S0();const M0=E_(T0),E0=({start:v,end:w,map:z})=>{const[E,L]=Ye.useState(null),[F,A]=Ye.useState(null),c=async()=>{if(!(!v||!w||v.length!==2||w.length!==2)){console.log("Start lon:",v[0]),console.log("Start lat:",v[1]),console.log("End lon:",w[0]),console.log("End lat:",w[1]);try{const J=await fetch(`http://router.project-osrm.org/route/v1/driving/${v[0]},${v[1]};${w[0]},${w[1]}`);if(!J.ok)throw new Error(`HTTP error! status: ${J.status}`);const X=await J.json();if(X.routes&&X.routes.length>0){const re=M0.toGeoJSON(X.routes[0].geometry);console.log("Route Geometry:",re),L(re),A(null)}else L(null),A("No route found between the given points")}catch(J){console.error(J),L(null),A("Failed to calculate the route")}}};return Ye.useEffect(()=>{c()},[v,w]),Ye.useEffect(()=>{if(E&&z){console.log("Adding route to map:",E);try{z.getSource("route")&&(z.removeLayer("route"),z.removeSource("route")),z.addSource("route",{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:E}]}}),z.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#007bff","line-width":5}});const X=E.coordinates.reduce((re,Te)=>[[Math.min(re[0][0],Te[0]),Math.min(re[0][1],Te[1])],[Math.max(re[1][0],Te[0]),Math.max(re[1][1],Te[1])]],[[1/0,1/0],[-1/0,-1/0]]);z.fitBounds(X,{padding:20,duration:2500})}catch(J){console.error(J),A("Failed to add the route to the map")}}return()=>{z&&z.getSource("route")&&(z.removeLayer("route"),z.removeSource("route"))}},[E,z,v,w]),Et.jsx("div",{children:F&&Et.jsx("div",{style:{position:"absolute",top:0,left:0,backgroundColor:"red",color:"white",padding:"10px"},children:F})})},Z_=({start:v,end:w})=>{const z=Ye.useRef(null),E=Ye.useRef(null),[L,F]=Ye.useState(!1),[A,c]=Ye.useState(null);return Ye.useEffect(()=>{try{E.current=new w0.Map({container:z.current,style:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",center:[151.333413,-33.512393],zoom:12}),E.current.on("load",()=>{F(!0)}),E.current.on("error",J=>{console.error(J),c("Failed to load the map")})}catch(J){console.error(J),c("Failed to initialize the map")}},[]),Et.jsxs("div",{ref:z,style:{width:"100%",height:"100%",borderRadius:"10px",border:"1px solid #15F4EE"},id:"map",children:[L&&v&&w&&Et.jsx(E0,{start:v,end:w,map:E.current}),A&&Et.jsx("div",{style:{position:"absolute",top:0,left:0,backgroundColor:"red",color:"white",padding:"10px"},children:A})]})},n_=({address:v,onGeocode:w})=>{const z=async()=>{if(!v){console.log("Please enter a valid address.");return}try{const E=await fetch(`http://localhost:3001/geocode?q=${v}`);if(!E.ok)throw new Error(`HTTP error! status: ${E.status}`);const L=await E.json();if(L&&L.length>0){const F=parseFloat(L[0].lat),A=parseFloat(L[0].lon);w([A,F])}else console.log("No geocode data found for the given address.")}catch(E){console.error(E)}};return Ye.useEffect(()=>{z()},[v]),null};function $_(v,w){return function(){return v.apply(w,arguments)}}const{toString:C0}=Object.prototype,{getPrototypeOf:Eg}=Object,{iterator:bm,toStringTag:H_}=Symbol,wm=(v=>w=>{const z=C0.call(w);return v[z]||(v[z]=z.slice(8,-1).toLowerCase())})(Object.create(null)),sl=v=>(v=v.toLowerCase(),w=>wm(w)===v),Sm=v=>w=>typeof w===v,{isArray:Vd}=Array,pp=Sm("undefined");function xp(v){return v!==null&&!pp(v)&&v.constructor!==null&&!pp(v.constructor)&&os(v.constructor.isBuffer)&&v.constructor.isBuffer(v)}const X_=sl("ArrayBuffer");function A0(v){let w;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?w=ArrayBuffer.isView(v):w=v&&v.buffer&&X_(v.buffer),w}const z0=Sm("string"),os=Sm("function"),Y_=Sm("number"),bp=v=>v!==null&&typeof v=="object",P0=v=>v===!0||v===!1,um=v=>{if(wm(v)!=="object")return!1;const w=Eg(v);return(w===null||w===Object.prototype||Object.getPrototypeOf(w)===null)&&!(H_ in v)&&!(bm in v)},R0=v=>{if(!bp(v)||xp(v))return!1;try{return Object.keys(v).length===0&&Object.getPrototypeOf(v)===Object.prototype}catch{return!1}},D0=sl("Date"),I0=sl("File"),k0=sl("Blob"),L0=sl("FileList"),O0=v=>bp(v)&&os(v.pipe),B0=v=>{let w;return v&&(typeof FormData=="function"&&v instanceof FormData||os(v.append)&&((w=wm(v))==="formdata"||w==="object"&&os(v.toString)&&v.toString()==="[object FormData]"))},F0=sl("URLSearchParams"),[N0,j0,U0,V0]=["ReadableStream","Request","Response","Headers"].map(sl),G0=v=>v.trim?v.trim():v.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function wp(v,w,{allOwnKeys:z=!1}={}){if(v===null||typeof v>"u")return;let E,L;if(typeof v!="object"&&(v=[v]),Vd(v))for(E=0,L=v.length;E<L;E++)w.call(null,v[E],E,v);else{if(xp(v))return;const F=z?Object.getOwnPropertyNames(v):Object.keys(v),A=F.length;let c;for(E=0;E<A;E++)c=F[E],w.call(null,v[c],c,v)}}function K_(v,w){if(xp(v))return null;w=w.toLowerCase();const z=Object.keys(v);let E=z.length,L;for(;E-- >0;)if(L=z[E],w===L.toLowerCase())return L;return null}const Uh=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,W_=v=>!pp(v)&&v!==Uh;function cg(){const{caseless:v}=W_(this)&&this||{},w={},z=(E,L)=>{const F=v&&K_(w,L)||L;um(w[F])&&um(E)?w[F]=cg(w[F],E):um(E)?w[F]=cg({},E):Vd(E)?w[F]=E.slice():w[F]=E};for(let E=0,L=arguments.length;E<L;E++)arguments[E]&&wp(arguments[E],z);return w}const q0=(v,w,z,{allOwnKeys:E}={})=>(wp(w,(L,F)=>{z&&os(L)?v[F]=$_(L,z):v[F]=L},{allOwnKeys:E}),v),Z0=v=>(v.charCodeAt(0)===65279&&(v=v.slice(1)),v),$0=(v,w,z,E)=>{v.prototype=Object.create(w.prototype,E),v.prototype.constructor=v,Object.defineProperty(v,"super",{value:w.prototype}),z&&Object.assign(v.prototype,z)},H0=(v,w,z,E)=>{let L,F,A;const c={};if(w=w||{},v==null)return w;do{for(L=Object.getOwnPropertyNames(v),F=L.length;F-- >0;)A=L[F],(!E||E(A,v,w))&&!c[A]&&(w[A]=v[A],c[A]=!0);v=z!==!1&&Eg(v)}while(v&&(!z||z(v,w))&&v!==Object.prototype);return w},X0=(v,w,z)=>{v=String(v),(z===void 0||z>v.length)&&(z=v.length),z-=w.length;const E=v.indexOf(w,z);return E!==-1&&E===z},Y0=v=>{if(!v)return null;if(Vd(v))return v;let w=v.length;if(!Y_(w))return null;const z=new Array(w);for(;w-- >0;)z[w]=v[w];return z},K0=(v=>w=>v&&w instanceof v)(typeof Uint8Array<"u"&&Eg(Uint8Array)),W0=(v,w)=>{const E=(v&&v[bm]).call(v);let L;for(;(L=E.next())&&!L.done;){const F=L.value;w.call(v,F[0],F[1])}},Q0=(v,w)=>{let z;const E=[];for(;(z=v.exec(w))!==null;)E.push(z);return E},J0=sl("HTMLFormElement"),ex=v=>v.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(z,E,L){return E.toUpperCase()+L}),r_=(({hasOwnProperty:v})=>(w,z)=>v.call(w,z))(Object.prototype),tx=sl("RegExp"),Q_=(v,w)=>{const z=Object.getOwnPropertyDescriptors(v),E={};wp(z,(L,F)=>{let A;(A=w(L,F,v))!==!1&&(E[F]=A||L)}),Object.defineProperties(v,E)},ix=v=>{Q_(v,(w,z)=>{if(os(v)&&["arguments","caller","callee"].indexOf(z)!==-1)return!1;const E=v[z];if(os(E)){if(w.enumerable=!1,"writable"in w){w.writable=!1;return}w.set||(w.set=()=>{throw Error("Can not rewrite read-only method '"+z+"'")})}})},nx=(v,w)=>{const z={},E=L=>{L.forEach(F=>{z[F]=!0})};return Vd(v)?E(v):E(String(v).split(w)),z},rx=()=>{},ax=(v,w)=>v!=null&&Number.isFinite(v=+v)?v:w;function sx(v){return!!(v&&os(v.append)&&v[H_]==="FormData"&&v[bm])}const ox=v=>{const w=new Array(10),z=(E,L)=>{if(bp(E)){if(w.indexOf(E)>=0)return;if(xp(E))return E;if(!("toJSON"in E)){w[L]=E;const F=Vd(E)?[]:{};return wp(E,(A,c)=>{const J=z(A,L+1);!pp(J)&&(F[c]=J)}),w[L]=void 0,F}}return E};return z(v,0)},lx=sl("AsyncFunction"),cx=v=>v&&(bp(v)||os(v))&&os(v.then)&&os(v.catch),J_=((v,w)=>v?setImmediate:w?((z,E)=>(Uh.addEventListener("message",({source:L,data:F})=>{L===Uh&&F===z&&E.length&&E.shift()()},!1),L=>{E.push(L),Uh.postMessage(z,"*")}))(`axios@${Math.random()}`,[]):z=>setTimeout(z))(typeof setImmediate=="function",os(Uh.postMessage)),ux=typeof queueMicrotask<"u"?queueMicrotask.bind(Uh):typeof process<"u"&&process.nextTick||J_,hx=v=>v!=null&&os(v[bm]),He={isArray:Vd,isArrayBuffer:X_,isBuffer:xp,isFormData:B0,isArrayBufferView:A0,isString:z0,isNumber:Y_,isBoolean:P0,isObject:bp,isPlainObject:um,isEmptyObject:R0,isReadableStream:N0,isRequest:j0,isResponse:U0,isHeaders:V0,isUndefined:pp,isDate:D0,isFile:I0,isBlob:k0,isRegExp:tx,isFunction:os,isStream:O0,isURLSearchParams:F0,isTypedArray:K0,isFileList:L0,forEach:wp,merge:cg,extend:q0,trim:G0,stripBOM:Z0,inherits:$0,toFlatObject:H0,kindOf:wm,kindOfTest:sl,endsWith:X0,toArray:Y0,forEachEntry:W0,matchAll:Q0,isHTMLForm:J0,hasOwnProperty:r_,hasOwnProp:r_,reduceDescriptors:Q_,freezeMethods:ix,toObjectSet:nx,toCamelCase:ex,noop:rx,toFiniteNumber:ax,findKey:K_,global:Uh,isContextDefined:W_,isSpecCompliantForm:sx,toJSONObject:ox,isAsyncFn:lx,isThenable:cx,setImmediate:J_,asap:ux,isIterable:hx};function di(v,w,z,E,L){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=v,this.name="AxiosError",w&&(this.code=w),z&&(this.config=z),E&&(this.request=E),L&&(this.response=L,this.status=L.status?L.status:null)}He.inherits(di,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:He.toJSONObject(this.config),code:this.code,status:this.status}}});const ey=di.prototype,ty={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(v=>{ty[v]={value:v}});Object.defineProperties(di,ty);Object.defineProperty(ey,"isAxiosError",{value:!0});di.from=(v,w,z,E,L,F)=>{const A=Object.create(ey);return He.toFlatObject(v,A,function(J){return J!==Error.prototype},c=>c!=="isAxiosError"),di.call(A,v.message,w,z,E,L),A.cause=v,A.name=v.name,F&&Object.assign(A,F),A};const dx=null;function ug(v){return He.isPlainObject(v)||He.isArray(v)}function iy(v){return He.endsWith(v,"[]")?v.slice(0,-2):v}function a_(v,w,z){return v?v.concat(w).map(function(L,F){return L=iy(L),!z&&F?"["+L+"]":L}).join(z?".":""):w}function fx(v){return He.isArray(v)&&!v.some(ug)}const px=He.toFlatObject(He,{},null,function(w){return/^is[A-Z]/.test(w)});function Tm(v,w,z){if(!He.isObject(v))throw new TypeError("target must be an object");w=w||new FormData,z=He.toFlatObject(z,{metaTokens:!0,dots:!1,indexes:!1},!1,function(We,Ve){return!He.isUndefined(Ve[We])});const E=z.metaTokens,L=z.visitor||re,F=z.dots,A=z.indexes,J=(z.Blob||typeof Blob<"u"&&Blob)&&He.isSpecCompliantForm(w);if(!He.isFunction(L))throw new TypeError("visitor must be a function");function X(Ee){if(Ee===null)return"";if(He.isDate(Ee))return Ee.toISOString();if(He.isBoolean(Ee))return Ee.toString();if(!J&&He.isBlob(Ee))throw new di("Blob is not supported. Use a Buffer instead.");return He.isArrayBuffer(Ee)||He.isTypedArray(Ee)?J&&typeof Blob=="function"?new Blob([Ee]):Buffer.from(Ee):Ee}function re(Ee,We,Ve){let et=Ee;if(Ee&&!Ve&&typeof Ee=="object"){if(He.endsWith(We,"{}"))We=E?We:We.slice(0,-2),Ee=JSON.stringify(Ee);else if(He.isArray(Ee)&&fx(Ee)||(He.isFileList(Ee)||He.endsWith(We,"[]"))&&(et=He.toArray(Ee)))return We=iy(We),et.forEach(function(Tt,Ot){!(He.isUndefined(Tt)||Tt===null)&&w.append(A===!0?a_([We],Ot,F):A===null?We:We+"[]",X(Tt))}),!1}return ug(Ee)?!0:(w.append(a_(Ve,We,F),X(Ee)),!1)}const Te=[],xe=Object.assign(px,{defaultVisitor:re,convertValue:X,isVisitable:ug});function de(Ee,We){if(!He.isUndefined(Ee)){if(Te.indexOf(Ee)!==-1)throw Error("Circular reference detected in "+We.join("."));Te.push(Ee),He.forEach(Ee,function(et,ft){(!(He.isUndefined(et)||et===null)&&L.call(w,et,He.isString(ft)?ft.trim():ft,We,xe))===!0&&de(et,We?We.concat(ft):[ft])}),Te.pop()}}if(!He.isObject(v))throw new TypeError("data must be an object");return de(v),w}function s_(v){const w={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(v).replace(/[!'()~]|%20|%00/g,function(E){return w[E]})}function Cg(v,w){this._pairs=[],v&&Tm(v,this,w)}const ny=Cg.prototype;ny.append=function(w,z){this._pairs.push([w,z])};ny.toString=function(w){const z=w?function(E){return w.call(this,E,s_)}:s_;return this._pairs.map(function(L){return z(L[0])+"="+z(L[1])},"").join("&")};function mx(v){return encodeURIComponent(v).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function ry(v,w,z){if(!w)return v;const E=z&&z.encode||mx;He.isFunction(z)&&(z={serialize:z});const L=z&&z.serialize;let F;if(L?F=L(w,z):F=He.isURLSearchParams(w)?w.toString():new Cg(w,z).toString(E),F){const A=v.indexOf("#");A!==-1&&(v=v.slice(0,A)),v+=(v.indexOf("?")===-1?"?":"&")+F}return v}class o_{constructor(){this.handlers=[]}use(w,z,E){return this.handlers.push({fulfilled:w,rejected:z,synchronous:E?E.synchronous:!1,runWhen:E?E.runWhen:null}),this.handlers.length-1}eject(w){this.handlers[w]&&(this.handlers[w]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(w){He.forEach(this.handlers,function(E){E!==null&&w(E)})}}const ay={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},gx=typeof URLSearchParams<"u"?URLSearchParams:Cg,_x=typeof FormData<"u"?FormData:null,yx=typeof Blob<"u"?Blob:null,vx={isBrowser:!0,classes:{URLSearchParams:gx,FormData:_x,Blob:yx},protocols:["http","https","file","blob","url","data"]},Ag=typeof window<"u"&&typeof document<"u",hg=typeof navigator=="object"&&navigator||void 0,xx=Ag&&(!hg||["ReactNative","NativeScript","NS"].indexOf(hg.product)<0),bx=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",wx=Ag&&window.location.href||"http://localhost",Sx=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ag,hasStandardBrowserEnv:xx,hasStandardBrowserWebWorkerEnv:bx,navigator:hg,origin:wx},Symbol.toStringTag,{value:"Module"})),wa={...Sx,...vx};function Tx(v,w){return Tm(v,new wa.classes.URLSearchParams,{visitor:function(z,E,L,F){return wa.isNode&&He.isBuffer(z)?(this.append(E,z.toString("base64")),!1):F.defaultVisitor.apply(this,arguments)},...w})}function Mx(v){return He.matchAll(/\w+|\[(\w*)]/g,v).map(w=>w[0]==="[]"?"":w[1]||w[0])}function Ex(v){const w={},z=Object.keys(v);let E;const L=z.length;let F;for(E=0;E<L;E++)F=z[E],w[F]=v[F];return w}function sy(v){function w(z,E,L,F){let A=z[F++];if(A==="__proto__")return!0;const c=Number.isFinite(+A),J=F>=z.length;return A=!A&&He.isArray(L)?L.length:A,J?(He.hasOwnProp(L,A)?L[A]=[L[A],E]:L[A]=E,!c):((!L[A]||!He.isObject(L[A]))&&(L[A]=[]),w(z,E,L[A],F)&&He.isArray(L[A])&&(L[A]=Ex(L[A])),!c)}if(He.isFormData(v)&&He.isFunction(v.entries)){const z={};return He.forEachEntry(v,(E,L)=>{w(Mx(E),L,z,0)}),z}return null}function Cx(v,w,z){if(He.isString(v))try{return(w||JSON.parse)(v),He.trim(v)}catch(E){if(E.name!=="SyntaxError")throw E}return(z||JSON.stringify)(v)}const Sp={transitional:ay,adapter:["xhr","http","fetch"],transformRequest:[function(w,z){const E=z.getContentType()||"",L=E.indexOf("application/json")>-1,F=He.isObject(w);if(F&&He.isHTMLForm(w)&&(w=new FormData(w)),He.isFormData(w))return L?JSON.stringify(sy(w)):w;if(He.isArrayBuffer(w)||He.isBuffer(w)||He.isStream(w)||He.isFile(w)||He.isBlob(w)||He.isReadableStream(w))return w;if(He.isArrayBufferView(w))return w.buffer;if(He.isURLSearchParams(w))return z.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),w.toString();let c;if(F){if(E.indexOf("application/x-www-form-urlencoded")>-1)return Tx(w,this.formSerializer).toString();if((c=He.isFileList(w))||E.indexOf("multipart/form-data")>-1){const J=this.env&&this.env.FormData;return Tm(c?{"files[]":w}:w,J&&new J,this.formSerializer)}}return F||L?(z.setContentType("application/json",!1),Cx(w)):w}],transformResponse:[function(w){const z=this.transitional||Sp.transitional,E=z&&z.forcedJSONParsing,L=this.responseType==="json";if(He.isResponse(w)||He.isReadableStream(w))return w;if(w&&He.isString(w)&&(E&&!this.responseType||L)){const A=!(z&&z.silentJSONParsing)&&L;try{return JSON.parse(w)}catch(c){if(A)throw c.name==="SyntaxError"?di.from(c,di.ERR_BAD_RESPONSE,this,null,this.response):c}}return w}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:wa.classes.FormData,Blob:wa.classes.Blob},validateStatus:function(w){return w>=200&&w<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};He.forEach(["delete","get","head","post","put","patch"],v=>{Sp.headers[v]={}});const Ax=He.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),zx=v=>{const w={};let z,E,L;return v&&v.split(`
`).forEach(function(A){L=A.indexOf(":"),z=A.substring(0,L).trim().toLowerCase(),E=A.substring(L+1).trim(),!(!z||w[z]&&Ax[z])&&(z==="set-cookie"?w[z]?w[z].push(E):w[z]=[E]:w[z]=w[z]?w[z]+", "+E:E)}),w},l_=Symbol("internals");function lp(v){return v&&String(v).trim().toLowerCase()}function hm(v){return v===!1||v==null?v:He.isArray(v)?v.map(hm):String(v)}function Px(v){const w=Object.create(null),z=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let E;for(;E=z.exec(v);)w[E[1]]=E[2];return w}const Rx=v=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(v.trim());function Qm(v,w,z,E,L){if(He.isFunction(E))return E.call(this,w,z);if(L&&(w=z),!!He.isString(w)){if(He.isString(E))return w.indexOf(E)!==-1;if(He.isRegExp(E))return E.test(w)}}function Dx(v){return v.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(w,z,E)=>z.toUpperCase()+E)}function Ix(v,w){const z=He.toCamelCase(" "+w);["get","set","has"].forEach(E=>{Object.defineProperty(v,E+z,{value:function(L,F,A){return this[E].call(this,w,L,F,A)},configurable:!0})})}let ls=class{constructor(w){w&&this.set(w)}set(w,z,E){const L=this;function F(c,J,X){const re=lp(J);if(!re)throw new Error("header name must be a non-empty string");const Te=He.findKey(L,re);(!Te||L[Te]===void 0||X===!0||X===void 0&&L[Te]!==!1)&&(L[Te||J]=hm(c))}const A=(c,J)=>He.forEach(c,(X,re)=>F(X,re,J));if(He.isPlainObject(w)||w instanceof this.constructor)A(w,z);else if(He.isString(w)&&(w=w.trim())&&!Rx(w))A(zx(w),z);else if(He.isObject(w)&&He.isIterable(w)){let c={},J,X;for(const re of w){if(!He.isArray(re))throw TypeError("Object iterator must return a key-value pair");c[X=re[0]]=(J=c[X])?He.isArray(J)?[...J,re[1]]:[J,re[1]]:re[1]}A(c,z)}else w!=null&&F(z,w,E);return this}get(w,z){if(w=lp(w),w){const E=He.findKey(this,w);if(E){const L=this[E];if(!z)return L;if(z===!0)return Px(L);if(He.isFunction(z))return z.call(this,L,E);if(He.isRegExp(z))return z.exec(L);throw new TypeError("parser must be boolean|regexp|function")}}}has(w,z){if(w=lp(w),w){const E=He.findKey(this,w);return!!(E&&this[E]!==void 0&&(!z||Qm(this,this[E],E,z)))}return!1}delete(w,z){const E=this;let L=!1;function F(A){if(A=lp(A),A){const c=He.findKey(E,A);c&&(!z||Qm(E,E[c],c,z))&&(delete E[c],L=!0)}}return He.isArray(w)?w.forEach(F):F(w),L}clear(w){const z=Object.keys(this);let E=z.length,L=!1;for(;E--;){const F=z[E];(!w||Qm(this,this[F],F,w,!0))&&(delete this[F],L=!0)}return L}normalize(w){const z=this,E={};return He.forEach(this,(L,F)=>{const A=He.findKey(E,F);if(A){z[A]=hm(L),delete z[F];return}const c=w?Dx(F):String(F).trim();c!==F&&delete z[F],z[c]=hm(L),E[c]=!0}),this}concat(...w){return this.constructor.concat(this,...w)}toJSON(w){const z=Object.create(null);return He.forEach(this,(E,L)=>{E!=null&&E!==!1&&(z[L]=w&&He.isArray(E)?E.join(", "):E)}),z}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([w,z])=>w+": "+z).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(w){return w instanceof this?w:new this(w)}static concat(w,...z){const E=new this(w);return z.forEach(L=>E.set(L)),E}static accessor(w){const E=(this[l_]=this[l_]={accessors:{}}).accessors,L=this.prototype;function F(A){const c=lp(A);E[c]||(Ix(L,A),E[c]=!0)}return He.isArray(w)?w.forEach(F):F(w),this}};ls.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);He.reduceDescriptors(ls.prototype,({value:v},w)=>{let z=w[0].toUpperCase()+w.slice(1);return{get:()=>v,set(E){this[z]=E}}});He.freezeMethods(ls);function Jm(v,w){const z=this||Sp,E=w||z,L=ls.from(E.headers);let F=E.data;return He.forEach(v,function(c){F=c.call(z,F,L.normalize(),w?w.status:void 0)}),L.normalize(),F}function oy(v){return!!(v&&v.__CANCEL__)}function Gd(v,w,z){di.call(this,v??"canceled",di.ERR_CANCELED,w,z),this.name="CanceledError"}He.inherits(Gd,di,{__CANCEL__:!0});function ly(v,w,z){const E=z.config.validateStatus;!z.status||!E||E(z.status)?v(z):w(new di("Request failed with status code "+z.status,[di.ERR_BAD_REQUEST,di.ERR_BAD_RESPONSE][Math.floor(z.status/100)-4],z.config,z.request,z))}function kx(v){const w=/^([-+\w]{1,25})(:?\/\/|:)/.exec(v);return w&&w[1]||""}function Lx(v,w){v=v||10;const z=new Array(v),E=new Array(v);let L=0,F=0,A;return w=w!==void 0?w:1e3,function(J){const X=Date.now(),re=E[F];A||(A=X),z[L]=J,E[L]=X;let Te=F,xe=0;for(;Te!==L;)xe+=z[Te++],Te=Te%v;if(L=(L+1)%v,L===F&&(F=(F+1)%v),X-A<w)return;const de=re&&X-re;return de?Math.round(xe*1e3/de):void 0}}function Ox(v,w){let z=0,E=1e3/w,L,F;const A=(X,re=Date.now())=>{z=re,L=null,F&&(clearTimeout(F),F=null),v(...X)};return[(...X)=>{const re=Date.now(),Te=re-z;Te>=E?A(X,re):(L=X,F||(F=setTimeout(()=>{F=null,A(L)},E-Te)))},()=>L&&A(L)]}const mm=(v,w,z=3)=>{let E=0;const L=Lx(50,250);return Ox(F=>{const A=F.loaded,c=F.lengthComputable?F.total:void 0,J=A-E,X=L(J),re=A<=c;E=A;const Te={loaded:A,total:c,progress:c?A/c:void 0,bytes:J,rate:X||void 0,estimated:X&&c&&re?(c-A)/X:void 0,event:F,lengthComputable:c!=null,[w?"download":"upload"]:!0};v(Te)},z)},c_=(v,w)=>{const z=v!=null;return[E=>w[0]({lengthComputable:z,total:v,loaded:E}),w[1]]},u_=v=>(...w)=>He.asap(()=>v(...w)),Bx=wa.hasStandardBrowserEnv?((v,w)=>z=>(z=new URL(z,wa.origin),v.protocol===z.protocol&&v.host===z.host&&(w||v.port===z.port)))(new URL(wa.origin),wa.navigator&&/(msie|trident)/i.test(wa.navigator.userAgent)):()=>!0,Fx=wa.hasStandardBrowserEnv?{write(v,w,z,E,L,F){const A=[v+"="+encodeURIComponent(w)];He.isNumber(z)&&A.push("expires="+new Date(z).toGMTString()),He.isString(E)&&A.push("path="+E),He.isString(L)&&A.push("domain="+L),F===!0&&A.push("secure"),document.cookie=A.join("; ")},read(v){const w=document.cookie.match(new RegExp("(^|;\\s*)("+v+")=([^;]*)"));return w?decodeURIComponent(w[3]):null},remove(v){this.write(v,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Nx(v){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(v)}function jx(v,w){return w?v.replace(/\/?\/$/,"")+"/"+w.replace(/^\/+/,""):v}function cy(v,w,z){let E=!Nx(w);return v&&(E||z==!1)?jx(v,w):w}const h_=v=>v instanceof ls?{...v}:v;function qh(v,w){w=w||{};const z={};function E(X,re,Te,xe){return He.isPlainObject(X)&&He.isPlainObject(re)?He.merge.call({caseless:xe},X,re):He.isPlainObject(re)?He.merge({},re):He.isArray(re)?re.slice():re}function L(X,re,Te,xe){if(He.isUndefined(re)){if(!He.isUndefined(X))return E(void 0,X,Te,xe)}else return E(X,re,Te,xe)}function F(X,re){if(!He.isUndefined(re))return E(void 0,re)}function A(X,re){if(He.isUndefined(re)){if(!He.isUndefined(X))return E(void 0,X)}else return E(void 0,re)}function c(X,re,Te){if(Te in w)return E(X,re);if(Te in v)return E(void 0,X)}const J={url:F,method:F,data:F,baseURL:A,transformRequest:A,transformResponse:A,paramsSerializer:A,timeout:A,timeoutMessage:A,withCredentials:A,withXSRFToken:A,adapter:A,responseType:A,xsrfCookieName:A,xsrfHeaderName:A,onUploadProgress:A,onDownloadProgress:A,decompress:A,maxContentLength:A,maxBodyLength:A,beforeRedirect:A,transport:A,httpAgent:A,httpsAgent:A,cancelToken:A,socketPath:A,responseEncoding:A,validateStatus:c,headers:(X,re,Te)=>L(h_(X),h_(re),Te,!0)};return He.forEach(Object.keys({...v,...w}),function(re){const Te=J[re]||L,xe=Te(v[re],w[re],re);He.isUndefined(xe)&&Te!==c||(z[re]=xe)}),z}const uy=v=>{const w=qh({},v);let{data:z,withXSRFToken:E,xsrfHeaderName:L,xsrfCookieName:F,headers:A,auth:c}=w;w.headers=A=ls.from(A),w.url=ry(cy(w.baseURL,w.url,w.allowAbsoluteUrls),v.params,v.paramsSerializer),c&&A.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):"")));let J;if(He.isFormData(z)){if(wa.hasStandardBrowserEnv||wa.hasStandardBrowserWebWorkerEnv)A.setContentType(void 0);else if((J=A.getContentType())!==!1){const[X,...re]=J?J.split(";").map(Te=>Te.trim()).filter(Boolean):[];A.setContentType([X||"multipart/form-data",...re].join("; "))}}if(wa.hasStandardBrowserEnv&&(E&&He.isFunction(E)&&(E=E(w)),E||E!==!1&&Bx(w.url))){const X=L&&F&&Fx.read(F);X&&A.set(L,X)}return w},Ux=typeof XMLHttpRequest<"u",Vx=Ux&&function(v){return new Promise(function(z,E){const L=uy(v);let F=L.data;const A=ls.from(L.headers).normalize();let{responseType:c,onUploadProgress:J,onDownloadProgress:X}=L,re,Te,xe,de,Ee;function We(){de&&de(),Ee&&Ee(),L.cancelToken&&L.cancelToken.unsubscribe(re),L.signal&&L.signal.removeEventListener("abort",re)}let Ve=new XMLHttpRequest;Ve.open(L.method.toUpperCase(),L.url,!0),Ve.timeout=L.timeout;function et(){if(!Ve)return;const Tt=ls.from("getAllResponseHeaders"in Ve&&Ve.getAllResponseHeaders()),pt={data:!c||c==="text"||c==="json"?Ve.responseText:Ve.response,status:Ve.status,statusText:Ve.statusText,headers:Tt,config:v,request:Ve};ly(function(oi){z(oi),We()},function(oi){E(oi),We()},pt),Ve=null}"onloadend"in Ve?Ve.onloadend=et:Ve.onreadystatechange=function(){!Ve||Ve.readyState!==4||Ve.status===0&&!(Ve.responseURL&&Ve.responseURL.indexOf("file:")===0)||setTimeout(et)},Ve.onabort=function(){Ve&&(E(new di("Request aborted",di.ECONNABORTED,v,Ve)),Ve=null)},Ve.onerror=function(){E(new di("Network Error",di.ERR_NETWORK,v,Ve)),Ve=null},Ve.ontimeout=function(){let Ot=L.timeout?"timeout of "+L.timeout+"ms exceeded":"timeout exceeded";const pt=L.transitional||ay;L.timeoutErrorMessage&&(Ot=L.timeoutErrorMessage),E(new di(Ot,pt.clarifyTimeoutError?di.ETIMEDOUT:di.ECONNABORTED,v,Ve)),Ve=null},F===void 0&&A.setContentType(null),"setRequestHeader"in Ve&&He.forEach(A.toJSON(),function(Ot,pt){Ve.setRequestHeader(pt,Ot)}),He.isUndefined(L.withCredentials)||(Ve.withCredentials=!!L.withCredentials),c&&c!=="json"&&(Ve.responseType=L.responseType),X&&([xe,Ee]=mm(X,!0),Ve.addEventListener("progress",xe)),J&&Ve.upload&&([Te,de]=mm(J),Ve.upload.addEventListener("progress",Te),Ve.upload.addEventListener("loadend",de)),(L.cancelToken||L.signal)&&(re=Tt=>{Ve&&(E(!Tt||Tt.type?new Gd(null,v,Ve):Tt),Ve.abort(),Ve=null)},L.cancelToken&&L.cancelToken.subscribe(re),L.signal&&(L.signal.aborted?re():L.signal.addEventListener("abort",re)));const ft=kx(L.url);if(ft&&wa.protocols.indexOf(ft)===-1){E(new di("Unsupported protocol "+ft+":",di.ERR_BAD_REQUEST,v));return}Ve.send(F||null)})},Gx=(v,w)=>{const{length:z}=v=v?v.filter(Boolean):[];if(w||z){let E=new AbortController,L;const F=function(X){if(!L){L=!0,c();const re=X instanceof Error?X:this.reason;E.abort(re instanceof di?re:new Gd(re instanceof Error?re.message:re))}};let A=w&&setTimeout(()=>{A=null,F(new di(`timeout ${w} of ms exceeded`,di.ETIMEDOUT))},w);const c=()=>{v&&(A&&clearTimeout(A),A=null,v.forEach(X=>{X.unsubscribe?X.unsubscribe(F):X.removeEventListener("abort",F)}),v=null)};v.forEach(X=>X.addEventListener("abort",F));const{signal:J}=E;return J.unsubscribe=()=>He.asap(c),J}},qx=function*(v,w){let z=v.byteLength;if(z<w){yield v;return}let E=0,L;for(;E<z;)L=E+w,yield v.slice(E,L),E=L},Zx=async function*(v,w){for await(const z of $x(v))yield*qx(z,w)},$x=async function*(v){if(v[Symbol.asyncIterator]){yield*v;return}const w=v.getReader();try{for(;;){const{done:z,value:E}=await w.read();if(z)break;yield E}}finally{await w.cancel()}},d_=(v,w,z,E)=>{const L=Zx(v,w);let F=0,A,c=J=>{A||(A=!0,E&&E(J))};return new ReadableStream({async pull(J){try{const{done:X,value:re}=await L.next();if(X){c(),J.close();return}let Te=re.byteLength;if(z){let xe=F+=Te;z(xe)}J.enqueue(new Uint8Array(re))}catch(X){throw c(X),X}},cancel(J){return c(J),L.return()}},{highWaterMark:2})},Mm=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",hy=Mm&&typeof ReadableStream=="function",Hx=Mm&&(typeof TextEncoder=="function"?(v=>w=>v.encode(w))(new TextEncoder):async v=>new Uint8Array(await new Response(v).arrayBuffer())),dy=(v,...w)=>{try{return!!v(...w)}catch{return!1}},Xx=hy&&dy(()=>{let v=!1;const w=new Request(wa.origin,{body:new ReadableStream,method:"POST",get duplex(){return v=!0,"half"}}).headers.has("Content-Type");return v&&!w}),f_=64*1024,dg=hy&&dy(()=>He.isReadableStream(new Response("").body)),gm={stream:dg&&(v=>v.body)};Mm&&(v=>{["text","arrayBuffer","blob","formData","stream"].forEach(w=>{!gm[w]&&(gm[w]=He.isFunction(v[w])?z=>z[w]():(z,E)=>{throw new di(`Response type '${w}' is not supported`,di.ERR_NOT_SUPPORT,E)})})})(new Response);const Yx=async v=>{if(v==null)return 0;if(He.isBlob(v))return v.size;if(He.isSpecCompliantForm(v))return(await new Request(wa.origin,{method:"POST",body:v}).arrayBuffer()).byteLength;if(He.isArrayBufferView(v)||He.isArrayBuffer(v))return v.byteLength;if(He.isURLSearchParams(v)&&(v=v+""),He.isString(v))return(await Hx(v)).byteLength},Kx=async(v,w)=>{const z=He.toFiniteNumber(v.getContentLength());return z??Yx(w)},Wx=Mm&&(async v=>{let{url:w,method:z,data:E,signal:L,cancelToken:F,timeout:A,onDownloadProgress:c,onUploadProgress:J,responseType:X,headers:re,withCredentials:Te="same-origin",fetchOptions:xe}=uy(v);X=X?(X+"").toLowerCase():"text";let de=Gx([L,F&&F.toAbortSignal()],A),Ee;const We=de&&de.unsubscribe&&(()=>{de.unsubscribe()});let Ve;try{if(J&&Xx&&z!=="get"&&z!=="head"&&(Ve=await Kx(re,E))!==0){let pt=new Request(w,{method:"POST",body:E,duplex:"half"}),Ut;if(He.isFormData(E)&&(Ut=pt.headers.get("content-type"))&&re.setContentType(Ut),pt.body){const[oi,Di]=c_(Ve,mm(u_(J)));E=d_(pt.body,f_,oi,Di)}}He.isString(Te)||(Te=Te?"include":"omit");const et="credentials"in Request.prototype;Ee=new Request(w,{...xe,signal:de,method:z.toUpperCase(),headers:re.normalize().toJSON(),body:E,duplex:"half",credentials:et?Te:void 0});let ft=await fetch(Ee,xe);const Tt=dg&&(X==="stream"||X==="response");if(dg&&(c||Tt&&We)){const pt={};["status","statusText","headers"].forEach(Mi=>{pt[Mi]=ft[Mi]});const Ut=He.toFiniteNumber(ft.headers.get("content-length")),[oi,Di]=c&&c_(Ut,mm(u_(c),!0))||[];ft=new Response(d_(ft.body,f_,oi,()=>{Di&&Di(),We&&We()}),pt)}X=X||"text";let Ot=await gm[He.findKey(gm,X)||"text"](ft,v);return!Tt&&We&&We(),await new Promise((pt,Ut)=>{ly(pt,Ut,{data:Ot,headers:ls.from(ft.headers),status:ft.status,statusText:ft.statusText,config:v,request:Ee})})}catch(et){throw We&&We(),et&&et.name==="TypeError"&&/Load failed|fetch/i.test(et.message)?Object.assign(new di("Network Error",di.ERR_NETWORK,v,Ee),{cause:et.cause||et}):di.from(et,et&&et.code,v,Ee)}}),fg={http:dx,xhr:Vx,fetch:Wx};He.forEach(fg,(v,w)=>{if(v){try{Object.defineProperty(v,"name",{value:w})}catch{}Object.defineProperty(v,"adapterName",{value:w})}});const p_=v=>`- ${v}`,Qx=v=>He.isFunction(v)||v===null||v===!1,fy={getAdapter:v=>{v=He.isArray(v)?v:[v];const{length:w}=v;let z,E;const L={};for(let F=0;F<w;F++){z=v[F];let A;if(E=z,!Qx(z)&&(E=fg[(A=String(z)).toLowerCase()],E===void 0))throw new di(`Unknown adapter '${A}'`);if(E)break;L[A||"#"+F]=E}if(!E){const F=Object.entries(L).map(([c,J])=>`adapter ${c} `+(J===!1?"is not supported by the environment":"is not available in the build"));let A=w?F.length>1?`since :
`+F.map(p_).join(`
`):" "+p_(F[0]):"as no adapter specified";throw new di("There is no suitable adapter to dispatch the request "+A,"ERR_NOT_SUPPORT")}return E},adapters:fg};function eg(v){if(v.cancelToken&&v.cancelToken.throwIfRequested(),v.signal&&v.signal.aborted)throw new Gd(null,v)}function m_(v){return eg(v),v.headers=ls.from(v.headers),v.data=Jm.call(v,v.transformRequest),["post","put","patch"].indexOf(v.method)!==-1&&v.headers.setContentType("application/x-www-form-urlencoded",!1),fy.getAdapter(v.adapter||Sp.adapter)(v).then(function(E){return eg(v),E.data=Jm.call(v,v.transformResponse,E),E.headers=ls.from(E.headers),E},function(E){return oy(E)||(eg(v),E&&E.response&&(E.response.data=Jm.call(v,v.transformResponse,E.response),E.response.headers=ls.from(E.response.headers))),Promise.reject(E)})}const py="1.11.0",Em={};["object","boolean","number","function","string","symbol"].forEach((v,w)=>{Em[v]=function(E){return typeof E===v||"a"+(w<1?"n ":" ")+v}});const g_={};Em.transitional=function(w,z,E){function L(F,A){return"[Axios v"+py+"] Transitional option '"+F+"'"+A+(E?". "+E:"")}return(F,A,c)=>{if(w===!1)throw new di(L(A," has been removed"+(z?" in "+z:"")),di.ERR_DEPRECATED);return z&&!g_[A]&&(g_[A]=!0,console.warn(L(A," has been deprecated since v"+z+" and will be removed in the near future"))),w?w(F,A,c):!0}};Em.spelling=function(w){return(z,E)=>(console.warn(`${E} is likely a misspelling of ${w}`),!0)};function Jx(v,w,z){if(typeof v!="object")throw new di("options must be an object",di.ERR_BAD_OPTION_VALUE);const E=Object.keys(v);let L=E.length;for(;L-- >0;){const F=E[L],A=w[F];if(A){const c=v[F],J=c===void 0||A(c,F,v);if(J!==!0)throw new di("option "+F+" must be "+J,di.ERR_BAD_OPTION_VALUE);continue}if(z!==!0)throw new di("Unknown option "+F,di.ERR_BAD_OPTION)}}const dm={assertOptions:Jx,validators:Em},Hl=dm.validators;let Gh=class{constructor(w){this.defaults=w||{},this.interceptors={request:new o_,response:new o_}}async request(w,z){try{return await this._request(w,z)}catch(E){if(E instanceof Error){let L={};Error.captureStackTrace?Error.captureStackTrace(L):L=new Error;const F=L.stack?L.stack.replace(/^.+\n/,""):"";try{E.stack?F&&!String(E.stack).endsWith(F.replace(/^.+\n.+\n/,""))&&(E.stack+=`
`+F):E.stack=F}catch{}}throw E}}_request(w,z){typeof w=="string"?(z=z||{},z.url=w):z=w||{},z=qh(this.defaults,z);const{transitional:E,paramsSerializer:L,headers:F}=z;E!==void 0&&dm.assertOptions(E,{silentJSONParsing:Hl.transitional(Hl.boolean),forcedJSONParsing:Hl.transitional(Hl.boolean),clarifyTimeoutError:Hl.transitional(Hl.boolean)},!1),L!=null&&(He.isFunction(L)?z.paramsSerializer={serialize:L}:dm.assertOptions(L,{encode:Hl.function,serialize:Hl.function},!0)),z.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?z.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:z.allowAbsoluteUrls=!0),dm.assertOptions(z,{baseUrl:Hl.spelling("baseURL"),withXsrfToken:Hl.spelling("withXSRFToken")},!0),z.method=(z.method||this.defaults.method||"get").toLowerCase();let A=F&&He.merge(F.common,F[z.method]);F&&He.forEach(["delete","get","head","post","put","patch","common"],Ee=>{delete F[Ee]}),z.headers=ls.concat(A,F);const c=[];let J=!0;this.interceptors.request.forEach(function(We){typeof We.runWhen=="function"&&We.runWhen(z)===!1||(J=J&&We.synchronous,c.unshift(We.fulfilled,We.rejected))});const X=[];this.interceptors.response.forEach(function(We){X.push(We.fulfilled,We.rejected)});let re,Te=0,xe;if(!J){const Ee=[m_.bind(this),void 0];for(Ee.unshift(...c),Ee.push(...X),xe=Ee.length,re=Promise.resolve(z);Te<xe;)re=re.then(Ee[Te++],Ee[Te++]);return re}xe=c.length;let de=z;for(Te=0;Te<xe;){const Ee=c[Te++],We=c[Te++];try{de=Ee(de)}catch(Ve){We.call(this,Ve);break}}try{re=m_.call(this,de)}catch(Ee){return Promise.reject(Ee)}for(Te=0,xe=X.length;Te<xe;)re=re.then(X[Te++],X[Te++]);return re}getUri(w){w=qh(this.defaults,w);const z=cy(w.baseURL,w.url,w.allowAbsoluteUrls);return ry(z,w.params,w.paramsSerializer)}};He.forEach(["delete","get","head","options"],function(w){Gh.prototype[w]=function(z,E){return this.request(qh(E||{},{method:w,url:z,data:(E||{}).data}))}});He.forEach(["post","put","patch"],function(w){function z(E){return function(F,A,c){return this.request(qh(c||{},{method:w,headers:E?{"Content-Type":"multipart/form-data"}:{},url:F,data:A}))}}Gh.prototype[w]=z(),Gh.prototype[w+"Form"]=z(!0)});let eb=class my{constructor(w){if(typeof w!="function")throw new TypeError("executor must be a function.");let z;this.promise=new Promise(function(F){z=F});const E=this;this.promise.then(L=>{if(!E._listeners)return;let F=E._listeners.length;for(;F-- >0;)E._listeners[F](L);E._listeners=null}),this.promise.then=L=>{let F;const A=new Promise(c=>{E.subscribe(c),F=c}).then(L);return A.cancel=function(){E.unsubscribe(F)},A},w(function(F,A,c){E.reason||(E.reason=new Gd(F,A,c),z(E.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(w){if(this.reason){w(this.reason);return}this._listeners?this._listeners.push(w):this._listeners=[w]}unsubscribe(w){if(!this._listeners)return;const z=this._listeners.indexOf(w);z!==-1&&this._listeners.splice(z,1)}toAbortSignal(){const w=new AbortController,z=E=>{w.abort(E)};return this.subscribe(z),w.signal.unsubscribe=()=>this.unsubscribe(z),w.signal}static source(){let w;return{token:new my(function(L){w=L}),cancel:w}}};function tb(v){return function(z){return v.apply(null,z)}}function ib(v){return He.isObject(v)&&v.isAxiosError===!0}const pg={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(pg).forEach(([v,w])=>{pg[w]=v});function gy(v){const w=new Gh(v),z=$_(Gh.prototype.request,w);return He.extend(z,Gh.prototype,w,{allOwnKeys:!0}),He.extend(z,w,null,{allOwnKeys:!0}),z.create=function(L){return gy(qh(v,L))},z}const hr=gy(Sp);hr.Axios=Gh;hr.CanceledError=Gd;hr.CancelToken=eb;hr.isCancel=oy;hr.VERSION=py;hr.toFormData=Tm;hr.AxiosError=di;hr.Cancel=hr.CanceledError;hr.all=function(w){return Promise.all(w)};hr.spread=tb;hr.isAxiosError=ib;hr.mergeConfig=qh;hr.AxiosHeaders=ls;hr.formToJSON=v=>sy(He.isHTMLForm(v)?new FormData(v):v);hr.getAdapter=fy.getAdapter;hr.HttpStatusCode=pg;hr.default=hr;const{Axios:u1,AxiosError:h1,CanceledError:d1,isCancel:f1,CancelToken:p1,VERSION:m1,all:g1,Cancel:_1,isAxiosError:y1,spread:v1,toFormData:x1,AxiosHeaders:b1,HttpStatusCode:w1,formToJSON:S1,getAdapter:T1,mergeConfig:M1}=hr,nb=({rating:v})=>{const w=Array(5).fill(0).map((z,E)=>E<v?"★":"☆");return Et.jsx("div",{children:w.map((z,E)=>Et.jsx("span",{style:{color:"#007bff"},children:z},E))})},rb=({itemId:v})=>{const[w,z]=Ye.useState(0),E=async()=>{try{const L=await hr.get(`/api/ratings/average/${v}`);z(L.data.average)}catch(L){console.error(L)}};return Ye.useEffect(()=>{E()},[v]),Et.jsx("div",{children:Et.jsx(nb,{rating:w})})};var Vh,Fd;class ab{constructor(w){Um(this,Vh);Um(this,Fd,new Set);Vm(this,Vh,w)}get current(){return Bd(this,Vh)}set current(w){Bd(this,Vh)!=w&&(Vm(this,Vh,w),Bd(this,Fd).forEach(z=>z(w)))}on(w){return Bd(this,Fd).add(w),()=>Bd(this,Fd).delete(w)}}Vh=new WeakMap,Fd=new WeakMap;const _y=v=>new ab(v),mg=Symbol.for("atomico.hooks");globalThis[mg]=globalThis[mg]||{};let Nd=globalThis[mg];const sb=Symbol.for("Atomico.suspense"),yy=Symbol.for("Atomico.effect"),ob=Symbol.for("Atomico.layoutEffect"),vy=Symbol.for("Atomico.insertionEffect"),qd=(v,w,z)=>{const{i:E,hooks:L}=Nd.c,F=L[E]=L[E]||{};return F.value=v(F.value),F.effect=w,F.tag=z,Nd.c.i++,L[E].value},lb=v=>qd((w=_y(v))=>w),Tp=()=>qd((v=_y(Nd.c.host))=>v),xy=()=>Nd.c.update,cb=(v,w,z=0)=>{let E={},L=!1;const F=()=>L,A=(c,J)=>{for(const X in E){const re=E[X];re.effect&&re.tag===c&&(re.value=re.effect(re.value,J))}};return{load:c=>{Nd.c={host:w,hooks:E,update:v,i:0,id:z};let J;try{L=!1,J=c()}catch(X){if(X!==sb)throw X;L=!0}finally{Nd.c=null}return J},cleanEffects:c=>(A(vy,c),()=>(A(ob,c),()=>{A(yy,c)})),isSuspense:F}},Zd=Symbol.for;function by(v,w){const z=v.length;if(z!==w.length)return!1;for(let E=0;E<z;E++){let L=v[E],F=w[E];if(L!==F)return!1}return!0}const Xl=v=>typeof v=="function",up=v=>typeof v=="object",{isArray:ub}=Array,gg=(v,w)=>(w?v instanceof HTMLStyleElement:!0)&&"hydrate"in((v==null?void 0:v.dataset)||{});function wy(v,w){let z;const E=L=>{let{length:F}=L;for(let A=0;A<F;A++){const c=L[A];if(c&&Array.isArray(c))E(c);else{const J=typeof c;if(c==null||J==="function"||J==="boolean")continue;J==="string"||J==="number"?(z==null&&(z=""),z+=c):(z!=null&&(w(z),z=null),w(c))}}};E(v),z!=null&&w(z)}const Sy=(v,w,z)=>(v.addEventListener(w,z),()=>v.removeEventListener(w,z));class Ty{constructor(w,z,E){this.message=z,this.target=w,this.value=E}}class My extends Ty{}class hb extends Ty{}const _m="Custom",db=null,fb={true:1,"":1,1:1};function pb(v,w,z,E,L){const{type:F,reflect:A,event:c,value:J,attr:X=mb(w)}=(z==null?void 0:z.name)!=_m&&up(z)&&z!=db?z:{type:z},re=(F==null?void 0:F.name)===_m&&F.map,Te=J!=null?F==Function||!Xl(J)?()=>J:J:null;Object.defineProperty(v,w,{configurable:!0,set(xe){const de=this[w];Te&&F!=Boolean&&xe==null&&(xe=Te());const{error:Ee,value:We}=(re?yb:vb)(F,xe);if(Ee&&We!=null)throw new My(this,`The value defined for prop '${w}' must be of type '${F.name}'`,We);de!=We&&(this._props[w]=We??void 0,this.update(),c&&Ey(this,c),this.updated.then(()=>{A&&(this._ignoreAttr=X,gb(this,F,X,this[w]),this._ignoreAttr=null)}))},get(){return this._props[w]}}),Te&&(L[w]=Te()),E[X]={prop:w,type:F}}const Ey=(v,{type:w,base:z=CustomEvent,...E})=>v.dispatchEvent(new z(w,E)),mb=v=>v.replace(/([A-Z])/g,"-$1").toLowerCase(),gb=(v,w,z,E)=>E==null||w==Boolean&&!E?v.removeAttribute(z):v.setAttribute(z,(w==null?void 0:w.name)===_m&&(w!=null&&w.serialize)?w==null?void 0:w.serialize(E):up(E)?JSON.stringify(E):w==Boolean?"":E),_b=(v,w)=>v==Boolean?!!fb[w]:v==Number?Number(w):v==String?w:v==Array||v==Object?JSON.parse(w):v.name==_m?w:new v(w),yb=({map:v},w)=>{try{return{value:v(w),error:!1}}catch{return{value:w,error:!0}}},vb=(v,w)=>v==null||w==null?{value:w,error:!1}:v!=String&&w===""?{value:void 0,error:!1}:v==Object||v==Array||v==Symbol?{value:w,error:{}.toString.call(w)!==`[object ${v.name}]`}:w instanceof v?{value:w,error:v==Number&&Number.isNaN(w.valueOf())}:v==String||v==Number||v==Boolean?{value:w,error:v==Number?typeof w!="number"?!0:Number.isNaN(w):v==String?typeof w!="string":typeof w!="boolean"}:{value:w,error:!0};let xb=0;const bb=v=>{var z;return((z=(v==null?void 0:v.dataset)||{})==null?void 0:z.hydrate)||""||"c"+xb++},Mp=(v,w=HTMLElement)=>{const z={},E={},L="prototype"in w&&w.prototype instanceof Element,F=L?w:"base"in w?w.base:HTMLElement,{props:A,styles:c}=L?v:w;class J extends F{constructor(){super(),this._setup(),this._render=()=>v({...this._props});for(const re in E)this[re]=E[re]}static get styles(){return[super.styles,c]}async _setup(){if(this._props)return;this._props={};let re,Te;this.mounted=new Promise(Ve=>this.mount=()=>{Ve(),re!=this.parentNode&&(Te!=re?this.unmounted.then(this.update):this.update()),re=this.parentNode}),this.unmounted=new Promise(Ve=>this.unmount=()=>{Ve(),(re!=this.parentNode||!this.isConnected)&&(xe.cleanEffects(!0)()(),Te=this.parentNode,re=null)}),this.symbolId=this.symbolId||Symbol(),this.symbolIdParent=Symbol();const xe=cb(()=>this.update(),this,bb(this));let de,Ee=!0;const We=gg(this);this.update=()=>(de||(de=!0,this.updated=(this.updated||this.mounted).then(()=>{try{const Ve=xe.load(this._render),et=xe.cleanEffects();return Ve&&Ve.render(this,this.symbolId,We),de=!1,Ee&&!xe.isSuspense()&&(Ee=!1,!We&&wb(this)),et()}finally{de=!1}}).then(Ve=>{Ve&&Ve()})),this.updated),this.update()}connectedCallback(){this.mount(),super.connectedCallback&&super.connectedCallback()}disconnectedCallback(){super.disconnectedCallback&&super.disconnectedCallback(),this.unmount()}attributeChangedCallback(re,Te,xe){if(z[re]){if(re===this._ignoreAttr||Te===xe)return;const{prop:de,type:Ee}=z[re];try{this[de]=_b(Ee,xe)}catch{throw new hb(this,`The value defined as attr '${re}' cannot be parsed by type '${Ee.name}'`,xe)}}else super.attributeChangedCallback(re,Te,xe)}static get props(){return{...super.props,...A}}static get observedAttributes(){const re=super.observedAttributes||[];for(const Te in A)pb(this.prototype,Te,A[Te],z,E);return Object.keys(z).concat(re)}}return J};function wb(v){const{styles:w}=v.constructor,{shadowRoot:z}=v;if(z&&w.length){const E=[];wy(w,L=>{L&&(L instanceof Element?z.appendChild(L.cloneNode(!0)):E.push(L))}),E.length&&(z.adoptedStyleSheets=E)}}const Cy=v=>(w,z)=>{qd(([E,L]=[])=>((L||!L)&&(L&&by(L,z)?E=E||!0:(Xl(E)&&E(),E=null)),[E,z]),([E,L],F)=>F?(Xl(E)&&E(),[]):[E||w(),L],v)},mp=Cy(yy),Sb=Cy(vy);class Ay extends Array{constructor(w,z){let E=!0;const L=F=>{try{z(F,this,E)}finally{E=!1}};super(void 0,L,z),L(w)}}const zg=v=>{const w=xy();return qd((z=new Ay(v,(E,L,F)=>{E=Xl(E)?E(L[0]):E,E!==L[0]&&(L[0]=E,F||w())}))=>z)},Uc=(v,w)=>{const[z]=qd(([E,L,F=0]=[])=>((!L||L&&!by(L,w))&&(E=v()),[E,w,F]));return z},Pg=v=>{const{current:w}=Tp();if(!(v in w))throw new My(w,`For useProp("${v}"), the prop does not exist on the host.`,v);return qd((z=new Ay(w[v],(E,L)=>{E=Xl(E)?E(w[v]):E,w[v]=E}))=>(z[0]=w[v],z))},Ou=(v,w={})=>{const z=Tp();return z[v]||(z[v]=(E=w.detail)=>Ey(z.current,{type:v,...w,detail:E})),z[v]},_g=Zd("atomico/options");globalThis[_g]=globalThis[_g]||{sheet:!!document.adoptedStyleSheets};const zy=globalThis[_g],Tb={checked:1,value:1,selected:1},Mb={list:1,type:1,size:1,form:1,width:1,height:1,src:1,href:1,slot:1},Eb={shadowDom:1,staticNode:1,cloneNode:1,children:1,key:1},fm={},yg=[];class vg extends Text{}const Cb=Zd("atomico/id"),hp=Zd("atomico/type"),tg=Zd("atomico/ref"),Py=Zd("atomico/vnode"),Ab=()=>{};function zb(v,w,z){return Dy(this,v,w,z)}const Ry=(v,w,...z)=>{const E=w||fm;let{children:L}=E;if(L=L??(z.length?z:yg),v===Ab)return L;const F=v?v instanceof Node?1:v.prototype instanceof HTMLElement&&2:0;if(F===!1&&v instanceof Function)return v(L!=yg?{children:L,...E}:E);const A=zy.render||zb;return{[hp]:Py,type:v,props:E,children:L,key:E.key,shadow:E.shadowDom,static:E.staticNode,raw:F,is:E.is,clone:E.cloneNode,render:A}};function Dy(v,w,z=Cb,E,L){let F;if(w&&w[z]&&w[z].vnode==v||v[hp]!=Py)return w;(v||!w)&&(L=L||v.type=="svg",F=v.type!="host"&&(v.raw==1?(w&&v.clone?w[tg]:w)!=v.type:v.raw==2?!(w instanceof v.type):w?w[tg]||w.localName!=v.type:!w),F&&v.type!=null&&(v.raw==1&&v.clone?(E=!0,w=v.type.cloneNode(!0),w[tg]=v.type):w=v.raw==1?v.type:v.raw==2?new v.type:L?document.createElementNS("http://www.w3.org/2000/svg",v.type):document.createElement(v.type,v.is?{is:v.is}:void 0)));const A=w[z]?w[z]:fm,{vnode:c=fm,cycle:J=0}=A;let{fragment:X,handlers:re}=A;const{children:Te=yg,props:xe=fm}=c;if(re=F?{}:re||{},v.static&&!F)return w;if(v.shadow&&!w.shadowRoot&&w.attachShadow({mode:"open",...v.shadow}),v.props!=xe&&Db(w,xe,v.props,re,L),v.children!==Te){const de=v.shadow?w.shadowRoot:w;X=Rb(v.children,X,de,z,!J&&E,L&&v.type=="foreignObject"?!1:L)}return w[z]={vnode:v,handlers:re,fragment:X,cycle:J+1},w}function Pb(v,w){const z=new vg(""),E=new vg("");let L;if(v[w?"prepend":"append"](z),w){let{lastElementChild:F}=v;for(;F;){const{previousElementSibling:A}=F;if(gg(F,!0)&&!gg(A,!0)){L=F;break}F=A}}return L?L.before(E):v.append(E),{markStart:z,markEnd:E}}function Rb(v,w,z,E,L,F){v=v==null?null:ub(v)?v:[v];const A=w||Pb(z,L),{markStart:c,markEnd:J,keyes:X}=A;let re;const Te=X&&new Set;let xe=c;if(v&&wy(v,de=>{if(typeof de=="object"&&!de[hp])return;const Ee=de[hp]&&de.key,We=X&&Ee!=null&&X.get(Ee);xe!=J&&xe===We?Te.delete(xe):xe=xe==J?J:xe.nextSibling;const Ve=X?We:xe;let et=Ve;if(de[hp])et=Dy(de,Ve,E,L,F);else{const ft=de+"";!(et instanceof Text)||et instanceof vg?et=new Text(ft):et.data!=ft&&(et.data=ft)}et!=xe&&(X&&Te.delete(et),!Ve||X?(z.insertBefore(et,xe),X&&xe!=J&&Te.add(xe)):Ve==J?z.insertBefore(et,J):(z.replaceChild(et,Ve),xe=et)),Ee!=null&&(re=re||new Map,re.set(Ee,et))}),xe=xe==J?J:xe.nextSibling,w&&xe!=J)for(;xe!=J;){const de=xe;xe=xe.nextSibling,de.remove()}return Te&&Te.forEach(de=>de.remove()),A.keyes=re,A}function Db(v,w,z,E,L){for(const F in w)!(F in z)&&__(v,F,w[F],null,L,E);for(const F in z)__(v,F,w[F],z[F],L,E)}function __(v,w,z,E,L,F){if(w=w=="class"&&!L?"className":w,z=z??null,E=E??null,w in v&&Tb[w]&&(z=v[w]),!(E===z||Eb[w]||w[0]=="_"))if(w[0]=="o"&&w[1]=="n"&&(Xl(E)||Xl(z)))Ib(v,w.slice(2),E,F);else if(w=="ref")E&&(Xl(E)?E(v):E.current=v);else if(w=="style"){const{style:A}=v;z=z||"",E=E||"";const c=up(z),J=up(E);if(c)for(const X in z)if(J)!(X in E)&&y_(A,X,null);else break;if(J)for(const X in E){const re=E[X];c&&z[X]===re||y_(A,X,re)}else A.cssText=E}else{const A=w[0]=="$"?w.slice(1):w;A===w&&(!L&&!Mb[w]&&w in v||Xl(E)||Xl(z))?v[w]=E??"":E==null?v.removeAttribute(A):v.setAttribute(A,up(E)?JSON.stringify(E):E)}}function Ib(v,w,z,E){if(E.handleEvent||(E.handleEvent=L=>E[L.type].call(v,L)),z){if(!E[w]){const L=z.capture||z.once||z.passive?Object.assign({},z):null;v.addEventListener(w,E,L)}E[w]=z}else E[w]&&(v.removeEventListener(w,E),delete E[w])}function y_(v,w,z){let E="setProperty";z==null&&(E="removeProperty",z=null),~w.indexOf("-")?v[E](w,z):v[w]=z}const v_={};function Cm(v,...w){const z=(v.raw||v).reduce((E,L,F)=>E+L+(w[F]||""),"");return v_[z]=v_[z]||kb(z)}function kb(v){if(zy.sheet){const w=new CSSStyleSheet;return w.replaceSync(v),w}else{const w=document.createElement("style");return w.textContent=v,w}}const Lb=Ry("host",{style:"display: contents"}),ig=Zd("atomico/context"),Ob=(v,w)=>{const z=Tp();Sb(()=>Sy(z.current,"ConnectContext",E=>{v===E.detail.id&&(E.stopPropagation(),E.detail.connect(w))}),[v])},Bb=v=>{const w=Ou("ConnectContext",{bubbles:!0,composed:!0}),z=()=>{let F;return w({id:v,connect(A){F=A}}),F},[E,L]=zg(z);return mp(()=>{E||(v[ig]||(v[ig]=customElements.whenDefined(new v().localName)),v[ig].then(()=>L(z)))},[v]),E},Fb=v=>{const w=Bb(v),z=xy();return mp(()=>{if(w)return Sy(w,"UpdatedValue",z)},[w]),(w||v).value},Nb=v=>{const w=Mp(()=>(Ob(w,Tp().current),Lb),{props:{value:{type:Object,event:{type:"UpdatedValue"},value:()=>v}}});return w.value=v,w},kn=(v,w,z)=>(w==null?w={key:z}:w.key=z,Ry(v,w)),dp=kn,Iy=Cm`*,*:before,*:after{box-sizing:border-box}button{padding:0;touch-action:manipulation;cursor:pointer;user-select:none}`,ky=Cm`.vh{position:absolute;transform:scale(0)}`;function Rg(){const v=new Date;return new Pr(v.getFullYear(),v.getMonth()+1,v.getDate())}function Dg(v,w=0){const z=al(v),E=z.getUTCDay(),L=(E<w?7:0)+E-w;return z.setUTCDate(z.getUTCDate()-L),Pr.from(z)}function Ly(v,w=0){return Dg(v,w).add({days:6})}function Oy(v){return Pr.from(new Date(Date.UTC(v.year,v.month,0)))}function Am(v,w,z){return w&&Pr.compare(v,w)<0?w:z&&Pr.compare(v,z)>0?z:v}const jb={days:1};function Ub(v,w=0){let z=Dg(v.toPlainDate(),w);const E=Ly(Oy(v),w),L=[];for(;Pr.compare(z,E)<0;){const F=[];for(let A=0;A<7;A++)F.push(z),z=z.add(jb);L.push(F)}return L}function al(v){return new Date(Date.UTC(v.year,v.month-1,v.day??1))}const Vb=/^(\d{4})-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[0-1])$/,ng=(v,w)=>v.toString().padStart(w,"0");class Pr{constructor(w,z,E){this.year=w,this.month=z,this.day=E}add(w){const z=al(this);if("days"in w)return z.setUTCDate(this.day+w.days),Pr.from(z);let{year:E,month:L}=this;"months"in w?(L=this.month+w.months,z.setUTCMonth(L-1)):(E=this.year+w.years,z.setUTCFullYear(E));const F=Pr.from(al({year:E,month:L,day:1}));return Am(Pr.from(z),F,Oy(F))}toString(){return`${ng(this.year,4)}-${ng(this.month,2)}-${ng(this.day,2)}`}toPlainYearMonth(){return new zm(this.year,this.month)}equals(w){return Pr.compare(this,w)===0}static compare(w,z){return w.year<z.year?-1:w.year>z.year?1:w.month<z.month?-1:w.month>z.month?1:w.day<z.day?-1:w.day>z.day?1:0}static from(w){if(typeof w=="string"){const z=w.match(Vb);if(!z)throw new TypeError(w);const[,E,L,F]=z;return new Pr(parseInt(E,10),parseInt(L,10),parseInt(F,10))}return new Pr(w.getUTCFullYear(),w.getUTCMonth()+1,w.getUTCDate())}}class zm{constructor(w,z){this.year=w,this.month=z}add(w){const z=al(this),E=(w.months??0)+(w.years??0)*12;return z.setUTCMonth(z.getUTCMonth()+E),new zm(z.getUTCFullYear(),z.getUTCMonth()+1)}equals(w){return this.year===w.year&&this.month===w.month}toPlainDate(){return new Pr(this.year,this.month,1)}}function ym(v,w){if(w)try{return v.from(w)}catch{}}function Bu(v){const[w,z]=Pg(v);return[Uc(()=>ym(Pr,w),[w]),E=>z(E==null?void 0:E.toString())]}function Gb(v){const[w="",z]=Pg(v);return[Uc(()=>{const[E,L]=w.split("/"),F=ym(Pr,E),A=ym(Pr,L);return F&&A?[F,A]:[]},[w]),E=>z(`${E[0]}/${E[1]}`)]}function qb(v){const[w="",z]=Pg(v);return[Uc(()=>{const E=[];for(const L of w.trim().split(/\s+/)){const F=ym(Pr,L);F&&E.push(F)}return E},[w]),E=>z(E.join(" "))]}function gp(v,w){return Uc(()=>new Intl.DateTimeFormat(w,{timeZone:"UTC",...v}),[w,v])}function x_(v,w,z){const E=gp(v,z);return Uc(()=>{const L=[],F=new Date;for(var A=0;A<7;A++){const c=(F.getUTCDay()-w+7)%7;L[c]=E.format(F),F.setUTCDate(F.getUTCDate()+1)}return L},[w,E])}const b_=(v,w,z)=>Am(v,w,z)===v,w_=v=>v.target.matches(":dir(ltr)"),Zb={month:"long",day:"numeric"},$b={month:"long"},Hb={weekday:"long"},rg={bubbles:!0};function Xb({props:v,context:w}){const{offset:z}=v,{firstDayOfWeek:E,isDateDisallowed:L,min:F,max:A,today:c,page:J,locale:X,focusedDate:re,formatWeekday:Te}=w,xe=c??Rg(),de=x_(Hb,E,X),Ee=Uc(()=>({weekday:Te}),[Te]),We=x_(Ee,E,X),Ve=gp(Zb,X),et=gp($b,X),ft=Uc(()=>J.start.add({months:z}),[J,z]),Tt=Uc(()=>Ub(ft,E),[ft,E]),Ot=Ou("focusday",rg),pt=Ou("selectday",rg),Ut=Ou("hoverday",rg);function oi(Jt){Ot(Am(Jt,F,A))}function Di(Jt){let wi;switch(Jt.key){case"ArrowRight":wi=re.add({days:w_(Jt)?1:-1});break;case"ArrowLeft":wi=re.add({days:w_(Jt)?-1:1});break;case"ArrowDown":wi=re.add({days:7});break;case"ArrowUp":wi=re.add({days:-7});break;case"PageUp":wi=re.add(Jt.shiftKey?{years:-1}:{months:-1});break;case"PageDown":wi=re.add(Jt.shiftKey?{years:1}:{months:1});break;case"Home":wi=Dg(re,E);break;case"End":wi=Ly(re,E);break;default:return}oi(wi),Jt.preventDefault()}function Mi(Jt){var mi,be;const wi=ft.equals(Jt);if(!w.showOutsideDays&&!wi)return;const en=Jt.equals(re),bn=Jt.equals(xe),Yn=al(Jt),Ei=L==null?void 0:L(Yn),Ke=!b_(Jt,F,A);let yt="",It;if(w.type==="range"){const[Qe,lt]=w.value,gt=Qe==null?void 0:Qe.equals(Jt),Ct=lt==null?void 0:lt.equals(Jt);It=Qe&&lt&&b_(Jt,Qe,lt),yt=`${gt?"range-start":""} ${Ct?"range-end":""} ${It&&!gt&&!Ct?"range-inner":""}`}else w.type==="multi"?It=w.value.some(Qe=>Qe.equals(Jt)):It=(mi=w.value)==null?void 0:mi.equals(Jt);return{part:`${`button day day-${Yn.getDay()} ${wi?It?"selected":"":"outside"} ${Ei?"disallowed":""} ${bn?"today":""} ${((be=w.getDayParts)==null?void 0:be.call(w,Yn))??""}`} ${yt}`,tabindex:wi&&en?0:-1,disabled:Ke,"aria-disabled":Ei?"true":void 0,"aria-pressed":wi&&It,"aria-current":bn?"date":void 0,"aria-label":Ve.format(Yn),onkeydown:Di,onclick(){Ei||pt(Jt),oi(Jt)},onmouseover(){!Ei&&!Ke&&Ut(Jt)}}}return{weeks:Tt,yearMonth:ft,daysLong:de,daysVisible:We,formatter:et,getDayProps:Mi}}const ag=Rg(),Ig=Nb({type:"date",firstDayOfWeek:1,focusedDate:ag,page:{start:ag.toPlainYearMonth(),end:ag.toPlainYearMonth()}});customElements.define("calendar-ctx",Ig);const Yb=(v,w)=>(w+v)%7,Kb=Mp(v=>{const w=Fb(Ig),z=lb(),E=Xb({props:v,context:w});function L(){var F;(F=z.current.querySelector("button[tabindex='0']"))==null||F.focus()}return dp("host",{shadowDom:!0,focus:L,children:[kn("div",{id:"h",part:"heading",children:E.formatter.format(al(E.yearMonth))}),dp("table",{ref:z,"aria-labelledby":"h",part:"table",children:[kn("thead",{children:kn("tr",{part:"tr head",children:E.daysLong.map((F,A)=>dp("th",{part:`th day day-${Yb(w.firstDayOfWeek,A)}`,scope:"col",children:[kn("span",{class:"vh",children:F}),kn("span",{"aria-hidden":"true",children:E.daysVisible[A]})]}))})}),kn("tbody",{children:E.weeks.map((F,A)=>kn("tr",{part:"tr week",children:F.map((c,J)=>{const X=E.getDayProps(c);return kn("td",{part:"td",children:X&&kn("button",{...X,children:c.day})},J)})},A))})]})]})},{props:{offset:{type:Number,value:0}},styles:[Iy,ky,Cm`:host{--color-accent: black;--color-text-on-accent: white;display:flex;flex-direction:column;gap:.25rem;text-align:center;inline-size:fit-content}table{border-collapse:collapse;font-size:.875rem}th{font-weight:700;block-size:2.25rem}td{padding-inline:0}button{color:inherit;font-size:inherit;background:transparent;border:0;font-variant-numeric:tabular-nums;block-size:2.25rem;inline-size:2.25rem}button:hover:where(:not(:disabled,[aria-disabled])){background:#0000000d}button:is([aria-pressed=true],:focus-visible){background:var(--color-accent);color:var(--color-text-on-accent)}button:focus-visible{outline:1px solid var(--color-text-on-accent);outline-offset:-2px}button:disabled,:host::part(outside),:host::part(disallowed){cursor:default;opacity:.5}`]});customElements.define("calendar-month",Kb);function S_(v){return kn("button",{part:`button ${v.name} ${v.onclick?"":"disabled"}`,onclick:v.onclick,"aria-disabled":v.onclick?null:"true",children:kn("slot",{name:v.name,children:v.children})})}function kg(v){const w=al(v.page.start),z=al(v.page.end);return dp("div",{role:"group","aria-labelledby":"h",part:"container",children:[kn("div",{id:"h",class:"vh","aria-live":"polite","aria-atomic":"true",children:v.formatVerbose.formatRange(w,z)}),dp("div",{part:"header",children:[kn(S_,{name:"previous",onclick:v.previous,children:"Previous"}),kn("slot",{part:"heading",name:"heading",children:kn("div",{"aria-hidden":"true",children:v.format.formatRange(w,z)})}),kn(S_,{name:"next",onclick:v.next,children:"Next"})]}),kn(Ig,{value:v,onselectday:v.onSelect,onfocusday:v.onFocus,onhoverday:v.onHover,children:kn("slot",{})})]})}const Lg={value:{type:String,value:""},min:{type:String,value:""},max:{type:String,value:""},today:{type:String,value:""},isDateDisallowed:{type:Function,value:v=>!1},formatWeekday:{type:String,value:()=>"narrow"},getDayParts:{type:Function,value:v=>""},firstDayOfWeek:{type:Number,value:()=>1},showOutsideDays:{type:Boolean,value:!1},locale:{type:String,value:()=>{}},months:{type:Number,value:1},focusedDate:{type:String,value:()=>{}},pageBy:{type:String,value:()=>"months"}},Og=[Iy,ky,Cm`:host{display:block;inline-size:fit-content}[role=group]{display:flex;flex-direction:column;gap:1em}:host::part(header){display:flex;align-items:center;justify-content:space-between}:host::part(heading){font-weight:700;font-size:1.25em}button{display:flex;align-items:center;justify-content:center}button[aria-disabled]{cursor:default;opacity:.5}`],Wb={year:"numeric"},Qb={year:"numeric",month:"long"};function sg(v,w){return(w.year-v.year)*12+w.month-v.month}const T_=(v,w)=>(v=w===12?new zm(v.year,1):v,{start:v,end:v.add({months:w-1})});function Jb({pageBy:v,focusedDate:w,months:z,max:E,min:L,goto:F}){const A=v==="single"?1:z,[c,J]=zg(()=>T_(w.toPlainYearMonth(),z)),X=Te=>J(T_(c.start.add({months:Te}),z)),re=Te=>{const xe=sg(c.start,Te.toPlainYearMonth());return xe>=0&&xe<z};return mp(()=>{if(re(w))return;const Te=sg(w.toPlainYearMonth(),c.start);F(w.add({months:Te}))},[c.start]),mp(()=>{if(re(w))return;const Te=sg(c.start,w.toPlainYearMonth());X(Te===-1?-A:Te===z?A:Math.floor(Te/z)*z)},[w,A,z]),{page:c,previous:!L||!re(L)?()=>X(-A):void 0,next:!E||!re(E)?()=>X(A):void 0}}function Bg({months:v,pageBy:w,locale:z,focusedDate:E,setFocusedDate:L}){const[F]=Bu("min"),[A]=Bu("max"),[c]=Bu("today"),J=Ou("focusday"),X=Ou("change"),re=Uc(()=>Am(E??c??Rg(),F,A),[E,c,F,A]);function Te(et){L(et),J(al(et))}const{next:xe,previous:de,page:Ee}=Jb({pageBy:w,focusedDate:re,months:v,min:F,max:A,goto:Te}),We=Tp();function Ve(et){const ft=(et==null?void 0:et.target)??"day";ft==="day"?We.current.querySelectorAll("calendar-month").forEach(Tt=>Tt.focus(et)):We.current.shadowRoot.querySelector(`[part~='${ft}']`).focus(et)}return{format:gp(Wb,z),formatVerbose:gp(Qb,z),page:Ee,focusedDate:re,dispatch:X,onFocus(et){et.stopPropagation(),Te(et.detail),setTimeout(Ve)},min:F,max:A,today:c,next:xe,previous:de,focus:Ve}}const e1=Mp(v=>{const[w,z]=Bu("value"),[E=w,L]=Bu("focusedDate"),F=Bg({...v,focusedDate:E,setFocusedDate:L});function A(c){z(c.detail),F.dispatch()}return kn("host",{shadowDom:!0,focus:F.focus,children:kn(kg,{...v,...F,type:"date",value:w,onSelect:A})})},{props:Lg,styles:Og});customElements.define("calendar-date",e1);const M_=(v,w)=>Pr.compare(v,w)<0?[v,w]:[w,v],t1=Mp(v=>{const[w,z]=Gb("value"),[E=w[0],L]=Bu("focusedDate"),F=Bg({...v,focusedDate:E,setFocusedDate:L}),A=Ou("rangestart"),c=Ou("rangeend"),[J,X]=Bu("tentative"),[re,Te]=zg();mp(()=>Te(void 0),[J]);function xe(Ve){F.onFocus(Ve),de(Ve)}function de(Ve){Ve.stopPropagation(),J&&Te(Ve.detail)}function Ee(Ve){const et=Ve.detail;Ve.stopPropagation(),J?(z(M_(J,et)),X(void 0),c(al(et)),F.dispatch()):(X(et),A(al(et)))}const We=J?M_(J,re??J):w;return kn("host",{shadowDom:!0,focus:F.focus,children:kn(kg,{...v,...F,type:"range",value:We,onFocus:xe,onHover:de,onSelect:Ee})})},{props:{...Lg,tentative:{type:String,value:""}},styles:Og});customElements.define("calendar-range",t1);const i1=Mp(v=>{const[w,z]=qb("value"),[E=w[0],L]=Bu("focusedDate"),F=Bg({...v,focusedDate:E,setFocusedDate:L});function A(c){const J=[...w],X=w.findIndex(re=>re.equals(c.detail));X<0?J.push(c.detail):J.splice(X,1),z(J),F.dispatch()}return kn("host",{shadowDom:!0,focus:F.focus,children:kn(kg,{...v,...F,type:"multi",value:w,onSelect:A})})},{props:Lg,styles:Og});customElements.define("calendar-multi",i1);const n1=()=>{const[v,w]=Ye.useState("Pick a date"),[z,E]=Ye.useState(!1),L=Ye.useRef(null);Ye.useEffect(()=>{const A=document.querySelector("calendar-date.cally");A&&A.addEventListener("change",c=>{c.detail&&c.detail.value&&(w(c.detail.value),E(!1))})},[]);const F=()=>{E(!z)};return Et.jsxs("div",{className:"mt-2 flex justify-center",children:[Et.jsx("button",{onClick:F,className:"input input-border",id:"cally1",style:{anchorName:"--cally1"},children:v}),z&&Et.jsx("div",{id:"cally-popover1",className:"dropdown bg-base-100 rounded-box shadow-lg",style:{positionAnchor:"--cally1"},children:Et.jsxs("calendar-date",{ref:L,class:"cally",children:[Et.jsx("svg",{"aria-label":"Previous",className:"fill-current size-4",slot:"previous",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:Et.jsx("path",{d:"M15.75 19.5 8.25 12l7.5-7.5"})}),Et.jsx("svg",{"aria-label":"Next",className:"fill-current size-4",slot:"next",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:Et.jsx("path",{d:"m8.25 4.5 7.5 7.5-7.5 7.5"})}),Et.jsx("calendar-month",{})]})})]})},r1=()=>{const[v,w]=Ye.useState(""),[z,E]=Ye.useState(""),[L,F]=Ye.useState(null),[A,c]=Ye.useState(null),[J,X]=Ye.useState(""),[re,Te]=Ye.useState(""),[xe,de]=Ye.useState(!1),Ee=pt=>{F(pt)},We=pt=>{c(pt)},Ve=pt=>{w(pt.target.value)},et=pt=>{E(pt.target.value)},ft=pt=>{pt.key==="Enter"&&(console.log(`Start location: Enter key pressed with value: ${v}`),X(v))},Tt=pt=>{pt.key==="Enter"&&(console.log(`End location: Enter key pressed with value: ${z}`),Te(z))},Ot=()=>{de(!xe)};return Et.jsxs("div",{className:"h-screen grid grid-cols-3 grid-rows-6 gap-4 p-4",children:[Et.jsxs("div",{className:"bg-base-200 p-4 rounded-box col-span-1",children:["Ratings:",Et.jsx(rb,{itemId:"origin-item-id"})]}),Et.jsxs("div",{className:"bg-base-200 p-4 rounded-box col-span-1 flex justify-between",children:[Et.jsx("div",{children:"Setup"}),Et.jsx("div",{children:Et.jsxs("button",{onClick:null,children:[Et.jsx("img",{src:"https://www.paypalobjects.com/webstatic/en_US/i/buttons/checkout-logo-large.png",alt:"PayPal"})," "]})})]}),Et.jsxs("div",{className:"bg-base-200 p-4 rounded-box row-span-2",children:[Et.jsxs("div",{className:"mb-2 flex justify-between items-center",children:[Et.jsx("span",{className:"mr-2",children:xe?"Moving Object":"Stagnant Space"}),Et.jsx("input",{type:"checkbox",className:"toggle border-2 border-blue-400 checked:border-blue-400",checked:xe,onChange:Ot})]}),"Capacity:"]}),Et.jsx("div",{className:"bg-base-200 p-0 rounded-box col-span-2 row-span-4 overflow-hidden",style:{gridColumn:"1 / 3",gridRow:"2 / 6"},children:Et.jsx(Z_,{start:L,end:A})}),Et.jsxs("div",{className:"bg-base-200 p-4 rounded-box",children:[Et.jsx("label",{className:"block text-sm mb-2",children:"Location:"}),Et.jsx("input",{type:"text",value:v,onChange:Ve,onKeyDown:ft,placeholder:"Enter location",className:"input input-bordered w-full"}),Et.jsx(n_,{address:J,onGeocode:Ee})]}),Et.jsxs("div",{className:"bg-base-200 p-4 rounded-box",children:[Et.jsx("label",{className:"block text-sm mb-2",children:"Destination:"}),Et.jsx("input",{type:"text",value:z,onChange:et,onKeyDown:Tt,placeholder:"Enter destination",className:"input input-bordered w-full"}),Et.jsx(n_,{address:re,onGeocode:We})]}),Et.jsxs("div",{className:"bg-base-200 p-4 rounded-box",children:[Et.jsx("div",{children:"Date / Time of Listing:"}),Et.jsx(n1,{})]}),Et.jsx("div",{className:"bg-base-200 p-4 rounded-box",children:"Price: "}),Et.jsx("div",{className:"bg-base-200 p-4 rounded-box items-center gap-2",children:"Notes:"}),Et.jsx("div",{className:"bg-base-200 p-4 rounded-box",children:"Go-Online:"})]})},a1=()=>Et.jsxs("div",{className:"h-screen grid grid-cols-3 grid-rows-6 gap-4 p-4",children:[Et.jsx("div",{className:"bg-base-200 p-4 rounded-box col-span-1",children:"Rating:"}),Et.jsx("div",{className:"bg-base-200 p-4 rounded-box col-span-1",children:"Account:"}),Et.jsx("div",{className:"bg-base-200 p-4 rounded-box row-span-2",children:"Capacity:"}),Et.jsx("div",{className:"bg-base-200 p-0 rounded-box col-span-2 row-span-4 overflow-hidden",style:{gridColumn:"1 / 3",gridRow:"2 / 6"},children:Et.jsx(Z_,{})}),Et.jsx("div",{className:"bg-base-200 p-4 rounded-box",children:"Location:"}),Et.jsx("div",{className:"bg-base-200 p-4 rounded-box",children:"Destination:"}),Et.jsx("div",{className:"bg-base-200 p-4 rounded-box",children:"Date / Time of travel:"}),Et.jsx("div",{className:"bg-base-200 p-4 rounded-box row-span-2",children:"Price: "}),Et.jsx("div",{className:"bg-base-200 p-4 rounded-box row-span-2",children:"Notes: "}),Et.jsx("div",{className:"bg-base-200 p-4 rounded-box row-span-2",children:"Go-Online:"})]});function s1(){return Et.jsx(l0,{children:Et.jsxs(Nv,{children:[Et.jsx(cp,{path:"/",element:Et.jsx(Navigate,{to:"/dash/origin",replace:!0})}),Et.jsx(cp,{path:"/login",element:Et.jsx(y0,{})}),Et.jsx(cp,{path:"/dash/origin",element:Et.jsx(r1,{})}),Et.jsx(cp,{path:"/dash/recipient",element:Et.jsx(a1,{})})]})})}Xy.createRoot(document.getElementById("root")).render(Et.jsx(Ye.StrictMode,{children:Et.jsx(s1,{})}));
